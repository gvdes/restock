import{u as O,r as u,c as D,a8 as re,o as c,aE as I,d as a,w as l,f as n,t as r,b as p,aG as M,e as S,Q as R,aD as k,i as w,h as _,aF as T,au as F,R as ce,aJ as ue,x as ve,a as X,g as pe}from"./index.08f3e598.js";import{u as Z,x as h,q as j,t as N,y as G,z as P,Q as ee,a as ae,s as me,A as K,B as fe,w as z,v as A,R as Y,b as ge,c as _e,d as be,e as ye,f as ke,g as he}from"./QCard.7efc9022.js";import{d as $}from"./dayjs.min.16be2667.js";import{Q as xe,a as we,b as H,c as Ve,d as J,e as Ce,u as te}from"./browser.069ec7a9.js";import"./axios.05577114.js";import{Q as W,C as Qe}from"./ClosePopup.945bad5f.js";const Se=n("div",{class:"text-overline text-grey-7"},"Sucursal",-1),De={class:"text-h6"},$e={class:"q-px-lg text-center"},Ee=n("div",{class:"text-overline text-grey-7"},"Folio",-1),Ie={class:"text-h6"},Pe={class:"text-right"},Ue=n("div",{class:"text-overline text-grey-7"},"Agente",-1),Ye={class:"text-h6"},qe={class:"text--1"},Le={key:0},Me=n("div",null,"Salida",-1),je={class:"text-bold text-indigo-10"},Be=n("div",null,"Entrada",-1),ze={class:"text-bold text-orange-10"},Re={class:"full-width row items-center"},Ae={class:"col text-dark"},Oe={class:"text-h6"},Te={class:"text-bold"},Fe={key:1,class:"text-center q-pa-lg text-h6 text-grey-7"},Ne=n("canvas",{id:"qrcode"},null,-1),Ge={class:"text--2"},Ke=n("div",{class:"q-ml-md"},[n("div",{class:"text-h6"},"Emitir salida?"),n("div",null,"La salida emitira la factura correspondiente en Factusol.")],-1),He={__name:"OrderViewer",props:{head:{type:Object,default:{}}},emits:["loaded","loading"],setup(B,{emit:b}){const U=B,m=Z();O();const o=u(U.head),Q=u(!0),x=u([]),V=u("basket"),t=u(null),s=u([]),v=u(!1),C=u({state:!1}),f=u({state:!1,key:null}),y=u([]),g=u({columns:[{name:"id",label:"ID",field:"id",align:"left",coldesc:"Identificador del producto (MySQL)"},{name:"code",label:"Codigo",field:"code",align:"left",coldesc:"Codigo principal del producto"},{name:"assocs",label:"Asociados",field:e=>e.variants.length?e.variants.map(i=>i.barcode).join(", "):null,align:"left",coldesc:"Codigos relacionados al codigo principal"},{name:"bcode",label:"Codigo de Barras",field:"barcode",align:"center",coldesc:"Codigo de barras principal"},{name:"locs",label:"Ubicacion",field:e=>e.locations.length?e.locations.map(i=>i.path).join(", "):"--",align:"left",coldesc:"Ubicaciones en almacen general"},{name:"ipack",label:"PxC",field:e=>typeof e.pivot.ipack=="number"?e.pivot.ipack:e.pieces,align:"center",coldesc:"Unidades x Embalaje"},{name:"request",label:"Solicitud",field:e=>e.pivot.amount,align:"center",coldesc:"Embalaje solicitado"},{name:"uspply",label:"Unidad",field:e=>e.units.id==3?"Cajas":"Piezas",align:"left",coldesc:"Unidad de embalaje del producto"},{name:"delivery",label:"Salida (conteo)",field:e=>e.pivot.toDelivered,align:"center",coldesc:"Embalaje surtido",sortable:!0},{name:"reqinpzs",label:"Piezas",field:e=>e.pivot._supply_by==3?(typeof e.pivot.ipack=="number"?e.pivot.ipack:e.pieces)*(typeof e.pivot.ipack=="number"?e.pivot.toDelivered:e.pivot.amount):typeof e.pivot.ipack=="number"?e.pivot.toDelivered:e.pivot.amount,align:"center",coldesc:"Unidades totales en embalaje"},{name:"checkout",label:"Checkout",field:e=>e.pivot.checkout?"OK":"--",align:"center",classes:e=>e.pivot.checkout?"text-positive":"",sortable:!0,coldesc:"Revision del Administrador"},{name:"received",label:"Entrada (conteo)",field:e=>e.pivot.toReceived,align:"center",coldesc:"Embalaje recibido"},{name:"descr",label:"Descripcion",field:"description",align:"left"},{name:"section",label:"Seccion",field:"section",align:"left"},{name:"family",label:"Familia",field:"family",align:"left"},{name:"category",label:"Categoria",field:"category",align:"left"}],filter:"",pagination:{sortBy:"locs",descending:!1,rowsPerPage:20}}),q=D(()=>s.value.reduce((e,i)=>e+(i.pivot._supply_by==3?i.pivot.amount*i.pieces:i.pivot.amount),0));D(()=>t.value&&(t.value.id==2||t.value.id==6));const L=D(()=>x.value.find(e=>e.id==t.value.id).pivot),E=async()=>{b("loading"),Q.value=!0;let e=await Y.order(o.value.id);console.log(e.data),s.value=e.data.products,x.value=e.data.log.map(i=>(i.pivot.details=JSON.parse(i.pivot.details),i)),t.value=e.data.status,f.value.key=e.data.entry_key,Q.value=!1,b("loaded")},le=async()=>{b("loading"),v.value=!0;let e=3,i={id:o.value.id,state:e};const d=await Y.nextState(i);d.status==200?(v.value=!1,m.notify({message:`Surtido iniciado para el pedido  ${o.value.id}`,icon:"done",position:"center",color:"teal"}),E()):alert(`Error ${d.status}: ${d.data}`),b("loaded")},oe=async()=>{m.loading.show({message:"Generando, espera..."}),C.value.state=!1;const e=await Y.genInvoice(o.value.id);console.log(e.data),e.status==200?e.data.invoice?E():alert("Error 500: Ocurrio un error inesperado :("):alert(`Error ${e.status}: ${e.data}`),m.loading.hide()},se=async()=>{let e=`http://192.168.10.15:2200/#/checkin/${o.value.id}?key=${f.value.key}`;f.value.state=!0,ve(()=>Ce.toCanvas(document.getElementById("qrcode"),e))},ie=async()=>{const e=await Y.printKey(o.value.id);console.log(e)};return re(()=>y.value=g.value.columns.map(e=>e.name)),E(),(e,i)=>(c(),I(M,null,[a(z,{class:"full-width"},{default:l(()=>[a(h,{class:"row justify-between"},{default:l(()=>[n("div",null,[Se,n("div",De,r(o.value.from.alias),1)]),n("div",$e,[Ee,n("div",Ie,r(o.value.id),1)]),n("div",Pe,[Ue,n("div",Ye,r(o.value.created_by.nick),1)])]),_:1}),a(j),Q.value?(c(),p(h,{key:0,class:"text-center"},{default:l(()=>[a(xe,{size:"50px",color:"purple"})]),_:1})):(c(),I(M,{key:1},[a(h,{horizontal:"",class:"row"},{default:l(()=>[a(h,{class:"col"},{default:l(()=>[n("div",null,r(t.value.name),1),n("div",qe,r(S($)(S(L).updated_at).format("YYYY-MM-DD hh:mm A")),1),o.value.notes?(c(),I("div",Le,[a(R,{name:"info",color:"pink-5",size:"20px"}),k(r(o.value.notes),1)])):w("",!0)]),_:1}),t.value&&t.value.id>6?(c(),p(h,{key:0},{default:l(()=>[Me,n("div",je,r(o.value.invoice),1)]),_:1})):w("",!0),t.value&&t.value.id>9?(c(),p(h,{key:1},{default:l(()=>[Be,n("div",ze,r(o.value.invoice),1)]),_:1})):w("",!0),t.value&&t.value.id>1?(c(),p(W,{key:2,class:"col",align:"right"},{default:l(()=>[t.value&&t.value.id>6?(c(),p(_,{key:0,color:"pink-6",icon:"qr_code",dense:"",onClick:se})):w("",!0),t.value&&t.value.id>2?(c(),p(_,{key:1,color:"primary",icon:"print",dense:""})):w("",!0),t.value&&t.value.id==2?(c(),p(_,{key:2,color:"positive",icon:"start",dense:"",label:"Iniciar Surtido",onClick:le})):w("",!0),t.value&&t.value.id==6?(c(),p(_,{key:3,color:"pink",icon:"start",dense:"",label:"Emitir Salida",onClick:i[0]||(i[0]=d=>C.value.state=!0)})):w("",!0)]),_:1})):w("",!0)]),_:1}),a(j),a(we,{modelValue:V.value,"onUpdate:modelValue":i[1]||(i[1]=d=>V.value=d),class:"text-pink-5",dense:"","no-caps":""},{default:l(()=>[a(H,{name:"log",label:"Log"}),a(H,{name:"basket",label:"Productos"})]),_:1},8,["modelValue"]),a(Ve,{modelValue:V.value,"onUpdate:modelValue":i[4]||(i[4]=d=>V.value=d),animated:""},{default:l(()=>[a(J,{name:"log"},{default:l(()=>[a(N,null,{default:l(()=>[(c(!0),I(M,null,T(x.value,d=>(c(),p(G,{key:d.id},{default:l(()=>[a(P,{avatar:""},{default:l(()=>[k(r(d.id),1)]),_:2},1024),a(P,null,{default:l(()=>[k(r(d.name),1)]),_:2},1024),a(P,null,{default:l(()=>[k(r(d.pivot.details.responsable),1)]),_:2},1024),a(P,null,{default:l(()=>[k("de "+r(S($)(d.pivot.created_at).format("h:mm a"))+" a "+r(S($)(d.pivot.updated_at).format("h:mm a")),1)]),_:2},1024)]),_:2},1024))),128))]),_:1})]),_:1}),a(J,{name:"basket"},{default:l(()=>[s.value.length?(c(),p(ee,{key:0,"row-key":"id",flat:"",rows:s.value,columns:g.value.columns,pagination:g.value.pagination,filter:g.value.filter,"visible-columns":y.value},{top:l(()=>[n("div",Re,[n("div",Ae,[n("span",Oe,[a(_,{color:"pink-5",icon:"sync",onClick:E,round:"",dense:"",flat:""}),k(" Productos: "+r(s.value.length),1)]),k(", "),n("span",Te,"Piezas: "+r(S(q)),1)]),a(ae,{dense:"",modelValue:g.value.filter,"onUpdate:modelValue":i[2]||(i[2]=d=>g.value.filter=d),placeholder:"Buscar","input-class":"text-uppercase",color:"pink-5"},{append:l(()=>[a(R,{name:"search"})]),_:1},8,["modelValue"]),a(_,{color:"secondary",icon:"fas fa-eye","no-caps":""},{default:l(()=>[a(me,{style:{"min-width":"200px"}},{default:l(()=>[a(N,null,{default:l(()=>[(c(!0),I(M,null,T(g.value.columns,(d,ne)=>F((c(),p(G,{tag:"label",key:ne},{default:l(()=>[a(P,null,{default:l(()=>[a(K,null,{default:l(()=>[k(r(d.label),1)]),_:2},1024),a(K,{caption:""},{default:l(()=>[k(r(d.coldesc),1)]),_:2},1024)]),_:2},1024),a(P,{side:"",top:""},{default:l(()=>[a(fe,{color:"pink-5",modelValue:y.value,"onUpdate:modelValue":i[3]||(i[3]=de=>y.value=de),val:d.name},null,8,["modelValue","val"])]),_:2},1024)]),_:2},1024)),[[ce]])),128))]),_:1})]),_:1})]),_:1})])]),_:1},8,["rows","columns","pagination","filter","visible-columns"])):(c(),I("div",Fe,"Nada por aqui"))]),_:1})]),_:1},8,["modelValue"])],64))]),_:1}),a(A,{modelValue:f.value.state,"onUpdate:modelValue":i[5]||(i[5]=d=>f.value.state=d)},{default:l(()=>[a(z,null,{default:l(()=>[a(h,{class:"text-h6 text-center"},{default:l(()=>[k(r(o.value.id)+" - "+r(o.value.from.alias),1)]),_:1}),a(j),a(h,{class:"text-center"},{default:l(()=>[Ne,n("div",Ge,r(f.value.key),1)]),_:1}),a(j),a(h,{align:"center"},{default:l(()=>[a(_,{color:"primary",icon:"print",onClick:ie})]),_:1})]),_:1})]),_:1},8,["modelValue"]),a(A,{modelValue:C.value.state,"onUpdate:modelValue":i[6]||(i[6]=d=>C.value.state=d)},{default:l(()=>[a(z,null,{default:l(()=>[a(h,{class:"row items-start"},{default:l(()=>[a(ue,{icon:"warning",color:"orange-14","text-color":"white"}),Ke]),_:1}),a(W,{align:"right"},{default:l(()=>[F(a(_,{flat:"",label:"Cancelar",color:"primary","no-caps":""},null,512),[[Qe]]),a(_,{flat:"",label:"Continuar",color:"primary",onClick:oe,"no-caps":""})]),_:1})]),_:1})]),_:1},8,["modelValue"])],64))}},Je={class:"full-width row items-center"},We={class:"col text-h6 text-dark"},Xe={__name:"AdminDashboard",setup(B){O(),X();const b=te(),U=["text-grey-5 text-bold","text-bold text-h6 text-red","text-indigo","4","5","text-bold text-pink-7","text-orange-8","8","text-primary","text-positive"],m=u({columns:[{name:"id",label:"Folio",field:"id",align:"center",sortable:!0},{name:"state",label:"Estado",field:t=>t.log.length==1?t.log[0].name:t.log[t.log.length-1].name,align:"left",sortable:!0,sort:(t,s,v,C)=>parseInt(v._status)-parseInt(C._status),classes:t=>U[t._status-1]},{name:"laststate",label:"Ultima actividad",field:t=>$(t.log.find(s=>s.id==t.status.id).pivot.updated_at).format("YYYY-MM-DD hh:mm A"),align:"left"},{name:"from",label:"Sucursal",field:t=>t.from.name.toUpperCase(),align:"left",sortable:!0},{name:"notes",label:"Notas",field:t=>t.notes,align:"left",classes:t=>t.notes?"text-orange text-bold":""},{name:"invoice",label:"Salida",field:t=>{var s;return(s=t.invoice)!=null?s:null},align:"center",classes:"text-bold"},{name:"entry",label:"Entrada",field:t=>{var s;return(s=t.invoice_received)!=null?s:null},align:"center",classes:"text-bold"}],filter:"",pagination:{sortBy:"desc",descending:!1,rowsPerPage:20}}),o=u({state:!1,head:null,block:!0}),Q=D(()=>b.ordersSize),x=D(()=>b.ordersdb),V=async(t,s,v)=>{o.value.head=s,o.value.state=!0};return(t,s)=>(c(),p(ge,{padding:"",class:"bg-grey-2"},{default:l(()=>[a(ee,{flat:"",bordered:"","row-key":"id",rows:S(x),columns:m.value.columns,filter:m.value.filter,pagination:m.value.pagination,onRowClick:V},{top:l(()=>[n("div",Je,[n("div",We,"Pedidos: "+r(S(Q)),1),a(ae,{dense:"",modelValue:m.value.filter,"onUpdate:modelValue":s[0]||(s[0]=v=>m.value.filter=v),"input-class":"text-uppercase",placeholder:"Buscar",color:"pink-5"},{append:l(()=>[a(R,{name:"search"})]),_:1},8,["modelValue"])])]),_:1},8,["rows","columns","filter","pagination"]),a(A,{"full-width":"",modelValue:o.value.state,"onUpdate:modelValue":s[3]||(s[3]=v=>o.value.state=v),persistent:o.value.block,"no-esc-dismiss":o.value.block,"no-backdrop-dismiss":o.value.block},{default:l(()=>[a(He,{head:o.value.head,onLoaded:s[1]||(s[1]=v=>o.value.block=!1),onLoading:s[2]||(s[2]=v=>o.value.block=!0)},null,8,["head"])]),_:1},8,["modelValue","persistent","no-esc-dismiss","no-backdrop-dismiss"])]),_:1}))}};const Ze=n("div",{class:"text-bold"},"Dashboard ",-1),ea={class:"row"},aa={class:"col row"},da={__name:"DashboardLyt",setup(B){const b=O(),U=X(),m=te(),o=Z(),Q=u([{id:0,alias:"Todas"},{id:1,alias:"CEDIS",_state:1},{id:2,alias:"SP1",_state:1}]),x=u([{id:"day",label:"Hoy"},{id:"week",label:"Semana"},{id:"month",label:"Mes"},{id:"C",label:"otra ...",disable:!0}]),V=u(null),t=u(null),s=u({from:$(Date.now()).startOf("day"),to:$(Date.now()).startOf("day")}),v=async()=>{var L;o.loading.show({message:"Cargado vista..."}),console.log("%cIniciando MainLayout...","font-size:2em;color:orange;");let f=(L=b.query.v)!=null?L:"day",y=x.value.findIndex(E=>E.id==f),g=y>=0?y:0;t.value=x.value[g],s.value.from=$(Date.now()).startOf(t.value.id);const q=await Y.index(t.value.id);console.log(q),m.fillOrders(q.orders),V.value=Q.value[0],console.log("%cMainLayout listo!!","font-size:2em;color:orange;"),o.loading.hide()},C=f=>U.push(`/dashboard?v=${f.id}`);return D(()=>s.value.from.format("YYYY/MM/DD")),D(()=>s.value.to.format("YYYY/MM/DD")),pe(()=>b.query,()=>{v()}),v(),document.title="Dashboard",(f,y)=>(c(),p(_e,{view:"lHh Lpr lFf"},{default:l(()=>[a(ke,{bordered:"",class:"transparent text-dark"},{default:l(()=>[a(be,{class:"row justify-between items-center"},{default:l(()=>[Ze,n("div",ea,[a(_,{color:"pink-5",round:"",unelevated:"",flat:"",icon:"sync",onClick:v}),n("div",aa,[a(ye,{class:"col",dense:"",filled:"",label:"Vista",modelValue:t.value,"onUpdate:modelValue":[y[0]||(y[0]=g=>t.value=g),C],options:x.value},null,8,["modelValue","options"]),t.value.id=="C"?(c(),p(_,{key:0,unelevated:"",color:"pink-5",icon:"fas fa-calendar-day",dense:""})):w("",!0)])])]),_:1})]),_:1}),a(he,null,{default:l(()=>[a(Xe)]),_:1})]),_:1}))}};export{da as default};
