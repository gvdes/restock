import{r as m,c as T,o as r,aF as w,f as o,d as e,w as t,h as y,aH as Y,i as O,e as z,aA as Z,b as q,aN as Te,Q as le,t as u,aE as x,R as Ve,u as xe,a7 as je,aG as te,aJ as he,x as Be,a as De,aO as Ne,aP as Ye,g as Me}from"./index.b7666210.js";import{u as de,t as N,b as se,y as ne,z as Q,A as ae,v as ue,w as ke,Q as ie,x as X,B as Se,a as Ge}from"./QPage.d4557b62.js";import{a as He,Q as Ke}from"./QToggle.d55df56b.js";import{Q as Je,a as We,b as Xe}from"./QLayout.c35dd3f5.js";import{d as ee}from"./dayjs.min.53a5c0af.js";import{b as P,Q as we,a as W,c as pe,R as F}from"./QCardActions.86fd2376.js";import{a as Ce,Q as Ze,b as et,c as fe,d as tt,e as _e,f as lt,u as at}from"./Restock.9abbee6d.js";import{Q as ge,a as be}from"./QTd.b82ed11b.js";import{Q as ot}from"./QTabs.7ad16374.js";import{C as ve}from"./ClosePopup.4c42ec17.js";import{A as oe}from"./AssistApi.82b98af9.js";import{b as st}from"./jspdf.plugin.autotable.9c34486a.js";import{p as $e}from"./pdfCreate.84d9115e.js";import{$sktRestock as K,usrSkt as nt}from"./socket.9951ace7.js";import"./rtl.16f92835.js";import"./axios.10c2b4ae.js";const it={class:"q-pa-sm bg-grey-2 text-bold row justify-between items-center",style:{"min-width":"250px"}},dt=o("div",null,"Impresion",-1),rt={key:0,class:"row justify-between items-center"},ct={class:"q-mt-sm q-pa-sm"},ut={key:0,class:"q-pa-sm"},pt={class:"text--3"},vt={class:"q-pa-sm text-right"},ye={__name:"PrinterSelect",props:{partition:{type:Boolean}},emits:["selected","selectedPartition"],setup(J,{emit:h}){const I=de(),f=Ce(),c=m(null),v=m(null),R=T(()=>f.printers),k=T(()=>c.value?c.value.printers:[]),i=()=>{I.localStorage.set("LUP",{wkp:c.value,printer:v.value}),h("selected",v.value)},$=()=>{I.localStorage.set("LUP",{wkp:c.value,printer:v.value}),h("selectedPartition",v.value)},V=I.localStorage.getItem("LUP");return V&&(c.value=V.wkp,v.value=V.printer),(B,C)=>(r(),w(Y,null,[o("div",it,[dt,c.value?(r(),w("div",rt,[e(Ze,{flat:""},{default:t(()=>[e(y,{flat:"",color:"positive",icon:"add",dense:""}),v.value?(r(),w(Y,{key:0},[e(y,{flat:"",color:"negative",icon:"delete",dense:""}),e(y,{flat:"",color:"orange",icon:"edit",dense:""})],64)):O("",!0)]),_:1})])):O("",!0)]),e(N),o("div",ct,[e(se,{modelValue:c.value,"onUpdate:modelValue":[C[0]||(C[0]=g=>c.value=g),C[1]||(C[1]=g=>v.value=null)],options:z(R),label:"Sucursal",filled:"","option-label":"alias","option-value":"id"},null,8,["modelValue","options"])]),c.value?(r(),w("div",ut,[e(se,{modelValue:v.value,"onUpdate:modelValue":C[2]||(C[2]=g=>v.value=g),options:z(k),label:"Impresora",filled:"","option-value":"id","option-label":"name"},{option:t(g=>[Z((r(),q(ne,Te({clickable:""},g.itemProps),{default:t(()=>[e(Q,{class:"text-center",side:""},{default:t(()=>[e(le,{color:"primary","text-color":"white",name:"print",size:"30px"}),o("span",pt,"ID:"+u(g.opt.id),1)]),_:2},1024),e(Q,null,{default:t(()=>[e(ae,null,{default:t(()=>[x(u(g.opt.name),1)]),_:2},1024),e(ae,{caption:"",lines:"2"},{default:t(()=>[x(u(g.opt.ip),1)]),_:2},1024)]),_:2},1024)]),_:2},1040)),[[Ve]])]),_:1},8,["modelValue","options"])])):O("",!0),o("div",vt,[c.value&&v.value&&!J.partition?(r(),q(y,{key:0,color:"primary",icon:"print",onClick:i})):O("",!0),c.value&&v.value&&J.partition?(r(),q(y,{key:1,color:"secondary",icon:"print",onClick:$})):O("",!0)])],64))}},mt=o("div",{class:"text-overline text-grey-7"},"Sucursal",-1),ft={class:"text-h6"},_t={class:"q-px-lg text-center"},gt=o("div",{class:"text-overline text-grey-7"},"Folio",-1),bt={class:"text-h6"},yt={class:"text-right"},ht=o("div",{class:"text-overline text-grey-7"},"Agente",-1),kt={class:"text-h6"},xt={class:"text-center"},wt=o("div",{class:"text-overline text-grey-7"},"Fecha",-1),Ct={class:"text-h6"},St={key:0,class:"text-center"},$t=o("div",{class:"text-overline text-grey-7 col"},"Notas",-1),Vt={class:"text-h6"},Dt={class:"text-center"},Et={class:"text-overline text-grey-7"},Pt={class:"text-h6"},It={class:"full-width row items-center"},qt={class:"col text-dark"},Qt={class:"text-h6"},Ut={class:"text-bold"},At={key:1,class:"text-center q-pa-lg text-h6 text-grey-7"},Ot={class:"q-pa-xs col-xs-12 col-sm-6 col-md-4"},Rt=o("br",null,null,-1),Lt=o("br",null,null,-1),Ft={class:"text-overline text-grey-7"},zt={key:0},Tt=o("div",null,"Salida",-1),jt=o("div",null,"Entrada",-1),Bt=[Tt,jt],Nt={key:1},Yt=o("div",null,"Traspaso",-1),Mt=[Yt],Gt=o("div",null,"Herramientas",-1),Ht={key:0},Kt={key:1},Jt={class:"row"},Wt={key:0,class:"col"},Xt={key:1,class:"col"},Zt={key:2,class:"col"},el=o("canvas",{id:"qrcode"},null,-1),tl={class:"text--2"},ll=o("div",{class:"q-ml-md"},[o("div",{class:"text-h6"},"Cambiar a En Camino?"),o("div",null,"Cambiara a estatus en camino")],-1),al=o("div",{class:"text-center text-h6"},"Surtidor",-1),ol={class:"text-center text-bold text-subtitle2 text-overline"},sl=o("div",{class:"q-ml-sm text-bold"},"Estas a punto de cancelar el pedido ",-1),nl={class:"q-ml-sm text-bold"},il={__name:"OrderViewer",props:{head:{type:Object,default:{}}},emits:["loaded","loading","fresh","chofiAssigned"],setup(J,{emit:h}){const I=J,f=de();xe();const c=m({opts:[],val:[],filter:[]}),v=m({opts:null,val:null,filter:null}),R=m(null),k=m(null),i=m(I.head),$=m(null),V=m(!0),B=m([]),C=m("supliers"),g=m(null),S=m([]),j=m(!1),L=m({state:!1}),G=m({state:!1,key:null}),M=m(null),d=m(!1),_=m({state:!1}),s=m(null),p=m([]),b=m({columns:[{name:"id",label:"ID",field:"id",align:"left",coldesc:"Identificador del producto (MySQL)"},{name:"code",label:"Codigo",field:"code",align:"left",coldesc:"Codigo principal del producto"},{name:"assocs",label:"Asociados",field:l=>l.variants.length?l.variants.map(a=>a.barcode).join(", "):null,align:"left",coldesc:"Codigos relacionados al codigo principal"},{name:"bcode",label:"Codigo de Barras",field:"barcode",align:"center",coldesc:"Codigo de barras principal"},{name:"locs",label:"Ubicacion",field:l=>l.locations.length?l.locations.map(a=>a.path).join(", "):"--",align:"left",coldesc:"Ubicaciones en almacen general"},{name:"stocks",label:"Stock (pzs)",field:l=>l.stocks.reduce((a,n)=>a+n.pivot.stock,0),sortable:!0,classes:l=>l.stocks.reduce((a,n)=>a+n.pivot.stock,0)<=0?"text-red text-bold":"text-bold text-primary",align:"center",coldesc:"Stock total en almacenes GENERALES (CEDIS+PAN)"},{name:"ipack",label:"PxC",field:l=>typeof l.pivot.ipack=="number"?l.pivot.ipack:l.pieces,align:"center",coldesc:"Unidades x Embalaje"},{name:"request",label:"Solicitud",field:l=>l.pivot.amount,align:"center",coldesc:"Embalaje solicitado"},{name:"uspply",label:"Unidad",field:l=>l.units.id==3?"Cajas":"Piezas",align:"left",coldesc:"Unidad de embalaje del producto"},{name:"delivery",label:"Salida (conteo)",field:l=>l.pivot.toDelivered,align:"center",coldesc:"Embalaje surtido",sortable:!0},{name:"reqinpzs",label:"Piezas",field:l=>l.pivot._supply_by==3?(typeof l.pivot.ipack=="number"?l.pivot.ipack:l.pieces)*(typeof l.pivot.ipack=="number"?l.pivot.toDelivered:l.pivot.amount):typeof l.pivot.ipack=="number"?l.pivot.toDelivered:l.pivot.amount,align:"center",coldesc:"Unidades totales en embalaje"},{name:"checkout",label:"Checkout",field:l=>l.pivot.checkout?"OK":"---",align:"center",classes:l=>l.pivot.checkout?"text-positive text-bold":"text-red",sortable:!0,coldesc:"Revision del Administrador"},{name:"received",label:"Entrada (conteo)",field:l=>l.pivot.toReceived,align:"center",coldesc:"Embalaje recibido"},{name:"descr",label:"Descripcion",field:"description",align:"left"},{name:"section",label:"Seccion",field:"section",align:"left"},{name:"family",label:"Familia",field:"family",align:"left"},{name:"category",label:"Categoria",field:"category",align:"left"}],filter:"",pagination:{sortBy:"locs",descending:!1,rowsPerPage:20}}),U=T(()=>S.value.reduce((l,a)=>l+(a.pivot._supply_by==3?a.pivot.amount*a.pieces:a.pivot.amount),0));T(()=>g.value&&(g.value.id==2||g.value.id==6)),T(()=>B.value.find(l=>l.id==g.value.id).pivot),T(()=>M.value.map(l=>l._status).includes(6));const D=async()=>{h("loading"),V.value=!0;let l=await F.order(i.value.id);if(console.log(l.data),S.value=l.data.products,B.value=l.data.log.map(a=>(a.pivot.details=JSON.parse(a.pivot.details),a)),M.value=l.data.partition,g.value=l.data.status,$.value=l.data,s.value=l.data.invoice,g.value.id==2){console.log($.value.to.id);let a=await oe.getSupply($.value.to.id);console.log(a),c.value.opts=a}V.value=!1,h("loaded")},H=()=>{_.value.state=!0},re=()=>{d.value=!0},me=async()=>{console.log("Iniciando surtido"),h("loading"),j.value=!0;let l=3,a={id:i.value.id,state:l};const n=await F.nextState(a);if(n.status==200){j.value=!1,f.notify({message:`Surtido iniciado para el pedido  ${i.value.id}`,icon:"done",position:"center",color:"teal"});let E={supplyer:c.value.val,pedido:i.value.id,status:l},A=await oe.SaveSupply(E);console.log(A),A.status==200?(D(),h("fresh",i.value.id),_.value.state=!1):alert(`Error ${A.status}: ${A.data} 2`)}else alert(`Error ${n.status}: ${n.data} 1`);h("loaded")},Ee=async()=>{console.log("Generando factura"),f.loading.show({message:"Cambiando, espera..."});let l={chofi:v.value.val,supplyer:k.value._suplier_id,pedido:i.value.id,status:7},a=await oe.SaveChofi(l);if(console.log("%cDELIVERY ASSIGNED","color:white; background:#b71540; font-size:1.3em;"),console.log(a),a.status==200){let n={id:i.value.id,state:7,suply:k.value._suplier_id};console.log(n);let E=await oe.nextState(n);if(console.log("%cState Changed on Assist","color:white; background:#0a3d62; font-size:1.2em;"),console.log(E),E.data.partitionsEnd>$.value._status){console.log("%cTodas las particiones se han finalizado","color:white; background:#eb2f06; font-size:1.3em;");let A={id:i.value.id,state:E.data.partitionsEnd};console.log(A);const ce=await F.nextState(A);console.log("%cState Changed on RestockAPI","color:white; background:#079992; font-size:1.3em;"),console.log(ce)}if(h("chofiAssigned",n.id),E.status==200){D();let A=E.data.partition.id,ce=M.value.findIndex(ze=>ze.id==A);M.value[ce]._status=E.data.partition._status,M.value[ce].invoice=E.data.partition.invoice}f.notify({message:"Pedido en ruta",position:"center",icon:"done",timeout:5e3,color:"positive"}),L.value.state=!1}else alert(`Error ${a.status}: ${a.data}`);f.loading.hide()},Pe=async l=>{let a=`http://192.168.10.189:2200/#/checkin/${i.value.id}?key=${l}`;G.value.state=!0,Be(()=>st.toCanvas(document.getElementById("qrcode"),a))},Ie=async l=>{f.loading.show({message:"..."}),console.log(l);const a=await F.printKey({ip:l.ip,port:l._port,order:i.value.id});a.status==200?(a.data,f.loading.hide(),f.notify({message:"Impresion correcta",icon:"done",color:"positive",position:"top"})):(console.error(a),alert(`Error ${a.status}: ${a.data}`))},qe=async l=>{f.loading.show({message:"..."}),console.log(l);const a=await F.printForSupply({ip:l.ip,port:l._port,order:i.value.id});console.log(a),a.status==200?(a.data?f.notify({message:"Impresion correcta",icon:"done",color:"positive",position:"top"}):f.notify({message:`Sin conexion a <b>${l.name} <small>(${l.ip})</small></b>`,icon:"fas fa-bug",color:"negative",position:"center",html:!0,timeout:4e3}),f.loading.hide()):(console.error(a),alert(`Error ${a.status}: ${a.data}`))},Qe=async l=>{f.loading.show({message:"..."}),console.log(l.ip),console.log(R.value);const a=await F.printForPartition({ip:l.ip,port:l._port,_partition:R.value});console.log(a),a.status==200?(a.data?f.notify({message:"Impresion correcta",icon:"done",color:"positive",position:"top"}):f.notify({message:`Sin conexion a <b>${l.name} <small>(${l.ip})</small></b>`,icon:"fas fa-bug",color:"negative",position:"center",html:!0,timeout:4e3}),f.loading.hide()):(console.error(a),alert(`Error ${a.status}: ${a.data}`))},Ue=async l=>{k.value=l,L.value.state=!0;let a=await oe.getSupply($.value.to.id);console.log(a),v.value.opts=a},Ae=(l,a,n)=>{a(()=>{if(l==="")c.value.filter=c.value.opts;else{const E=l.toLowerCase();c.value.filter=c.value.opts.filter(A=>A.complete_name.toLowerCase().indexOf(E)>-1)}})},Oe=(l,a,n)=>{a(()=>{if(l==="")v.value.filter=v.value.opts;else{const E=l.toLowerCase();v.value.filter=v.value.opts.filter(A=>A.complete_name.toLowerCase().indexOf(E)>-1)}})},Re=async()=>{console.log("Eliminando Pedido"),h("loading");let l=100,a={id:i.value.id,state:l};const n=await F.nextState(a);n.status==200?(d.value=!1,f.notify({message:`Surtido Cancelado para el pedido  ${i.value.id}`,icon:"close",position:"center",color:"negative"}),D(),h("fresh",i.value.id)):alert(`Error ${n.status}: ${n.data} 1`),h("loaded")},Le=l=>{console.log(l.id),R.value=l.id},Fe=l=>{console.log($.value),$.value.from._type!=1?$e.pdf(l.invoice,l.entry_key,i.value.id):(console.log(l.invoice),$e.pdfTransfer(l.invoice,l.entry_key,i.value.id))};return je(()=>p.value=b.value.columns.map(l=>l.name)),D(),(l,a)=>(r(),w(Y,null,[e(W,{class:"full-width"},{default:t(()=>[e(P,{class:"row justify-between"},{default:t(()=>[o("div",null,[mt,o("div",ft,u(i.value.from.alias),1)]),o("div",_t,[gt,o("div",bt,u(i.value.id),1)]),o("div",yt,[ht,o("div",kt,u(i.value.created_by.nick),1)])]),_:1}),e(N),e(P,{class:"row justify-between"},{default:t(()=>[o("div",xt,[wt,o("div",Ct,u(z(ee)(i.value.updated_at).format("YYYY-MM-DD")),1)]),i.value.notes?(r(),w("div",St,[$t,o("div",Vt,u(i.value.notes),1)])):O("",!0),o("div",Dt,[o("div",Et,[g.value&&g.value.id==2?(r(),q(y,{key:0,color:"positive",icon:"start",dense:"",label:"Iniciar",onClick:H,flat:"",rounded:""})):O("",!0)]),e(N,{spaced:"",inset:"",vertical:"",dark:""}),o("div",Pt,[g.value&&g.value.id==2?(r(),q(y,{key:0,color:"negative",icon:"close",dense:"",label:"Declinar",onClick:re,flat:"",rounded:""})):O("",!0)]),g.value&&g.value.id>2?(r(),q(y,{key:0,color:"indigo-10",icon:"print",dense:""},{default:t(()=>[e(ue,{class:"bg-grey-1 text-indigo-10",style:{"min-width":"250px"}},{default:t(()=>[e(ye,{onSelected:qe,partition:!1})]),_:1})]),_:1})):O("",!0)])]),_:1}),e(N),V.value?(r(),q(P,{key:0,class:"text-center"},{default:t(()=>[e(et,{size:"50px",color:"purple"})]),_:1})):(r(),w(Y,{key:1},[e(N),e(ot,{modelValue:C.value,"onUpdate:modelValue":a[0]||(a[0]=n=>C.value=n),class:"text-pink-5",dense:"","no-caps":""},{default:t(()=>[e(fe,{name:"log",label:"Log"}),e(fe,{name:"basket",label:"Productos"}),e(fe,{name:"supliers",label:"Surtidores"})]),_:1},8,["modelValue"]),e(tt,{modelValue:C.value,"onUpdate:modelValue":a[3]||(a[3]=n=>C.value=n),animated:""},{default:t(()=>[e(_e,{name:"log"},{default:t(()=>[e(ke,null,{default:t(()=>[(r(!0),w(Y,null,te(B.value,n=>(r(),q(ne,{key:n.id},{default:t(()=>[e(Q,{avatar:""},{default:t(()=>[x(u(n.id),1)]),_:2},1024),e(Q,null,{default:t(()=>[x(u(n.name),1)]),_:2},1024),e(Q,null,{default:t(()=>[x(u(n.pivot.details.responsable),1)]),_:2},1024),e(Q,null,{default:t(()=>[x("de "+u(z(ee)(n.pivot.created_at).format("h:mm a"))+" a "+u(z(ee)(n.pivot.updated_at).format("h:mm a")),1)]),_:2},1024)]),_:2},1024))),128))]),_:1})]),_:1}),e(_e,{name:"basket"},{default:t(()=>[S.value.length?(r(),q(ie,{key:0,"row-key":"id",flat:"",rows:S.value,columns:b.value.columns,pagination:b.value.pagination,filter:b.value.filter,"visible-columns":p.value},{top:t(()=>[o("div",It,[o("div",qt,[o("span",Qt,[e(y,{color:"pink-5",icon:"sync",onClick:D,round:"",dense:"",flat:""}),x(" Productos: "+u(S.value.length),1)]),x(", "),o("span",Ut,"Piezas: "+u(z(U)),1)]),e(we,{dense:"",modelValue:b.value.filter,"onUpdate:modelValue":a[1]||(a[1]=n=>b.value.filter=n),placeholder:"Buscar","input-class":"text-uppercase",color:"pink-5"},{append:t(()=>[e(le,{name:"search"})]),_:1},8,["modelValue"]),e(y,{color:"secondary",icon:"fas fa-eye","no-caps":""},{default:t(()=>[e(ue,{style:{"min-width":"200px"}},{default:t(()=>[e(ke,null,{default:t(()=>[(r(!0),w(Y,null,te(b.value.columns,(n,E)=>Z((r(),q(ne,{tag:"label",key:E},{default:t(()=>[e(Q,null,{default:t(()=>[e(ae,null,{default:t(()=>[x(u(n.label),1)]),_:2},1024),e(ae,{caption:""},{default:t(()=>[x(u(n.coldesc),1)]),_:2},1024)]),_:2},1024),e(Q,{side:"",top:""},{default:t(()=>[e(He,{color:"pink-5",modelValue:p.value,"onUpdate:modelValue":a[2]||(a[2]=A=>p.value=A),val:n.name},null,8,["modelValue","val"])]),_:2},1024)]),_:2},1024)),[[Ve]])),128))]),_:1})]),_:1})]),_:1})])]),_:1},8,["rows","columns","pagination","filter","visible-columns"])):(r(),w("div",At,"Nada por aqui"))]),_:1}),e(_e,{name:"supliers"},{default:t(()=>[e(ie,{rows:M.value,"row-key":"id",dense:"",flat:"",bordered:"",grid:"","hide-header":""},{item:t(n=>[o("div",Ot,[e(W,{flat:"",bordered:""},{default:t(()=>[e(P,{class:"text-center"},{default:t(()=>[x(" Surtidor "),Rt,o("strong",null,u(n.row._suplier),1),e(N,{spaced:"",inset:"",vertical:"",dark:""}),e(le,{name:"print",color:"pink",size:"sm",onClick:E=>Le(n.row)},{default:t(()=>[e(ue,{class:"bg-grey-1 text-indigo-10",style:{"min-width":"250px"}},{default:t(()=>[e(ye,{onSelectedPartition:Qe,partition:!0})]),_:1})]),_:2},1032,["onClick"]),Lt,o("div",Ft,[e(lt,{color:"primary","text-color":"white",label:n.row.status.name},null,8,["label"])])]),_:2},1024),e(N),e(P,{class:"flex justify-between"},{default:t(()=>[i.value.from._type!=1?(r(),w("div",zt,Bt)):(r(),w("div",Nt,Mt)),Gt]),_:1}),e(N),e(P,{class:"flex justify-between"},{default:t(()=>[i.value.from._type!=1?(r(),w("div",Ht,[o("div",null,u(n.row.invoice),1),o("div",null,u(n.row.invoice_received),1)])):(r(),w("div",Kt,[o("div",null,u(n.row.invoice),1)])),o("div",Jt,[n.row._status==6?(r(),w("div",Wt,[e(y,{color:"pink",label:"En Camino",class:"q-px-xl q-py-xs",size:"10px",padding:"5px 2px","icon-right":"start",flat:"",onClick:E=>Ue(n.row)},null,8,["onClick"])])):O("",!0),n.row._status>=7?(r(),w("div",Xt,[e(y,{color:"pink",icon:"qr_code",onClick:E=>Pe(n.row.entry_key),flat:""},null,8,["onClick"])])):O("",!0),n.row._status>=7?(r(),w("div",Zt,[e(y,{color:"pink",icon:"list",onClick:E=>Fe(n.row),flat:""},null,8,["onClick"])])):O("",!0)])]),_:2},1024)]),_:2},1024)])]),_:1},8,["rows"])]),_:1})]),_:1},8,["modelValue"])],64))]),_:1}),e(X,{modelValue:G.value.state,"onUpdate:modelValue":a[4]||(a[4]=n=>G.value.state=n)},{default:t(()=>[e(W,null,{default:t(()=>[e(P,{class:"text-h6 text-center"},{default:t(()=>[x(u(i.value.id)+" - "+u(i.value.from.alias),1)]),_:1}),e(N),e(P,{class:"text-center"},{default:t(()=>[el,o("div",tl,u(G.value.key),1)]),_:1}),e(N),e(P,{align:"center"},{default:t(()=>[e(y,{color:"indigo-10",icon:"print"},{default:t(()=>[e(ue,null,{default:t(()=>[e(ye,{onSelected:Ie})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]),e(X,{modelValue:L.value.state,"onUpdate:modelValue":a[6]||(a[6]=n=>L.value.state=n)},{default:t(()=>[e(W,null,{default:t(()=>[e(P,{class:"row items-start"},{default:t(()=>[e(he,{icon:"warning",color:"orange-14","text-color":"white"}),ll]),_:1}),e(P,null,{default:t(()=>[o("div",null,[al,o("div",ol,u(k.value._suplier),1)])]),_:1}),k.value?(r(),q(P,{key:0},{default:t(()=>[e(se,{modelValue:v.value.val,"onUpdate:modelValue":a[5]||(a[5]=n=>v.value.val=n),options:v.value.filter,label:"CHOFER","option-label":"complete_name",filled:"",style:{width:"100%"},onFilter:Oe,"input-debounce":"0","use-input":""},null,8,["modelValue","options"])]),_:1})):O("",!0),e(pe,{align:"right"},{default:t(()=>[Z(e(y,{flat:"",label:"Cancelar",color:"primary","no-caps":""},null,512),[[ve]]),e(y,{flat:"",label:"Continuar",color:"primary",onClick:Ee,"no-caps":"",disable:v.value.val==null},null,8,["disable"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),e(X,{modelValue:_.value.state,"onUpdate:modelValue":a[8]||(a[8]=n=>_.value.state=n),persistent:""},{default:t(()=>[e(W,{style:{width:"400px"}},{default:t(()=>[e(P,{class:"row items-center"},{default:t(()=>[e(se,{modelValue:c.value.val,"onUpdate:modelValue":a[7]||(a[7]=n=>c.value.val=n),options:c.value.filter,label:"SELECCIONA SURTIDOR","option-label":"complete_name",filled:"",multiple:"",counter:"","max-values":"5",hint:"Maximo 5 colaboradores",style:{width:"100%"},onFilter:Ae,"input-debounce":"0","use-input":"","use-chips":""},null,8,["modelValue","options"])]),_:1}),e(pe,{align:"right"},{default:t(()=>[Z(e(y,{flat:"",label:"Cancel",color:"primary"},null,512),[[ve]]),e(y,{flat:"",label:"Continuar",color:"primary",onClick:me,disable:c.value.val.length==0},null,8,["disable"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),e(X,{modelValue:d.value,"onUpdate:modelValue":a[9]||(a[9]=n=>d.value=n),persistent:""},{default:t(()=>[e(W,null,{default:t(()=>[e(P,{class:"row items-center"},{default:t(()=>[e(he,{icon:"warning",color:"negative","text-color":"white"}),sl,o("div",nl,u(i.value.id),1)]),_:1}),e(P,null,{default:t(()=>[x(" Es correcto? ")]),_:1}),e(pe,{align:"center"},{default:t(()=>[Z(e(y,{flat:"",label:"Cancel",color:"positive"},null,512),[[ve]]),e(y,{flat:"",label:"Confirmar",color:"negative",onClick:Re})]),_:1})]),_:1})]),_:1},8,["modelValue"])],64))}},dl={class:"text-h6"},rl={class:"row q-mt-md"},cl={class:"q-ml-sm text-h6"},ul={__name:"TableReport",props:{rows:{type:Array,default:[]},name:{type:String,default:""},type:{type:String,default:""}},emits:["cardResumeActived"],setup(J,{emit:h}){const I=J;at();const f=de(),c=m({state:!1,action:null}),v=m({columns:[{name:"ID",field:"ID",label:"ID",align:"center"},{name:"code",field:"CODIGO",label:"Codigo",align:"center",sortable:!0},{name:"desc",field:"DESCRIPCION",label:"Descripcion",align:"left"},{name:"stockcedis",field:"CEDIS",label:"Stock (CEDIS)",align:"center",sortable:!0},{name:"stockpan",field:"PANTACO",label:"Stock (PAN)",align:"center",sortable:!0}],filter:""}),R={pndcs:{l:"Habilitar todo",c:"indigo-13",desc:"Los productos en esta lista se habilitaran y podran ser solicitados por cuaqluier tienda."},pdss:{l:"Deshabilitar todo",c:"pink-13",desc:"Los productos en esta lista se deshabilitaran y no podran ser solicitados."}},k=m(I.rows),i=m(I.name),$=m(I.type),V=T(()=>$.value?R[$.value]:{l:"",c:""}),B=()=>{const S=R[$.value];c.value.action=S,c.value.state=!0},C=async()=>{f.loading.show({message:"Espera..."});const S=await F.massiveAction({action:$.value});console.log(S),S.status==200?(S.data,c.value.state=!1,c.value.action=null,f.loading.hide(),f.notify({position:"center",color:"positive",icon:"done"}),h("cardResumeActived")):(console.error(S.data),alert(`Error ${S.status}: ${S.data.msg}`))},g=(S,j,L)=>{console.log(S),console.log(j),console.log(L),console.log($.value)};return(S,j)=>(r(),w(Y,null,[e(ie,{"row-key":"ID",rows:k.value,columns:v.value.columns,filter:v.value.filter,onRowClick:g},{top:t(()=>[o("div",dl,u(i.value),1),o("div",rl,[e(y,{color:z(V).c,icon:"warning",label:z(V).l,onClick:B},null,8,["color","label"]),e(we,{modelValue:v.value.filter,"onUpdate:modelValue":j[0]||(j[0]=L=>v.value.filter=L),dense:"",type:"text",icon:"search",label:"Buscar"},{prepend:t(()=>[e(le,{name:"search"})]),_:1},8,["modelValue"])])]),_:1},8,["rows","columns","filter"]),e(X,{modelValue:c.value.state,"onUpdate:modelValue":j[1]||(j[1]=L=>c.value.state=L),persistent:""},{default:t(()=>[e(W,null,{default:t(()=>[e(P,{class:"row items-center"},{default:t(()=>[e(he,{icon:"warning",color:c.value.action.c,"text-color":"white"},null,8,["color"]),o("span",cl,u(c.value.action.l),1)]),_:1}),e(P,null,{default:t(()=>[x(u(c.value.action.desc),1)]),_:1}),e(pe,{align:"right"},{default:t(()=>[Z(e(y,{flat:"",label:"cancelar",color:"primary"},null,512),[[ve]]),e(y,{flat:"",label:"continuar",color:"primary",onClick:C})]),_:1})]),_:1})]),_:1},8,["modelValue"])],64))}},pl={key:0,class:"bg-negative text-white q-pa-md q-mb-md"},vl=o("div",{class:"text-warning text-bold"},"Los siguientes folios tienen errores que no permiten ser listados en la tabla. ",-1),ml={class:"text-h6"},fl=o("div",{class:"text--2"},"Errores comunes: Sin log, Sin fecha, Estatus desconocido",-1),_l={class:"row q-mb-md items-start justify-around"},gl={class:"text-left"},bl={class:"text-h5"},yl={class:"text--2"},hl={class:"full-width row items-center"},kl={class:"col text-h6 text-dark"},xl={__name:"AdminDashboard",emits:["reloadDashboard","freshOrder"],setup(J,{emit:h}){xe(),De();const I=Ce(),f=de(),c=["text-grey-5 text-bold","text-bold text-h6 text-red","text-indigo","4","5","text-bold text-pink-7","text-orange-8","8","text-primary","text-positive"],v=m({columns:[{name:"id",label:"Folio",field:"id",align:"center",sortable:!0},{name:"state",label:"Estado",field:d=>d.log.length==1?d.log[0].name:d.log[d.log.length-1].name,align:"left",sortable:!0,sort:(d,_,s,p)=>parseInt(s._status)-parseInt(p._status),classes:d=>c[d._status?parseInt(d._status)-1:parseInt(d.status.id)-1]},{name:"suplier",label:"Surtidores",field:d=>{var _;return(_=d.partition)==null?void 0:_.length},align:"center",classes:"text-bold"},{name:"laststate",label:"Ultima actividad",field:d=>ee(d.log.find(_=>_.id==d.status.id).pivot.updated_at).format("YYYY-MM-DD hh:mm A"),align:"left"},{name:"from",label:"Sucursal",field:d=>d.from.name.toUpperCase(),align:"left",sortable:!0},{name:"to",label:"Destino",field:d=>d.to.name.toUpperCase(),align:"left",sortable:!0},{name:"notes",label:"Notas",field:d=>d.notes,align:"left",classes:"text-orange text-bold"},{name:"tmodels",label:"Modelos",field:d=>d.products_count,align:"center",sortable:!0}],filter:"",pagination:{sortBy:"desc",descending:!1,rowsPerPage:20}}),R=m(!1),k=m({state:!1,title:"",data:null,name:null,type:null}),i=m({state:!1,head:null,block:!0}),$=T(()=>I.ordersSize),V=T(()=>I.ordersok.filter(d=>d._status!=100)),B=T(()=>I.ordersok.filter(d=>d._status==100)),C=T(()=>I.orderserrors),g=T(()=>I.resume),S=async d=>{console.log(d.row),i.value.head=d.row,i.value.state=!0},j=async d=>{f.loading.show({message:"cargando..."+d});const _=await F.report(d);console.log(_.data),k.value.data=_.data.rows,k.value.name=_.data.name,k.value.type=d,k.value.state=!0,f.loading.hide()},L=()=>{k.value.state=!1,k.state=!1,h("reload")},G=d=>{console.log(d),console.log("Se crearon las particiones",d),h("freshOrder",d)},M=()=>{R.value=!0};return(d,_)=>(r(),q(Ge,{padding:"",class:"bg-grey-2"},{default:t(()=>[z(C).length?(r(),w("div",pl,[vl,o("div",ml,u(z(C).map(s=>s.id).join("id")),1),fl])):O("",!0),o("div",_l,[(r(!0),w(Y,null,te(z(g),s=>(r(),q(y,{stack:"","no-caps":"",class:"q-py-md",key:s.key,onClick:p=>j(s.key),color:s.total==0?"teal-10":"pink-13",disabled:s.total==0},{default:t(()=>[o("div",gl,[o("div",bl,u(s.total),1),o("div",yl,u(s.name),1)])]),_:2},1032,["onClick","color","disabled"]))),128))]),e(ie,{flat:"",bordered:"","row-key":"id",rows:z(V),columns:v.value.columns,filter:v.value.filter,pagination:v.value.pagination},{header:t(s=>[e(ge,{props:s},{default:t(()=>[e(Se,{"auto-width":""}),(r(!0),w(Y,null,te(s.cols,p=>(r(),q(Se,{key:p.name,props:s},{default:t(()=>[x(u(p.label),1)]),_:2},1032,["props"]))),128))]),_:2},1032,["props"])]),body:t(s=>[e(ge,{props:s},{default:t(()=>[e(be,{"auto-width":""},{default:t(()=>[e(y,{size:"sm",dense:"",round:"",flat:"",onClick:p=>s.expand=!s.expand,icon:s.expand?"expand_less":"expand_more"},null,8,["onClick","icon"])]),_:2},1024),(r(!0),w(Y,null,te(s.cols,p=>(r(),q(be,{key:p.name,props:s,onClick:b=>S(s)},{default:t(()=>[x(u(p.value),1)]),_:2},1032,["props","onClick"]))),128))]),_:2},1032,["props"]),Z(e(ge,{props:s},{default:t(()=>[e(be,{colspan:"100%"},{default:t(()=>[e(ke,{dense:"",padding:"",class:"rounded-borders"},{default:t(()=>[e(ne,null,{default:t(()=>[e(Q,null,{default:t(()=>[x("ID")]),_:1}),e(Q,null,{default:t(()=>[x("ESTADO")]),_:1}),e(Q,null,{default:t(()=>[x(" SALIDA")]),_:1}),e(Q,null,{default:t(()=>[x("ENTRADA")]),_:1})]),_:1}),(r(!0),w(Y,null,te(s.row.partition,(p,b)=>(r(),w("div",{key:b},[e(ne,null,{default:t(()=>[e(Q,null,{default:t(()=>[e(ae,{overline:""},{default:t(()=>[x(u(p._suplier),1)]),_:2},1024),e(ae,{caption:""},{default:t(()=>[x(u(p.id),1)]),_:2},1024)]),_:2},1024),e(Q,{class:Ne(`${c[p.status.id-1]}`)},{default:t(()=>[x(u(p.status.name),1)]),_:2},1032,["class"]),e(Q,null,{default:t(()=>[x(u(p.invoice),1)]),_:2},1024),e(Q,null,{default:t(()=>[x(u(p.invoice_received),1)]),_:2},1024)]),_:2},1024),e(N,{spaced:"",inset:""})]))),128))]),_:2},1024)]),_:2},1024)]),_:2},1032,["props"]),[[Ye,s.expand]])]),top:t(()=>[o("div",hl,[o("div",kl,"Pedidos: "+u(z($)),1),e(we,{dense:"",modelValue:v.value.filter,"onUpdate:modelValue":_[0]||(_[0]=s=>v.value.filter=s),"input-class":"text-uppercase",placeholder:"Buscar",color:"pink-5"},{append:t(()=>[e(le,{name:"search"})]),_:1},8,["modelValue"]),e(N,{spaced:"",inset:"",vertical:"",dark:""}),o("div",null,[e(le,{name:"archive",size:"md",color:"negative",onClick:M})])])]),_:1},8,["rows","columns","filter","pagination"]),e(X,{"full-width":"",modelValue:i.value.state,"onUpdate:modelValue":_[3]||(_[3]=s=>i.value.state=s),persistent:i.value.block,"no-esc-dismiss":i.value.block,"no-backdrop-dismiss":i.value.block},{default:t(()=>[e(il,{head:i.value.head,onLoaded:_[1]||(_[1]=s=>i.value.block=!1),onLoading:_[2]||(_[2]=s=>i.value.block=!0),onFresh:G,onChofiAssigned:G},null,8,["head"])]),_:1},8,["modelValue","persistent","no-esc-dismiss","no-backdrop-dismiss"]),e(X,{modelValue:k.value.state,"onUpdate:modelValue":_[4]||(_[4]=s=>k.value.state=s)},{default:t(()=>[e(ul,{rows:k.value.data,name:k.value.name,type:k.value.type,onCardResumeActived:L},null,8,["rows","name","type"])]),_:1},8,["modelValue"]),e(X,{modelValue:R.value,"onUpdate:modelValue":_[5]||(_[5]=s=>R.value=s),"full-width":""},{default:t(()=>[e(W,{style:{width:"700px","max-width":"80vw"}},{default:t(()=>[e(P,{class:"q-pt-none"},{default:t(()=>[e(ie,{flat:"",bordered:"","row-key":"id",rows:z(B),columns:v.value.columns,pagination:v.value.pagination,title:"Pedidos Cancelados"},null,8,["rows","columns","pagination"])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1}))}};const wl=o("div",{class:"text-bold"},"Dashboard ",-1),Cl={class:"row"},Sl={class:"col row"},jl={__name:"DashboardLyt",setup(J){const h=xe(),I=De(),f=Ce(),c=de(),v=nt,R=m([{id:0,alias:"Todas"},{id:1,alias:"CEDIS",_state:1},{id:2,alias:"SP1",_state:1}]),k=m([{id:"day",label:"Hoy"},{id:"week",label:"Semana"},{id:"month",label:"Mes"},{id:"C",label:"otra ...",disable:!0}]),i=["p2","P2","p3","P3","bol","BOL","sap","SAP","TEX"],$=m(null),V=m(null),B=m({from:ee(Date.now()).startOf("day"),to:ee(Date.now()).startOf("day")}),C=async()=>{var H;c.loading.show({message:"Cargado vista..."}),console.log("%cIniciando MainLayout...","font-size:2em;color:orange;");let s=(H=h.query.v)!=null?H:"day",p=k.value.findIndex(re=>re.id==s),b=p>=0?p:0;V.value=k.value[b],B.value.from=ee(Date.now()).startOf(V.value.id);let U=h.query.d&&i.includes(h.query.d)?h.query.d:"all";console.log(U);const D=await F.index(V.value.id,U);console.log(D),f.fillOrders(D.orders),f.fillResume(D.resume),f.fillPrinters(D.printers),$.value=R.value[0],console.log("%cMainLayout listo!!","font-size:2em;color:orange;"),c.loading.hide(),K.connect(),K.emit("joinat",v),K.on("joineddashreq",S),K.on("creating",j),K.on("order_update",L),K.on("order_changestate",G),K.on("order_refresh",M),K.on("orderpartition_refresh",_)},g=s=>{let p=h.query.d&&i.includes(h.query.d)?h.query.d:"all";I.push(`/dashboard?v=${s.id}&d=${p}`)};T(()=>B.value.from.format("YYYY/MM/DD")),T(()=>B.value.to.format("YYYY/MM/DD"));const S=s=>{console.log(`%c${s.user.me.nick} de ${s.from.alias} se ha unido a Restock (UID: ${s.user.me.id})`,"background:#076F3E;color:#f5f6fa;border-radius:10px;padding:10px;font-size:1.1em;")},j=async s=>{let p=s.order,b=await F.orderFresh(p.id),U=b.data.order,D=b.data.oid;f.addOrUpdate(D,U)},L=s=>{f.orderUpdate(s)},G=async s=>{let p=s.order,b=s.state,U=await F.orderFresh(p.id),D=U.data.order,H=U.data.oid;f.addOrUpdate(H,D),b.id==2&&c.notify({message:`El pedido <b>${p.id}</b> esta listo para iniciar surtido!!`,color:"positive",textColor:"white",position:"bottom",html:!0,timeout:5e3})},M=async s=>{console.log("REFRESHING BY SKT!!",s);let p=s.order,b=await F.orderFresh(p);console.log(b);let U=b.data.order;console.log(U.partition);let D=b.data.oid;f.addOrUpdate(D,U)},d=s=>{console.log("orderViewer/AdminDashboard actualizaron el pedido:",s),K.emit("order_refresh",{order:s})},_=async s=>{console.log("Partition refresh!!",s);let p=s.order,b=await F.orderFresh(p);console.log(b);let U=b.data.order,D=U.partition,H=b.data.oid;f.addOrUpdate(H,U),D.filter(me=>me._status==4).length==D.length&&c.notify({message:`El pedido <b>${H}</b> esta listo para iniciar <b>embarque</b>`,html:!0,color:"purple-10",icon:"fa-solid fa-truck-ramp-box"})};return Me(()=>h.query,()=>{C()}),C(),document.title="Dashboard",(s,p)=>(r(),q(Je,{view:"lHh Lpr lFf"},{default:t(()=>[e(We,{bordered:"",class:"bg-yellow text-dark"},{default:t(()=>[e(Ke,{class:"row justify-between items-center"},{default:t(()=>[wl,o("div",Cl,[e(y,{color:"dark",round:"",unelevated:"",flat:"",icon:"sync",onClick:C}),o("div",Sl,[e(se,{class:"col",dense:"",filled:"",label:"Vista",modelValue:V.value,"onUpdate:modelValue":[p[0]||(p[0]=b=>V.value=b),g],options:k.value},null,8,["modelValue","options"]),V.value.id=="C"?(r(),q(y,{key:0,unelevated:"",color:"pink-5",icon:"fas fa-calendar-day",dense:""})):O("",!0)])])]),_:1})]),_:1}),e(Xe,null,{default:t(()=>[e(xl,{onReload:C,onFreshOrder:d})]),_:1})]),_:1}))}};export{jl as default};
