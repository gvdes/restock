import{r as v,c as N,o as n,aF as S,f as o,d as e,w as t,h,aH as H,i as D,e as j,aA as le,b as $,aN as Be,Q as se,t as u,aE as k,R as Ee,u as Se,a7 as ze,aG as oe,aJ as we,x as je,a as Ae,aO as Ne,aP as Ye,g as Me}from"./index.df10290c.js";import{u as ce,s as G,a as ne,x as re,y as Q,z as ie,t as me,v as Ce,Q as ue,w as te,A as De}from"./QTable.5cc59191.js";import{a as Ge,Q as He}from"./QToggle.03bde3a7.js";import{Q as Ke,a as Je,b as Xe}from"./QLayout.d2df61df.js";import{d as ae}from"./dayjs.min.25545ff6.js";import{R as z}from"./RestockApi.88111cc4.js";import{a as $e,Q as We,b as Ze,c as be,d as et,e as ye,f as tt,u as lt}from"./Restock.b25df37f.js";import{Q as he,a as ke}from"./QTd.61e3c65d.js";import{b as q,Q as Ve,a as ee,c as fe}from"./QCardActions.5dc4067b.js";import{Q as at}from"./QPage.382cacb5.js";import{Q as ot}from"./QTabs.d4d5527e.js";import{C as _e}from"./ClosePopup.f05cf158.js";import{A as de}from"./AssistApi.0709f2af.js";import{b as st}from"./jspdf.plugin.autotable.e7ded030.js";import{p as Pe}from"./pdfCreate.a293c36b.js";import{$sktRestock as W,usrSkt as nt}from"./socket.97cb7a0e.js";import"./rtl.97119600.js";import"./_commonjsHelpers.88e99c8f.js";import"./axios.1781237b.js";import"./use-cache.b0833c75.js";const it={class:"q-pa-sm bg-grey-2 text-bold row justify-between items-center",style:{"min-width":"250px"}},dt=o("div",null,"Impresion",-1),rt={key:0,class:"row justify-between items-center"},ut={class:"q-mt-sm q-pa-sm"},ct={key:0,class:"q-pa-sm"},pt={class:"text--3"},vt={class:"q-pa-sm text-right"},xe={__name:"PrinterSelect",props:{partition:{type:Boolean}},emits:["selected","selectedPartition"],setup(Z,{emit:b}){const I=ce(),m=$e(),c=v(null),p=v(null),T=N(()=>m.printers),w=N(()=>c.value?c.value.printers:[]),i=()=>{I.localStorage.set("LUP",{wkp:c.value,printer:p.value}),b("selected",p.value)},x=()=>{I.localStorage.set("LUP",{wkp:c.value,printer:p.value}),b("selectedPartition",p.value)},F=I.localStorage.getItem("LUP");return F&&(c.value=F.wkp,p.value=F.printer),(O,P)=>(n(),S(H,null,[o("div",it,[dt,c.value?(n(),S("div",rt,[e(We,{flat:""},{default:t(()=>[e(h,{flat:"",color:"positive",icon:"add",dense:""}),p.value?(n(),S(H,{key:0},[e(h,{flat:"",color:"negative",icon:"delete",dense:""}),e(h,{flat:"",color:"orange",icon:"edit",dense:""})],64)):D("",!0)]),_:1})])):D("",!0)]),e(G),o("div",ut,[e(ne,{modelValue:c.value,"onUpdate:modelValue":[P[0]||(P[0]=f=>c.value=f),P[1]||(P[1]=f=>p.value=null)],options:j(T),label:"Sucursal",filled:"","option-label":"alias","option-value":"id"},null,8,["modelValue","options"])]),c.value?(n(),S("div",ct,[e(ne,{modelValue:p.value,"onUpdate:modelValue":P[2]||(P[2]=f=>p.value=f),options:j(w),label:"Impresora",filled:"","option-value":"id","option-label":"name"},{option:t(f=>[le((n(),$(re,Be({clickable:""},f.itemProps),{default:t(()=>[e(Q,{class:"text-center",side:""},{default:t(()=>[e(se,{color:"primary","text-color":"white",name:"print",size:"30px"}),o("span",pt,"ID:"+u(f.opt.id),1)]),_:2},1024),e(Q,null,{default:t(()=>[e(ie,null,{default:t(()=>[k(u(f.opt.name),1)]),_:2},1024),e(ie,{caption:"",lines:"2"},{default:t(()=>[k(u(f.opt.ip),1)]),_:2},1024)]),_:2},1024)]),_:2},1040)),[[Ee]])]),_:1},8,["modelValue","options"])])):D("",!0),o("div",vt,[c.value&&p.value&&!Z.partition?(n(),$(h,{key:0,color:"primary",icon:"print",onClick:i})):D("",!0),c.value&&p.value&&Z.partition?(n(),$(h,{key:1,color:"secondary",icon:"print",onClick:x})):D("",!0)])],64))}},mt=o("div",{class:"text-overline text-grey-7"},"Sucursal",-1),ft={class:"text-h6"},_t={class:"q-px-lg text-center"},gt=o("div",{class:"text-overline text-grey-7"},"Folio",-1),bt={class:"text-h6"},yt={class:"text-right"},ht=o("div",{class:"text-overline text-grey-7"},"Agente",-1),kt={class:"text-h6"},xt={class:"text-center"},wt=o("div",{class:"text-overline text-grey-7"},"Fecha",-1),Ct={class:"text-h6"},St={key:0,class:"text-center"},$t=o("div",{class:"text-overline text-grey-7 col"},"Notas",-1),Vt={class:"text-h6"},Dt={class:"text-center"},Pt={class:"text-overline text-grey-7"},Et={class:"text-h6"},At={class:"full-width row items-center"},It={class:"col text-dark"},qt={class:"text-h6"},Qt={class:"text-bold"},Ot={key:1,class:"text-center q-pa-lg text-h6 text-grey-7"},Ut={class:"q-pa-xs col-xs-12 col-sm-6 col-md-4"},Rt=o("br",null,null,-1),Lt=o("br",null,null,-1),Tt={class:"text-overline text-grey-7"},Ft={key:0},Bt=o("div",null,"Salida",-1),zt=o("div",null,"Entrada",-1),jt=[Bt,zt],Nt={key:1},Yt=o("div",null,"Traspaso",-1),Mt=[Yt],Gt=o("div",null,"Herramientas",-1),Ht={key:0},Kt={key:1},Jt={class:"row"},Xt={key:0,class:"col"},Wt={key:1,class:"col"},Zt={key:2,class:"col"},el=o("canvas",{id:"qrcode"},null,-1),tl={class:"text--2"},ll=o("div",{class:"q-ml-md"},[o("div",{class:"text-h6"},"Cambiar a En Camino?"),o("div",null,"Cambiara a estatus en camino")],-1),al=o("div",{class:"text-center text-h6"},"Surtidor",-1),ol={class:"text-center text-bold text-subtitle2 text-overline"},sl=o("div",{class:"q-ml-sm text-bold"},"Estas a punto de cancelar el pedido ",-1),nl={class:"q-ml-sm text-bold"},il={__name:"OrderViewer",props:{head:{type:Object,default:{}}},emits:["loaded","loading","fresh","chofiAssigned"],setup(Z,{emit:b}){const I=Z,m=ce();Se();const c=v({opts:[],val:[],filter:[]}),p=v({opts:null,val:null,filter:null}),T=v(null),w=v(null),i=v(I.head),x=v(null),F=v(!0),O=v([]),P=v("supliers"),f=v(null),V=v([]),Y=v(!1),B=v({state:!1}),J=v({state:!1,key:null}),K=v(null),d=v(!1),_=v({state:!1}),r=v(null),C=v([]),M=v({columns:[{name:"id",label:"ID",field:"id",align:"left",coldesc:"Identificador del producto (MySQL)"},{name:"code",label:"Codigo",field:"code",align:"left",coldesc:"Codigo principal del producto"},{name:"assocs",label:"Asociados",field:l=>l.variants.length?l.variants.map(a=>a.barcode).join(", "):null,align:"left",coldesc:"Codigos relacionados al codigo principal"},{name:"bcode",label:"Codigo de Barras",field:"barcode",align:"center",coldesc:"Codigo de barras principal"},{name:"locs",label:"Ubicacion",field:l=>l.locations.length?l.locations.map(a=>a.path).join(", "):"--",align:"left",coldesc:"Ubicaciones en almacen general"},{name:"stocks",label:"Stock (pzs)",field:l=>l.stocks.reduce((a,s)=>a+s.pivot.stock,0),sortable:!0,classes:l=>l.stocks.reduce((a,s)=>a+s.pivot.stock,0)<=0?"text-red text-bold":"text-bold text-primary",align:"center",coldesc:"Stock total en almacenes GENERALES (CEDIS+PAN)"},{name:"ipack",label:"PxC",field:l=>typeof l.pivot.ipack=="number"?l.pivot.ipack:l.pieces,align:"center",coldesc:"Unidades x Embalaje"},{name:"request",label:"Solicitud",field:l=>l.pivot.amount,align:"center",coldesc:"Embalaje solicitado"},{name:"uspply",label:"Unidad",field:l=>l.units.id==3?"Cajas":"Piezas",align:"left",coldesc:"Unidad de embalaje del producto"},{name:"delivery",label:"Salida (conteo)",field:l=>l.pivot.toDelivered,align:"center",coldesc:"Embalaje surtido",sortable:!0},{name:"reqinpzs",label:"Piezas",field:l=>l.pivot._supply_by==3?(typeof l.pivot.ipack=="number"?l.pivot.ipack:l.pieces)*(typeof l.pivot.ipack=="number"?l.pivot.toDelivered:l.pivot.amount):typeof l.pivot.ipack=="number"?l.pivot.toDelivered:l.pivot.amount,align:"center",coldesc:"Unidades totales en embalaje"},{name:"checkout",label:"Checkout",field:l=>l.pivot.checkout?"OK":"---",align:"center",classes:l=>l.pivot.checkout?"text-positive text-bold":"text-red",sortable:!0,coldesc:"Revision del Administrador"},{name:"received",label:"Entrada (conteo)",field:l=>l.pivot.toReceived,align:"center",coldesc:"Embalaje recibido"},{name:"descr",label:"Descripcion",field:"description",align:"left"},{name:"section",label:"Seccion",field:"section",align:"left"},{name:"family",label:"Familia",field:"family",align:"left"},{name:"category",label:"Categoria",field:"category",align:"left"}],filter:"",pagination:{sortBy:"locs",descending:!1,rowsPerPage:20}}),g=N(()=>V.value.reduce((l,a)=>l+(a.pivot._supply_by==3?a.pivot.amount*a.pieces:a.pivot.amount),0));N(()=>f.value&&(f.value.id==2||f.value.id==6)),N(()=>O.value.find(l=>l.id==f.value.id).pivot),N(()=>K.value.map(l=>l._status).includes(6));const y=async()=>{b("loading"),F.value=!0;let l=await z.order(i.value.id);if(console.log(l.data),V.value=l.data.products,O.value=l.data.log.map(a=>(a.pivot.details=JSON.parse(a.pivot.details),a)),K.value=l.data.partition,f.value=l.data.status,x.value=l.data,r.value=l.data.invoice,f.value.id==2){console.log(x.value.to.id);let a=await de.getSupply(x.value.to.id);console.log(a),c.value.opts=a}F.value=!1,b("loaded")},E=()=>{_.value.state=!0},U=()=>{d.value=!0},R=async()=>{console.log("Iniciando surtido"),b("loading"),Y.value=!0;let l=3,a={id:i.value.id,state:l};const s=await z.nextState(a);if(s.status==200){Y.value=!1,m.notify({message:`Surtido iniciado para el pedido  ${i.value.id}`,icon:"done",position:"center",color:"teal"});let A={supplyer:c.value.val,pedido:i.value.id,status:l},L=await de.SaveSupply(A);console.log(L),L.status==200?(y(),b("fresh",i.value.id),_.value.state=!1):alert(`Error ${L.status}: ${L.data} 2`)}else alert(`Error ${s.status}: ${s.data} 1`);b("loaded")},X=async()=>{console.log("Generando factura"),m.loading.show({message:"Cambiando, espera..."});let l={chofi:p.value.val,supplyer:w.value._suplier_id,pedido:i.value.id,status:7},a=await de.SaveChofi(l);if(console.log("%cDELIVERY ASSIGNED","color:white; background:#b71540; font-size:1.3em;"),console.log(a),a.status==200){let s={id:i.value.id,state:7,suply:w.value._suplier_id};console.log(s);let A=await de.nextState(s);if(console.log("%cState Changed on Assist","color:white; background:#0a3d62; font-size:1.2em;"),console.log(A),A.data.partitionsEnd>x.value._status){console.log("%cTodas las particiones se han finalizado","color:white; background:#eb2f06; font-size:1.3em;");let L={id:i.value.id,state:A.data.partitionsEnd};console.log(L);const ve=await z.nextState(L);console.log("%cState Changed on RestockAPI","color:white; background:#079992; font-size:1.3em;"),console.log(ve)}if(b("chofiAssigned",s.id),A.status==200){y();let L=A.data.partition.id,ve=K.value.findIndex(Fe=>Fe.id==L);K.value[ve]._status=A.data.partition._status,K.value[ve].invoice=A.data.partition.invoice}m.notify({message:"Pedido en ruta",position:"center",icon:"done",timeout:5e3,color:"positive"}),B.value.state=!1}else alert(`Error ${a.status}: ${a.data}`);m.loading.hide()},pe=async l=>{let a=`http://192.168.10.189:2200/#/checkin/${i.value.id}?key=${l}`;J.value.state=!0,je(()=>st.toCanvas(document.getElementById("qrcode"),a))},ge=async l=>{m.loading.show({message:"..."}),console.log(l);const a=await z.printKey({ip:l.ip,port:l._port,order:i.value.id});a.status==200?(a.data,m.loading.hide(),m.notify({message:"Impresion correcta",icon:"done",color:"positive",position:"top"})):(console.error(a),alert(`Error ${a.status}: ${a.data}`))},Ie=async l=>{m.loading.show({message:"..."}),console.log(l);const a=await z.printForSupply({ip:l.ip,port:l._port,order:i.value.id});console.log(a),a.status==200?(a.data?m.notify({message:"Impresion correcta",icon:"done",color:"positive",position:"top"}):m.notify({message:`Sin conexion a <b>${l.name} <small>(${l.ip})</small></b>`,icon:"fas fa-bug",color:"negative",position:"center",html:!0,timeout:4e3}),m.loading.hide()):(console.error(a),alert(`Error ${a.status}: ${a.data}`))},qe=async l=>{m.loading.show({message:"..."}),console.log(l.ip),console.log(T.value);const a=await z.printForPartition({ip:l.ip,port:l._port,_partition:T.value});console.log(a),a.status==200?(a.data?m.notify({message:"Impresion correcta",icon:"done",color:"positive",position:"top"}):m.notify({message:`Sin conexion a <b>${l.name} <small>(${l.ip})</small></b>`,icon:"fas fa-bug",color:"negative",position:"center",html:!0,timeout:4e3}),m.loading.hide()):(console.error(a),alert(`Error ${a.status}: ${a.data}`))},Qe=async l=>{w.value=l,B.value.state=!0;let a=await de.getSupply(x.value.to.id);console.log(a),p.value.opts=a},Oe=(l,a,s)=>{a(()=>{if(l==="")c.value.filter=c.value.opts;else{const A=l.toLowerCase();c.value.filter=c.value.opts.filter(L=>L.complete_name.toLowerCase().indexOf(A)>-1)}})},Ue=(l,a,s)=>{a(()=>{if(l==="")p.value.filter=p.value.opts;else{const A=l.toLowerCase();p.value.filter=p.value.opts.filter(L=>L.complete_name.toLowerCase().indexOf(A)>-1)}})},Re=async()=>{console.log("Eliminando Pedido"),b("loading");let l=100,a={id:i.value.id,state:l};const s=await z.nextState(a);s.status==200?(d.value=!1,m.notify({message:`Surtido Cancelado para el pedido  ${i.value.id}`,icon:"close",position:"center",color:"negative"}),y(),b("fresh",i.value.id)):alert(`Error ${s.status}: ${s.data} 1`),b("loaded")},Le=l=>{console.log(l.id),T.value=l.id},Te=l=>{console.log(x.value),x.value.from._type!=1?Pe.pdf(l.invoice,l.entry_key,i.value.id):(console.log(l.invoice),Pe.pdfTransfer(l.invoice,l.entry_key,i.value.id))};return ze(()=>C.value=M.value.columns.map(l=>l.name)),y(),(l,a)=>(n(),S(H,null,[e(ee,{class:"full-width"},{default:t(()=>[e(q,{class:"row justify-between"},{default:t(()=>[o("div",null,[mt,o("div",ft,u(i.value.from.alias),1)]),o("div",_t,[gt,o("div",bt,u(i.value.id),1)]),o("div",yt,[ht,o("div",kt,u(i.value.created_by.nick),1)])]),_:1}),e(G),e(q,{class:"row justify-between"},{default:t(()=>[o("div",xt,[wt,o("div",Ct,u(j(ae)(i.value.updated_at).format("YYYY-MM-DD")),1)]),i.value.notes?(n(),S("div",St,[$t,o("div",Vt,u(i.value.notes),1)])):D("",!0),o("div",Dt,[o("div",Pt,[f.value&&f.value.id==2?(n(),$(h,{key:0,color:"positive",icon:"start",dense:"",label:"Iniciar",onClick:E,flat:"",rounded:""})):D("",!0)]),e(G,{spaced:"",inset:"",vertical:"",dark:""}),o("div",Et,[f.value&&f.value.id==2?(n(),$(h,{key:0,color:"negative",icon:"close",dense:"",label:"Declinar",onClick:U,flat:"",rounded:""})):D("",!0)]),f.value&&f.value.id>2?(n(),$(h,{key:0,color:"indigo-10",icon:"print",dense:""},{default:t(()=>[e(me,{class:"bg-grey-1 text-indigo-10",style:{"min-width":"250px"}},{default:t(()=>[e(xe,{onSelected:Ie,partition:!1})]),_:1})]),_:1})):D("",!0)])]),_:1}),e(G),F.value?(n(),$(q,{key:0,class:"text-center"},{default:t(()=>[e(Ze,{size:"50px",color:"purple"})]),_:1})):(n(),S(H,{key:1},[e(G),e(ot,{modelValue:P.value,"onUpdate:modelValue":a[0]||(a[0]=s=>P.value=s),class:"text-pink-5",dense:"","no-caps":""},{default:t(()=>[e(be,{name:"log",label:"Log"}),e(be,{name:"basket",label:"Productos"}),e(be,{name:"supliers",label:"Surtidores"})]),_:1},8,["modelValue"]),e(et,{modelValue:P.value,"onUpdate:modelValue":a[3]||(a[3]=s=>P.value=s),animated:""},{default:t(()=>[e(ye,{name:"log"},{default:t(()=>[e(Ce,null,{default:t(()=>[(n(!0),S(H,null,oe(O.value,s=>(n(),$(re,{key:s.id},{default:t(()=>[e(Q,{avatar:""},{default:t(()=>[k(u(s.id),1)]),_:2},1024),e(Q,null,{default:t(()=>[k(u(s.name),1)]),_:2},1024),e(Q,null,{default:t(()=>[k(u(s.pivot.details.responsable),1)]),_:2},1024),e(Q,null,{default:t(()=>[k("de "+u(j(ae)(s.pivot.created_at).format("h:mm a"))+" a "+u(j(ae)(s.pivot.updated_at).format("h:mm a")),1)]),_:2},1024)]),_:2},1024))),128))]),_:1})]),_:1}),e(ye,{name:"basket"},{default:t(()=>[V.value.length?(n(),$(ue,{key:0,"row-key":"id",flat:"",rows:V.value,columns:M.value.columns,pagination:M.value.pagination,filter:M.value.filter,"visible-columns":C.value},{top:t(()=>[o("div",At,[o("div",It,[o("span",qt,[e(h,{color:"pink-5",icon:"sync",onClick:y,round:"",dense:"",flat:""}),k(" Productos: "+u(V.value.length),1)]),k(", "),o("span",Qt,"Piezas: "+u(j(g)),1)]),e(Ve,{dense:"",modelValue:M.value.filter,"onUpdate:modelValue":a[1]||(a[1]=s=>M.value.filter=s),placeholder:"Buscar","input-class":"text-uppercase",color:"pink-5"},{append:t(()=>[e(se,{name:"search"})]),_:1},8,["modelValue"]),e(h,{color:"secondary",icon:"fas fa-eye","no-caps":""},{default:t(()=>[e(me,{style:{"min-width":"200px"}},{default:t(()=>[e(Ce,null,{default:t(()=>[(n(!0),S(H,null,oe(M.value.columns,(s,A)=>le((n(),$(re,{tag:"label",key:A},{default:t(()=>[e(Q,null,{default:t(()=>[e(ie,null,{default:t(()=>[k(u(s.label),1)]),_:2},1024),e(ie,{caption:""},{default:t(()=>[k(u(s.coldesc),1)]),_:2},1024)]),_:2},1024),e(Q,{side:"",top:""},{default:t(()=>[e(Ge,{color:"pink-5",modelValue:C.value,"onUpdate:modelValue":a[2]||(a[2]=L=>C.value=L),val:s.name},null,8,["modelValue","val"])]),_:2},1024)]),_:2},1024)),[[Ee]])),128))]),_:1})]),_:1})]),_:1})])]),_:1},8,["rows","columns","pagination","filter","visible-columns"])):(n(),S("div",Ot,"Nada por aqui"))]),_:1}),e(ye,{name:"supliers"},{default:t(()=>[e(ue,{rows:K.value,"row-key":"id",dense:"",flat:"",bordered:"",grid:"","hide-header":""},{item:t(s=>[o("div",Ut,[e(ee,{flat:"",bordered:""},{default:t(()=>[e(q,{class:"text-center"},{default:t(()=>[k(" Surtidor "),Rt,o("strong",null,u(s.row._suplier),1),e(G,{spaced:"",inset:"",vertical:"",dark:""}),e(se,{name:"print",color:"pink",size:"sm",onClick:A=>Le(s.row)},{default:t(()=>[e(me,{class:"bg-grey-1 text-indigo-10",style:{"min-width":"250px"}},{default:t(()=>[e(xe,{onSelectedPartition:qe,partition:!0})]),_:1})]),_:2},1032,["onClick"]),Lt,o("div",Tt,[e(tt,{color:"primary","text-color":"white",label:s.row.status.name},null,8,["label"])])]),_:2},1024),e(G),e(q,{class:"flex justify-between"},{default:t(()=>[i.value.from._type!=1?(n(),S("div",Ft,jt)):(n(),S("div",Nt,Mt)),Gt]),_:1}),e(G),e(q,{class:"flex justify-between"},{default:t(()=>[i.value.from._type!=1?(n(),S("div",Ht,[o("div",null,u(s.row.invoice),1),o("div",null,u(s.row.invoice_received),1)])):(n(),S("div",Kt,[o("div",null,u(s.row.invoice),1)])),o("div",Jt,[s.row._status==6?(n(),S("div",Xt,[e(h,{color:"pink",label:"En Camino",class:"q-px-xl q-py-xs",size:"10px",padding:"5px 2px","icon-right":"start",flat:"",onClick:A=>Qe(s.row)},null,8,["onClick"])])):D("",!0),s.row._status>=7?(n(),S("div",Wt,[e(h,{color:"pink",icon:"qr_code",onClick:A=>pe(s.row.entry_key),flat:""},null,8,["onClick"])])):D("",!0),s.row._status>=7?(n(),S("div",Zt,[e(h,{color:"pink",icon:"list",onClick:A=>Te(s.row),flat:""},null,8,["onClick"])])):D("",!0)])]),_:2},1024)]),_:2},1024)])]),_:1},8,["rows"])]),_:1})]),_:1},8,["modelValue"])],64))]),_:1}),e(te,{modelValue:J.value.state,"onUpdate:modelValue":a[4]||(a[4]=s=>J.value.state=s)},{default:t(()=>[e(ee,null,{default:t(()=>[e(q,{class:"text-h6 text-center"},{default:t(()=>[k(u(i.value.id)+" - "+u(i.value.from.alias),1)]),_:1}),e(G),e(q,{class:"text-center"},{default:t(()=>[el,o("div",tl,u(J.value.key),1)]),_:1}),e(G),e(q,{align:"center"},{default:t(()=>[e(h,{color:"indigo-10",icon:"print"},{default:t(()=>[e(me,null,{default:t(()=>[e(xe,{onSelected:ge})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]),e(te,{modelValue:B.value.state,"onUpdate:modelValue":a[6]||(a[6]=s=>B.value.state=s)},{default:t(()=>[e(ee,null,{default:t(()=>[e(q,{class:"row items-start"},{default:t(()=>[e(we,{icon:"warning",color:"orange-14","text-color":"white"}),ll]),_:1}),e(q,null,{default:t(()=>[o("div",null,[al,o("div",ol,u(w.value._suplier),1)])]),_:1}),w.value?(n(),$(q,{key:0},{default:t(()=>[e(ne,{modelValue:p.value.val,"onUpdate:modelValue":a[5]||(a[5]=s=>p.value.val=s),options:p.value.filter,label:"CHOFER","option-label":"complete_name",filled:"",style:{width:"100%"},onFilter:Ue,"input-debounce":"0","use-input":""},null,8,["modelValue","options"])]),_:1})):D("",!0),e(fe,{align:"right"},{default:t(()=>[le(e(h,{flat:"",label:"Cancelar",color:"primary","no-caps":""},null,512),[[_e]]),e(h,{flat:"",label:"Continuar",color:"primary",onClick:X,"no-caps":"",disable:p.value.val==null},null,8,["disable"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),e(te,{modelValue:_.value.state,"onUpdate:modelValue":a[8]||(a[8]=s=>_.value.state=s),persistent:""},{default:t(()=>[e(ee,{style:{width:"400px"}},{default:t(()=>[e(q,{class:"row items-center"},{default:t(()=>[e(ne,{modelValue:c.value.val,"onUpdate:modelValue":a[7]||(a[7]=s=>c.value.val=s),options:c.value.filter,label:"SELECCIONA SURTIDOR","option-label":"complete_name",filled:"",multiple:"",counter:"","max-values":"5",hint:"Maximo 5 colaboradores",style:{width:"100%"},onFilter:Oe,"input-debounce":"0","use-input":"","use-chips":""},null,8,["modelValue","options"])]),_:1}),e(fe,{align:"right"},{default:t(()=>[le(e(h,{flat:"",label:"Cancel",color:"primary"},null,512),[[_e]]),e(h,{flat:"",label:"Continuar",color:"primary",onClick:R,disable:c.value.val.length==0},null,8,["disable"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),e(te,{modelValue:d.value,"onUpdate:modelValue":a[9]||(a[9]=s=>d.value=s),persistent:""},{default:t(()=>[e(ee,null,{default:t(()=>[e(q,{class:"row items-center"},{default:t(()=>[e(we,{icon:"warning",color:"negative","text-color":"white"}),sl,o("div",nl,u(i.value.id),1)]),_:1}),e(q,null,{default:t(()=>[k(" Es correcto? ")]),_:1}),e(fe,{align:"center"},{default:t(()=>[le(e(h,{flat:"",label:"Cancel",color:"positive"},null,512),[[_e]]),e(h,{flat:"",label:"Confirmar",color:"negative",onClick:Re})]),_:1})]),_:1})]),_:1},8,["modelValue"])],64))}},dl={class:"text-h6"},rl={class:"row q-mt-md"},ul={class:"q-ml-sm text-h6"},cl={__name:"TableReport",props:{rows:{type:Array,default:[]},name:{type:String,default:""},type:{type:String,default:""}},emits:["cardResumeActived"],setup(Z,{emit:b}){const I=Z;lt();const m=ce(),c=v({state:!1,action:null}),p=v({columns:[{name:"ID",field:"ID",label:"ID",align:"center"},{name:"code",field:"CODIGO",label:"Codigo",align:"center",sortable:!0},{name:"desc",field:"DESCRIPCION",label:"Descripcion",align:"left"},{name:"stockcedis",field:"CEDIS",label:"Stock (CEDIS)",align:"center",sortable:!0},{name:"stockpan",field:"PANTACO",label:"Stock (PAN)",align:"center",sortable:!0}],filter:""}),T={pndcs:{l:"Habilitar todo",c:"indigo-13",desc:"Los productos en esta lista se habilitaran y podran ser solicitados por cuaqluier tienda."},pdss:{l:"Deshabilitar todo",c:"pink-13",desc:"Los productos en esta lista se deshabilitaran y no podran ser solicitados."}},w=v(I.rows),i=v(I.name),x=v(I.type),F=N(()=>x.value?T[x.value]:{l:"",c:""}),O=()=>{const V=T[x.value];c.value.action=V,c.value.state=!0},P=async()=>{m.loading.show({message:"Espera..."});const V=await z.massiveAction({action:x.value});console.log(V),V.status==200?(V.data,c.value.state=!1,c.value.action=null,m.loading.hide(),m.notify({position:"center",color:"positive",icon:"done"}),b("cardResumeActived")):(console.error(V.data),alert(`Error ${V.status}: ${V.data.msg}`))},f=(V,Y,B)=>{console.log(V),console.log(Y),console.log(B),console.log(x.value)};return(V,Y)=>(n(),S(H,null,[e(ue,{"row-key":"ID",rows:w.value,columns:p.value.columns,filter:p.value.filter,onRowClick:f},{top:t(()=>[o("div",dl,u(i.value),1),o("div",rl,[e(h,{color:j(F).c,icon:"warning",label:j(F).l,onClick:O},null,8,["color","label"]),e(Ve,{modelValue:p.value.filter,"onUpdate:modelValue":Y[0]||(Y[0]=B=>p.value.filter=B),dense:"",type:"text",icon:"search",label:"Buscar"},{prepend:t(()=>[e(se,{name:"search"})]),_:1},8,["modelValue"])])]),_:1},8,["rows","columns","filter"]),e(te,{modelValue:c.value.state,"onUpdate:modelValue":Y[1]||(Y[1]=B=>c.value.state=B),persistent:""},{default:t(()=>[e(ee,null,{default:t(()=>[e(q,{class:"row items-center"},{default:t(()=>[e(we,{icon:"warning",color:c.value.action.c,"text-color":"white"},null,8,["color"]),o("span",ul,u(c.value.action.l),1)]),_:1}),e(q,null,{default:t(()=>[k(u(c.value.action.desc),1)]),_:1}),e(fe,{align:"right"},{default:t(()=>[le(e(h,{flat:"",label:"cancelar",color:"primary"},null,512),[[_e]]),e(h,{flat:"",label:"continuar",color:"primary",onClick:P})]),_:1})]),_:1})]),_:1},8,["modelValue"])],64))}},pl={key:0,class:"bg-negative text-white q-pa-md q-mb-md"},vl=o("div",{class:"text-warning text-bold"},"Los siguientes folios tienen errores que no permiten ser listados en la tabla. ",-1),ml={class:"text-h6"},fl=o("div",{class:"text--2"},"Errores comunes: Sin log, Sin fecha, Estatus desconocido",-1),_l={class:"row q-mb-md items-start justify-around"},gl={class:"text-left"},bl={class:"text-h5"},yl={class:"text--2"},hl={class:"full-width row items-center"},kl={class:"col text-h6 text-dark"},xl={__name:"AdminDashboard",emits:["reloadDashboard","freshOrder"],setup(Z,{emit:b}){Se(),Ae();const I=$e(),m=ce(),c=["text-grey-5 text-bold","text-bold text-h6 text-red","text-indigo","4","5","text-bold text-pink-7","text-orange-8","8","text-primary","text-positive"],p=v({columns:[{name:"id",label:"Folio",field:"id",align:"center",sortable:!0},{name:"state",label:"Estado",field:d=>d.log.length==1?d.log[0].name:d.log[d.log.length-1].name,align:"left",sortable:!0,sort:(d,_,r,C)=>parseInt(r._status)-parseInt(C._status),classes:d=>c[d._status?parseInt(d._status)-1:parseInt(d.status.id)-1]},{name:"suplier",label:"Surtidores",field:d=>{var _;return(_=d.partition)==null?void 0:_.length},align:"center",classes:"text-bold"},{name:"laststate",label:"Ultima actividad",field:d=>ae(d.log.find(_=>_.id==d.status.id).pivot.updated_at).format("YYYY-MM-DD hh:mm A"),align:"left"},{name:"from",label:"Sucursal",field:d=>d.from.name.toUpperCase(),align:"left",sortable:!0},{name:"to",label:"Destino",field:d=>d.to.name.toUpperCase(),align:"left",sortable:!0},{name:"notes",label:"Notas",field:d=>d.notes,align:"left",classes:"text-orange text-bold"},{name:"tmodels",label:"Modelos",field:d=>d.products_count,align:"center",sortable:!0}],filter:"",pagination:{sortBy:"desc",descending:!1,rowsPerPage:20}}),T=v(!1),w=v({state:!1,title:"",data:null,name:null,type:null}),i=v({state:!1,head:null,block:!0}),x=N(()=>I.ordersSize),F=N(()=>I.ordersok.filter(d=>d._status!=100)),O=N(()=>I.ordersok.filter(d=>d._status==100)),P=N(()=>I.orderserrors),f=N(()=>I.resume),V=async d=>{console.log(d.row),i.value.head=d.row,i.value.state=!0},Y=async d=>{m.loading.show({message:"cargando..."+d});const _=await z.report(d);console.log(_.data),w.value.data=_.data.rows,w.value.name=_.data.name,w.value.type=d,w.value.state=!0,m.loading.hide()},B=()=>{w.value.state=!1,w.state=!1,b("reload")},J=d=>{console.log(d),console.log("Se crearon las particiones",d),b("freshOrder",d)},K=()=>{T.value=!0};return(d,_)=>(n(),$(at,{padding:"",class:"bg-grey-2"},{default:t(()=>[j(P).length?(n(),S("div",pl,[vl,o("div",ml,u(j(P).map(r=>r.id).join("id")),1),fl])):D("",!0),o("div",_l,[(n(!0),S(H,null,oe(j(f),r=>(n(),$(h,{stack:"","no-caps":"",class:"q-py-md",key:r.key,onClick:C=>Y(r.key),color:r.total==0?"teal-10":"pink-13",disabled:r.total==0},{default:t(()=>[o("div",gl,[o("div",bl,u(r.total),1),o("div",yl,u(r.name),1)])]),_:2},1032,["onClick","color","disabled"]))),128))]),e(ue,{flat:"",bordered:"","row-key":"id",rows:j(F),columns:p.value.columns,filter:p.value.filter,pagination:p.value.pagination},{header:t(r=>[e(he,{props:r},{default:t(()=>[e(De,{"auto-width":""}),(n(!0),S(H,null,oe(r.cols,C=>(n(),$(De,{key:C.name,props:r},{default:t(()=>[k(u(C.label),1)]),_:2},1032,["props"]))),128))]),_:2},1032,["props"])]),body:t(r=>[e(he,{props:r},{default:t(()=>[e(ke,{"auto-width":""},{default:t(()=>[e(h,{size:"sm",dense:"",round:"",flat:"",onClick:C=>r.expand=!r.expand,icon:r.expand?"expand_less":"expand_more"},null,8,["onClick","icon"])]),_:2},1024),(n(!0),S(H,null,oe(r.cols,C=>(n(),$(ke,{key:C.name,props:r,onClick:M=>V(r)},{default:t(()=>[k(u(C.value),1)]),_:2},1032,["props","onClick"]))),128))]),_:2},1032,["props"]),le(e(he,{props:r},{default:t(()=>[e(ke,{colspan:"100%"},{default:t(()=>[e(Ce,{dense:"",padding:"",class:"rounded-borders"},{default:t(()=>[e(re,null,{default:t(()=>[e(Q,null,{default:t(()=>[k("ID")]),_:1}),e(Q,null,{default:t(()=>[k("ESTADO")]),_:1}),r.row.from._type==2?(n(),$(Q,{key:0},{default:t(()=>[k(" SALIDA")]),_:1})):D("",!0),r.row.from._type==2?(n(),$(Q,{key:1},{default:t(()=>[k("ENTRADA")]),_:1})):D("",!0),r.row.from._type==1?(n(),$(Q,{key:2},{default:t(()=>[k("TRASPASO")]),_:1})):D("",!0)]),_:2},1024),(n(!0),S(H,null,oe(r.row.partition,(C,M)=>(n(),S("div",{key:M},[e(re,null,{default:t(()=>[e(Q,null,{default:t(()=>[e(ie,{overline:""},{default:t(()=>[k(u(C._suplier),1)]),_:2},1024),e(ie,{caption:""},{default:t(()=>[k(u(C.id),1)]),_:2},1024)]),_:2},1024),e(Q,{class:Ne(`${c[C.status.id-1]}`)},{default:t(()=>[k(u(C.status.name),1)]),_:2},1032,["class"]),r.row.from._type==2?(n(),$(Q,{key:0},{default:t(()=>[k(u(C.invoice),1)]),_:2},1024)):D("",!0),r.row.from._type==2?(n(),$(Q,{key:1},{default:t(()=>[k(u(C.invoice_received),1)]),_:2},1024)):D("",!0),r.row.from._type==1?(n(),$(Q,{key:2},{default:t(()=>[k(u(C.invoice),1)]),_:2},1024)):D("",!0)]),_:2},1024),e(G,{spaced:"",inset:""})]))),128))]),_:2},1024)]),_:2},1024)]),_:2},1032,["props"]),[[Ye,r.expand]])]),top:t(()=>[o("div",hl,[o("div",kl,"Pedidos: "+u(j(x)),1),e(Ve,{dense:"",modelValue:p.value.filter,"onUpdate:modelValue":_[0]||(_[0]=r=>p.value.filter=r),"input-class":"text-uppercase",placeholder:"Buscar",color:"pink-5"},{append:t(()=>[e(se,{name:"search"})]),_:1},8,["modelValue"]),e(G,{spaced:"",inset:"",vertical:"",dark:""}),o("div",null,[e(se,{name:"archive",size:"md",color:"negative",onClick:K})])])]),_:1},8,["rows","columns","filter","pagination"]),e(te,{"full-width":"",modelValue:i.value.state,"onUpdate:modelValue":_[3]||(_[3]=r=>i.value.state=r),persistent:i.value.block,"no-esc-dismiss":i.value.block,"no-backdrop-dismiss":i.value.block},{default:t(()=>[e(il,{head:i.value.head,onLoaded:_[1]||(_[1]=r=>i.value.block=!1),onLoading:_[2]||(_[2]=r=>i.value.block=!0),onFresh:J,onChofiAssigned:J},null,8,["head"])]),_:1},8,["modelValue","persistent","no-esc-dismiss","no-backdrop-dismiss"]),e(te,{modelValue:w.value.state,"onUpdate:modelValue":_[4]||(_[4]=r=>w.value.state=r)},{default:t(()=>[e(cl,{rows:w.value.data,name:w.value.name,type:w.value.type,onCardResumeActived:B},null,8,["rows","name","type"])]),_:1},8,["modelValue"]),e(te,{modelValue:T.value,"onUpdate:modelValue":_[5]||(_[5]=r=>T.value=r),"full-width":""},{default:t(()=>[e(ee,{style:{width:"700px","max-width":"80vw"}},{default:t(()=>[e(q,{class:"q-pt-none"},{default:t(()=>[e(ue,{flat:"",bordered:"","row-key":"id",rows:j(O),columns:p.value.columns,pagination:p.value.pagination,title:"Pedidos Cancelados"},null,8,["rows","columns","pagination"])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1}))}};const wl=o("div",{class:"text-bold"},"Dashboard ",-1),Cl={class:"text-bold"},Sl={class:"row"},$l={class:"col row"},Gl={__name:"DashboardLyt",setup(Z){var M;const b=Se(),I=Ae(),m=$e(),c=ce(),p=nt,T=v([{id:0,alias:"Todas"},{id:1,alias:"CEDIS",_state:1},{id:2,alias:"SP1",_state:1}]),w=v([{id:"day",label:"Hoy"},{id:"week",label:"Semana"},{id:"month",label:"Mes"},{id:"C",label:"otra ...",disable:!0}]),i=["BOL","SAP","TEX","BRA"],x=v((M=b.query.d)!=null?M:"SAP"),F=v(null),O=v(null),P=v({from:ae(Date.now()).startOf("day"),to:ae(Date.now()).startOf("day")}),f=async()=>{var X;c.loading.show({message:"Cargado vista..."}),console.log("%cIniciando MainLayout...","font-size:2em;color:orange;");let g=(X=b.query.v)!=null?X:"day";console.log(g);let y=w.value.findIndex(pe=>pe.id==g),E=y>=0?y:0;O.value=w.value[E],P.value.from=ae(Date.now()).startOf(O.value.id);let U=b.query.d&&i.includes(b.query.d)?b.query.d:"SAP";console.log(U);const R=await z.index(O.value.id,U);console.log(R),m.fillOrders(R.orders),m.fillResume(R.resume),m.fillPrinters(R.printers),F.value=T.value[0],console.log("%cMainLayout listo!!","font-size:2em;color:orange;"),c.loading.hide(),W.connect(),W.emit("joinat",p),W.on("joineddashreq",Y),W.on("creating",J),W.on("order_update",K),W.on("order_changestate",d),W.on("order_refresh",_),W.on("orderpartition_refresh",C)},V=g=>{let y=b.query.d&&i.includes(b.query.d)?b.query.d:"all";I.push(`/dashboard?v=${g.id}&d=${y}`)};N(()=>P.value.from.format("YYYY/MM/DD")),N(()=>P.value.to.format("YYYY/MM/DD"));const Y=g=>{console.log(`%c${g.user.me.nick} de ${g.from.alias} se ha unido a Restock (UID: ${g.user.me.id})`,"background:#076F3E;color:#f5f6fa;border-radius:10px;padding:10px;font-size:1.1em;")},B=()=>{var y;console.log(x.value);let g=(y=b.query.v)!=null?y:"day";I.push(`/dashboard?v=${g}&d=${x.value}`)},J=async g=>{let y=g.order,E=await z.orderFresh(y.id),U=E.data.order,R=E.data.oid;m.addOrUpdate(R,U)},K=g=>{m.orderUpdate(g)},d=async g=>{let y=g.order,E=g.state,U=await z.orderFresh(y.id),R=U.data.order,X=U.data.oid;m.addOrUpdate(X,R),E.id==2&&c.notify({message:`El pedido <b>${y.id}</b> esta listo para iniciar surtido!!`,color:"positive",textColor:"white",position:"bottom",html:!0,timeout:5e3})},_=async g=>{console.log("REFRESHING BY SKT!!",g);let y=g.order,E=await z.orderFresh(y);console.log(E);let U=E.data.order;console.log(U.partition);let R=E.data.oid;m.addOrUpdate(R,U)},r=g=>{console.log("orderViewer/AdminDashboard actualizaron el pedido:",g),W.emit("order_refresh",{order:g})},C=async g=>{console.log("Partition refresh!!",g);let y=g.order,E=await z.orderFresh(y);console.log(E);let U=E.data.order,R=U.partition,X=E.data.oid;m.addOrUpdate(X,U),R.filter(ge=>ge._status==4).length==R.length&&c.notify({message:`El pedido <b>${X}</b> esta listo para iniciar <b>embarque</b>`,html:!0,color:"purple-10",icon:"fa-solid fa-truck-ramp-box"})};return Me(()=>b.query,()=>{f()}),f(),document.title="Dashboard",(g,y)=>(n(),$(Ke,{view:"lHh Lpr lFf"},{default:t(()=>[e(Je,{bordered:"",class:"bg-yellow text-dark"},{default:t(()=>[e(He,{class:"row justify-between items-center"},{default:t(()=>[wl,o("div",Cl,"Cedis "+u(x.value=="SAP"?"SAN PABLO":x.value=="TEX"?"TEXCOCO":x.value=="BOL"?"BOLIVIA":x.value=="BRA"?"BRASIL":"TODOS ? "),1),o("div",Sl,[e(h,{color:"dark",round:"",unelevated:"",flat:"",icon:"sync",onClick:f}),o("div",$l,[e(ne,{modelValue:x.value,"onUpdate:modelValue":[y[0]||(y[0]=E=>x.value=E),B],options:i,label:"Almacen",filled:"",dense:""},null,8,["modelValue"]),e(G,{spaced:"",inset:"",vertical:"",dark:""}),e(ne,{class:"col",dense:"",filled:"",label:"Vista",modelValue:O.value,"onUpdate:modelValue":[y[1]||(y[1]=E=>O.value=E),V],options:w.value},null,8,["modelValue","options"]),O.value.id=="C"?(n(),$(h,{key:0,unelevated:"",color:"pink-5",icon:"fa-calendar-day",dense:""})):D("",!0)])])]),_:1})]),_:1}),e(Xe,null,{default:t(()=>[e(xl,{onReload:f,onFreshOrder:r})]),_:1})]),_:1}))}};export{Gl as default};
