import{ar as U,k as M,r as g,c as O,a as B,d as L,w as n,e as r,u as P,h as _,t as q,j as N,q as T,Q as C}from"./index.7e921193.js";import{u as z,Q as H,a as G}from"./use-quasar.7b47a71b.js";import{Q as J}from"./QSeparator.c14e4b85.js";import{Q as K}from"./QToolbar.0e5cd21d.js";import{Q as X}from"./QHeader.74755d06.js";import{Q as W}from"./QDate.c5e08d29.js";import{Q as Z,a as E}from"./QCard.c76abb4b.js";import{Q as ee}from"./QCardActions.04da1783.js";import{Q as te,a as oe}from"./QLayout.43a8fcfe.js";import{d as Q}from"./dayjs.min.25545ff6.js";import{R as h}from"./RestockApi.b0d544bf.js";import{u as F}from"./Restock.b5a8dba6.js";import{Q as ae}from"./QInput.565cd4eb.js";import{Q as re}from"./QTable.a1281efc.js";import{Q as se}from"./QPage.951cf0d6.js";import"./axios.10c2b4ae.js";import"./QTabs.332db8e0.js";import"./QItem.53775c98.js";import"./QList.f7fbec1e.js";import"./QToggle.b3a23ab3.js";import"./ClosePopup.16f9acec.js";import"./jspdf.plugin.autotable.dd6c5f1c.js";import{$sktRestock as s,usrSkt as le}from"./socket.97cb7a0e.js";import"./use-key-composition.e06502bd.js";import"./uid.42677368.js";import"./format.65a4c853.js";import"./rtl.403b2679.js";import"./use-timeout.422eb332.js";import"./_commonjsHelpers.88e99c8f.js";import"./touch.70a9dd44.js";const ie={class:"full-width row items-center"},ne={class:"col text-h6 text-dark"},de={__name:"OrdersCheckout",props:{dash:{type:Object,default:{}}},setup(w){const b=w;U();const i=M(),c=F(),k=["text-grey-5 text-bold","text-bold text-h6 text-red","text-indigo","text-orange-8 text-bold","text-positive text-bold","6","7","8","9","9"],m=g({columns:[{name:"id",label:"Folio",field:"id",align:"center"},{name:"state",label:"Estado",field:t=>t.log.length==1?t.log[0].name:t.log[t.log.length-1].name,align:"left",sortable:!0,sort:(t,l,v,y)=>parseInt(v._status)-parseInt(y._status),classes:t=>k[t._status-1]},{name:"laststate",label:"Ultima actividad",field:t=>Q(t.log.find(l=>l.id==t.status.id).pivot.updated_at).format("YYYY-MM-DD hh:mm A"),align:"left"},{name:"from",label:"Sucursal",field:t=>t.from.name.toUpperCase(),align:"left",sortable:!0},{name:"models",label:"Modelos",field:"products_count",align:"center"},{name:"notes",label:"Notas",field:t=>t.notes,align:"left"},{name:"invoice",label:"Salida",field:t=>{var l;return(l=t.invoice)!=null?l:"--"},align:"center"}],filter:"",pagination:{sortBy:"desc",descending:!1,rowsPerPage:20}}),p=(t,l,v)=>i.push(`/checkout/${l.id}`),d=O(()=>c.ordersdb.filter(t=>b.dash.id==0?t._status>2:t._status>2&&t.to.id==b.dash.id));return(t,l)=>(B(),L(se,{padding:""},{default:n(()=>[r(re,{flat:"","row-key":"id",rows:P(d),columns:m.value.columns,filter:m.value.filter,pagination:m.value.pagination,onRowClick:p},{top:n(()=>[_("div",ie,[_("div",ne,"Pedidos: "+q(P(d).length),1),r(ae,{dense:"",modelValue:m.value.filter,"onUpdate:modelValue":l[0]||(l[0]=v=>m.value.filter=v),"input-class":"text-uppercase",placeholder:"Buscar",color:"pink-5"},{append:n(()=>[r(N,{name:"search"})]),_:1},8,["modelValue"])])]),_:1},8,["rows","columns","filter","pagination"])]),_:1}))}};const ce=_("div",{class:"text-bold"},"CheckOut ",-1),ue={class:"row"},me={class:"col row"},pe={class:"q-pa-md"},fe={class:"q-pb-sm"},ze={__name:"CheckoutLyt",setup(w){const b=U();M();const i=F(),c=z(),k=le,m=g([{id:0,alias:"Todas"},{id:1,alias:"CEDIS",_state:1},{id:2,alias:"SP1",_state:1}]),p=g({val:null}),d=g(!1),t=[{id:0,label:"TODAS"},{id:1,label:"CEDIS SN PABLO",_state:1},{id:2,label:"CEDIS TEXCOCO",_state:1},{id:16,label:"CEDIS BRASIL",_state:1},{id:24,label:"CEDIS BOLIVIA",_state:1}],l=g({id:1,label:"CEDIS SN PABLO",_state:1}),v=g(null);g(null);const y=g({from:Q(Date.now()).startOf("day"),to:Q(Date.now()).startOf("day")}),x=async()=>{c.loading.show({message:"Cargado vista..."}),console.log("%cIniciando MainLayout...","font-size:2em;color:orange;"),p.value.val=Q(new Date).format("YYYY/MM/DD");const e=await h.index({date:p.value.val});console.log(e),i.fillOrders(e.orders),i.fillResume(e.resume),i.fillPrinters(e.printers),v.value=m.value[0],console.log("%cMainLayout listo!!","font-size:2em;color:orange;"),c.loading.hide(),s.connect(),s.emit("joinat",k),s.on("joineddashreq",S),s.on("creating",$),s.on("order_update",Y),s.on("order_changestate",I),s.on("order_refresh",R),s.on("orderpartition_refresh",V)};O(()=>y.value.from.format("YYYY/MM/DD")),O(()=>y.value.to.format("YYYY/MM/DD")),T(()=>b.query,()=>{x()});const S=e=>{console.log(`%c${e.user.me.nick} de ${e.from.alias} se ha unido a Restock (UID: ${e.user.me.id})`,"background:#076F3E;color:#f5f6fa;border-radius:10px;padding:10px;font-size:1.1em;")},$=async e=>{let a=e.order;console.log(`Pedido ${a.id} iniciado`);let o=await h.orderFresh(a.id),u=o.data.order,f=o.data.oid;i.addOrUpdate(f,u)},Y=e=>{i.orderUpdate(e)},I=async e=>{let a=e.order;console.log(`Refrescando orden ${a.id}`),e.state;let o=await h.orderFresh(a.id);console.log(o.data);let u=o.data.order,f=o.data.oid;i.addOrUpdate(f,u),u._status==4&&c.notify({message:`El pedido <b>${a.id}</b> esta listo para CheckOut!!`,color:"positive",textColor:"white",position:"bottom",html:!0,timeout:5e3})},R=async e=>{console.log("REFRESHING BY SKT!!",e);let a=e.order,o=await h.orderFresh(a);console.log(o);let u=o.data.order,f=o.data.oid;i.addOrUpdate(f,u)},V=async e=>{console.log("Partition refresh!!",e);let a=e.order,o=await h.orderFresh(a);console.log(o);let u=o.data.order,f=u.partition,D=o.data.oid;i.addOrUpdate(D,u),f.filter(A=>A._status==4).length==f.length?c.notify({message:`El pedido ${D} ha finalizado particiones`,html:!0,color:"purple-10",icon:"fa-solid fa-truck-ramp-box"}):c.notify({message:`Particion lista para checkout en pedidido <b>${D}</b>`,html:!0,color:"pink-14",icon:"fa-solid fa-truck-ramp-box"})},j=async()=>{d.value=!1,c.loading.show({message:"Obteniendo Datos"});const e=await h.index({date:p.value.val});console.log(e),i.fillOrders(e.orders),i.fillResume(e.resume),i.fillPrinters(e.printers),v.value=m.value[0],console.log("%cMainLayout listo!!","font-size:2em;color:orange;"),c.loading.hide(),s.connect(),s.emit("joinat",k),s.on("joineddashreq",S),s.on("creating",$),s.on("order_update",Y),s.on("order_changestate",I),s.on("order_refresh",R),s.on("orderpartition_refresh",V)};return x(),document.title="CheckOut",(e,a)=>(B(),L(te,{view:"lHh Lpr lFf"},{default:n(()=>[r(X,{bordered:"",class:"bg-cyan-10"},{default:n(()=>[r(K,{class:"row justify-between items-center"},{default:n(()=>[ce,_("div",ue,[r(C,{color:"white",round:"",unelevated:"",flat:"",icon:"sync",onClick:x}),_("div",me,[r(H,{modelValue:l.value,"onUpdate:modelValue":a[0]||(a[0]=o=>l.value=o),options:t,filled:"",dense:""},null,8,["modelValue"]),r(J,{spaced:"",inset:"",vertical:"",dark:""}),r(C,{color:"primary",icon:"event",onClick:a[1]||(a[1]=o=>d.value=!d.value),flat:"",round:""})])])]),_:1})]),_:1}),r(G,{modelValue:d.value,"onUpdate:modelValue":a[4]||(a[4]=o=>d.value=o)},{default:n(()=>[r(Z,{class:"my-card"},{default:n(()=>[r(E,null,{default:n(()=>[_("div",pe,[_("div",fe,q(p.value.val),1),r(W,{modelValue:p.value.val,"onUpdate:modelValue":a[2]||(a[2]=o=>p.value.val=o),range:"",minimal:""},null,8,["modelValue"])])]),_:1}),r(E,null,{default:n(()=>[r(ee,{align:"right"},{default:n(()=>[r(C,{flat:"",icon:"close",color:"negative",onClick:a[3]||(a[3]=o=>d.value=!d.value)}),r(C,{flat:"",icon:"check",color:"positive",onClick:j})]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]),r(oe,null,{default:n(()=>[r(de,{dash:l.value},null,8,["dash"])]),_:1})]),_:1}))}};export{ze as default};
