import{r as m,c as z,o as c,aF as x,f as o,d as e,w as t,h as y,aH as M,i as E,e as j,aA as Z,b as S,aN as je,Q as le,t as p,aE as h,R as $e,u as xe,a7 as ze,aG as te,aJ as he,x as Be,a as De,aO as Ye,aP as Ne,g as Me}from"./index.522acccc.js";import{u as ue,s as B,a as ie,x as re,y as A,z as ae,t as pe,v as ke,Q as de,w as W,A as Se}from"./QTable.b111e15f.js";import{a as Ge,Q as He}from"./QToggle.08a45e0e.js";import{Q as Ke,a as Je,b as Xe}from"./QLayout.0939920e.js";import{Q as We}from"./QDate.14a1296f.js";import{b as D,Q as we,a as X,c as ne}from"./QCardActions.6fc3480c.js";import{d as ee}from"./dayjs.min.25545ff6.js";import{R as T}from"./RestockApi.b0d544bf.js";import{a as Ce,Q as Ze,b as et,c as fe,d as tt,e as _e,f as lt,u as at}from"./Restock.5c2d7e80.js";import{Q as ge,a as be}from"./QTd.2ec8b3a1.js";import{Q as ot}from"./QPage.00842823.js";import{Q as st}from"./QTabs.b2436da9.js";import{C as ve}from"./ClosePopup.263651ea.js";import{A as se}from"./AssistApi.d49e53f7.js";import{b as nt}from"./jspdf.plugin.autotable.2c4f5619.js";import{p as Ve}from"./pdfCreate.1e7dfeef.js";import{$sktRestock as U,usrSkt as it}from"./socket.97cb7a0e.js";import"./rtl.7f7f7520.js";import"./use-cache.b0833c75.js";import"./_commonjsHelpers.88e99c8f.js";import"./axios.10c2b4ae.js";const rt={class:"q-pa-sm bg-grey-2 text-bold row justify-between items-center",style:{"min-width":"250px"}},dt=o("div",null,"Impresion",-1),ut={key:0,class:"row justify-between items-center"},ct={class:"q-mt-sm q-pa-sm"},pt={key:0,class:"q-pa-sm"},vt={class:"text--3"},mt={class:"q-pa-sm text-right"},ye={__name:"PrinterSelect",props:{partition:{type:Boolean}},emits:["selected","selectedPartition"],setup(G,{emit:I}){const k=ue(),f=Ce(),v=m(null),g=m(null),w=z(()=>f.printers),V=z(()=>v.value?v.value.printers:[]),r=()=>{k.localStorage.set("LUP",{wkp:v.value,printer:g.value}),I("selected",g.value)},_=()=>{k.localStorage.set("LUP",{wkp:v.value,printer:g.value}),I("selectedPartition",g.value)},q=k.localStorage.getItem("LUP");return q&&(v.value=q.wkp,g.value=q.printer),(Y,$)=>(c(),x(M,null,[o("div",rt,[dt,v.value?(c(),x("div",ut,[e(Ze,{flat:""},{default:t(()=>[e(y,{flat:"",color:"positive",icon:"add",dense:""}),g.value?(c(),x(M,{key:0},[e(y,{flat:"",color:"negative",icon:"delete",dense:""}),e(y,{flat:"",color:"orange",icon:"edit",dense:""})],64)):E("",!0)]),_:1})])):E("",!0)]),e(B),o("div",ct,[e(ie,{modelValue:v.value,"onUpdate:modelValue":[$[0]||($[0]=b=>v.value=b),$[1]||($[1]=b=>g.value=null)],options:j(w),label:"Sucursal",filled:"","option-label":"alias","option-value":"id"},null,8,["modelValue","options"])]),v.value?(c(),x("div",pt,[e(ie,{modelValue:g.value,"onUpdate:modelValue":$[2]||($[2]=b=>g.value=b),options:j(V),label:"Impresora",filled:"","option-value":"id","option-label":"name"},{option:t(b=>[Z((c(),S(re,je({clickable:""},b.itemProps),{default:t(()=>[e(A,{class:"text-center",side:""},{default:t(()=>[e(le,{color:"primary","text-color":"white",name:"print",size:"30px"}),o("span",vt,"ID:"+p(b.opt.id),1)]),_:2},1024),e(A,null,{default:t(()=>[e(ae,null,{default:t(()=>[h(p(b.opt.name),1)]),_:2},1024),e(ae,{caption:"",lines:"2"},{default:t(()=>[h(p(b.opt.ip),1)]),_:2},1024)]),_:2},1024)]),_:2},1040)),[[$e]])]),_:1},8,["modelValue","options"])])):E("",!0),o("div",mt,[v.value&&g.value&&!G.partition?(c(),S(y,{key:0,color:"primary",icon:"print",onClick:r})):E("",!0),v.value&&g.value&&G.partition?(c(),S(y,{key:1,color:"secondary",icon:"print",onClick:_})):E("",!0)])],64))}},ft=o("div",{class:"text-overline text-grey-7"},"Sucursal",-1),_t={class:"text-h6"},gt={class:"q-px-lg text-center"},bt=o("div",{class:"text-overline text-grey-7"},"Folio",-1),yt={class:"text-h6"},ht={class:"text-right"},kt=o("div",{class:"text-overline text-grey-7"},"Agente",-1),xt={class:"text-h6"},wt={class:"text-center"},Ct=o("div",{class:"text-overline text-grey-7"},"Fecha",-1),St={class:"text-h6"},Vt={key:0,class:"text-center"},$t=o("div",{class:"text-overline text-grey-7 col"},"Notas",-1),Dt={class:"text-h6"},Et={class:"text-center"},It={class:"text-overline text-grey-7"},Pt={class:"text-h6"},Ot={class:"full-width row items-center"},At={class:"col text-dark"},Qt={class:"text-h6"},Ut={class:"text-bold"},qt={key:1,class:"text-center q-pa-lg text-h6 text-grey-7"},Rt={class:"q-pa-xs col-xs-12 col-sm-6 col-md-4"},Lt=o("br",null,null,-1),Tt=o("br",null,null,-1),Ft={class:"text-overline text-grey-7"},jt={key:0},zt=o("div",null,"Salida",-1),Bt=o("div",null,"Entrada",-1),Yt=[zt,Bt],Nt={key:1},Mt=o("div",null,"Traspaso",-1),Gt=[Mt],Ht=o("div",null,"Herramientas",-1),Kt={key:0},Jt={key:1},Xt={class:"row"},Wt={key:0,class:"col"},Zt={key:1,class:"col"},el={key:2,class:"col"},tl=o("canvas",{id:"qrcode"},null,-1),ll={class:"text--2"},al=o("div",{class:"q-ml-md"},[o("div",{class:"text-h6"},"Cambiar a En Camino?"),o("div",null,"Cambiara a estatus en camino")],-1),ol=o("div",{class:"text-center text-h6"},"Surtidor",-1),sl={class:"text-center text-bold text-subtitle2 text-overline"},nl=o("div",{class:"q-ml-sm text-bold"},"Estas a punto de cancelar el pedido ",-1),il={class:"q-ml-sm text-bold"},rl={__name:"OrderViewer",props:{head:{type:Object,default:{}}},emits:["loaded","loading","fresh","chofiAssigned"],setup(G,{emit:I}){const k=G,f=ue();xe();const v=m({opts:[],val:[],filter:[]}),g=m({opts:null,val:null,filter:null}),w=m(null),V=m(null),r=m(k.head),_=m(null),q=m(!0),Y=m([]),$=m("supliers"),b=m(null),C=m([]),F=m(!1),R=m({state:!1}),H=m({state:!1,key:null}),N=m(null),K=m(!1),d=m({state:!1}),i=m(null),s=m([]),u=m({columns:[{name:"id",label:"ID",field:"id",align:"left",coldesc:"Identificador del producto (MySQL)"},{name:"code",label:"Codigo",field:"code",align:"left",coldesc:"Codigo principal del producto"},{name:"assocs",label:"Asociados",field:l=>l.variants.length?l.variants.map(a=>a.barcode).join(", "):null,align:"left",coldesc:"Codigos relacionados al codigo principal"},{name:"bcode",label:"Codigo de Barras",field:"barcode",align:"center",coldesc:"Codigo de barras principal"},{name:"locs",label:"Ubicacion",field:l=>l.locations.length?l.locations.map(a=>a.path).join(", "):"--",align:"left",coldesc:"Ubicaciones en almacen general"},{name:"stocks",label:"Stock (pzs)",field:l=>l.stocks.reduce((a,n)=>a+n.pivot.stock,0),sortable:!0,classes:l=>l.stocks.reduce((a,n)=>a+n.pivot.stock,0)<=0?"text-red text-bold":"text-bold text-primary",align:"center",coldesc:"Stock total en almacenes GENERALES (CEDIS+PAN)"},{name:"ipack",label:"PxC",field:l=>typeof l.pivot.ipack=="number"?l.pivot.ipack:l.pieces,align:"center",coldesc:"Unidades x Embalaje"},{name:"request",label:"Solicitud",field:l=>l.pivot.amount,align:"center",coldesc:"Embalaje solicitado"},{name:"uspply",label:"Unidad",field:l=>l.units.id==3?"Cajas":"Piezas",align:"left",coldesc:"Unidad de embalaje del producto"},{name:"delivery",label:"Salida (conteo)",field:l=>l.pivot.toDelivered,align:"center",coldesc:"Embalaje surtido",sortable:!0},{name:"reqinpzs",label:"Piezas",field:l=>l.pivot._supply_by==3?(typeof l.pivot.ipack=="number"?l.pivot.ipack:l.pieces)*(typeof l.pivot.ipack=="number"?l.pivot.toDelivered:l.pivot.amount):typeof l.pivot.ipack=="number"?l.pivot.toDelivered:l.pivot.amount,align:"center",coldesc:"Unidades totales en embalaje"},{name:"checkout",label:"Checkout",field:l=>l.pivot.checkout?"OK":"---",align:"center",classes:l=>l.pivot.checkout?"text-positive text-bold":"text-red",sortable:!0,coldesc:"Revision del Administrador"},{name:"received",label:"Entrada (conteo)",field:l=>l.pivot.toReceived,align:"center",coldesc:"Embalaje recibido"},{name:"descr",label:"Descripcion",field:"description",align:"left"},{name:"section",label:"Seccion",field:"section",align:"left"},{name:"family",label:"Familia",field:"family",align:"left"},{name:"category",label:"Categoria",field:"category",align:"left"}],filter:"",pagination:{sortBy:"locs",descending:!1,rowsPerPage:20}}),O=z(()=>C.value.reduce((l,a)=>l+(a.pivot._supply_by==3?a.pivot.amount*a.pieces:a.pivot.amount),0));z(()=>b.value&&(b.value.id==2||b.value.id==6)),z(()=>Y.value.find(l=>l.id==b.value.id).pivot),z(()=>N.value.map(l=>l._status).includes(6));const Q=async()=>{I("loading"),q.value=!0;let l=await T.order(r.value.id);if(console.log(l.data),C.value=l.data.products,Y.value=l.data.log.map(a=>(a.pivot.details=JSON.parse(a.pivot.details),a)),N.value=l.data.partition,b.value=l.data.status,_.value=l.data,i.value=l.data.invoice,b.value.id==2){console.log(_.value.to.id);let a=await se.getSupply(_.value.to.id);console.log(a),v.value.opts=a}q.value=!1,I("loaded")},J=()=>{d.value.state=!0},oe=()=>{K.value=!0},me=async()=>{console.log("Iniciando surtido"),I("loading"),F.value=!0;let l=3,a={id:r.value.id,state:l};const n=await T.nextState(a);if(n.status==200){F.value=!1,f.notify({message:`Surtido iniciado para el pedido  ${r.value.id}`,icon:"done",position:"center",color:"teal"});let P={supplyer:v.value.val,pedido:r.value.id,status:l,_workpoint_to:r.value.to.id,_workpoint_from:r.value.from.id},L=await se.SaveSupply(P);console.log(L),L.status==200?(Q(),I("fresh",r.value.id),d.value.state=!1):alert(`Error ${L.status}: ${L.data} 2`)}else alert(`Error ${n.status}: ${n.data} 1`);I("loaded")},Ee=async()=>{console.log("Generando factura"),f.loading.show({message:"Cambiando, espera..."});let l={chofi:g.value.val,supplyer:V.value._suplier_id,pedido:r.value.id,status:7},a=await se.SaveChofi(l);if(console.log("%cDELIVERY ASSIGNED","color:white; background:#b71540; font-size:1.3em;"),console.log(a),a.status==200){let n={id:r.value.id,state:7,suply:V.value._suplier_id};console.log(n);let P=await se.nextState(n);if(console.log("%cState Changed on Assist","color:white; background:#0a3d62; font-size:1.2em;"),console.log(P),P.data.partitionsEnd>_.value._status){console.log("%cTodas las particiones se han finalizado","color:white; background:#eb2f06; font-size:1.3em;");let L={id:r.value.id,state:P.data.partitionsEnd};console.log(L);const ce=await T.nextState(L);console.log("%cState Changed on RestockAPI","color:white; background:#079992; font-size:1.3em;"),console.log(ce)}if(I("chofiAssigned",n.id),P.status==200){Q();let L=P.data.partition.id,ce=N.value.findIndex(Fe=>Fe.id==L);N.value[ce]._status=P.data.partition._status,N.value[ce].invoice=P.data.partition.invoice}f.notify({message:"Pedido en ruta",position:"center",icon:"done",timeout:5e3,color:"positive"}),R.value.state=!1}else alert(`Error ${a.status}: ${a.data}`);f.loading.hide()},Ie=async l=>{let a=`http://192.168.10.189:2200/#/checkin/${r.value.id}?key=${l}`;H.value.state=!0,Be(()=>nt.toCanvas(document.getElementById("qrcode"),a))},Pe=async l=>{f.loading.show({message:"..."}),console.log(l);const a=await T.printKey({ip:l.ip,port:l._port,order:r.value.id});a.status==200?(a.data,f.loading.hide(),f.notify({message:"Impresion correcta",icon:"done",color:"positive",position:"top"})):(console.error(a),alert(`Error ${a.status}: ${a.data}`))},Oe=async l=>{f.loading.show({message:"..."}),console.log(l);const a=await T.printForSupply({ip:l.ip,port:l._port,order:r.value.id});console.log(a),a.status==200?(a.data?f.notify({message:"Impresion correcta",icon:"done",color:"positive",position:"top"}):f.notify({message:`Sin conexion a <b>${l.name} <small>(${l.ip})</small></b>`,icon:"fas fa-bug",color:"negative",position:"center",html:!0,timeout:4e3}),f.loading.hide()):(console.error(a),alert(`Error ${a.status}: ${a.data}`))},Ae=async l=>{f.loading.show({message:"..."}),console.log(l.ip),console.log(w.value);const a=await T.printForPartition({ip:l.ip,port:l._port,_partition:w.value,_workpoint_to:r.value._workpoint_to});console.log(a),a.status==200?(a.data?f.notify({message:"Impresion correcta",icon:"done",color:"positive",position:"top"}):f.notify({message:`Sin conexion a <b>${l.name} <small>(${l.ip})</small></b>`,icon:"fas fa-bug",color:"negative",position:"center",html:!0,timeout:4e3}),f.loading.hide()):(console.error(a),alert(`Error ${a.status}: ${a.data}`))},Qe=async l=>{V.value=l,R.value.state=!0;let a=await se.getSupply(_.value.to.id);console.log(a),g.value.opts=a},Ue=(l,a,n)=>{a(()=>{if(l==="")v.value.filter=v.value.opts;else{const P=l.toLowerCase();v.value.filter=v.value.opts.filter(L=>L.complete_name.toLowerCase().indexOf(P)>-1)}})},qe=(l,a,n)=>{a(()=>{if(l==="")g.value.filter=g.value.opts;else{const P=l.toLowerCase();g.value.filter=g.value.opts.filter(L=>L.complete_name.toLowerCase().indexOf(P)>-1)}})},Re=async()=>{console.log("Eliminando Pedido"),I("loading");let l=100,a={id:r.value.id,state:l};const n=await T.nextState(a);n.status==200?(K.value=!1,f.notify({message:`Surtido Cancelado para el pedido  ${r.value.id}`,icon:"close",position:"center",color:"negative"}),Q(),I("fresh",r.value.id)):alert(`Error ${n.status}: ${n.data} 1`),I("loaded")},Le=l=>{console.log(l.id),w.value=l.id},Te=l=>{console.log(_.value),_.value.from._type!=1?Ve.pdf(l.invoice,l.entry_key,r.value.id):(console.log(l.invoice),Ve.pdfTransfer(l.invoice,l.entry_key,r.value.id))};return ze(()=>s.value=u.value.columns.map(l=>l.name)),Q(),(l,a)=>(c(),x(M,null,[e(X,{class:"full-width"},{default:t(()=>[e(D,{class:"row justify-between"},{default:t(()=>[o("div",null,[ft,o("div",_t,p(r.value.from.alias),1)]),o("div",gt,[bt,o("div",yt,p(r.value.id),1)]),o("div",ht,[kt,o("div",xt,p(r.value.created_by.nick),1)])]),_:1}),e(B),e(D,{class:"row justify-between"},{default:t(()=>[o("div",wt,[Ct,o("div",St,p(j(ee)(r.value.updated_at).format("YYYY-MM-DD")),1)]),r.value.notes?(c(),x("div",Vt,[$t,o("div",Dt,p(r.value.notes),1)])):E("",!0),o("div",Et,[o("div",It,[b.value&&b.value.id==2?(c(),S(y,{key:0,color:"positive",icon:"start",dense:"",label:"Iniciar",onClick:J,flat:"",rounded:""})):E("",!0)]),e(B,{spaced:"",inset:"",vertical:"",dark:""}),o("div",Pt,[b.value&&b.value.id==2?(c(),S(y,{key:0,color:"negative",icon:"close",dense:"",label:"Declinar",onClick:oe,flat:"",rounded:""})):E("",!0)]),b.value&&b.value.id>2?(c(),S(y,{key:0,color:"indigo-10",icon:"print",dense:""},{default:t(()=>[e(pe,{class:"bg-grey-1 text-indigo-10",style:{"min-width":"250px"}},{default:t(()=>[e(ye,{onSelected:Oe,partition:!1})]),_:1})]),_:1})):E("",!0)])]),_:1}),e(B),q.value?(c(),S(D,{key:0,class:"text-center"},{default:t(()=>[e(et,{size:"50px",color:"purple"})]),_:1})):(c(),x(M,{key:1},[e(B),e(st,{modelValue:$.value,"onUpdate:modelValue":a[0]||(a[0]=n=>$.value=n),class:"text-pink-5",dense:"","no-caps":""},{default:t(()=>[e(fe,{name:"log",label:"Log"}),e(fe,{name:"basket",label:"Productos"}),e(fe,{name:"supliers",label:"Surtidores"})]),_:1},8,["modelValue"]),e(tt,{modelValue:$.value,"onUpdate:modelValue":a[3]||(a[3]=n=>$.value=n),animated:""},{default:t(()=>[e(_e,{name:"log"},{default:t(()=>[e(ke,null,{default:t(()=>[(c(!0),x(M,null,te(Y.value,n=>(c(),S(re,{key:n.id},{default:t(()=>[e(A,{avatar:""},{default:t(()=>[h(p(n.id),1)]),_:2},1024),e(A,null,{default:t(()=>[h(p(n.name),1)]),_:2},1024),e(A,null,{default:t(()=>[h(p(n.pivot.details.responsable),1)]),_:2},1024),e(A,null,{default:t(()=>[h("de "+p(j(ee)(n.pivot.created_at).format("h:mm a"))+" a "+p(j(ee)(n.pivot.updated_at).format("h:mm a")),1)]),_:2},1024)]),_:2},1024))),128))]),_:1})]),_:1}),e(_e,{name:"basket"},{default:t(()=>[C.value.length?(c(),S(de,{key:0,"row-key":"id",flat:"",rows:C.value,columns:u.value.columns,pagination:u.value.pagination,filter:u.value.filter,"visible-columns":s.value},{top:t(()=>[o("div",Ot,[o("div",At,[o("span",Qt,[e(y,{color:"pink-5",icon:"sync",onClick:Q,round:"",dense:"",flat:""}),h(" Productos: "+p(C.value.length),1)]),h(", "),o("span",Ut,"Piezas: "+p(j(O)),1)]),e(we,{dense:"",modelValue:u.value.filter,"onUpdate:modelValue":a[1]||(a[1]=n=>u.value.filter=n),placeholder:"Buscar","input-class":"text-uppercase",color:"pink-5"},{append:t(()=>[e(le,{name:"search"})]),_:1},8,["modelValue"]),e(y,{color:"secondary",icon:"fas fa-eye","no-caps":""},{default:t(()=>[e(pe,{style:{"min-width":"200px"}},{default:t(()=>[e(ke,null,{default:t(()=>[(c(!0),x(M,null,te(u.value.columns,(n,P)=>Z((c(),S(re,{tag:"label",key:P},{default:t(()=>[e(A,null,{default:t(()=>[e(ae,null,{default:t(()=>[h(p(n.label),1)]),_:2},1024),e(ae,{caption:""},{default:t(()=>[h(p(n.coldesc),1)]),_:2},1024)]),_:2},1024),e(A,{side:"",top:""},{default:t(()=>[e(Ge,{color:"pink-5",modelValue:s.value,"onUpdate:modelValue":a[2]||(a[2]=L=>s.value=L),val:n.name},null,8,["modelValue","val"])]),_:2},1024)]),_:2},1024)),[[$e]])),128))]),_:1})]),_:1})]),_:1})])]),_:1},8,["rows","columns","pagination","filter","visible-columns"])):(c(),x("div",qt,"Nada por aqui"))]),_:1}),e(_e,{name:"supliers"},{default:t(()=>[e(de,{rows:N.value,"row-key":"id",dense:"",flat:"",bordered:"",grid:"","hide-header":""},{item:t(n=>[o("div",Rt,[e(X,{flat:"",bordered:""},{default:t(()=>[e(D,{class:"text-center"},{default:t(()=>[h(" Surtidor "),Lt,o("strong",null,p(n.row._suplier),1),e(B,{spaced:"",inset:"",vertical:"",dark:""}),e(le,{name:"print",color:"pink",size:"sm",onClick:P=>Le(n.row)},{default:t(()=>[e(pe,{class:"bg-grey-1 text-indigo-10",style:{"min-width":"250px"}},{default:t(()=>[e(ye,{onSelectedPartition:Ae,partition:!0})]),_:1})]),_:2},1032,["onClick"]),Tt,o("div",Ft,[e(lt,{color:"primary","text-color":"white",label:n.row.status.name},null,8,["label"])])]),_:2},1024),e(B),e(D,{class:"flex justify-between"},{default:t(()=>[r.value.from._type!=1?(c(),x("div",jt,Yt)):(c(),x("div",Nt,Gt)),Ht]),_:1}),e(B),e(D,{class:"flex justify-between"},{default:t(()=>[r.value.from._type!=1?(c(),x("div",Kt,[o("div",null,p(n.row.invoice),1),o("div",null,p(n.row.invoice_received),1)])):(c(),x("div",Jt,[o("div",null,p(n.row.invoice),1)])),o("div",Xt,[n.row._status==6?(c(),x("div",Wt,[e(y,{color:"pink",label:"En Camino",class:"q-px-xl q-py-xs",size:"10px",padding:"5px 2px","icon-right":"start",flat:"",onClick:P=>Qe(n.row)},null,8,["onClick"])])):E("",!0),n.row._status>=7?(c(),x("div",Zt,[e(y,{color:"pink",icon:"qr_code",onClick:P=>Ie(n.row.entry_key),flat:""},null,8,["onClick"])])):E("",!0),n.row._status>=7?(c(),x("div",el,[e(y,{color:"pink",icon:"list",onClick:P=>Te(n.row),flat:""},null,8,["onClick"])])):E("",!0)])]),_:2},1024)]),_:2},1024)])]),_:1},8,["rows"])]),_:1})]),_:1},8,["modelValue"])],64))]),_:1}),e(W,{modelValue:H.value.state,"onUpdate:modelValue":a[4]||(a[4]=n=>H.value.state=n)},{default:t(()=>[e(X,null,{default:t(()=>[e(D,{class:"text-h6 text-center"},{default:t(()=>[h(p(r.value.id)+" - "+p(r.value.from.alias),1)]),_:1}),e(B),e(D,{class:"text-center"},{default:t(()=>[tl,o("div",ll,p(H.value.key),1)]),_:1}),e(B),e(D,{align:"center"},{default:t(()=>[e(y,{color:"indigo-10",icon:"print"},{default:t(()=>[e(pe,null,{default:t(()=>[e(ye,{onSelected:Pe})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]),e(W,{modelValue:R.value.state,"onUpdate:modelValue":a[6]||(a[6]=n=>R.value.state=n)},{default:t(()=>[e(X,null,{default:t(()=>[e(D,{class:"row items-start"},{default:t(()=>[e(he,{icon:"warning",color:"orange-14","text-color":"white"}),al]),_:1}),e(D,null,{default:t(()=>[o("div",null,[ol,o("div",sl,p(V.value._suplier),1)])]),_:1}),V.value?(c(),S(D,{key:0},{default:t(()=>[e(ie,{modelValue:g.value.val,"onUpdate:modelValue":a[5]||(a[5]=n=>g.value.val=n),options:g.value.filter,label:"CHOFER","option-label":"complete_name",filled:"",style:{width:"100%"},onFilter:qe,"input-debounce":"0","use-input":""},null,8,["modelValue","options"])]),_:1})):E("",!0),e(ne,{align:"right"},{default:t(()=>[Z(e(y,{flat:"",label:"Cancelar",color:"primary","no-caps":""},null,512),[[ve]]),e(y,{flat:"",label:"Continuar",color:"primary",onClick:Ee,"no-caps":"",disable:g.value.val==null},null,8,["disable"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),e(W,{modelValue:d.value.state,"onUpdate:modelValue":a[8]||(a[8]=n=>d.value.state=n),persistent:""},{default:t(()=>[e(X,{style:{width:"400px"}},{default:t(()=>[e(D,{class:"row items-center"},{default:t(()=>[e(ie,{modelValue:v.value.val,"onUpdate:modelValue":a[7]||(a[7]=n=>v.value.val=n),options:v.value.filter,label:"SELECCIONA SURTIDOR","option-label":"complete_name",filled:"",multiple:"",counter:"","max-values":"10",hint:"Maximo 10 colaboradores",style:{width:"100%"},onFilter:Ue,"input-debounce":"0","use-input":"","use-chips":""},null,8,["modelValue","options"])]),_:1}),e(ne,{align:"right"},{default:t(()=>[Z(e(y,{flat:"",label:"Cancel",color:"primary"},null,512),[[ve]]),e(y,{flat:"",label:"Continuar",color:"primary",onClick:me,disable:v.value.val.length==0},null,8,["disable"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),e(W,{modelValue:K.value,"onUpdate:modelValue":a[9]||(a[9]=n=>K.value=n),persistent:""},{default:t(()=>[e(X,null,{default:t(()=>[e(D,{class:"row items-center"},{default:t(()=>[e(he,{icon:"warning",color:"negative","text-color":"white"}),nl,o("div",il,p(r.value.id),1)]),_:1}),e(D,null,{default:t(()=>[h(" Es correcto? ")]),_:1}),e(ne,{align:"center"},{default:t(()=>[Z(e(y,{flat:"",label:"Cancel",color:"positive"},null,512),[[ve]]),e(y,{flat:"",label:"Confirmar",color:"negative",onClick:Re})]),_:1})]),_:1})]),_:1},8,["modelValue"])],64))}},dl={class:"text-h6"},ul={class:"row q-mt-md"},cl={class:"q-ml-sm text-h6"},pl={__name:"TableReport",props:{rows:{type:Array,default:[]},name:{type:String,default:""},type:{type:String,default:""}},emits:["cardResumeActived"],setup(G,{emit:I}){const k=G;at();const f=ue(),v=m({state:!1,action:null}),g=m({columns:[{name:"ID",field:"ID",label:"ID",align:"center"},{name:"code",field:"CODIGO",label:"Codigo",align:"center",sortable:!0},{name:"desc",field:"DESCRIPCION",label:"Descripcion",align:"left"},{name:"stockcedis",field:"CEDIS",label:"Stock (CEDIS)",align:"center",sortable:!0},{name:"stockpan",field:"PANTACO",label:"Stock (PAN)",align:"center",sortable:!0}],filter:""}),w={pndcs:{l:"Habilitar todo",c:"indigo-13",desc:"Los productos en esta lista se habilitaran y podran ser solicitados por cuaqluier tienda."},pdss:{l:"Deshabilitar todo",c:"pink-13",desc:"Los productos en esta lista se deshabilitaran y no podran ser solicitados."}},V=m(k.rows),r=m(k.name),_=m(k.type),q=z(()=>_.value?w[_.value]:{l:"",c:""}),Y=()=>{const C=w[_.value];v.value.action=C,v.value.state=!0},$=async()=>{f.loading.show({message:"Espera..."});const C=await T.massiveAction({action:_.value});console.log(C),C.status==200?(C.data,v.value.state=!1,v.value.action=null,f.loading.hide(),f.notify({position:"center",color:"positive",icon:"done"}),I("cardResumeActived")):(console.error(C.data),alert(`Error ${C.status}: ${C.data.msg}`))},b=(C,F,R)=>{console.log(C),console.log(F),console.log(R),console.log(_.value)};return(C,F)=>(c(),x(M,null,[e(de,{"row-key":"ID",rows:V.value,columns:g.value.columns,filter:g.value.filter,onRowClick:b},{top:t(()=>[o("div",dl,p(r.value),1),o("div",ul,[e(y,{color:j(q).c,icon:"warning",label:j(q).l,onClick:Y},null,8,["color","label"]),e(we,{modelValue:g.value.filter,"onUpdate:modelValue":F[0]||(F[0]=R=>g.value.filter=R),dense:"",type:"text",icon:"search",label:"Buscar"},{prepend:t(()=>[e(le,{name:"search"})]),_:1},8,["modelValue"])])]),_:1},8,["rows","columns","filter"]),e(W,{modelValue:v.value.state,"onUpdate:modelValue":F[1]||(F[1]=R=>v.value.state=R),persistent:""},{default:t(()=>[e(X,null,{default:t(()=>[e(D,{class:"row items-center"},{default:t(()=>[e(he,{icon:"warning",color:v.value.action.c,"text-color":"white"},null,8,["color"]),o("span",cl,p(v.value.action.l),1)]),_:1}),e(D,null,{default:t(()=>[h(p(v.value.action.desc),1)]),_:1}),e(ne,{align:"right"},{default:t(()=>[Z(e(y,{flat:"",label:"cancelar",color:"primary"},null,512),[[ve]]),e(y,{flat:"",label:"continuar",color:"primary",onClick:$})]),_:1})]),_:1})]),_:1},8,["modelValue"])],64))}},vl={key:0,class:"bg-negative text-white q-pa-md q-mb-md"},ml=o("div",{class:"text-warning text-bold"},"Los siguientes folios tienen errores que no permiten ser listados en la tabla. ",-1),fl={class:"text-h6"},_l=o("div",{class:"text--2"},"Errores comunes: Sin log, Sin fecha, Estatus desconocido",-1),gl={class:"row q-mb-md items-start justify-around"},bl={class:"text-left"},yl={class:"text-h5"},hl={class:"text--2"},kl={class:"full-width row items-center"},xl={class:"col text-h6 text-dark"},wl={__name:"AdminDashboard",props:{dash:{type:Object,default:{}}},emits:["reloadDashboard","freshOrder"],setup(G,{emit:I}){const k=G;xe(),De();const f=Ce(),v=ue(),g=["text-grey-5 text-bold","text-bold text-h6 text-red","text-indigo","4","5","text-bold text-pink-7","text-orange-8","8","text-primary","text-positive"],w=m({columns:[{name:"id",label:"Folio",field:"id",align:"center",sortable:!0},{name:"state",label:"Estado",field:d=>d.log.length==1?d.log[0].name:d.log[d.log.length-1].name,align:"left",sortable:!0,sort:(d,i,s,u)=>parseInt(s._status)-parseInt(u._status),classes:d=>g[d._status?parseInt(d._status)-1:parseInt(d.status.id)-1]},{name:"suplier",label:"Surtidores",field:d=>{var i;return(i=d.partition)==null?void 0:i.length},align:"center",classes:"text-bold"},{name:"laststate",label:"Ultima actividad",field:d=>ee(d.log.find(i=>i.id==d.status.id).pivot.updated_at).format("YYYY-MM-DD hh:mm A"),align:"left"},{name:"from",label:"Sucursal",field:d=>d.from.name.toUpperCase(),align:"left",sortable:!0},{name:"to",label:"Destino",field:d=>d.to.name.toUpperCase(),align:"left",sortable:!0},{name:"notes",label:"Notas",field:d=>d.notes,align:"left",classes:"text-orange text-bold"},{name:"tmodels",label:"Modelos",field:d=>d.products_count,align:"center",sortable:!0}],filter:"",pagination:{sortBy:"desc",descending:!1,rowsPerPage:20}}),V=m(!1),r=m({state:!1,title:"",data:null,name:null,type:null}),_=m({state:!1,head:null,block:!0}),q=z(()=>f.ordersSize),Y=z(()=>f.ordersok.filter(d=>k.dash.id==0?d._status!=100:d._status!=100&&d.to.id==k.dash.id)),$=z(()=>f.ordersok.filter(d=>d._status==100)),b=z(()=>f.orderserrors),C=z(()=>f.resume),F=async d=>{console.log(d.row),_.value.head=d.row,_.value.state=!0},R=async d=>{v.loading.show({message:"cargando..."+d});const i=await T.report(d);console.log(i.data),r.value.data=i.data.rows,r.value.name=i.data.name,r.value.type=d,r.value.state=!0,v.loading.hide()},H=()=>{r.value.state=!1,r.state=!1,I("reload")},N=d=>{console.log(d),console.log("Se crearon las particiones",d),I("freshOrder",d)},K=()=>{V.value=!0};return(d,i)=>(c(),S(ot,{padding:"",class:"bg-grey-2"},{default:t(()=>[j(b).length?(c(),x("div",vl,[ml,o("div",fl,p(j(b).map(s=>s.id).join("id")),1),_l])):E("",!0),o("div",gl,[(c(!0),x(M,null,te(j(C),s=>(c(),S(y,{stack:"","no-caps":"",class:"q-py-md",key:s.key,onClick:u=>R(s.key),color:s.total==0?"teal-10":"pink-13",disabled:s.total==0},{default:t(()=>[o("div",bl,[o("div",yl,p(s.total),1),o("div",hl,p(s.name),1)])]),_:2},1032,["onClick","color","disabled"]))),128))]),e(de,{flat:"",bordered:"","row-key":"id",rows:j(Y),columns:w.value.columns,filter:w.value.filter,pagination:w.value.pagination},{header:t(s=>[e(ge,{props:s},{default:t(()=>[e(Se,{"auto-width":""}),(c(!0),x(M,null,te(s.cols,u=>(c(),S(Se,{key:u.name,props:s},{default:t(()=>[h(p(u.label),1)]),_:2},1032,["props"]))),128))]),_:2},1032,["props"])]),body:t(s=>[e(ge,{props:s},{default:t(()=>[e(be,{"auto-width":""},{default:t(()=>[e(y,{size:"sm",dense:"",round:"",flat:"",onClick:u=>s.expand=!s.expand,icon:s.expand?"expand_less":"expand_more"},null,8,["onClick","icon"])]),_:2},1024),(c(!0),x(M,null,te(s.cols,u=>(c(),S(be,{key:u.name,props:s,onClick:O=>F(s)},{default:t(()=>[h(p(u.value),1)]),_:2},1032,["props","onClick"]))),128))]),_:2},1032,["props"]),Z(e(ge,{props:s},{default:t(()=>[e(be,{colspan:"100%"},{default:t(()=>[e(ke,{dense:"",padding:"",class:"rounded-borders"},{default:t(()=>[e(re,null,{default:t(()=>[e(A,null,{default:t(()=>[h("ID")]),_:1}),e(A,null,{default:t(()=>[h("ESTADO")]),_:1}),s.row.from._type==2?(c(),S(A,{key:0},{default:t(()=>[h(" SALIDA")]),_:1})):E("",!0),s.row.from._type==2?(c(),S(A,{key:1},{default:t(()=>[h("ENTRADA")]),_:1})):E("",!0),s.row.from._type==1?(c(),S(A,{key:2},{default:t(()=>[h("TRASPASO")]),_:1})):E("",!0)]),_:2},1024),(c(!0),x(M,null,te(s.row.partition,(u,O)=>(c(),x("div",{key:O},[e(re,null,{default:t(()=>[e(A,null,{default:t(()=>[e(ae,{overline:""},{default:t(()=>[h(p(u._suplier),1)]),_:2},1024),e(ae,{caption:""},{default:t(()=>[h(p(u.id),1)]),_:2},1024)]),_:2},1024),e(A,{class:Ye(`${g[u.status.id-1]}`)},{default:t(()=>[h(p(u.status.name),1)]),_:2},1032,["class"]),s.row.from._type==2?(c(),S(A,{key:0},{default:t(()=>[h(p(u.invoice),1)]),_:2},1024)):E("",!0),s.row.from._type==2?(c(),S(A,{key:1},{default:t(()=>[h(p(u.invoice_received),1)]),_:2},1024)):E("",!0),s.row.from._type==1?(c(),S(A,{key:2},{default:t(()=>[h(p(u.invoice),1)]),_:2},1024)):E("",!0)]),_:2},1024),e(B,{spaced:"",inset:""})]))),128))]),_:2},1024)]),_:2},1024)]),_:2},1032,["props"]),[[Ne,s.expand]])]),top:t(()=>[o("div",kl,[o("div",xl,"Pedidos: "+p(j(q)),1),e(we,{dense:"",modelValue:w.value.filter,"onUpdate:modelValue":i[0]||(i[0]=s=>w.value.filter=s),"input-class":"text-uppercase",placeholder:"Buscar",color:"pink-5"},{append:t(()=>[e(le,{name:"search"})]),_:1},8,["modelValue"]),e(B,{spaced:"",inset:"",vertical:"",dark:""}),o("div",null,[e(le,{name:"archive",size:"md",color:"negative",onClick:K})])])]),_:1},8,["rows","columns","filter","pagination"]),e(W,{"full-width":"",modelValue:_.value.state,"onUpdate:modelValue":i[3]||(i[3]=s=>_.value.state=s),persistent:_.value.block,"no-esc-dismiss":_.value.block,"no-backdrop-dismiss":_.value.block},{default:t(()=>[e(rl,{head:_.value.head,onLoaded:i[1]||(i[1]=s=>_.value.block=!1),onLoading:i[2]||(i[2]=s=>_.value.block=!0),onFresh:N,onChofiAssigned:N},null,8,["head"])]),_:1},8,["modelValue","persistent","no-esc-dismiss","no-backdrop-dismiss"]),e(W,{modelValue:r.value.state,"onUpdate:modelValue":i[4]||(i[4]=s=>r.value.state=s)},{default:t(()=>[e(pl,{rows:r.value.data,name:r.value.name,type:r.value.type,onCardResumeActived:H},null,8,["rows","name","type"])]),_:1},8,["modelValue"]),e(W,{modelValue:V.value,"onUpdate:modelValue":i[5]||(i[5]=s=>V.value=s),"full-width":""},{default:t(()=>[e(X,{style:{width:"700px","max-width":"80vw"}},{default:t(()=>[e(D,{class:"q-pt-none"},{default:t(()=>[e(de,{flat:"",bordered:"","row-key":"id",rows:j($),columns:w.value.columns,pagination:w.value.pagination,title:"Pedidos Cancelados"},null,8,["rows","columns","pagination"])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1}))}};const Cl=o("div",{class:"text-bold"},"Dashboard ",-1),Sl={class:"text-bold"},Vl={class:"row"},$l={class:"col row"},Dl={class:"q-pa-md"},El={class:"q-pb-sm"},Xl={__name:"DashboardLyt",setup(G){const I=xe();De();const k=Ce(),f=ue(),v=it,g=m([{id:0,alias:"Todas"},{id:1,alias:"CEDIS",_state:1},{id:2,alias:"SP1",_state:1}]),w=m({val:null}),V=m(!1),r=[{id:0,label:"TODAS"},{id:1,label:"CEDIS SN PABLO",_state:1},{id:2,label:"CEDIS TEXCOCO",_state:1},{id:16,label:"CEDIS BRASIL",_state:1},{id:24,label:"CEDIS BOLIVIA",_state:1}],_=m({id:1,label:"CEDIS SN PABLO",_state:1}),q=m(null);m(null);const Y=m({from:ee(Date.now()).startOf("day"),to:ee(Date.now()).startOf("day")}),$=async()=>{f.loading.show({message:"Cargado vista..."}),console.log("%cIniciando MainLayout...","font-size:2em;color:orange;"),w.value.val=ee(new Date).format("YYYY/MM/DD");const i=await T.index({date:w.value.val});console.log(i),k.fillOrders(i.orders),k.fillResume(i.resume),k.fillPrinters(i.printers),q.value=g.value[0],console.log("%cMainLayout listo!!","font-size:2em;color:orange;"),f.loading.hide(),U.connect(),U.emit("joinat",v),U.on("joineddashreq",b),U.on("creating",C),U.on("order_update",F),U.on("order_changestate",R),U.on("order_refresh",H),U.on("orderpartition_refresh",K)};z(()=>Y.value.from.format("YYYY/MM/DD")),z(()=>Y.value.to.format("YYYY/MM/DD"));const b=i=>{console.log(`%c${i.user.me.nick} de ${i.from.alias} se ha unido a Restock (UID: ${i.user.me.id})`,"background:#076F3E;color:#f5f6fa;border-radius:10px;padding:10px;font-size:1.1em;")},C=async i=>{let s=i.order,u=await T.orderFresh(s.id),O=u.data.order,Q=u.data.oid;k.addOrUpdate(Q,O)},F=i=>{k.orderUpdate(i)},R=async i=>{let s=i.order,u=i.state,O=await T.orderFresh(s.id),Q=O.data.order,J=O.data.oid;k.addOrUpdate(J,Q),u.id==2&&f.notify({message:`El pedido <b>${s.id}</b> esta listo para iniciar surtido!!`,color:"positive",textColor:"white",position:"bottom",html:!0,timeout:5e3})},H=async i=>{console.log("REFRESHING BY SKT!!",i);let s=i.order,u=await T.orderFresh(s);console.log(u);let O=u.data.order;console.log(O.partition);let Q=u.data.oid;k.addOrUpdate(Q,O)},N=i=>{console.log("orderViewer/AdminDashboard actualizaron el pedido:",i),U.emit("order_refresh",{order:i})},K=async i=>{console.log("Partition refresh!!",i);let s=i.order,u=await T.orderFresh(s);console.log(u);let O=u.data.order,Q=O.partition,J=u.data.oid;k.addOrUpdate(J,O),Q.filter(me=>me._status==4).length==Q.length&&f.notify({message:`El pedido <b>${J}</b> esta listo para iniciar <b>embarque</b>`,html:!0,color:"purple-10",icon:"fa-solid fa-truck-ramp-box"})},d=async()=>{V.value=!1,f.loading.show({message:"Obteniendo Datos"});const i=await T.index({date:w.value.val});console.log(i),k.fillOrders(i.orders),k.fillResume(i.resume),k.fillPrinters(i.printers),q.value=g.value[0],console.log("%cMainLayout listo!!","font-size:2em;color:orange;"),f.loading.hide(),U.connect(),U.emit("joinat",v),U.on("joineddashreq",b),U.on("creating",C),U.on("order_update",F),U.on("order_changestate",R),U.on("order_refresh",H),U.on("orderpartition_refresh",K)};return Me(()=>I.query,()=>{$()}),$(),document.title="Dashboard",(i,s)=>(c(),S(Ke,{view:"lHh Lpr lFf"},{default:t(()=>[e(Je,{bordered:"",class:"bg-yellow text-dark"},{default:t(()=>[e(He,{class:"row justify-between items-center"},{default:t(()=>{var u,O,Q,J;return[Cl,o("div",Sl,"Cedis "+p(((u=_.value)==null?void 0:u.id)=="1"?"SAN PABLO":((O=_.value)==null?void 0:O.id)==2?"TEXCOCO":((Q=_.value)==null?void 0:Q.id)==24?"BOLIVIA":((J=_.value)==null?void 0:J.id)==16?"BRASIL":"TODOS ? "),1),o("div",Vl,[e(y,{color:"dark",round:"",unelevated:"",flat:"",icon:"sync",onClick:$}),o("div",$l,[e(ie,{modelValue:_.value,"onUpdate:modelValue":s[0]||(s[0]=oe=>_.value=oe),options:r,filled:"",dense:""},null,8,["modelValue"]),e(B,{spaced:"",inset:"",vertical:"",dark:""}),e(y,{color:"primary",icon:"event",onClick:s[1]||(s[1]=oe=>V.value=!V.value),flat:"",round:""})])])]}),_:1})]),_:1}),e(W,{modelValue:V.value,"onUpdate:modelValue":s[4]||(s[4]=u=>V.value=u)},{default:t(()=>[e(X,{class:"my-card"},{default:t(()=>[e(D,null,{default:t(()=>[o("div",Dl,[o("div",El,p(w.value.val),1),e(We,{modelValue:w.value.val,"onUpdate:modelValue":s[2]||(s[2]=u=>w.value.val=u),range:"",minimal:""},null,8,["modelValue"])])]),_:1}),e(D,null,{default:t(()=>[e(ne,{align:"right"},{default:t(()=>[e(y,{flat:"",icon:"close",color:"negative",onClick:s[3]||(s[3]=u=>V.value=!V.value)}),e(y,{flat:"",icon:"check",color:"positive",onClick:d})]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]),e(Xe,null,{default:t(()=>[e(wl,{onReload:$,onFreshOrder:N,dash:_.value},null,8,["dash"])]),_:1})]),_:1}))}};export{Xl as default};
