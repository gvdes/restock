import{u as Q,a as Y,r as f,c as C,o as $,b as O,w as p,d as i,e as S,f as _,t as L,Q as N,g as j,h as D,i as z}from"./index.f71dd59b.js";import{Q as H,a as T,b as A,c as G,u as J,R as h,d as K,e as W,f as X,g as Z}from"./ClosePopup.004aec16.js";import{d as k}from"./dayjs.min.53a5c0af.js";import{u as R}from"./Restock.90e947d6.js";import"./axios.e009800f.js";import"./jspdf.plugin.autotable.ad50246c.js";import{$sktRestock as u,usrSkt as ee}from"./socket.66d9ef78.js";const te={class:"full-width row items-center"},oe={class:"col text-h6 text-dark"},ae={__name:"OrdersCheckout",setup(U){Q();const v=Y(),y=R(),c=["text-grey-5 text-bold","text-bold text-h6 text-red","text-indigo","text-orange-8 text-bold","text-positive text-bold","6","7","8","9","9"],l=f({columns:[{name:"id",label:"Folio",field:"id",align:"center"},{name:"state",label:"Estado",field:e=>e.log.length==1?e.log[0].name:e.log[e.log.length-1].name,align:"left",sortable:!0,sort:(e,s,d,m)=>parseInt(d._status)-parseInt(m._status),classes:e=>c[e._status-1]},{name:"laststate",label:"Ultima actividad",field:e=>k(e.log.find(s=>s.id==e.status.id).pivot.updated_at).format("YYYY-MM-DD hh:mm A"),align:"left"},{name:"from",label:"Sucursal",field:e=>e.from.name.toUpperCase(),align:"left",sortable:!0},{name:"models",label:"Modelos",field:"products_count",align:"center"},{name:"notes",label:"Notas",field:e=>e.notes,align:"left"},{name:"invoice",label:"Salida",field:e=>{var s;return(s=e.invoice)!=null?s:"--"},align:"center"}],filter:"",pagination:{sortBy:"desc",descending:!1,rowsPerPage:20}}),x=(e,s,d)=>v.push(`/checkout/${s.id}`),b=C(()=>y.ordersdb.filter(e=>e._status>2));return(e,s)=>($(),O(A,{padding:""},{default:p(()=>[i(H,{flat:"","row-key":"id",rows:S(b),columns:l.value.columns,filter:l.value.filter,pagination:l.value.pagination,onRowClick:x},{top:p(()=>[_("div",te,[_("div",oe,"Pedidos: "+L(S(b).length),1),i(T,{dense:"",modelValue:l.value.filter,"onUpdate:modelValue":s[0]||(s[0]=d=>l.value.filter=d),"input-class":"text-uppercase",placeholder:"Buscar",color:"pink-5"},{append:p(()=>[i(N,{name:"search"})]),_:1},8,["modelValue"])])]),_:1},8,["rows","columns","filter","pagination"])]),_:1}))}};const se=_("div",{class:"text-bold"},"CheckOut ",-1),re={class:"row"},le={class:"col row"},ge={__name:"CheckoutLyt",setup(U){const v=Q(),y=Y(),c=R(),l=J(),x=ee,b=f([{id:0,alias:"Todas"},{id:1,alias:"CEDIS",_state:1},{id:2,alias:"SP1",_state:1}]),e=f([{id:"day",label:"Hoy"},{id:"week",label:"Semana"},{id:"month",label:"Mes"},{id:"C",label:"otra ...",disable:!0}]),s=f(null),d=f(null),m=f({from:k(Date.now()).startOf("day"),to:k(Date.now()).startOf("day")}),w=async()=>{var n;l.loading.show({message:"Cargado vista..."}),console.log("%cIniciando MainLayout...","font-size:2em;color:orange;");let t=(n=v.query.v)!=null?n:"day",a=e.value.findIndex(g=>g.id==t),o=a>=0?a:0;d.value=e.value[o],m.value.from=k(Date.now()).startOf(d.value.id);const r=await h.index(d.value.id);console.log(r),c.fillOrders(r.orders),s.value=b.value[0],console.log("%cMainLayout listo!!","font-size:2em;color:orange;"),l.loading.hide(),u.connect(),u.emit("joinat",x),u.on("joineddashreq",F),u.on("creating",M),u.on("order_update",P),u.on("order_changestate",I),u.on("order_refresh",B),u.on("orderpartition_refresh",E)},V=t=>y.push(`/checkout?v=${t.id}`);C(()=>m.value.from.format("YYYY/MM/DD")),C(()=>m.value.to.format("YYYY/MM/DD")),j(()=>v.query,()=>{w()});const F=t=>{console.log(`%c${t.user.me.nick} de ${t.from.alias} se ha unido a Restock (UID: ${t.user.me.id})`,"background:#076F3E;color:#f5f6fa;border-radius:10px;padding:10px;font-size:1.1em;")},M=async t=>{let a=t.order;console.log(`Pedido ${a.id} iniciado`);let o=await h.orderFresh(a.id),r=o.data.order,n=o.data.oid;c.addOrUpdate(n,r)},P=t=>{c.orderUpdate(t)},I=async t=>{let a=t.order;console.log(`Refrescando orden ${a.id}`),t.state;let o=await h.orderFresh(a.id);console.log(o.data);let r=o.data.order,n=o.data.oid;c.addOrUpdate(n,r),r._status==4&&l.notify({message:`El pedido <b>${a.id}</b> esta listo para CheckOut!!`,color:"positive",textColor:"white",position:"bottom",html:!0,timeout:5e3})},B=async t=>{console.log("REFRESHING BY SKT!!",t);let a=t.order,o=await h.orderFresh(a);console.log(o);let r=o.data.order,n=o.data.oid;c.addOrUpdate(n,r)},E=async t=>{console.log("Partition refresh!!",t);let a=t.order,o=await h.orderFresh(a);console.log(o);let r=o.data.order,n=r.partition,g=o.data.oid;c.addOrUpdate(g,r),n.filter(q=>q._status==4).length==n.length?l.notify({message:`El pedido ${g} ha finalizado particiones`,html:!0,color:"purple-10",icon:"fa-solid fa-truck-ramp-box"}):l.notify({message:`Particion lista para checkout en pedidido <b>${g}</b>`,html:!0,color:"pink-14",icon:"fa-solid fa-truck-ramp-box"})};return w(),document.title="CheckOut",(t,a)=>($(),O(G,{view:"lHh Lpr lFf"},{default:p(()=>[i(X,{bordered:"",class:"bg-cyan-10"},{default:p(()=>[i(K,{class:"row justify-between items-center"},{default:p(()=>[se,_("div",re,[i(D,{color:"white",round:"",unelevated:"",flat:"",icon:"sync",onClick:w}),_("div",le,[i(W,{class:"col",dark:"",dense:"",filled:"",label:"Vista",modelValue:d.value,"onUpdate:modelValue":[a[0]||(a[0]=o=>d.value=o),V],options:e.value},null,8,["modelValue","options"]),d.value.id=="C"?($(),O(D,{key:0,unelevated:"",color:"pink-5",icon:"fas fa-calendar-day",dense:""})):z("",!0)])])]),_:1})]),_:1}),i(Z,null,{default:p(()=>[i(ae)]),_:1})]),_:1}))}};export{ge as default};
