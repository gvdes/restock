import{u as I,a as M,r as p,c as w,o as P,b as U,w as d,d as o,e as V,f,t as B,Q as A,g as j,h as b}from"./index.767d3255.js";import{Q as N,u as T,a as z,b as H,c as G}from"./QTable.7f8932d3.js";import{Q as J}from"./QToggle.ae638996.js";import{Q as K,a as X,b as W}from"./QLayout.27661e65.js";import{Q as Z}from"./QDate.62fb1d0b.js";import{Q as ee,a as te,b as E,c as ae}from"./QInput.be1c204b.js";import{d as y}from"./dayjs.min.25545ff6.js";import{R as _}from"./RestockApi.b0d544bf.js";import{u as L}from"./Restock.e38c5404.js";import{Q as oe}from"./QPage.b4f3eebb.js";import"./axios.10c2b4ae.js";import"./QTabs.a26a6991.js";import"./ClosePopup.5d030b49.js";import"./jspdf.plugin.autotable.e6f22c33.js";import{$sktRestock as r,usrSkt as se}from"./socket.97cb7a0e.js";import"./rtl.b38b1c0a.js";import"./_commonjsHelpers.88e99c8f.js";const le={class:"full-width row items-center"},re={class:"col text-h6 text-dark"},ie={__name:"OrdersSupply",props:{dash:{type:Object,default:{}}},setup(C){const h=C;I();const i=M(),c=L(),m=p({columns:[{name:"id",label:"Folio",field:"id",align:"center"},{name:"state",label:"Estado",field:e=>e.log.length==1?e.log[0].name:e.log[e.log.length-1].name,align:"left",sortable:!0,classes:e=>e._status==3?"text-positive text-bold":""},{name:"laststate",label:"Ultima actividad",field:e=>y(e.log.find(s=>s.id==e.status.id).pivot.updated_at).format("YYYY-MM-DD hh:mm A"),align:"left"},{name:"from",label:"Sucursal",field:e=>e.from.name.toUpperCase(),align:"left",sortable:!0},{name:"models",label:"Modelos",field:"products_count",align:"center"},{name:"notes",label:"Notas",field:e=>e.notes,align:"left"},{name:"invoice",label:"Salida",field:e=>{var s;return(s=e.invoice)!=null?s:"--"},align:"center"}],filter:"",pagination:{sortBy:"desc",descending:!1,rowsPerPage:20}}),k=(e,s,n)=>i.push(`/supply/${s.id}`),g=w(()=>c.ordersdb.filter(e=>h.dash.id==0?e._status>2:e._status>2&&e.to.id==h.dash.id));return(e,s)=>(P(),U(oe,{padding:""},{default:d(()=>[o(N,{flat:"","row-key":"id",rows:V(g),columns:m.value.columns,filter:m.value.filter,pagination:m.value.pagination,onRowClick:k},{top:d(()=>[f("div",le,[f("div",re,"Pedidos: "+B(V(g).length),1),o(ee,{dense:"",modelValue:m.value.filter,"onUpdate:modelValue":s[0]||(s[0]=n=>m.value.filter=n),"input-class":"text-uppercase",placeholder:"Buscar",color:"pink-5"},{append:d(()=>[o(A,{name:"search"})]),_:1},8,["modelValue"])])]),_:1},8,["rows","columns","filter","pagination"])]),_:1}))}};const de=f("div",{class:"text-bold"},"Resurtido ",-1),ne={class:"row"},ue={class:"col row"},ce={class:"q-pa-md"},me={class:"q-pb-sm"},Re={__name:"SupplyLyt",setup(C){const h=I();M();const i=L(),c=T(),m=se,k=[{id:0,label:"TODAS"},{id:1,label:"CEDIS SN PABLO",_state:1},{id:2,label:"CEDIS TEXCOCO",_state:1},{id:16,label:"CEDIS BRASIL",_state:1},{id:24,label:"CEDIS BOLIVIA",_state:1}],g=p({id:1,label:"CEDIS SN PABLO",_state:1}),e=p([{id:0,alias:"Todas"},{id:1,alias:"CEDIS",_state:1},{id:2,alias:"SP1",_state:1}]),s=p({val:null}),n=p(!1),D=p(null);p(null);const Q=p({from:y(Date.now()).startOf("day"),to:y(Date.now()).startOf("day")}),S=async()=>{c.loading.show({message:"Cargado vista..."}),console.log("%cIniciando MainLayout...","font-size:2em;color:orange;"),s.value.val=y(new Date).format("YYYY/MM/DD");const t=await _.index({date:s.value.val});console.log(t),i.fillOrders(t.orders),i.fillResume(t.resume),i.fillPrinters(t.printers),D.value=e.value[0],console.log("%cMainLayout listo!!","font-size:2em;color:orange;"),c.loading.hide(),r.connect(),r.emit("joinat",m),r.on("joineddashreq",O),r.on("creating",$),r.on("order_update",x),r.on("order_changestate",R),r.on("order_refresh",Y),r.on("orderpartition_refresh",sktOrderPartFresh)};w(()=>Q.value.from.format("YYYY/MM/DD")),w(()=>Q.value.to.format("YYYY/MM/DD"));const O=t=>{console.log(`%c${t.user.me.nick} de ${t.from.alias} se ha unido a Restock (UID: ${t.user.me.id})`,"background:#076F3E;color:#f5f6fa;border-radius:10px;padding:10px;font-size:1.1em;")},$=async t=>{let a=t.order;console.log(`El pedido ${a.id} ha sido iniciado!`);let l=await _.orderFresh(a.id),u=l.data.order,v=l.data.oid;i.addOrUpdate(v,u)},x=t=>{i.orderUpdate(t)},R=async t=>{let a=t.order;console.log(`Refrescando orden ${a.id}`);let l=t.state,u=await _.orderFresh(a.id);console.log(u.data);let v=u.data.order,q=u.data.oid;i.addOrUpdate(q,v),l.id==3&&c.notify({message:`El pedido <b>${a.id}</b> esta listo para surtir!!`,color:"positive",textColor:"white",position:"bottom",html:!0,timeout:5e3})},Y=async t=>{console.log("REFRESHING BY SKT!!",t);let a=t.order,l=await _.orderFresh(a);console.log(l);let u=l.data.order;console.log(u);let v=l.data.oid;i.addOrUpdate(v,u),u._status==3&&c.notify({message:`El pedido <b>${u.id}</b> esta listo para surtir!!`,color:"positive",textColor:"white",position:"bottom",html:!0,timeout:5e3})},F=async()=>{n.value=!1,c.loading.show({message:"Obteniendo Datos"});const t=await _.index({date:s.value.val});console.log(t),i.fillOrders(t.orders),i.fillResume(t.resume),i.fillPrinters(t.printers),D.value=e.value[0],console.log("%cMainLayout listo!!","font-size:2em;color:orange;"),c.loading.hide(),r.connect(),r.emit("joinat",m),r.on("joineddashreq",O),r.on("creating",$),r.on("order_update",x),r.on("order_changestate",R),r.on("order_refresh",Y),r.on("orderpartition_refresh",sktOrderPartFresh)};return j(()=>h.query,()=>{S()}),S(),document.title="Resurtido",(t,a)=>(P(),U(K,{view:"lHh Lpr lFf"},{default:d(()=>[o(X,{bordered:"",class:"transparent text-dark"},{default:d(()=>[o(J,{class:"row justify-between items-center"},{default:d(()=>[de,f("div",ne,[o(b,{color:"pink-5",round:"",unelevated:"",flat:"",icon:"sync",onClick:S}),f("div",ue,[o(z,{modelValue:g.value,"onUpdate:modelValue":a[0]||(a[0]=l=>g.value=l),options:k,filled:"",dense:""},null,8,["modelValue"]),o(H,{spaced:"",inset:"",vertical:"",dark:""}),o(b,{color:"primary",icon:"event",onClick:a[1]||(a[1]=l=>n.value=!n.value),flat:"",round:""})])])]),_:1})]),_:1}),o(G,{modelValue:n.value,"onUpdate:modelValue":a[4]||(a[4]=l=>n.value=l)},{default:d(()=>[o(te,{class:"my-card"},{default:d(()=>[o(E,null,{default:d(()=>[f("div",ce,[f("div",me,B(s.value.val),1),o(Z,{modelValue:s.value.val,"onUpdate:modelValue":a[2]||(a[2]=l=>s.value.val=l),range:"",minimal:""},null,8,["modelValue"])])]),_:1}),o(E,null,{default:d(()=>[o(ae,{align:"right"},{default:d(()=>[o(b,{flat:"",icon:"close",color:"negative",onClick:a[3]||(a[3]=l=>n.value=!n.value)}),o(b,{flat:"",icon:"check",color:"positive",onClick:F})]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]),o(W,null,{default:d(()=>[o(ie,{dash:g.value},null,8,["dash"])]),_:1})]),_:1}))}};export{Re as default};
