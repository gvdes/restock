import{ar as te,r as p,c as D,a as f,b as j,e as a,w as i,Q as k,g as C,t as d,u as _,i as $,h as l,j as G,at as F,as as J,aL as W,d as P,$ as re,aO as de,aP as O,f as ue,D as ce,k as pe}from"./index.46b313ec.js";import{Q as L,a as S}from"./QCard.0fb728b6.js";import{u as ae,f as ve,h as X,a as A,Q as me}from"./use-quasar.833708d0.js";import{Q as K}from"./QCardActions.89482656.js";import{a as Y,Q as fe}from"./QPage.3b7255b1.js";import{Q as _e,a as ge}from"./QLayout.a3308924.js";import{R as E}from"./RestockApi.75260ed3.js";import{Q as be}from"./QToolbarTitle.7af1d732.js";import{Q as ye}from"./QToolbar.220e77dc.js";import{Q as he}from"./QHeader.f5d93990.js";import{Q as N}from"./QInput.505e0cd7.js";import{Q as xe,a as Z}from"./QItem.b548151d.js";import{Q as ke}from"./QToggle.0936f262.js";import{Q as we}from"./QList.76a12b05.js";import{Q as Qe}from"./QTable.e38e3ee7.js";import{Q as Ce}from"./QForm.e6491753.js";import{Q as ee}from"./QFooter.01c1c853.js";import{C as $e}from"./ClosePopup.e9cae2a5.js";import{A as U}from"./AssistApi.d49e53f7.js";import{p as Se}from"./pdfCreate.939e69b4.js";import"./use-key-composition.7bdc05bb.js";import"./uid.42677368.js";import"./format.02636e7a.js";import"./rtl.8056f98d.js";import"./use-timeout.794c468a.js";import"./axios.10c2b4ae.js";import"./jspdf.plugin.autotable.e63df0d4.js";import"./_commonjsHelpers.88e99c8f.js";import"./dayjs.min.25545ff6.js";const Ee={key:0,class:"text--3"},Ve={key:0,class:"text-primary"},qe={class:"text-bold"},Re={class:"q-px-md q-py-sm"},je=l("div",{class:"col text-dark row justify-between"},null,-1),De={key:0,class:"row items-center justify-between q-pt-sm"},Pe=l("span",{class:"text--2"},"Contados:",-1),Ie=l("span",{class:"text--2"},"Por contar:",-1),Ue={class:"full-width row items-center justify-between"},Te={class:"row justify-between"},ze={class:"text-left"},Le={class:"text--3"},Ae={class:"text-h6"},Be={class:"text-right"},Fe={class:"text-bold"},Ne={class:"text--2"},Oe={class:"text-h6"},Ke={class:"text--2"},Me={class:"row items-start justify-between"},He={class:"text-center col text-primary"},Ge=l("div",null,"Solicitud",-1),Je={class:"text-bold"},We={class:"text-center col text-orange-10"},Xe=l("div",null,"Salida",-1),Ye={class:"text-bold"},Ze={class:"text-center col"},et=l("div",null,"PxC",-1),tt={class:"text-bold"},at={class:"text-center col"},ot=l("div",null,"Conteo",-1),lt={class:"text-center col"},st=l("div",null,"Piezas",-1),it={class:"text-bold"},nt=l("div",{class:"q-ml-md"},[l("div",{class:"text-h6"},"Quieres finalizar la revision?"),l("div",null,"EL pedido ya no podra editarse y se emitira una entrada...")],-1),rt={class:"q-pa-md text-bold text-uppercase text-center"},dt={__name:"OrderCheckin",props:{order:{type:Object,default:{}}},emits:["reload"],setup(M,{emit:x}){const y=M,g=ae(),b=te(),n=p(y.order),V=p({state:!1}),v=p(""),z=p(null),q=p(null),T=p(["code","request","ipack","uspply","delivery","checkout","received","reqinpzs"]),w=p({columns:[{name:"id",label:"ID",field:"id",align:"left",coldesc:"Identificador del producto (MySQL)"},{name:"code",label:"Codigo",field:"code",align:"left",coldesc:"Codigo principal del producto"},{name:"assocs",label:"Asociados",field:e=>e.variants.length?e.variants.map(s=>s.barcode).join(", "):null,align:"left",coldesc:"Codigos relacionados al codigo principal"},{name:"bcode",label:"Codigo de Barras",field:"barcode",align:"center",coldesc:"Codigo de barras principal"},{name:"ipack",label:"PxC",field:e=>typeof e.pivot.ipack=="number"?e.pivot.ipack:e.pieces,align:"center",coldesc:"Unidades x Embalaje"},{name:"request",label:"Solicitud",field:e=>e.pivot.amount,align:"center",coldesc:"Embalaje solicitado"},{name:"uspply",label:"Unidad",field:e=>e.pivot._supply_by==3?"Cajas":e.pivot._supply_by==2?"Docenas":"Piezas",align:"left",coldesc:"Unidad de embalaje del producto"},{name:"delivery",label:"Salida",field:e=>e.pivot.toDelivered,align:"center",coldesc:"Embalaje surtido",sortable:!0},{name:"reqinpzs",label:"Piezas",field:e=>e.pivot._supply_by==3?(typeof e.pivot.ipack=="number"?e.pivot.ipack:e.pieces)*(typeof e.pivot.ipack=="number"?e.pivot.toDelivered:e.pivot.amount):typeof e.pivot.ipack=="number"?e.pivot.toDelivered:e.pivot.amount,align:"center",coldesc:"Unidades totales en embalaje"},{name:"checkout",label:"Checkout",field:e=>e.pivot.checkout?"OK":null,classes:e=>e.pivot.checkout?"text-positive text-bold":"",align:"center",coldesc:"Revision del Administrador",sortable:!0},{name:"received",label:"Conteo",field:e=>e.pivot.toReceived,align:"center",coldesc:"Embalaje recepcion"},{name:"descr",label:"Descripcion",field:"description",align:"left"},{name:"section",label:"Seccion",field:"section",align:"left"},{name:"family",label:"Familia",field:"family",align:"left"},{name:"category",label:"Categoria",field:"category",align:"left"}],filter:"",pagination:{sortBy:"locs",descending:!1,rowsPerPage:20}}),t=p({state:!1,item:null,form:{count:0,ipack:null,setting:!1}}),r=D(()=>n.value?n.value.products.filter(e=>e.pivot.checkout==1):[]),u=D(()=>n.value?n.value.status:null),c=D(()=>u.value?u.value.id==9:!1),I=D(()=>r.value.filter(e=>typeof e.pivot.toReceived!="number")),R=D(()=>r.value.filter(e=>typeof e.pivot.toReceived=="number")),h=D(()=>{let e=v.value.toUpperCase().trim();return e.length?r.value.filter(s=>s.code.match(e)||s.barcode&&s.barcode.match(e)):r.value}),H=e=>{console.log(e),t.value.item=e,t.value.form.count=typeof e.pivot.toReceived=="number"?e.pivot.toReceived:0,t.value.form.ipack=typeof e.pivot.ipack=="number"?e.pivot.ipack:e.pieces,t.value.state=!0,ce(()=>{q.value.focus(),q.value.select()})},oe=()=>{let e=v.value.toUpperCase().trim();if(e.length){let s=h.value.length==1?h.value[0]:h.value.find(o=>o.code==e||o.barcode==e);s?H(s):g.notify({message:`Sin coincidencias para <b>${e}</b>`,color:"pink-5",position:"center",html:!0})}},le=async()=>{const e=parseInt(t.value.form.count),s=parseInt(t.value.form.ipack),o={order:t.value.item.pivot._partition,product:t.value.item.id,received:e,ipack:s,checkout:!1};console.log(o);const m=await E.setReceiveProduct(o);if(console.log(m),m.status==200){let Q=r.value.findIndex(ne=>ne.id==t.value.item.id);r.value[Q].pivot.toReceived=e,r.value[Q].pivot.ipack=s,t.value.state=!1,v.value="",g.notify({color:"positive",icon:"done",position:"right",message:""})}else alert(`Error ${m.status}: ${m.data}`)},se=async()=>{g.loading.show({message:"Generando, espera..."}),console.log(n.value.requisition.from._type);let e={id:b.params.oid,state:10,suply:n.value._suplier_id};console.log(e);let s=await U.nextState(e);if(s.status==200)if(n.value.requisition.from._type!=1){const o=await E.genEntry(n.value.id);if(console.log(o),o.status==200?(console.log(o.data),o.data?g.notify({message:`Se genero la Entrada <b class="text-h6">${o.data.invoice.folio}</b>`,html:!0,position:"center",icon:"done",timeout:5e3,color:"orange"}):alert("Error 500: Ocurrio un error inesperado :(")):(alert(`Error ${o.status}: ${o.data}`),console.log(o.data)),s.data.partitionsEnd>n.value.requisition._status){let m={id:b.params.oid,state:s.data.partitionsEnd};console.log(m);const Q=await E.nextState(m);console.log(Q)}g.notify({message:"Se genero la entrada",html:!0,position:"center",icon:"done",timeout:5e3,color:"positive"}),B(),console.log(s)}else{console.log("es Traspaso");const o=await E.genTransferRec(b.params.oid,n.value._suplier_id);if(console.log(o),o.status==200){if(s.data.partitionsEnd>n.value.requisition._status){let m={id:b.params.oid,state:s.data.partitionsEnd};console.log(m);const Q=await E.nextState(m);console.log(Q)}if(console.log(o),o.data.transfer){console.log(o),g.notify({message:`Se actualizo el traspaso  <b class="text-h6">${o.data.transfer.folio}</b>`,html:!0,position:"center",icon:"done",timeout:5e3,color:"positive"});let m=o.data.requisition.entry_key;Se.pdfTransfer(o.data.transfer.folio,m,b.params.oid)}B()}else alert(`Error ${o.status}: ${o.data}`)}else console.log(s);g.loading.hide()},ie=(e,s,o)=>c.value?H(s):null,B=()=>x("reload");return(e,s)=>(f(),j(F,null,[a(he,{bordered:"",class:"bg-white text-dark"},{default:i(()=>[a(ye,null,{default:i(()=>[a(k,{color:"pink-5",icon:"sync",onClick:B,round:"",dense:"",flat:""}),a(be,null,{default:i(()=>[C(" Pedido "+d(_(b).params.oid)+" ",1),n.value?(f(),j("span",Ee,"- "+d(n.value.requisition.from.alias),1)):$("",!0)]),_:1}),n.value.invoice_received?(f(),j("div",Ve,[l("div",null,d(n.value.requisition.from._type==1?"Traspaso":"Entrada"),1),l("div",qe,d(n.value.invoice_received),1)])):$("",!0)]),_:1}),a(Y),l("div",Re,[je,_(u)&&_(u).id>=5?(f(),j("div",De,[l("div",null,[Pe,C(),l("b",null,d(_(R).length),1)]),l("div",null,[Ie,C(),l("b",null,d(_(I).length),1)])])):$("",!0)])]),_:1}),a(Qe,{"row-key":"id",flat:"",rows:_(h),columns:w.value.columns,pagination:w.value.pagination,filter:w.value.filter,"visible-columns":T.value,onRowClick:ie},{top:i(()=>[l("div",Ue,[a(N,{dense:"",modelValue:w.value.filter,"onUpdate:modelValue":s[0]||(s[0]=o=>w.value.filter=o),placeholder:"Buscar","input-class":"text-uppercase",color:"pink-5"},{append:i(()=>[a(G,{name:"search"})]),_:1},8,["modelValue"]),a(k,{color:"secondary",icon:"fas fa-eye","no-caps":""},{default:i(()=>[a(ve,{style:{"min-width":"200px"}},{default:i(()=>[a(we,null,{default:i(()=>[(f(!0),j(F,null,J(w.value.columns,(o,m)=>W((f(),P(xe,{tag:"label",key:m},{default:i(()=>[a(Z,null,{default:i(()=>[a(X,null,{default:i(()=>[C(d(o.label),1)]),_:2},1024),a(X,{caption:""},{default:i(()=>[C(d(o.coldesc),1)]),_:2},1024)]),_:2},1024),a(Z,{side:"",top:""},{default:i(()=>[a(ke,{color:"pink-5",modelValue:T.value,"onUpdate:modelValue":s[1]||(s[1]=Q=>T.value=Q),val:o.name},null,8,["modelValue","val"])]),_:2},1024)]),_:2},1024)),[[re]])),128))]),_:1})]),_:1})]),_:1})])]),_:1},8,["rows","columns","pagination","filter","visible-columns"]),a(A,{modelValue:t.value.state,"onUpdate:modelValue":s[3]||(s[3]=o=>t.value.state=o),position:"bottom",onHide:s[4]||(s[4]=o=>z.value.focus())},{default:i(()=>[t.value.item?(f(),P(L,{key:0},{default:i(()=>[a(S,{class:"bg-grey-3"},{default:i(()=>[l("div",Te,[l("div",ze,[l("div",Le,"ID: "+d(t.value.item.id),1),l("div",Ae,d(t.value.item.code),1)]),l("div",Be,[l("div",Fe,d(t.value.item.name),1),l("div",Ne,d(t.value.item.barcode),1)])])]),_:1}),a(Y),a(S,null,{default:i(()=>[C(d(t.value.item.description),1)]),_:1}),a(S,{class:"row justify-around items-center bg-grey-2"},{default:i(()=>[(f(!0),j(F,null,J(t.value.item.stocks,o=>(f(),j("div",{key:o.id,class:"text-center"},[l("div",Oe,d(o.pivot.gen),1),l("div",Ke,d(o.alias),1)]))),128))]),_:1}),a(Ce,{onSubmit:de(le,["prevent"])},{default:i(()=>[a(S,null,{default:i(()=>[l("div",Me,[l("div",He,[Ge,l("div",Je,d(t.value.item.pivot.amount)+" "+d(t.value.item.pivot._supply_by==3?`Caja${t.value.item.pivot.amount!=1?"s":""}`:t.value.item.pivot._supply_by==2?`Docena${t.value.item.pivot.amount!=1?"s":""}`:`Pieza${t.value.item.pivot.amount!=1?"s":""}`),1)]),l("div",We,[Xe,C(" "+d(t.value.item.pivot.toDelivered)+" ",1),l("div",Ye,[C(d(t.value.item.pivot.toDelivered)+" "+d(t.value.item.pivot._supply_by==3?`Caja${t.value.item.pivot.amount!=1?"s":""}`:t.value.item.pivot._supply_by==2?`Docena${t.value.item.pivot.amount!=1?"s":""}`:`Pieza${t.value.item.pivot.amount!=1?"s":""}`)+" ",1),l("small",null,"("+d(t.value.item.pivot._supply_by==3?t.value.item.pivot.toDelivered*t.value.item.pivot.ipack:t.value.item.pivot.toDelivered)+" pzs)",1)])]),l("div",Ze,[et,l("div",tt,d(t.value.item.pivot.ipack),1)]),l("div",at,[ot,a(N,{dense:"",borderless:"",modelValue:t.value.form.count,"onUpdate:modelValue":s[2]||(s[2]=o=>t.value.form.count=o),type:"number",min:"0","input-class":"text-h6 text-center",ref_key:"iptcounter",ref:q},null,8,["modelValue"])]),l("div",lt,[st,l("div",it,d(t.value.item.pivot._supply_by==3?t.value.form.count*t.value.form.ipack:t.value.item.pivot._supply_by==2?t.value.form.count*12:t.value.form.count),1)])])]),_:1}),a(k,{color:"indigo",type:"submit",square:"",icon:"done","no-caps":"",class:"q-mt-md q-py-md full-width"})]),_:1},8,["onSubmit"])]),_:1})):$("",!0)]),_:1},8,["modelValue"]),a(A,{modelValue:V.value.state,"onUpdate:modelValue":s[5]||(s[5]=o=>V.value.state=o)},{default:i(()=>[a(L,null,{default:i(()=>[a(S,{class:"row items-start"},{default:i(()=>[a(O,{icon:"warning",color:"orange-14","text-color":"white"}),nt]),_:1}),a(K,{align:"right"},{default:i(()=>[W(a(k,{flat:"",label:"No",color:"primary","no-caps":""},null,512),[[$e]]),a(k,{flat:"",label:"Si",color:"primary",onClick:se})]),_:1})]),_:1})]),_:1},8,["modelValue"]),_(c)?(f(),P(ee,{key:0,bordered:"",class:"bg-indigo-10 text-dark q-pa-sm row",elevated:""},{default:i(()=>[a(N,{color:"white",modelValue:v.value,"onUpdate:modelValue":s[7]||(s[7]=o=>v.value=o),type:"text",class:"col","input-class":"text-white text-h6 text-center text-uppercase",autofocus:"",dense:"",onKeypress:ue(oe,["enter"]),ref_key:"iptfinder",ref:z},{prepend:i(()=>[a(G,{name:"fas fa-barcode",color:"white"})]),append:i(()=>[a(k,{flat:"",icon:"fas fa-eraser",color:"white",dense:"",onClick:s[6]||(s[6]=o=>v.value=""),disabled:!v.value.length},null,8,["disabled"])]),_:1},8,["modelValue","onKeypress"]),_(R).length>0?(f(),P(k,{key:0,color:"white","text-color":"indigo-10",label:"Finalizar",icon:"done",onClick:s[8]||(s[8]=o=>V.value.state=!0),"no-caps":""})):$("",!0)]),_:1})):$("",!0),_(u)&&_(u).id!=9?(f(),P(ee,{key:1,bordered:"",class:"bg-orange-9 text-white"},{default:i(()=>[l("div",rt,d(_(u).name),1)]),_:1})):$("",!0)],64))}},ut={class:"q-mx-sm text-h6"},ct={class:"q-mx-sm text-h6"},Bt={__name:"CheckInLyt",setup(M){const x=ae(),y=te();pe(),p(""),p("");const g=p({state:!1}),b=p({state:!1}),n=p(null),V=p(null),v=p({val:null,opts:null}),z=D(()=>n.value?n.value.status:null),q=async()=>{n.value=null,x.loading.show({message:"Espera..."});let t=y.params.oid,r=y.query.key,u={oid:t,key:r};const c=await E.checkin(u);if(console.log(c.data),c.status==200){let I=c.data;n.value=I.order,V.value=I.order.requisition,n.value._status==8&&(g.value.state=!0),n.value._status==7&&(b.value.state=!0),x.loading.hide();let R=n.value.requisition.from._client;console.log(R);let h=await U.getCheck(R);console.log(h),h.status==200?v.value.opts=h.data:alert(`Error ${h.status}: ${h.data}`)}else alert(`Error ${c.status}: ${c.data}`)},T=async()=>{x.loading.show({message:"Inicando, espera..."}),g.value.state=!1,x.loading.show({message:"Espera..."});let t={id:y.params.oid,state:9,suply:n.value._suplier_id};const r=await U.nextState(t);if(console.log(t),r.status==200){let u={verified:v.value.val.id,supplyer:n.value._suplier_id,pedido:n.value.requisition.id,status:9};if(console.log(u),r.data.partitionsEnd>V.value._status){let I={id:y.params.oid,state:r.data.partitionsEnd};const R=await E.nextState(I);console.log(R)}let c=await U.SaveCheck(u);c.status==200?(q(),x.notify({message:"Revision de Recibo",position:"center",icon:"done",timeout:5e3,color:"positive"})):alert(`Error ${c.status}: ${c.data}`)}else alert(`Error ${r.status} ${r.data}`)},w=async()=>{x.loading.show({message:"Cambiando Estado..."});let t={id:y.params.oid,state:8,suply:n.value._suplier_id};const r=await U.nextState(t);if(console.log(r),r.data.partitionsEnd>V.value._status){let u={id:y.params.oid,state:r.data.partitionsEnd};const c=await E.nextState(u);console.log(c)}if(r.status==200){b.value.state=!1;let u={id:n.value.invoice,suply:n.value._driver,store:n.value.requisition.from.name};const c=await U.sendMessage(u);console.log(c)}x.loading.hide()};return q(),(t,r)=>(f(),P(_e,{view:"hHh Lpr fFf"},{default:i(()=>[a(ge,null,{default:i(()=>[a(fe,null,{default:i(()=>[_(z)?(f(),P(dt,{key:0,order:n.value,onReload:q},null,8,["order"])):$("",!0),a(A,{modelValue:g.value.state,"onUpdate:modelValue":r[1]||(r[1]=u=>g.value.state=u),persistent:""},{default:i(()=>[a(L,null,{default:i(()=>[a(S,{class:"row items-center"},{default:i(()=>[a(O,{icon:"warning",color:"orange-14","text-color":"white"}),l("span",ut,"Iniciar CheckIn #"+d(_(y).params.oid),1)]),_:1}),a(S,null,{default:i(()=>[a(me,{modelValue:v.value.val,"onUpdate:modelValue":r[0]||(r[0]=u=>v.value.val=u),options:v.value.opts,label:"Revisa ?","option-label":"complete_name",filled:""},null,8,["modelValue","options"])]),_:1}),a(K,{vertical:"",align:"center"},{default:i(()=>[a(k,{flat:"",label:"Si",color:"primary",onClick:T,disable:v.value.val==null},null,8,["disable"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),a(A,{modelValue:b.value.state,"onUpdate:modelValue":r[2]||(r[2]=u=>b.value.state=u),persistent:""},{default:i(()=>[a(L,null,{default:i(()=>[a(S,{class:"row items-center"},{default:i(()=>[a(O,{icon:"warning",color:"orange-14","text-color":"white"}),l("span",ct,"Recepcionas el pedido #"+d(_(y).params.oid)+"? ",1)]),_:1}),a(K,{vertical:"",align:"center"},{default:i(()=>[a(k,{flat:"",label:"Si",color:"primary",onClick:w})]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1}))}};export{Bt as default};
