import{u as U,a as M,r as g,c as w,o as B,b as L,w as d,d as s,e as P,f as _,t as F,Q as N,g as T,h as C}from"./index.767d3255.js";import{Q as z,u as H,a as G,b as J,c as K}from"./QTable.7f8932d3.js";import{Q as X}from"./QToggle.ae638996.js";import{Q as W,a as Z,b as ee}from"./QLayout.27661e65.js";import{Q as te}from"./QDate.62fb1d0b.js";import{Q as ae,a as oe,b as E,c as se}from"./QInput.be1c204b.js";import{d as x}from"./dayjs.min.25545ff6.js";import{R as h}from"./RestockApi.b0d544bf.js";import{u as q}from"./Restock.e38c5404.js";import{Q as le}from"./QPage.b4f3eebb.js";import"./axios.10c2b4ae.js";import"./QTabs.a26a6991.js";import"./ClosePopup.5d030b49.js";import"./jspdf.plugin.autotable.e6f22c33.js";import{$sktRestock as l,usrSkt as re}from"./socket.97cb7a0e.js";import"./rtl.b38b1c0a.js";import"./_commonjsHelpers.88e99c8f.js";const ne={class:"full-width row items-center"},de={class:"col text-h6 text-dark"},ie={__name:"OrdersCheckout",props:{dash:{type:Object,default:{}}},setup(S){const b=S;U();const n=M(),c=q(),k=["text-grey-5 text-bold","text-bold text-h6 text-red","text-indigo","text-orange-8 text-bold","text-positive text-bold","6","7","8","9","9"],m=g({columns:[{name:"id",label:"Folio",field:"id",align:"center"},{name:"state",label:"Estado",field:t=>t.log.length==1?t.log[0].name:t.log[t.log.length-1].name,align:"left",sortable:!0,sort:(t,r,v,y)=>parseInt(v._status)-parseInt(y._status),classes:t=>k[t._status-1]},{name:"laststate",label:"Ultima actividad",field:t=>x(t.log.find(r=>r.id==t.status.id).pivot.updated_at).format("YYYY-MM-DD hh:mm A"),align:"left"},{name:"from",label:"Sucursal",field:t=>t.from.name.toUpperCase(),align:"left",sortable:!0},{name:"models",label:"Modelos",field:"products_count",align:"center"},{name:"notes",label:"Notas",field:t=>t.notes,align:"left"},{name:"invoice",label:"Salida",field:t=>{var r;return(r=t.invoice)!=null?r:"--"},align:"center"}],filter:"",pagination:{sortBy:"desc",descending:!1,rowsPerPage:20}}),p=(t,r,v)=>n.push(`/checkout/${r.id}`),i=w(()=>c.ordersdb.filter(t=>b.dash.id==0?t._status>2:t._status>2&&t.to.id==b.dash.id));return(t,r)=>(B(),L(le,{padding:""},{default:d(()=>[s(z,{flat:"","row-key":"id",rows:P(i),columns:m.value.columns,filter:m.value.filter,pagination:m.value.pagination,onRowClick:p},{top:d(()=>[_("div",ne,[_("div",de,"Pedidos: "+F(P(i).length),1),s(ae,{dense:"",modelValue:m.value.filter,"onUpdate:modelValue":r[0]||(r[0]=v=>m.value.filter=v),"input-class":"text-uppercase",placeholder:"Buscar",color:"pink-5"},{append:d(()=>[s(N,{name:"search"})]),_:1},8,["modelValue"])])]),_:1},8,["rows","columns","filter","pagination"])]),_:1}))}};const ce=_("div",{class:"text-bold"},"CheckOut ",-1),ue={class:"row"},me={class:"col row"},pe={class:"q-pa-md"},fe={class:"q-pb-sm"},Ve={__name:"CheckoutLyt",setup(S){const b=U();M();const n=q(),c=H(),k=re,m=g([{id:0,alias:"Todas"},{id:1,alias:"CEDIS",_state:1},{id:2,alias:"SP1",_state:1}]),p=g({val:null}),i=g(!1),t=[{id:0,label:"TODAS"},{id:1,label:"CEDIS SN PABLO",_state:1},{id:2,label:"CEDIS TEXCOCO",_state:1},{id:16,label:"CEDIS BRASIL",_state:1},{id:24,label:"CEDIS BOLIVIA",_state:1}],r=g({id:1,label:"CEDIS SN PABLO",_state:1}),v=g(null);g(null);const y=g({from:x(Date.now()).startOf("day"),to:x(Date.now()).startOf("day")}),D=async()=>{c.loading.show({message:"Cargado vista..."}),console.log("%cIniciando MainLayout...","font-size:2em;color:orange;"),p.value.val=x(new Date).format("YYYY/MM/DD");const e=await h.index({date:p.value.val});console.log(e),n.fillOrders(e.orders),n.fillResume(e.resume),n.fillPrinters(e.printers),v.value=m.value[0],console.log("%cMainLayout listo!!","font-size:2em;color:orange;"),c.loading.hide(),l.connect(),l.emit("joinat",k),l.on("joineddashreq",Q),l.on("creating",$),l.on("order_update",Y),l.on("order_changestate",I),l.on("order_refresh",R),l.on("orderpartition_refresh",V)};w(()=>y.value.from.format("YYYY/MM/DD")),w(()=>y.value.to.format("YYYY/MM/DD")),T(()=>b.query,()=>{D()});const Q=e=>{console.log(`%c${e.user.me.nick} de ${e.from.alias} se ha unido a Restock (UID: ${e.user.me.id})`,"background:#076F3E;color:#f5f6fa;border-radius:10px;padding:10px;font-size:1.1em;")},$=async e=>{let o=e.order;console.log(`Pedido ${o.id} iniciado`);let a=await h.orderFresh(o.id),u=a.data.order,f=a.data.oid;n.addOrUpdate(f,u)},Y=e=>{n.orderUpdate(e)},I=async e=>{let o=e.order;console.log(`Refrescando orden ${o.id}`),e.state;let a=await h.orderFresh(o.id);console.log(a.data);let u=a.data.order,f=a.data.oid;n.addOrUpdate(f,u),u._status==4&&c.notify({message:`El pedido <b>${o.id}</b> esta listo para CheckOut!!`,color:"positive",textColor:"white",position:"bottom",html:!0,timeout:5e3})},R=async e=>{console.log("REFRESHING BY SKT!!",e);let o=e.order,a=await h.orderFresh(o);console.log(a);let u=a.data.order,f=a.data.oid;n.addOrUpdate(f,u)},V=async e=>{console.log("Partition refresh!!",e);let o=e.order,a=await h.orderFresh(o);console.log(a);let u=a.data.order,f=u.partition,O=a.data.oid;n.addOrUpdate(O,u),f.filter(j=>j._status==4).length==f.length?c.notify({message:`El pedido ${O} ha finalizado particiones`,html:!0,color:"purple-10",icon:"fa-solid fa-truck-ramp-box"}):c.notify({message:`Particion lista para checkout en pedidido <b>${O}</b>`,html:!0,color:"pink-14",icon:"fa-solid fa-truck-ramp-box"})},A=async()=>{i.value=!1,c.loading.show({message:"Obteniendo Datos"});const e=await h.index({date:p.value.val});console.log(e),n.fillOrders(e.orders),n.fillResume(e.resume),n.fillPrinters(e.printers),v.value=m.value[0],console.log("%cMainLayout listo!!","font-size:2em;color:orange;"),c.loading.hide(),l.connect(),l.emit("joinat",k),l.on("joineddashreq",Q),l.on("creating",$),l.on("order_update",Y),l.on("order_changestate",I),l.on("order_refresh",R),l.on("orderpartition_refresh",V)};return D(),document.title="CheckOut",(e,o)=>(B(),L(W,{view:"lHh Lpr lFf"},{default:d(()=>[s(Z,{bordered:"",class:"bg-cyan-10"},{default:d(()=>[s(X,{class:"row justify-between items-center"},{default:d(()=>[ce,_("div",ue,[s(C,{color:"white",round:"",unelevated:"",flat:"",icon:"sync",onClick:D}),_("div",me,[s(G,{modelValue:r.value,"onUpdate:modelValue":o[0]||(o[0]=a=>r.value=a),options:t,filled:"",dense:""},null,8,["modelValue"]),s(J,{spaced:"",inset:"",vertical:"",dark:""}),s(C,{color:"primary",icon:"event",onClick:o[1]||(o[1]=a=>i.value=!i.value),flat:"",round:""})])])]),_:1})]),_:1}),s(K,{modelValue:i.value,"onUpdate:modelValue":o[4]||(o[4]=a=>i.value=a)},{default:d(()=>[s(oe,{class:"my-card"},{default:d(()=>[s(E,null,{default:d(()=>[_("div",pe,[_("div",fe,F(p.value.val),1),s(te,{modelValue:p.value.val,"onUpdate:modelValue":o[2]||(o[2]=a=>p.value.val=a),range:"",minimal:""},null,8,["modelValue"])])]),_:1}),s(E,null,{default:d(()=>[s(se,{align:"right"},{default:d(()=>[s(C,{flat:"",icon:"close",color:"negative",onClick:o[3]||(o[3]=a=>i.value=!i.value)}),s(C,{flat:"",icon:"check",color:"positive",onClick:A})]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]),s(ee,null,{default:d(()=>[s(ie,{dash:r.value},null,8,["dash"])]),_:1})]),_:1}))}};export{Ve as default};
