import{r as u,c as _,o as c,b as g,w as o,u as fe,a as _e,d as a,h as m,e as f,aE as r,t as n,aF as D,i as h,f as l,Q as J,aG as O,aH as W,aI as be,aJ as ye,ax as L,aK as ge,aL as he,aM as xe,x as ke,R as we}from"./index.936f670f.js";import{Q as Ce,a as Qe,b as X}from"./QFooter.548dcd23.js";import{Q as Y}from"./QSpace.24b73ae5.js";import{c as Ve,u as Se,R as N,d as De,o as Z,f as Pe,b as Ue,Q as je,a as E,p as Ee,q as $e,s as B,t as F,v as x,w as ee,e as qe,x as te,y as H,z as $,g as Ie,A as Ae,C as ae}from"./ClosePopup.11f69061.js";import"./dayjs.min.53a5c0af.js";import{A as ze}from"./AssistApi.82e5e84a.js";import"./axios.0b76110d.js";const Re={key:0,class:"text--3"},Te={class:"q-px-md q-py-sm"},Le={class:"col text-dark row justify-between"},Ne={key:0,class:"row items-center justify-between q-pt-sm"},Be=l("span",{class:"text--2"},"Contados:",-1),Fe=l("span",{class:"text--2"},"Por contar:",-1),He=l("span",{class:"text--2"},"Agotados:",-1),Ke=l("span",{class:"text--2"},"Con stock:",-1),Me={class:"full-width row items-center justify-between"},Ge={class:"row justify-between"},Je={class:"text-left"},Oe={class:"text--3"},We={class:"text-h6"},Xe={class:"text-right"},Ye={class:"text-bold"},Ze={class:"text--2"},et={class:"text-center"},tt={class:"text-h6"},at=l("div",{class:"text--2"},"Embalaje (org)",-1),lt={class:"text-h6"},ot={class:"text--2"},st={class:"row items-start justify-between"},it={class:"text-center col"},nt=l("div",null,"Solicitud",-1),dt={class:"text-bold"},ut={class:"text-center col"},rt=l("div",null,"Conteo",-1),ct={class:"text-center col"},pt=l("div",null,"PxC",-1),vt={class:"text-center col"},mt=l("div",null,"Piezas",-1),ft={class:"text-bold"},_t=l("div",{class:"q-ml-md"},[l("div",{class:"text-h6"},"Deseas terminar el surtido?"),l("div",null,"La orden se encolara para verificacion")],-1),bt=l("div",null,"Quien eres?",-1),yt={class:"q-pa-md text-bold text-uppercase text-center"},St={__name:"Supply",setup(gt){const Q=fe(),le=_e(),k=Se(),P=u({state:!1});u([]);const q=u([]),K=u(!0),p=u({val:null,opts:[]}),I=u(["code","notes","locs","request","uspply","stocks","delivery"]),A=u(null),w=u([]),b=u(""),M=u(null),V=u(null),z=u(null),C=u({columns:[{name:"id",label:"ID",field:"id",align:"left",coldesc:"Identificador del producto (MySQL)"},{name:"code",label:"Codigo",field:"code",align:"left",coldesc:"Codigo principal del producto"},{name:"assocs",label:"Asociados",field:e=>e.variants.length?e.variants.map(t=>t.barcode).join(", "):null,align:"left",coldesc:"Codigos relacionados al codigo principal"},{name:"bcode",label:"Codigo de Barras",field:"barcode",align:"center",coldesc:"Codigo de barras principal"},{name:"notes",label:"Notas",field:e=>e.pivot.comments,align:"left"},{name:"locs",label:"Ubicacion",field:e=>e.locations.length?e.locations.map(t=>t.path).join(", "):"--",align:"left",coldesc:"Ubicaciones en almacen general",sortable:!0},{name:"ipack",label:"PxC",field:e=>typeof e.pivot.ipack=="number"?e.pivot.ipack:e.pieces,align:"center",coldesc:"Unidades x Embalaje"},{name:"request",label:"Solicitud",field:e=>e.pivot.amount,align:"center",coldesc:"Embalaje solicitado"},{name:"uspply",label:"Unidad",field:e=>e.pivot._supply_by==3?"Cajas":e.pivot._supply_by==2?"Docenas":"Piezas",align:"left",coldesc:"Unidad de embalaje del producto"},{name:"stocks",label:"Stock (pzs)",field:e=>e.stocks.reduce((t,d)=>t+d.pivot.stock,0),sortable:!0,classes:e=>e.stocks.reduce((t,d)=>t+d.pivot.stock,0)<=0?"text-red text-bold":"text-bold text-primary",align:"center",coldesc:"Stock total en almacenes GENERALES (CEDIS+PAN)"},{name:"delivery",label:"Conteo",field:e=>e.pivot.toDelivered,align:"center",coldesc:"Embalaje surtido"},{name:"reqinpzs",label:"Piezas",field:e=>e.pivot._supply_by==3?(typeof e.pivot.ipack=="number"?e.pivot.ipack:e.pieces)*(typeof e.pivot.ipack=="number"?e.pivot.toDelivered:e.pivot.amount):typeof e.pivot.ipack=="number"?e.pivot.toDelivered:e.pivot.amount,align:"center",coldesc:"Unidades totales en embalaje"},{name:"checkout",label:"Checkout",field:e=>e.pivot.checkout,coldesc:"Revision del Administrador"},{name:"descr",label:"Descripcion",field:"description",align:"left"},{name:"section",label:"Seccion",field:"section",align:"left"},{name:"family",label:"Familia",field:"family",align:"left"},{name:"category",label:"Categoria",field:"category",align:"left"}],filter:"",pagination:{sortBy:"locs",descending:!1,rowsPerPage:20}}),i=u({state:!1,item:null,form:{count:0,ipack:null,setting:!1}}),y=u(null);_(()=>V.value?V.value.id==3:!1);const oe=_(()=>S.value.reduce((e,t)=>e+(t.pivot._supply_by==3?t.pivot.amount*t.pieces:t.pivot.amount),0)),se=_(()=>S.value.filter(e=>typeof e.pivot.toDelivered!="number")),U=_(()=>S.value.filter(e=>typeof e.pivot.toDelivered=="number")),ie=_(()=>U.value.filter(e=>e.pivot.toDelivered==0)),ne=_(()=>U.value.filter(e=>e.pivot.toDelivered>0)),S=_(()=>p.value.val?w.value.filter(e=>e.pivot._suplier_id==p.value.val._suplier_id):[]),j=_(()=>{let e=b.value.toUpperCase().trim();return e.length?S.value.filter(t=>t.code.match(e)||t.barcode&&t.barcode.match(e)):S.value}),R=async()=>{k.loading.show({message:"Cargando..."}),console.log("Iniciando...");const e=await N.order(Q.params.oid);console.log(e),e.status==200?(w.value=e.data.products,p.value.opts=e.data.partition,q.value=e.data,V.value=e.data.status,A.value=e.data.from,k.loading.hide()):alert(`Error ${e.status}: ${e.data}`)},de=e=>{y.value=e},ue=(e,t,d)=>y.value._status==3?G(t):null,G=e=>{i.value.item=e,i.value.form.count=typeof e.pivot.toDelivered=="number"?e.pivot.toDelivered:0,i.value.form.ipack=typeof e.pivot.ipack=="number"?e.pivot.ipack:e.pieces,i.value.state=!0,ke(()=>{z.value.focus(),z.value.select()})},re=()=>{let e=b.value.toUpperCase().trim();if(e.length){let t=j.value.length==1?j.value[0]:j.value.find(d=>d.code==e||d.barcode==e);t?G(t):k.notify({message:`Sin coincidencias para <b>${e}</b>`,color:"pink-5",position:"center",html:!0})}},ce=async()=>{const e=parseInt(i.value.form.count),t=parseInt(i.value.form.ipack),d={order:Q.params.oid,product:i.value.item.id,delivery:e,ipack:t,checkout:!1},v=await N.setDeliveryProduct(d);if(console.log(v),v.status==200){let s=w.value.findIndex(T=>T.id==i.value.item.id);w.value[s].pivot.toDelivered=e,w.value[s].pivot.ipack=t,i.value.state=!1,b.value="",k.notify({color:"positive",icon:"done",position:"right",message:"",timeout:1e3})}else alert(`Error ${v.status}: ${v.data}`)},pe=()=>{console.log("Hola")},ve=async()=>{console.log("Finalizando particion"),k.loading.show({message:"Terminando, espera..."}),P.value.state=!1;let e={id:Q.params.oid,state:4,suply:p.value.val._suplier_id};console.log(e);const t=await ze.nextState(e);if(console.log(t),y.value._status=t.data.partition._status,y.value.status.name=t.data.partition.name,t.data.partitionsEnd>q.value._status){let d={id:Q.params.oid,state:t.data.partitionsEnd};const v=await N.nextState(d);console.log(v)}t.status==200&&R(),k.loading.hide()};return R(),(e,t)=>(c(),g(Ve,{view:"hHh Lpr fFf"},{default:o(()=>[a(Pe,{bordered:"",class:"bg-white text-dark"},{default:o(()=>[a(De,null,{default:o(()=>{var d;return[a(m,{flat:"",round:"",dense:"",icon:"arrow_back",onClick:t[0]||(t[0]=v=>{f(le).replace("/supply")})}),a(Ce,null,{default:o(()=>[r(" Pedido "+n(f(Q).params.oid)+" ",1),A.value?(c(),D("span",Re,"- "+n(A.value.alias),1)):h("",!0)]),_:1}),r(" "+n((d=p.value.val)==null?void 0:d._suplier)+" ",1),a(Y),r(" "+n(q.value.notes)+" ",1),a(Y),a(m,{color:"pink-5",icon:"sync",onClick:R,round:"",dense:"",flat:""})]}),_:1}),a(Z),l("div",Te,[l("div",Le,[l("div",null,[r("Productos: "),l("b",null,n(w.value.length),1)]),l("div",null,[r("Piezas: "),l("b",null,n(f(oe)),1)])]),V.value&&V.value.id>=3?(c(),D("div",Ne,[l("div",null,[Be,r(),l("b",null,n(f(U).length),1)]),l("div",null,[Fe,r(),l("b",null,n(f(se).length),1)]),l("div",null,[He,r(),l("b",null,n(f(ie).length),1)]),l("div",null,[Ke,r(),l("b",null,n(f(ne).length),1)])])):h("",!0)])]),_:1}),a(Ie,null,{default:o(()=>{var d,v;return[a(Ue,{padding:""},{default:o(()=>[p.value.val?(c(),g(je,{key:0,"row-key":"id",flat:"",rows:f(j),columns:C.value.columns,pagination:C.value.pagination,filter:C.value.filter,"visible-columns":I.value,onRowClick:ue},{top:o(()=>[l("div",Me,[a(E,{dense:"",modelValue:C.value.filter,"onUpdate:modelValue":t[1]||(t[1]=s=>C.value.filter=s),placeholder:"Buscar","input-class":"text-uppercase",color:"pink-5"},{append:o(()=>[a(J,{name:"search"})]),_:1},8,["modelValue"]),a(m,{color:"secondary",icon:"fas fa-eye","no-caps":""},{default:o(()=>[a(Ee,{style:{"min-width":"200px"}},{default:o(()=>[a($e,null,{default:o(()=>[(c(!0),D(W,null,O(C.value.columns,(s,T)=>L((c(),g(te,{tag:"label",key:T},{default:o(()=>[a(H,null,{default:o(()=>[a($,null,{default:o(()=>[r(n(s.label),1)]),_:2},1024),a($,{caption:""},{default:o(()=>[r(n(s.coldesc),1)]),_:2},1024)]),_:2},1024),a(H,{side:"",top:""},{default:o(()=>[a(Ae,{color:"pink-5",modelValue:I.value,"onUpdate:modelValue":[t[2]||(t[2]=me=>I.value=me),pe],val:s.name},null,8,["modelValue","val"])]),_:2},1024)]),_:2},1024)),[[we]])),128))]),_:1})]),_:1})]),_:1})])]),_:1},8,["rows","columns","pagination","filter","visible-columns"])):h("",!0),a(B,{modelValue:i.value.state,"onUpdate:modelValue":t[5]||(t[5]=s=>i.value.state=s),position:"bottom",onHide:t[6]||(t[6]=s=>M.value.focus())},{default:o(()=>[i.value.item?(c(),g(F,{key:0},{default:o(()=>[a(x,null,{default:o(()=>[l("div",Ge,[l("div",Je,[l("div",Oe,"ID: "+n(i.value.item.id),1),l("div",We,n(i.value.item.code),1)]),l("div",Xe,[l("div",Ye,n(i.value.item.name),1),l("div",Ze,n(i.value.item.barcode),1)])])]),_:1}),a(Z),a(x,null,{default:o(()=>[r(n(i.value.item.description),1)]),_:1}),a(x,{class:"row justify-around items-center"},{default:o(()=>[l("div",et,[l("div",tt,n(i.value.item.pieces),1),at]),(c(!0),D(W,null,O(i.value.item.stocks,s=>(c(),D("div",{key:s.id,class:"text-center"},[l("div",lt,n(s.pivot.gen),1),l("div",ot,n(s.alias),1)]))),128))]),_:1}),a(Qe,{onSubmit:be(ce,["prevent"])},{default:o(()=>[a(x,null,{default:o(()=>[l("div",st,[l("div",it,[nt,l("div",dt,n(i.value.item.pivot.amount)+" "+n(i.value.item.pivot._supply_by==3?`Caja${i.value.item.pivot.amount!=1?"s":""}`:i.value.item.pivot._supply_by==2?`Docena${i.value.item.pivot.amount!=1?"s":""}`:`Pieza${i.value.item.pivot.amount!=1?"s":""}`),1)]),l("div",ut,[rt,a(E,{dense:"",borderless:"",modelValue:i.value.form.count,"onUpdate:modelValue":t[3]||(t[3]=s=>i.value.form.count=s),type:"number",min:"0","input-class":"text-h6 text-center",ref_key:"iptcounter",ref:z},null,8,["modelValue"])]),l("div",ct,[pt,a(E,{dense:"",borderless:"",modelValue:i.value.form.ipack,"onUpdate:modelValue":t[4]||(t[4]=s=>i.value.form.ipack=s),type:"number","input-class":"text-h6 text-center",readonly:i.value.item.units.id!=3,disable:i.value.item.units.id!=3},null,8,["modelValue","readonly","disable"])]),l("div",vt,[mt,l("div",ft,n(i.value.item.pivot._supply_by==3?i.value.form.count*i.value.form.ipack:i.value.item.pivot._supply_by==2?i.value.form.count*12:i.value.form.count),1)])])]),_:1}),a(m,{color:"primary",type:"submit",square:"",icon:"check","no-caps":"",class:"q-mt-md q-py-md full-width"})]),_:1},8,["onSubmit"])]),_:1})):h("",!0)]),_:1},8,["modelValue"]),a(B,{modelValue:P.value.state,"onUpdate:modelValue":t[7]||(t[7]=s=>P.value.state=s)},{default:o(()=>[a(F,null,{default:o(()=>[a(x,{class:"row items-start"},{default:o(()=>[a(ye,{icon:"warning",color:"orange-14","text-color":"white"}),_t]),_:1}),a(ee,{align:"right"},{default:o(()=>[L(a(m,{flat:"",label:"No",color:"primary","no-caps":""},null,512),[[ae]]),a(m,{flat:"",label:"Si",color:"primary",onClick:ve})]),_:1})]),_:1})]),_:1},8,["modelValue"]),a(B,{modelValue:K.value,"onUpdate:modelValue":t[9]||(t[9]=s=>K.value=s),persistent:""},{default:o(()=>[a(F,{style:{width:"400px"}},{default:o(()=>[a(x,{class:"row items-center"},{default:o(()=>[bt]),_:1}),a(x,null,{default:o(()=>[a(qe,{modelValue:p.value.val,"onUpdate:modelValue":[t[8]||(t[8]=s=>p.value.val=s),de],options:p.value.opts,label:"Surtidor","option-label":"_suplier","option-value":"_suplier_id",filled:"","option-disable":s=>s._status!=3},{option:o(s=>[a(te,ge(he(s.itemProps)),{default:o(()=>[a(H,null,{default:o(()=>[a($,null,{default:o(()=>[r(n(s.opt._suplier),1)]),_:2},1024),a($,{caption:"",lines:"2"},{default:o(()=>[r(n(s.opt.status.name),1)]),_:2},1024)]),_:2},1024)]),_:2},1040)]),_:1},8,["modelValue","options","option-disable"])]),_:1}),a(ee,{align:"right"},{default:o(()=>[L(a(m,{flat:"",label:"Continuar",color:"primary",disable:!p.value.val},null,8,["disable"]),[[ae]])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1}),((d=y.value)==null?void 0:d._status)==3?(c(),g(X,{key:0,bordered:"",class:"bg-primary text-dark q-pa-sm row",elevated:""},{default:o(()=>[a(E,{color:"white",modelValue:b.value,"onUpdate:modelValue":t[11]||(t[11]=s=>b.value=s),type:"text",class:"col","input-class":"text-white text-h6 text-center text-uppercase",autofocus:"",dense:"",onKeypress:xe(re,["enter"]),ref_key:"iptfinder",ref:M},{prepend:o(()=>[a(J,{name:"fas fa-barcode",color:"white"})]),append:o(()=>[a(m,{flat:"",icon:"fas fa-eraser",color:"white",dense:"",onClick:t[10]||(t[10]=s=>b.value=""),disabled:!b.value.length},null,8,["disabled"])]),_:1},8,["modelValue","onKeypress"]),f(U).length>0?(c(),g(m,{key:0,color:"white","text-color":"cyan-9",label:"Terminar",icon:"done",onClick:t[12]||(t[12]=s=>P.value.state=!0),"no-caps":""})):h("",!0)]),_:1})):h("",!0),((v=y.value)==null?void 0:v._status)!=3?(c(),g(X,{key:1,bordered:"",class:"bg-orange-9 text-white"},{default:o(()=>{var s;return[l("div",yt,n((s=y.value)==null?void 0:s.status.name),1)]}),_:1})):h("",!0)]}),_:1})]),_:1}))}};export{St as default};
