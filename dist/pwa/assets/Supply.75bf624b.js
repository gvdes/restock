import{r as c,c as f,o as u,b as g,w as i,u as ee,a as te,d as o,h as y,e as p,aD as r,t as n,aE as h,i as k,f as l,Q as B,aF as R,aG as z,aH as le,aI as ae,x as oe,au as se,R as ie}from"./index.a7959197.js";import{Q as ne,a as de,b as T}from"./QFooter.7aa157d2.js";import{c as ce,u as ue,R as A,d as re,q as L,f as pe,b as ve,Q as me,a as Q,s as fe,t as be,v as _e,w as ge,x as V,g as ye,y as he,z as F,A as N,B as ke}from"./QCard.b5e0bbc0.js";import"./dayjs.min.16be2667.js";import"./axios.35a4834a.js";const xe={key:0,class:"text--3"},Ce={class:"q-px-md q-py-sm"},we={class:"col text-dark row justify-between"},Qe={key:0,class:"row items-center justify-between q-pt-sm"},Ve=l("span",{class:"text--2"},"Contados:",-1),De=l("span",{class:"text--2"},"Por contar:",-1),Pe=l("span",{class:"text--2"},"Agotados:",-1),Se=l("span",{class:"text--2"},"Con stock:",-1),je={class:"full-width row items-center justify-between"},Ee={class:"row justify-between"},Ie={class:"text-left"},Ue={class:"text--3"},qe={class:"text-h6"},$e={class:"text-right"},Be={class:"text-bold"},Re={class:"text--2"},ze={class:"text-center"},Te={class:"text-h6"},Ae=l("div",{class:"text--2"},"Embalaje (org)",-1),Le={class:"text-h6"},Fe={class:"text--2"},Ne={class:"row items-start justify-between"},He={class:"text-center col"},Ke=l("div",null,"Solicitud",-1),Me={class:"text-bold"},Ge={class:"text-center col"},Je=l("div",null,"Conteo",-1),Oe={class:"text-center col"},We=l("div",null,"PxC",-1),Xe={class:"text-center col"},Ye=l("div",null,"Piezas",-1),Ze={class:"text-bold"},et={class:"q-pa-md text-bold text-uppercase text-center"},nt={__name:"Supply",setup(tt){const D=ee(),H=te(),x=ue();c([]);const P=c(["code","locs","request","uspply","stocks","delivery"]),S=c(null),d=c([]),m=c(""),I=c(null),v=c(null),j=c(null),b=c({columns:[{name:"id",label:"ID",field:"id",align:"left",coldesc:"Identificador del producto (MySQL)"},{name:"code",label:"Codigo",field:"code",align:"left",coldesc:"Codigo principal del producto"},{name:"assocs",label:"Asociados",field:e=>e.variants.length?e.variants.map(t=>t.barcode).join(", "):null,align:"left",coldesc:"Codigos relacionados al codigo principal"},{name:"bcode",label:"Codigo de Barras",field:"barcode",align:"center",coldesc:"Codigo de barras principal"},{name:"locs",label:"Ubicacion",field:e=>e.locations.length?e.locations.map(t=>t.path).join(", "):"--",align:"left",coldesc:"Ubicaciones en almacen general"},{name:"ipack",label:"PxC",field:e=>typeof e.pivot.ipack=="number"?e.pivot.ipack:e.pieces,align:"center",coldesc:"Unidades x Embalaje"},{name:"request",label:"Solicitud",field:e=>e.pivot.amount,align:"center",coldesc:"Embalaje solicitado"},{name:"uspply",label:"Unidad",field:e=>e.units.id==3?"Cajas":"Piezas",align:"left",coldesc:"Unidad de embalaje del producto"},{name:"stocks",label:"Stock (pzs)",field:e=>e.stocks.reduce((t,s)=>t+s.pivot.stock,0),sortable:!0,classes:e=>e.stocks.reduce((t,s)=>t+s.pivot.stock,0)<=0?"text-red text-bold":"text-bold text-primary",align:"center",coldesc:"Stock total en almacenes GENERALES (CEDIS+PAN)"},{name:"delivery",label:"Conteo",field:e=>e.pivot.toDelivered,align:"center",coldesc:"Embalaje surtido"},{name:"reqinpzs",label:"Piezas",field:e=>e.pivot._supply_by==3?(typeof e.pivot.ipack=="number"?e.pivot.ipack:e.pieces)*(typeof e.pivot.ipack=="number"?e.pivot.toDelivered:e.pivot.amount):typeof e.pivot.ipack=="number"?e.pivot.toDelivered:e.pivot.amount,align:"center",coldesc:"Unidades totales en embalaje"},{name:"checkout",label:"Checkout",field:e=>e.pivot.checkout,coldesc:"Revision del Administrador"},{name:"descr",label:"Descripcion",field:"description",align:"left"},{name:"section",label:"Seccion",field:"section",align:"left"},{name:"family",label:"Familia",field:"family",align:"left"},{name:"category",label:"Categoria",field:"category",align:"left"}],filter:"",pagination:{sortBy:"locs",descending:!1,rowsPerPage:20}}),a=c({state:!1,item:null,form:{count:0,ipack:null,setting:!1}}),U=f(()=>v.value?v.value.id==3:!1),K=f(()=>d.value.reduce((e,t)=>e+(t.pivot._supply_by==3?t.pivot.amount*t.pieces:t.pivot.amount),0)),M=f(()=>d.value.filter(e=>typeof e.pivot.toDelivered!="number")),E=f(()=>d.value.filter(e=>typeof e.pivot.toDelivered=="number")),G=f(()=>E.value.filter(e=>e.pivot.toDelivered==0)),J=f(()=>E.value.filter(e=>e.pivot.toDelivered>0)),C=f(()=>{let e=m.value.toUpperCase().trim();return e.length?d.value.filter(t=>t.code.match(e)||t.barcode&&t.barcode.match(e)):d.value}),q=async()=>{x.loading.show({message:"Cargando..."}),console.log("Iniciando...");const e=await A.order(D.params.oid);console.log(e),e.status==200?(d.value=e.data.products,v.value=e.data.status,S.value=e.data.from,x.loading.hide()):alert(`Error ${e.status}: ${e.data}`)},O=(e,t,s)=>U.value?$(t):null,$=e=>{a.value.item=e,a.value.form.count=typeof e.pivot.toDelivered=="number"?e.pivot.toDelivered:0,a.value.form.ipack=typeof e.pivot.ipack=="number"?e.pivot.ipack:e.pieces,a.value.state=!0,oe(()=>{j.value.focus(),j.value.select()})},W=()=>{let e=m.value.toUpperCase().trim();if(e.length){let t=C.value.length==1?C.value[0]:C.value.find(s=>s.code==e||s.barcode==e);t?$(t):x.notify({message:`Sin coincidencias para <b>${e}</b>`,color:"pink-5",position:"center",html:!0})}},X=async()=>{const e=parseInt(a.value.form.count),t=parseInt(a.value.form.ipack),s={order:D.params.oid,product:a.value.item.id,delivery:e,ipack:t,checkout:!1},_=await A.setDeliveryProduct(s);if(console.log(_),_.status==200){let w=d.value.findIndex(Z=>Z.id==a.value.item.id);d.value[w].pivot.toDelivered=e,d.value[w].pivot.ipack=t,a.value.state=!1,m.value="",x.notify({color:"positive",icon:"done",position:"right",message:"",timeout:1e3})}else alert(`Error ${_.status}: ${_.data}`)},Y=()=>{console.log("Hola")};return q(),(e,t)=>(u(),g(ce,{view:"hHh Lpr fFf"},{default:i(()=>[o(pe,{bordered:"",class:"bg-white text-dark"},{default:i(()=>[o(re,null,{default:i(()=>[o(y,{flat:"",round:"",dense:"",icon:"arrow_back",onClick:t[0]||(t[0]=s=>{p(H).replace("/supply")})}),o(ne,null,{default:i(()=>[r(" Pedido "+n(p(D).params.oid)+" ",1),S.value?(u(),h("span",xe,"- "+n(S.value.alias),1)):k("",!0)]),_:1}),o(y,{color:"pink-5",icon:"sync",onClick:q,round:"",dense:"",flat:""})]),_:1}),o(L),l("div",Ce,[l("div",we,[l("div",null,[r("Productos: "),l("b",null,n(d.value.length),1)]),l("div",null,[r("Piezas: "),l("b",null,n(p(K)),1)])]),v.value&&v.value.id>=3?(u(),h("div",Qe,[l("div",null,[Ve,r(),l("b",null,n(p(E).length),1)]),l("div",null,[De,r(),l("b",null,n(p(M).length),1)]),l("div",null,[Pe,r(),l("b",null,n(p(G).length),1)]),l("div",null,[Se,r(),l("b",null,n(p(J).length),1)])])):k("",!0)])]),_:1}),o(ye,null,{default:i(()=>[o(ve,{padding:""},{default:i(()=>[o(me,{"row-key":"id",flat:"",rows:p(C),columns:b.value.columns,pagination:b.value.pagination,filter:b.value.filter,"visible-columns":P.value,onRowClick:O},{top:i(()=>[l("div",je,[o(Q,{dense:"",modelValue:b.value.filter,"onUpdate:modelValue":t[1]||(t[1]=s=>b.value.filter=s),placeholder:"Buscar","input-class":"text-uppercase",color:"pink-5"},{append:i(()=>[o(B,{name:"search"})]),_:1},8,["modelValue"]),o(y,{color:"secondary",icon:"fas fa-eye","no-caps":""},{default:i(()=>[o(fe,{style:{"min-width":"200px"}},{default:i(()=>[o(be,null,{default:i(()=>[(u(!0),h(z,null,R(b.value.columns,(s,_)=>se((u(),g(he,{tag:"label",key:_},{default:i(()=>[o(F,null,{default:i(()=>[o(N,null,{default:i(()=>[r(n(s.label),1)]),_:2},1024),o(N,{caption:""},{default:i(()=>[r(n(s.coldesc),1)]),_:2},1024)]),_:2},1024),o(F,{side:"",top:""},{default:i(()=>[o(ke,{color:"pink-5",modelValue:P.value,"onUpdate:modelValue":[t[2]||(t[2]=w=>P.value=w),Y],val:s.name},null,8,["modelValue","val"])]),_:2},1024)]),_:2},1024)),[[ie]])),128))]),_:1})]),_:1})]),_:1})])]),_:1},8,["rows","columns","pagination","filter","visible-columns"]),o(_e,{modelValue:a.value.state,"onUpdate:modelValue":t[5]||(t[5]=s=>a.value.state=s),position:"bottom",onHide:t[6]||(t[6]=s=>I.value.focus())},{default:i(()=>[a.value.item?(u(),g(ge,{key:0},{default:i(()=>[o(V,null,{default:i(()=>[l("div",Ee,[l("div",Ie,[l("div",Ue,"ID: "+n(a.value.item.id),1),l("div",qe,n(a.value.item.code),1)]),l("div",$e,[l("div",Be,n(a.value.item.name),1),l("div",Re,n(a.value.item.barcode),1)])])]),_:1}),o(L),o(V,null,{default:i(()=>[r(n(a.value.item.description),1)]),_:1}),o(V,{class:"row justify-around items-center"},{default:i(()=>[l("div",ze,[l("div",Te,n(a.value.item.pieces),1),Ae]),(u(!0),h(z,null,R(a.value.item.stocks,s=>(u(),h("div",{key:s.id,class:"text-center"},[l("div",Le,n(s.pivot.gen),1),l("div",Fe,n(s.alias),1)]))),128))]),_:1}),o(de,{onSubmit:le(X,["prevent"])},{default:i(()=>[o(V,null,{default:i(()=>[l("div",Ne,[l("div",He,[Ke,l("div",Me,n(a.value.item.pivot.amount)+" "+n(a.value.item.units.id==3?`Caja${a.value.item.pivot.amount!=1?"s":""}`:`Pieza${a.value.item.pivot.amount!=1?"s":""}`),1)]),l("div",Ge,[Je,o(Q,{dense:"",borderless:"",modelValue:a.value.form.count,"onUpdate:modelValue":t[3]||(t[3]=s=>a.value.form.count=s),type:"number",min:"0","input-class":"text-h6 text-center",ref_key:"iptcounter",ref:j},null,8,["modelValue"])]),l("div",Oe,[We,o(Q,{dense:"",borderless:"",modelValue:a.value.form.ipack,"onUpdate:modelValue":t[4]||(t[4]=s=>a.value.form.ipack=s),type:"number","input-class":"text-h6 text-center",readonly:a.value.item.units.id!=3,disable:a.value.item.units.id!=3},null,8,["modelValue","readonly","disable"])]),l("div",Xe,[Ye,l("div",Ze,n(a.value.item.units.id==3?a.value.form.count*a.value.form.ipack:a.value.form.count),1)])])]),_:1}),o(y,{color:"primary",type:"submit",square:"",icon:"check","no-caps":"",class:"q-mt-md q-py-md full-width"})]),_:1},8,["onSubmit"])]),_:1})):k("",!0)]),_:1},8,["modelValue"])]),_:1}),p(U)?(u(),g(T,{key:0,bordered:"",class:"bg-primary text-dark q-pa-sm row",elevated:""},{default:i(()=>[o(Q,{color:"white",modelValue:m.value,"onUpdate:modelValue":t[8]||(t[8]=s=>m.value=s),type:"text",class:"col","input-class":"text-white text-h6 text-center text-uppercase",autofocus:"",dense:"",onKeypress:ae(W,["enter"]),ref_key:"iptfinder",ref:I},{prepend:i(()=>[o(B,{name:"fas fa-barcode",color:"white"})]),append:i(()=>[o(y,{flat:"",icon:"fas fa-eraser",color:"white",dense:"",onClick:t[7]||(t[7]=s=>m.value=""),disabled:!m.value.length},null,8,["disabled"])]),_:1},8,["modelValue","onKeypress"])]),_:1})):k("",!0),v.value&&v.value.id!=3?(u(),g(T,{key:1,bordered:"",class:"bg-orange-9 text-white"},{default:i(()=>[l("div",et,n(v.value.name),1)]),_:1})):k("",!0)]),_:1})]),_:1}))}};export{nt as default};
