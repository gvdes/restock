import{r as m,c as j,o as v,aF as S,f as o,d as e,w as t,h as y,aH as Y,i as A,e as O,aA as Z,b as I,aN as Fe,Q as le,t as c,aE as k,R as $e,u as ke,a7 as ze,aG as te,aJ as he,x as je,a as Ve,aO as Be,aP as Te,g as Ne}from"./index.d8761c27.js";import{u as de,t as N,b as se,y as ne,z as q,A as ae,v as ue,w as xe,Q as ie,x as X,B as Se,a as Ye}from"./QPage.9e12cc86.js";import{a as Me,Q as Ge}from"./QToggle.0e9cd36a.js";import{Q as He,a as Ke,b as Je}from"./QLayout.951ddc8f.js";import{d as ee}from"./dayjs.min.53a5c0af.js";import{b as E,Q as we,a as W,c as pe,C as ve,R as z}from"./ClosePopup.0f40a261.js";import{a as Ce,Q as We,b as Xe,c as fe,d as Ze,e as _e,f as et,u as tt}from"./Restock.34e47fb7.js";import{Q as ge,a as be}from"./QTd.817c9b77.js";import{Q as lt}from"./QTabs.379d9b84.js";import{A as oe}from"./AssistApi.c7327146.js";import{b as at}from"./jspdf.plugin.autotable.2f5f6c0d.js";import{p as ot}from"./pdfCreate.53fbfe4e.js";import{$sktRestock as K,usrSkt as st}from"./socket.9951ace7.js";import"./rtl.f0ac86cd.js";import"./axios.27494f8a.js";const nt={class:"q-pa-sm bg-grey-2 text-bold row justify-between items-center",style:{"min-width":"250px"}},it=o("div",null,"Impresion",-1),dt={key:0,class:"row justify-between items-center"},rt={class:"q-mt-sm q-pa-sm"},ct={key:0,class:"q-pa-sm"},ut={class:"text--3"},pt={class:"q-pa-sm text-right"},ye={__name:"PrinterSelect",props:{partition:{type:Boolean}},emits:["selected","selectedPartition"],setup(J,{emit:h}){const P=de(),f=Ce(),r=m(null),p=m(null),R=j(()=>f.printers),x=j(()=>r.value?r.value.printers:[]),d=()=>{P.localStorage.set("LUP",{wkp:r.value,printer:p.value}),h("selected",p.value)},L=()=>{P.localStorage.set("LUP",{wkp:r.value,printer:p.value}),h("selectedPartition",p.value)},$=P.localStorage.getItem("LUP");return $&&(r.value=$.wkp,p.value=$.printer),(T,w)=>(v(),S(Y,null,[o("div",nt,[it,r.value?(v(),S("div",dt,[e(We,{flat:""},{default:t(()=>[e(y,{flat:"",color:"positive",icon:"add",dense:""}),p.value?(v(),S(Y,{key:0},[e(y,{flat:"",color:"negative",icon:"delete",dense:""}),e(y,{flat:"",color:"orange",icon:"edit",dense:""})],64)):A("",!0)]),_:1})])):A("",!0)]),e(N),o("div",rt,[e(se,{modelValue:r.value,"onUpdate:modelValue":[w[0]||(w[0]=g=>r.value=g),w[1]||(w[1]=g=>p.value=null)],options:O(R),label:"Sucursal",filled:"","option-label":"alias","option-value":"id"},null,8,["modelValue","options"])]),r.value?(v(),S("div",ct,[e(se,{modelValue:p.value,"onUpdate:modelValue":w[2]||(w[2]=g=>p.value=g),options:O(x),label:"Impresora",filled:"","option-value":"id","option-label":"name"},{option:t(g=>[Z((v(),I(ne,Fe({clickable:""},g.itemProps),{default:t(()=>[e(q,{class:"text-center",side:""},{default:t(()=>[e(le,{color:"primary","text-color":"white",name:"print",size:"30px"}),o("span",ut,"ID:"+c(g.opt.id),1)]),_:2},1024),e(q,null,{default:t(()=>[e(ae,null,{default:t(()=>[k(c(g.opt.name),1)]),_:2},1024),e(ae,{caption:"",lines:"2"},{default:t(()=>[k(c(g.opt.ip),1)]),_:2},1024)]),_:2},1024)]),_:2},1040)),[[$e]])]),_:1},8,["modelValue","options"])])):A("",!0),o("div",pt,[r.value&&p.value&&!J.partition?(v(),I(y,{key:0,color:"primary",icon:"print",onClick:d})):A("",!0),r.value&&p.value&&J.partition?(v(),I(y,{key:1,color:"secondary",icon:"print",onClick:L})):A("",!0)])],64))}},vt=o("div",{class:"text-overline text-grey-7"},"Sucursal",-1),mt={class:"text-h6"},ft={class:"q-px-lg text-center"},_t=o("div",{class:"text-overline text-grey-7"},"Folio",-1),gt={class:"text-h6"},bt={class:"text-right"},yt=o("div",{class:"text-overline text-grey-7"},"Agente",-1),ht={class:"text-h6"},xt={class:"text-center"},kt=o("div",{class:"text-overline text-grey-7"},"Fecha",-1),wt={class:"text-h6"},Ct={key:0,class:"text-center"},St=o("div",{class:"text-overline text-grey-7 col"},"Notas",-1),$t={class:"text-h6"},Vt={class:"text-center"},Dt={class:"text-overline text-grey-7"},Et={class:"text-h6"},Pt={class:"full-width row items-center"},It={class:"col text-dark"},qt={class:"text-h6"},Qt={class:"text-bold"},Ut={key:1,class:"text-center q-pa-lg text-h6 text-grey-7"},At={class:"q-pa-xs col-xs-12 col-sm-6 col-md-4"},Ot=o("br",null,null,-1),Rt=o("br",null,null,-1),Lt={class:"text-overline text-grey-7"},Ft=o("div",null,"Salida",-1),zt=o("div",null,"Entrada",-1),jt=o("div",null,"Herramientas",-1),Bt={class:"row"},Tt={key:0,class:"col"},Nt={key:1,class:"col"},Yt={key:2,class:"col"},Mt=o("canvas",{id:"qrcode"},null,-1),Gt={class:"text--2"},Ht=o("div",{class:"q-ml-md"},[o("div",{class:"text-h6"},"Cambiar a En Camino?"),o("div",null,"Cambiara a estatus en camino")],-1),Kt=o("div",{class:"text-center text-h6"},"Surtidor",-1),Jt={class:"text-center text-bold text-subtitle2 text-overline"},Wt=o("div",{class:"q-ml-sm text-bold"},"Estas a punto de cancelar el pedido ",-1),Xt={class:"q-ml-sm text-bold"},Zt={__name:"OrderViewer",props:{head:{type:Object,default:{}}},emits:["loaded","loading","fresh","chofiAssigned"],setup(J,{emit:h}){const P=J,f=de();ke();const r=m({opts:[],val:[],filter:[]}),p=m({opts:null,val:null,filter:null}),R=m(null),x=m(null),d=m(P.head),L=m(null),$=m(!0),T=m([]),w=m("supliers"),g=m(null),C=m([]),B=m(!1),F=m({state:!1}),G=m({state:!1,key:null}),M=m(null),i=m(!1),_=m({state:!1}),s=m(null),u=m([]),b=m({columns:[{name:"id",label:"ID",field:"id",align:"left",coldesc:"Identificador del producto (MySQL)"},{name:"code",label:"Codigo",field:"code",align:"left",coldesc:"Codigo principal del producto"},{name:"assocs",label:"Asociados",field:l=>l.variants.length?l.variants.map(a=>a.barcode).join(", "):null,align:"left",coldesc:"Codigos relacionados al codigo principal"},{name:"bcode",label:"Codigo de Barras",field:"barcode",align:"center",coldesc:"Codigo de barras principal"},{name:"locs",label:"Ubicacion",field:l=>l.locations.length?l.locations.map(a=>a.path).join(", "):"--",align:"left",coldesc:"Ubicaciones en almacen general"},{name:"stocks",label:"Stock (pzs)",field:l=>l.stocks.reduce((a,n)=>a+n.pivot.stock,0),sortable:!0,classes:l=>l.stocks.reduce((a,n)=>a+n.pivot.stock,0)<=0?"text-red text-bold":"text-bold text-primary",align:"center",coldesc:"Stock total en almacenes GENERALES (CEDIS+PAN)"},{name:"ipack",label:"PxC",field:l=>typeof l.pivot.ipack=="number"?l.pivot.ipack:l.pieces,align:"center",coldesc:"Unidades x Embalaje"},{name:"request",label:"Solicitud",field:l=>l.pivot.amount,align:"center",coldesc:"Embalaje solicitado"},{name:"uspply",label:"Unidad",field:l=>l.units.id==3?"Cajas":"Piezas",align:"left",coldesc:"Unidad de embalaje del producto"},{name:"delivery",label:"Salida (conteo)",field:l=>l.pivot.toDelivered,align:"center",coldesc:"Embalaje surtido",sortable:!0},{name:"reqinpzs",label:"Piezas",field:l=>l.pivot._supply_by==3?(typeof l.pivot.ipack=="number"?l.pivot.ipack:l.pieces)*(typeof l.pivot.ipack=="number"?l.pivot.toDelivered:l.pivot.amount):typeof l.pivot.ipack=="number"?l.pivot.toDelivered:l.pivot.amount,align:"center",coldesc:"Unidades totales en embalaje"},{name:"checkout",label:"Checkout",field:l=>l.pivot.checkout?"OK":"---",align:"center",classes:l=>l.pivot.checkout?"text-positive text-bold":"text-red",sortable:!0,coldesc:"Revision del Administrador"},{name:"received",label:"Entrada (conteo)",field:l=>l.pivot.toReceived,align:"center",coldesc:"Embalaje recibido"},{name:"descr",label:"Descripcion",field:"description",align:"left"},{name:"section",label:"Seccion",field:"section",align:"left"},{name:"family",label:"Familia",field:"family",align:"left"},{name:"category",label:"Categoria",field:"category",align:"left"}],filter:"",pagination:{sortBy:"locs",descending:!1,rowsPerPage:20}}),Q=j(()=>C.value.reduce((l,a)=>l+(a.pivot._supply_by==3?a.pivot.amount*a.pieces:a.pivot.amount),0));j(()=>g.value&&(g.value.id==2||g.value.id==6)),j(()=>T.value.find(l=>l.id==g.value.id).pivot),j(()=>M.value.map(l=>l._status).includes(6));const V=async()=>{h("loading"),$.value=!0;let l=await z.order(d.value.id);if(console.log(l.data),C.value=l.data.products,T.value=l.data.log.map(a=>(a.pivot.details=JSON.parse(a.pivot.details),a)),M.value=l.data.partition,g.value=l.data.status,L.value=l.data,s.value=l.data.invoice,g.value.id==2){let a=await oe.getSupply();console.log(a),r.value.opts=a}$.value=!1,h("loaded")},H=()=>{_.value.state=!0},re=()=>{i.value=!0},me=async()=>{console.log("Iniciando surtido"),h("loading"),B.value=!0;let l=3,a={id:d.value.id,state:l};const n=await z.nextState(a);if(n.status==200){B.value=!1,f.notify({message:`Surtido iniciado para el pedido  ${d.value.id}`,icon:"done",position:"center",color:"teal"});let D={supplyer:r.value.val,pedido:d.value.id,status:l},U=await oe.SaveSupply(D);console.log(U),U.status==200?(V(),h("fresh",d.value.id),_.value.state=!1):alert(`Error ${U.status}: ${U.data} 2`)}else alert(`Error ${n.status}: ${n.data} 1`);h("loaded")},De=async()=>{console.log("Generando factura"),f.loading.show({message:"Cambiando, espera..."});let l={chofi:p.value.val,supplyer:x.value._suplier_id,pedido:d.value.id,status:7},a=await oe.SaveChofi(l);if(console.log("%cDELIVERY ASSIGNED","color:white; background:#b71540; font-size:1.3em;"),console.log(a),a.status==200){let n={id:d.value.id,state:7,suply:x.value._suplier_id};console.log(n);let D=await oe.nextState(n);if(console.log("%cState Changed on Assist","color:white; background:#0a3d62; font-size:1.2em;"),console.log(D),D.data.partitionsEnd>L.value._status){console.log("%cTodas las particiones se han finalizado","color:white; background:#eb2f06; font-size:1.3em;");let U={id:d.value.id,state:D.data.partitionsEnd};console.log(U);const ce=await z.nextState(U);console.log("%cState Changed on RestockAPI","color:white; background:#079992; font-size:1.3em;"),console.log(ce)}if(h("chofiAssigned",n.id),D.status==200){V();let U=D.data.partition.id,ce=M.value.findIndex(Le=>Le.id==U);M.value[ce]._status=D.data.partition._status,M.value[ce].invoice=D.data.partition.invoice}f.notify({message:"Pedido en ruta",position:"center",icon:"done",timeout:5e3,color:"positive"}),F.value.state=!1}else alert(`Error ${a.status}: ${a.data}`);f.loading.hide()},Ee=async l=>{let a=`http://192.168.10.189:2200/#/checkin/${d.value.id}?key=${l}`;G.value.state=!0,je(()=>at.toCanvas(document.getElementById("qrcode"),a))},Pe=async l=>{f.loading.show({message:"..."}),console.log(l);const a=await z.printKey({ip:l.ip,port:l._port,order:d.value.id});a.status==200?(a.data,f.loading.hide(),f.notify({message:"Impresion correcta",icon:"done",color:"positive",position:"top"})):(console.error(a),alert(`Error ${a.status}: ${a.data}`))},Ie=async l=>{f.loading.show({message:"..."}),console.log(l);const a=await z.printForSupply({ip:l.ip,port:l._port,order:d.value.id});console.log(a),a.status==200?(a.data?f.notify({message:"Impresion correcta",icon:"done",color:"positive",position:"top"}):f.notify({message:`Sin conexion a <b>${l.name} <small>(${l.ip})</small></b>`,icon:"fas fa-bug",color:"negative",position:"center",html:!0,timeout:4e3}),f.loading.hide()):(console.error(a),alert(`Error ${a.status}: ${a.data}`))},qe=async l=>{f.loading.show({message:"..."}),console.log(l.ip),console.log(R.value);const a=await z.printForPartition({ip:l.ip,port:l._port,_partition:R.value});console.log(a),a.status==200?(a.data?f.notify({message:"Impresion correcta",icon:"done",color:"positive",position:"top"}):f.notify({message:`Sin conexion a <b>${l.name} <small>(${l.ip})</small></b>`,icon:"fas fa-bug",color:"negative",position:"center",html:!0,timeout:4e3}),f.loading.hide()):(console.error(a),alert(`Error ${a.status}: ${a.data}`))},Qe=async l=>{x.value=l,F.value.state=!0;let a=await oe.getSupply();console.log(a),p.value.opts=a},Ue=(l,a,n)=>{a(()=>{if(l==="")r.value.filter=r.value.opts;else{const D=l.toLowerCase();r.value.filter=r.value.opts.filter(U=>U.complete_name.toLowerCase().indexOf(D)>-1)}})},Ae=(l,a,n)=>{a(()=>{if(l==="")p.value.filter=p.value.opts;else{const D=l.toLowerCase();p.value.filter=p.value.opts.filter(U=>U.complete_name.toLowerCase().indexOf(D)>-1)}})},Oe=async()=>{console.log("Eliminando Pedido"),h("loading");let l=100,a={id:d.value.id,state:l};const n=await z.nextState(a);n.status==200?(i.value=!1,f.notify({message:`Surtido Cancelado para el pedido  ${d.value.id}`,icon:"close",position:"center",color:"negative"}),V(),h("fresh",d.value.id)):alert(`Error ${n.status}: ${n.data} 1`),h("loaded")},Re=l=>{console.log(l.id),R.value=l.id};return ze(()=>u.value=b.value.columns.map(l=>l.name)),V(),(l,a)=>(v(),S(Y,null,[e(W,{class:"full-width"},{default:t(()=>[e(E,{class:"row justify-between"},{default:t(()=>[o("div",null,[vt,o("div",mt,c(d.value.from.alias),1)]),o("div",ft,[_t,o("div",gt,c(d.value.id),1)]),o("div",bt,[yt,o("div",ht,c(d.value.created_by.nick),1)])]),_:1}),e(N),e(E,{class:"row justify-between"},{default:t(()=>[o("div",xt,[kt,o("div",wt,c(O(ee)(d.value.updated_at).format("YYYY-MM-DD")),1)]),d.value.notes?(v(),S("div",Ct,[St,o("div",$t,c(d.value.notes),1)])):A("",!0),o("div",Vt,[o("div",Dt,[g.value&&g.value.id==2?(v(),I(y,{key:0,color:"positive",icon:"start",dense:"",label:"Iniciar",onClick:H,flat:"",rounded:""})):A("",!0)]),e(N,{spaced:"",inset:"",vertical:"",dark:""}),o("div",Et,[g.value&&g.value.id==2?(v(),I(y,{key:0,color:"negative",icon:"close",dense:"",label:"Declinar",onClick:re,flat:"",rounded:""})):A("",!0)]),g.value&&g.value.id>2?(v(),I(y,{key:0,color:"indigo-10",icon:"print",dense:""},{default:t(()=>[e(ue,{class:"bg-grey-1 text-indigo-10",style:{"min-width":"250px"}},{default:t(()=>[e(ye,{onSelected:Ie,partition:!1})]),_:1})]),_:1})):A("",!0)])]),_:1}),e(N),$.value?(v(),I(E,{key:0,class:"text-center"},{default:t(()=>[e(Xe,{size:"50px",color:"purple"})]),_:1})):(v(),S(Y,{key:1},[e(N),e(lt,{modelValue:w.value,"onUpdate:modelValue":a[0]||(a[0]=n=>w.value=n),class:"text-pink-5",dense:"","no-caps":""},{default:t(()=>[e(fe,{name:"log",label:"Log"}),e(fe,{name:"basket",label:"Productos"}),e(fe,{name:"supliers",label:"Surtidores"})]),_:1},8,["modelValue"]),e(Ze,{modelValue:w.value,"onUpdate:modelValue":a[3]||(a[3]=n=>w.value=n),animated:""},{default:t(()=>[e(_e,{name:"log"},{default:t(()=>[e(xe,null,{default:t(()=>[(v(!0),S(Y,null,te(T.value,n=>(v(),I(ne,{key:n.id},{default:t(()=>[e(q,{avatar:""},{default:t(()=>[k(c(n.id),1)]),_:2},1024),e(q,null,{default:t(()=>[k(c(n.name),1)]),_:2},1024),e(q,null,{default:t(()=>[k(c(n.pivot.details.responsable),1)]),_:2},1024),e(q,null,{default:t(()=>[k("de "+c(O(ee)(n.pivot.created_at).format("h:mm a"))+" a "+c(O(ee)(n.pivot.updated_at).format("h:mm a")),1)]),_:2},1024)]),_:2},1024))),128))]),_:1})]),_:1}),e(_e,{name:"basket"},{default:t(()=>[C.value.length?(v(),I(ie,{key:0,"row-key":"id",flat:"",rows:C.value,columns:b.value.columns,pagination:b.value.pagination,filter:b.value.filter,"visible-columns":u.value},{top:t(()=>[o("div",Pt,[o("div",It,[o("span",qt,[e(y,{color:"pink-5",icon:"sync",onClick:V,round:"",dense:"",flat:""}),k(" Productos: "+c(C.value.length),1)]),k(", "),o("span",Qt,"Piezas: "+c(O(Q)),1)]),e(we,{dense:"",modelValue:b.value.filter,"onUpdate:modelValue":a[1]||(a[1]=n=>b.value.filter=n),placeholder:"Buscar","input-class":"text-uppercase",color:"pink-5"},{append:t(()=>[e(le,{name:"search"})]),_:1},8,["modelValue"]),e(y,{color:"secondary",icon:"fas fa-eye","no-caps":""},{default:t(()=>[e(ue,{style:{"min-width":"200px"}},{default:t(()=>[e(xe,null,{default:t(()=>[(v(!0),S(Y,null,te(b.value.columns,(n,D)=>Z((v(),I(ne,{tag:"label",key:D},{default:t(()=>[e(q,null,{default:t(()=>[e(ae,null,{default:t(()=>[k(c(n.label),1)]),_:2},1024),e(ae,{caption:""},{default:t(()=>[k(c(n.coldesc),1)]),_:2},1024)]),_:2},1024),e(q,{side:"",top:""},{default:t(()=>[e(Me,{color:"pink-5",modelValue:u.value,"onUpdate:modelValue":a[2]||(a[2]=U=>u.value=U),val:n.name},null,8,["modelValue","val"])]),_:2},1024)]),_:2},1024)),[[$e]])),128))]),_:1})]),_:1})]),_:1})])]),_:1},8,["rows","columns","pagination","filter","visible-columns"])):(v(),S("div",Ut,"Nada por aqui"))]),_:1}),e(_e,{name:"supliers"},{default:t(()=>[e(ie,{rows:M.value,"row-key":"id",dense:"",flat:"",bordered:"",grid:"","hide-header":""},{item:t(n=>[o("div",At,[e(W,{flat:"",bordered:""},{default:t(()=>[e(E,{class:"text-center"},{default:t(()=>[k(" Surtidor "),Ot,o("strong",null,c(n.row._suplier),1),e(N,{spaced:"",inset:"",vertical:"",dark:""}),e(le,{name:"print",color:"pink",size:"sm",onClick:D=>Re(n.row)},{default:t(()=>[e(ue,{class:"bg-grey-1 text-indigo-10",style:{"min-width":"250px"}},{default:t(()=>[e(ye,{onSelectedPartition:qe,partition:!0})]),_:1})]),_:2},1032,["onClick"]),Rt,o("div",Lt,[e(et,{color:"primary","text-color":"white",label:n.row.status.name},null,8,["label"])])]),_:2},1024),e(N),e(E,{class:"flex justify-between"},{default:t(()=>[Ft,zt,jt]),_:1}),e(N),e(E,{class:"flex justify-between"},{default:t(()=>[o("div",null,c(n.row.invoice),1),o("div",null,c(n.row.invoice_received),1),o("div",Bt,[n.row._status==6?(v(),S("div",Tt,[e(y,{color:"pink",label:"En Camino",class:"q-px-xl q-py-xs",size:"10px",padding:"5px 2px","icon-right":"start",flat:"",onClick:D=>Qe(n.row)},null,8,["onClick"])])):A("",!0),n.row._status>=7?(v(),S("div",Nt,[e(y,{color:"pink",icon:"qr_code",onClick:D=>Ee(n.row.entry_key),flat:""},null,8,["onClick"])])):A("",!0),n.row._status>=7?(v(),S("div",Yt,[e(y,{color:"pink",icon:"list",onClick:D=>O(ot).pdf(n.row.invoice,n.row.entry_key,d.value.id),flat:""},null,8,["onClick"])])):A("",!0)])]),_:2},1024)]),_:2},1024)])]),_:1},8,["rows"])]),_:1})]),_:1},8,["modelValue"])],64))]),_:1}),e(X,{modelValue:G.value.state,"onUpdate:modelValue":a[4]||(a[4]=n=>G.value.state=n)},{default:t(()=>[e(W,null,{default:t(()=>[e(E,{class:"text-h6 text-center"},{default:t(()=>[k(c(d.value.id)+" - "+c(d.value.from.alias),1)]),_:1}),e(N),e(E,{class:"text-center"},{default:t(()=>[Mt,o("div",Gt,c(G.value.key),1)]),_:1}),e(N),e(E,{align:"center"},{default:t(()=>[e(y,{color:"indigo-10",icon:"print"},{default:t(()=>[e(ue,null,{default:t(()=>[e(ye,{onSelected:Pe})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]),e(X,{modelValue:F.value.state,"onUpdate:modelValue":a[6]||(a[6]=n=>F.value.state=n)},{default:t(()=>[e(W,null,{default:t(()=>[e(E,{class:"row items-start"},{default:t(()=>[e(he,{icon:"warning",color:"orange-14","text-color":"white"}),Ht]),_:1}),e(E,null,{default:t(()=>[o("div",null,[Kt,o("div",Jt,c(x.value._suplier),1)])]),_:1}),x.value?(v(),I(E,{key:0},{default:t(()=>[e(se,{modelValue:p.value.val,"onUpdate:modelValue":a[5]||(a[5]=n=>p.value.val=n),options:p.value.filter,label:"CHOFER","option-label":"complete_name",filled:"",style:{width:"100%"},onFilter:Ae,"input-debounce":"0","use-input":""},null,8,["modelValue","options"])]),_:1})):A("",!0),e(pe,{align:"right"},{default:t(()=>[Z(e(y,{flat:"",label:"Cancelar",color:"primary","no-caps":""},null,512),[[ve]]),e(y,{flat:"",label:"Continuar",color:"primary",onClick:De,"no-caps":"",disable:p.value.val==null},null,8,["disable"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),e(X,{modelValue:_.value.state,"onUpdate:modelValue":a[8]||(a[8]=n=>_.value.state=n),persistent:""},{default:t(()=>[e(W,{style:{width:"400px"}},{default:t(()=>[e(E,{class:"row items-center"},{default:t(()=>[e(se,{modelValue:r.value.val,"onUpdate:modelValue":a[7]||(a[7]=n=>r.value.val=n),options:r.value.filter,label:"SELECCIONA SURTIDOR","option-label":"complete_name",filled:"",multiple:"",counter:"","max-values":"5",hint:"Maximo 5 colaboradores",style:{width:"100%"},onFilter:Ue,"input-debounce":"0","use-input":"","use-chips":""},null,8,["modelValue","options"])]),_:1}),e(pe,{align:"right"},{default:t(()=>[Z(e(y,{flat:"",label:"Cancel",color:"primary"},null,512),[[ve]]),e(y,{flat:"",label:"Continuar",color:"primary",onClick:me,disable:r.value.val.length==0},null,8,["disable"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),e(X,{modelValue:i.value,"onUpdate:modelValue":a[9]||(a[9]=n=>i.value=n),persistent:""},{default:t(()=>[e(W,null,{default:t(()=>[e(E,{class:"row items-center"},{default:t(()=>[e(he,{icon:"warning",color:"negative","text-color":"white"}),Wt,o("div",Xt,c(d.value.id),1)]),_:1}),e(E,null,{default:t(()=>[k(" Es correcto? ")]),_:1}),e(pe,{align:"center"},{default:t(()=>[Z(e(y,{flat:"",label:"Cancel",color:"positive"},null,512),[[ve]]),e(y,{flat:"",label:"Confirmar",color:"negative",onClick:Oe})]),_:1})]),_:1})]),_:1},8,["modelValue"])],64))}},el={class:"text-h6"},tl={class:"row q-mt-md"},ll={class:"q-ml-sm text-h6"},al={__name:"TableReport",props:{rows:{type:Array,default:[]},name:{type:String,default:""},type:{type:String,default:""}},emits:["cardResumeActived"],setup(J,{emit:h}){const P=J;tt();const f=de(),r=m({state:!1,action:null}),p=m({columns:[{name:"ID",field:"ID",label:"ID",align:"center"},{name:"code",field:"CODIGO",label:"Codigo",align:"center",sortable:!0},{name:"desc",field:"DESCRIPCION",label:"Descripcion",align:"left"},{name:"stockcedis",field:"CEDIS",label:"Stock (CEDIS)",align:"center",sortable:!0},{name:"stockpan",field:"PANTACO",label:"Stock (PAN)",align:"center",sortable:!0}],filter:""}),R={pndcs:{l:"Habilitar todo",c:"indigo-13",desc:"Los productos en esta lista se habilitaran y podran ser solicitados por cuaqluier tienda."},pdss:{l:"Deshabilitar todo",c:"pink-13",desc:"Los productos en esta lista se deshabilitaran y no podran ser solicitados."}},x=m(P.rows),d=m(P.name),L=m(P.type),$=j(()=>L.value?R[L.value]:{l:"",c:""}),T=()=>{const C=R[L.value];r.value.action=C,r.value.state=!0},w=async()=>{f.loading.show({message:"Espera..."});const C=await z.massiveAction({action:L.value});console.log(C),C.status==200?(C.data,r.value.state=!1,r.value.action=null,f.loading.hide(),f.notify({position:"center",color:"positive",icon:"done"}),h("cardResumeActived")):(console.error(C.data),alert(`Error ${C.status}: ${C.data.msg}`))},g=(C,B,F)=>{console.log(C),console.log(B),console.log(F),console.log(L.value)};return(C,B)=>(v(),S(Y,null,[e(ie,{"row-key":"ID",rows:x.value,columns:p.value.columns,filter:p.value.filter,onRowClick:g},{top:t(()=>[o("div",el,c(d.value),1),o("div",tl,[e(y,{color:O($).c,icon:"warning",label:O($).l,onClick:T},null,8,["color","label"]),e(we,{modelValue:p.value.filter,"onUpdate:modelValue":B[0]||(B[0]=F=>p.value.filter=F),dense:"",type:"text",icon:"search",label:"Buscar"},{prepend:t(()=>[e(le,{name:"search"})]),_:1},8,["modelValue"])])]),_:1},8,["rows","columns","filter"]),e(X,{modelValue:r.value.state,"onUpdate:modelValue":B[1]||(B[1]=F=>r.value.state=F),persistent:""},{default:t(()=>[e(W,null,{default:t(()=>[e(E,{class:"row items-center"},{default:t(()=>[e(he,{icon:"warning",color:r.value.action.c,"text-color":"white"},null,8,["color"]),o("span",ll,c(r.value.action.l),1)]),_:1}),e(E,null,{default:t(()=>[k(c(r.value.action.desc),1)]),_:1}),e(pe,{align:"right"},{default:t(()=>[Z(e(y,{flat:"",label:"cancelar",color:"primary"},null,512),[[ve]]),e(y,{flat:"",label:"continuar",color:"primary",onClick:w})]),_:1})]),_:1})]),_:1},8,["modelValue"])],64))}},ol={key:0,class:"bg-negative text-white q-pa-md q-mb-md"},sl=o("div",{class:"text-warning text-bold"},"Los siguientes folios tienen errores que no permiten ser listados en la tabla. ",-1),nl={class:"text-h6"},il=o("div",{class:"text--2"},"Errores comunes: Sin log, Sin fecha, Estatus desconocido",-1),dl={class:"row q-mb-md items-start justify-around"},rl={class:"text-left"},cl={class:"text-h5"},ul={class:"text--2"},pl={class:"full-width row items-center"},vl={class:"col text-h6 text-dark"},ml={__name:"AdminDashboard",emits:["reloadDashboard","freshOrder"],setup(J,{emit:h}){ke(),Ve();const P=Ce(),f=de(),r=["text-grey-5 text-bold","text-bold text-h6 text-red","text-indigo","4","5","text-bold text-pink-7","text-orange-8","8","text-primary","text-positive"],p=m({columns:[{name:"id",label:"Folio",field:"id",align:"center",sortable:!0},{name:"state",label:"Estado",field:i=>i.log.length==1?i.log[0].name:i.log[i.log.length-1].name,align:"left",sortable:!0,sort:(i,_,s,u)=>parseInt(s._status)-parseInt(u._status),classes:i=>r[i._status?parseInt(i._status)-1:parseInt(i.status.id)-1]},{name:"suplier",label:"Surtidores",field:i=>{var _;return(_=i.partition)==null?void 0:_.length},align:"center",classes:"text-bold"},{name:"laststate",label:"Ultima actividad",field:i=>ee(i.log.find(_=>_.id==i.status.id).pivot.updated_at).format("YYYY-MM-DD hh:mm A"),align:"left"},{name:"from",label:"Sucursal",field:i=>i.from.name.toUpperCase(),align:"left",sortable:!0},{name:"to",label:"Destino",field:i=>i.to.name.toUpperCase(),align:"left",sortable:!0},{name:"notes",label:"Notas",field:i=>i.notes,align:"left",classes:"text-orange text-bold"},{name:"tmodels",label:"Modelos",field:i=>i.products_count,align:"center",sortable:!0}],filter:"",pagination:{sortBy:"desc",descending:!1,rowsPerPage:20}}),R=m(!1),x=m({state:!1,title:"",data:null,name:null,type:null}),d=m({state:!1,head:null,block:!0}),L=j(()=>P.ordersSize),$=j(()=>P.ordersok.filter(i=>i._status!=100)),T=j(()=>P.ordersok.filter(i=>i._status==100)),w=j(()=>P.orderserrors),g=j(()=>P.resume),C=async i=>{console.log(i.row),d.value.head=i.row,d.value.state=!0},B=async i=>{f.loading.show({message:"cargando..."+i});const _=await z.report(i);console.log(_.data),x.value.data=_.data.rows,x.value.name=_.data.name,x.value.type=i,x.value.state=!0,f.loading.hide()},F=()=>{x.value.state=!1,x.state=!1,h("reload")},G=i=>{console.log(i),console.log("Se crearon las particiones",i),h("freshOrder",i)},M=()=>{R.value=!0};return(i,_)=>(v(),I(Ye,{padding:"",class:"bg-grey-2"},{default:t(()=>[O(w).length?(v(),S("div",ol,[sl,o("div",nl,c(O(w).map(s=>s.id).join("id")),1),il])):A("",!0),o("div",dl,[(v(!0),S(Y,null,te(O(g),s=>(v(),I(y,{stack:"","no-caps":"",class:"q-py-md",key:s.key,onClick:u=>B(s.key),color:s.total==0?"teal-10":"pink-13",disabled:s.total==0},{default:t(()=>[o("div",rl,[o("div",cl,c(s.total),1),o("div",ul,c(s.name),1)])]),_:2},1032,["onClick","color","disabled"]))),128))]),e(ie,{flat:"",bordered:"","row-key":"id",rows:O($),columns:p.value.columns,filter:p.value.filter,pagination:p.value.pagination},{header:t(s=>[e(ge,{props:s},{default:t(()=>[e(Se,{"auto-width":""}),(v(!0),S(Y,null,te(s.cols,u=>(v(),I(Se,{key:u.name,props:s},{default:t(()=>[k(c(u.label),1)]),_:2},1032,["props"]))),128))]),_:2},1032,["props"])]),body:t(s=>[e(ge,{props:s},{default:t(()=>[e(be,{"auto-width":""},{default:t(()=>[e(y,{size:"sm",dense:"",round:"",flat:"",onClick:u=>s.expand=!s.expand,icon:s.expand?"expand_less":"expand_more"},null,8,["onClick","icon"])]),_:2},1024),(v(!0),S(Y,null,te(s.cols,u=>(v(),I(be,{key:u.name,props:s,onClick:b=>C(s)},{default:t(()=>[k(c(u.value),1)]),_:2},1032,["props","onClick"]))),128))]),_:2},1032,["props"]),Z(e(ge,{props:s},{default:t(()=>[e(be,{colspan:"100%"},{default:t(()=>[e(xe,{dense:"",padding:"",class:"rounded-borders"},{default:t(()=>[e(ne,null,{default:t(()=>[e(q,null,{default:t(()=>[k("ID")]),_:1}),e(q,null,{default:t(()=>[k("ESTADO")]),_:1}),e(q,null,{default:t(()=>[k(" SALIDA")]),_:1}),e(q,null,{default:t(()=>[k("ENTRADA")]),_:1})]),_:1}),(v(!0),S(Y,null,te(s.row.partition,(u,b)=>(v(),S("div",{key:b},[e(ne,null,{default:t(()=>[e(q,null,{default:t(()=>[e(ae,{overline:""},{default:t(()=>[k(c(u._suplier),1)]),_:2},1024),e(ae,{caption:""},{default:t(()=>[k(c(u.id),1)]),_:2},1024)]),_:2},1024),e(q,{class:Be(`${r[u.status.id-1]}`)},{default:t(()=>[k(c(u.status.name),1)]),_:2},1032,["class"]),e(q,null,{default:t(()=>[k(c(u.invoice),1)]),_:2},1024),e(q,null,{default:t(()=>[k(c(u.invoice_received),1)]),_:2},1024)]),_:2},1024),e(N,{spaced:"",inset:""})]))),128))]),_:2},1024)]),_:2},1024)]),_:2},1032,["props"]),[[Te,s.expand]])]),top:t(()=>[o("div",pl,[o("div",vl,"Pedidos: "+c(O(L)),1),e(we,{dense:"",modelValue:p.value.filter,"onUpdate:modelValue":_[0]||(_[0]=s=>p.value.filter=s),"input-class":"text-uppercase",placeholder:"Buscar",color:"pink-5"},{append:t(()=>[e(le,{name:"search"})]),_:1},8,["modelValue"]),e(N,{spaced:"",inset:"",vertical:"",dark:""}),o("div",null,[e(le,{name:"archive",size:"md",color:"negative",onClick:M})])])]),_:1},8,["rows","columns","filter","pagination"]),e(X,{"full-width":"",modelValue:d.value.state,"onUpdate:modelValue":_[3]||(_[3]=s=>d.value.state=s),persistent:d.value.block,"no-esc-dismiss":d.value.block,"no-backdrop-dismiss":d.value.block},{default:t(()=>[e(Zt,{head:d.value.head,onLoaded:_[1]||(_[1]=s=>d.value.block=!1),onLoading:_[2]||(_[2]=s=>d.value.block=!0),onFresh:G,onChofiAssigned:G},null,8,["head"])]),_:1},8,["modelValue","persistent","no-esc-dismiss","no-backdrop-dismiss"]),e(X,{modelValue:x.value.state,"onUpdate:modelValue":_[4]||(_[4]=s=>x.value.state=s)},{default:t(()=>[e(al,{rows:x.value.data,name:x.value.name,type:x.value.type,onCardResumeActived:F},null,8,["rows","name","type"])]),_:1},8,["modelValue"]),e(X,{modelValue:R.value,"onUpdate:modelValue":_[5]||(_[5]=s=>R.value=s),"full-width":""},{default:t(()=>[e(W,{style:{width:"700px","max-width":"80vw"}},{default:t(()=>[e(E,{class:"q-pt-none"},{default:t(()=>[e(ie,{flat:"",bordered:"","row-key":"id",rows:O(T),columns:p.value.columns,pagination:p.value.pagination,title:"Pedidos Cancelados"},null,8,["rows","columns","pagination"])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1}))}};const fl=o("div",{class:"text-bold"},"Dashboard ",-1),_l={class:"row"},gl={class:"col row"},Ql={__name:"DashboardLyt",setup(J){const h=ke(),P=Ve(),f=Ce(),r=de(),p=st,R=m([{id:0,alias:"Todas"},{id:1,alias:"CEDIS",_state:1},{id:2,alias:"SP1",_state:1}]),x=m([{id:"day",label:"Hoy"},{id:"week",label:"Semana"},{id:"month",label:"Mes"},{id:"C",label:"otra ...",disable:!0}]),d=["p2","P2","p3","P3","bol","BOL","sap","SAP"],L=m(null),$=m(null),T=m({from:ee(Date.now()).startOf("day"),to:ee(Date.now()).startOf("day")}),w=async()=>{var H;r.loading.show({message:"Cargado vista..."}),console.log("%cIniciando MainLayout...","font-size:2em;color:orange;");let s=(H=h.query.v)!=null?H:"day",u=x.value.findIndex(re=>re.id==s),b=u>=0?u:0;$.value=x.value[b],T.value.from=ee(Date.now()).startOf($.value.id);let Q=h.query.d&&d.includes(h.query.d)?h.query.d:"all";console.log(Q);const V=await z.index($.value.id,Q);console.log(V),f.fillOrders(V.orders),f.fillResume(V.resume),f.fillPrinters(V.printers),L.value=R.value[0],console.log("%cMainLayout listo!!","font-size:2em;color:orange;"),r.loading.hide(),K.connect(),K.emit("joinat",p),K.on("joineddashreq",C),K.on("creating",B),K.on("order_update",F),K.on("order_changestate",G),K.on("order_refresh",M),K.on("orderpartition_refresh",_)},g=s=>{let u=h.query.d&&d.includes(h.query.d)?h.query.d:"all";P.push(`/dashboard?v=${s.id}&d=${u}`)};j(()=>T.value.from.format("YYYY/MM/DD")),j(()=>T.value.to.format("YYYY/MM/DD"));const C=s=>{console.log(`%c${s.user.me.nick} de ${s.from.alias} se ha unido a Restock (UID: ${s.user.me.id})`,"background:#076F3E;color:#f5f6fa;border-radius:10px;padding:10px;font-size:1.1em;")},B=async s=>{let u=s.order,b=await z.orderFresh(u.id),Q=b.data.order,V=b.data.oid;f.addOrUpdate(V,Q)},F=s=>{f.orderUpdate(s)},G=async s=>{let u=s.order,b=s.state,Q=await z.orderFresh(u.id),V=Q.data.order,H=Q.data.oid;f.addOrUpdate(H,V),b.id==2&&r.notify({message:`El pedido <b>${u.id}</b> esta listo para iniciar surtido!!`,color:"positive",textColor:"white",position:"bottom",html:!0,timeout:5e3})},M=async s=>{console.log("REFRESHING BY SKT!!",s);let u=s.order,b=await z.orderFresh(u);console.log(b);let Q=b.data.order;console.log(Q.partition);let V=b.data.oid;f.addOrUpdate(V,Q)},i=s=>{console.log("orderViewer/AdminDashboard actualizaron el pedido:",s),K.emit("order_refresh",{order:s})},_=async s=>{console.log("Partition refresh!!",s);let u=s.order,b=await z.orderFresh(u);console.log(b);let Q=b.data.order,V=Q.partition,H=b.data.oid;f.addOrUpdate(H,Q),V.filter(me=>me._status==4).length==V.length&&r.notify({message:`El pedido <b>${H}</b> esta listo para iniciar <b>embarque</b>`,html:!0,color:"purple-10",icon:"fa-solid fa-truck-ramp-box"})};return Ne(()=>h.query,()=>{w()}),w(),document.title="Dashboard",(s,u)=>(v(),I(He,{view:"lHh Lpr lFf"},{default:t(()=>[e(Ke,{bordered:"",class:"bg-yellow text-dark"},{default:t(()=>[e(Ge,{class:"row justify-between items-center"},{default:t(()=>[fl,o("div",_l,[e(y,{color:"dark",round:"",unelevated:"",flat:"",icon:"sync",onClick:w}),o("div",gl,[e(se,{class:"col",dense:"",filled:"",label:"Vista",modelValue:$.value,"onUpdate:modelValue":[u[0]||(u[0]=b=>$.value=b),g],options:x.value},null,8,["modelValue","options"]),$.value.id=="C"?(v(),I(y,{key:0,unelevated:"",color:"pink-5",icon:"fas fa-calendar-day",dense:""})):A("",!0)])])]),_:1})]),_:1}),e(Je,null,{default:t(()=>[e(ml,{onReload:w,onFreshOrder:i})]),_:1})]),_:1}))}};export{Ql as default};
