import{r as v,c as j,o as p,aF as w,f as s,d as e,w as t,h as b,aH as M,i as F,e as L,aA as X,b as P,aN as Oe,Q as oe,t as u,aE as y,R as Ve,u as xe,a7 as Re,aG as te,aJ as he,x as Le,a as $e,aO as ze,aP as Fe,g as je}from"./index.8b802c3e.js";import{u as de,t as Y,b as se,y as ne,z as U,A as le,v as me,w as ye,Q as ie,x as W,B as Ce,a as Te}from"./QPage.ec3aa7eb.js";import{a as Be,Q as Ne}from"./QToggle.b31ded63.js";import{Q as Ye,a as Me,b as Ge}from"./QLayout.42732104.js";import{d as Z}from"./dayjs.min.53a5c0af.js";import{b as D,Q as ke,a as J,c as ce,C as pe,R as T}from"./ClosePopup.70109a64.js";import{a as we,Q as He,b as Ke,c as fe,d as Je,e as _e,f as We,u as Xe}from"./Restock.7ad6cebe.js";import{Q as ge,a as be}from"./QTd.a4857679.js";import{Q as Ze}from"./QTabs.9309dd16.js";import{A as ae}from"./AssistApi.66f62a15.js";import{b as et}from"./jspdf.plugin.autotable.a50de25a.js";import{p as tt}from"./pdfCreate.00d283ec.js";import{$sktRestock as H,usrSkt as lt}from"./socket.1aa8b866.js";import"./rtl.19991549.js";import"./axios.625f35ec.js";const at={class:"q-pa-sm bg-grey-2 text-bold row justify-between items-center",style:{"min-width":"250px"}},ot=s("div",null,"Impresion",-1),st={key:0,class:"row justify-between items-center"},nt={class:"q-mt-sm q-pa-sm"},it={key:0,class:"q-pa-sm"},dt={class:"text--3"},rt={class:"q-pa-sm text-right"},Se={__name:"PrinterSelect",emits:["selected"],setup(ee,{emit:h}){const I=de(),_=we(),c=v(null),m=v(null),q=j(()=>_.printers),d=j(()=>c.value?c.value.printers:[]),k=()=>{I.localStorage.set("LUP",{wkp:c.value,printer:m.value}),h("selected",m.value)},E=I.localStorage.getItem("LUP");return E&&(c.value=E.wkp,m.value=E.printer),(Q,C)=>(p(),w(M,null,[s("div",at,[ot,c.value?(p(),w("div",st,[e(He,{flat:""},{default:t(()=>[e(b,{flat:"",color:"positive",icon:"add",dense:""}),m.value?(p(),w(M,{key:0},[e(b,{flat:"",color:"negative",icon:"delete",dense:""}),e(b,{flat:"",color:"orange",icon:"edit",dense:""})],64)):F("",!0)]),_:1})])):F("",!0)]),e(Y),s("div",nt,[e(se,{modelValue:c.value,"onUpdate:modelValue":[C[0]||(C[0]=f=>c.value=f),C[1]||(C[1]=f=>m.value=null)],options:L(q),label:"Sucursal",filled:"","option-label":"alias","option-value":"id"},null,8,["modelValue","options"])]),c.value?(p(),w("div",it,[e(se,{modelValue:m.value,"onUpdate:modelValue":C[2]||(C[2]=f=>m.value=f),options:L(d),label:"Impresora",filled:"","option-value":"id","option-label":"name"},{option:t(f=>[X((p(),P(ne,Oe({clickable:""},f.itemProps),{default:t(()=>[e(U,{class:"text-center",side:""},{default:t(()=>[e(oe,{color:"primary","text-color":"white",name:"print",size:"30px"}),s("span",dt,"ID:"+u(f.opt.id),1)]),_:2},1024),e(U,null,{default:t(()=>[e(le,null,{default:t(()=>[y(u(f.opt.name),1)]),_:2},1024),e(le,{caption:"",lines:"2"},{default:t(()=>[y(u(f.opt.ip),1)]),_:2},1024)]),_:2},1024)]),_:2},1040)),[[Ve]])]),_:1},8,["modelValue","options"])])):F("",!0),s("div",rt,[c.value&&m.value?(p(),P(b,{key:0,color:"primary",icon:"print",onClick:k})):F("",!0)])],64))}},ut=s("div",{class:"text-overline text-grey-7"},"Sucursal",-1),ct={class:"text-h6"},pt={class:"q-px-lg text-center"},vt=s("div",{class:"text-overline text-grey-7"},"Folio",-1),mt={class:"text-h6"},ft={class:"text-right"},_t=s("div",{class:"text-overline text-grey-7"},"Agente",-1),gt={class:"text-h6"},bt={class:"text-center"},ht=s("div",{class:"text-overline text-grey-7"},"Fecha",-1),yt={class:"text-h6"},xt={key:0,class:"text-center"},kt=s("div",{class:"text-overline text-grey-7 col"},"Notas",-1),wt={class:"text-h6"},Ct={class:"text-center"},St={class:"text-overline text-grey-7"},Vt={class:"text-h6"},$t={class:"full-width row items-center"},Dt={class:"col text-dark"},Et={class:"text-h6"},It={class:"text-bold"},qt={key:1,class:"text-center q-pa-lg text-h6 text-grey-7"},Qt={class:"q-pa-xs col-xs-12 col-sm-6 col-md-4"},Pt=s("br",null,null,-1),Ut=s("br",null,null,-1),At={class:"text-overline text-grey-7"},Ot=s("div",null,"Salida",-1),Rt=s("div",null,"Entrada",-1),Lt=s("div",null,"Herramientas",-1),zt={class:"row"},Ft={key:0,class:"col"},jt={key:1,class:"col"},Tt={key:2,class:"col"},Bt=s("canvas",{id:"qrcode"},null,-1),Nt={class:"text--2"},Yt=s("div",{class:"q-ml-md"},[s("div",{class:"text-h6"},"Cambiar a En Camino?"),s("div",null,"Cambiara a estatus en camino")],-1),Mt=s("div",{class:"text-center text-h6"},"Surtidor",-1),Gt={class:"text-center text-bold text-subtitle2 text-overline"},Ht=s("div",{class:"q-ml-sm text-bold"},"Estas a punto de cancelar el pedido ",-1),Kt={class:"q-ml-sm text-bold"},Jt={__name:"OrderViewer",props:{head:{type:Object,default:{}}},emits:["loaded","loading","fresh","chofiAssigned"],setup(ee,{emit:h}){const I=ee,_=de();xe();const c=v({opts:[],val:[],filter:[]}),m=v({opts:null,val:null,filter:null}),q=v(null),d=v(I.head),k=v(null),E=v(!0),Q=v([]),C=v("supliers"),f=v(null),B=v([]),V=v(!1),A=v({state:!1}),z=v({state:!1,key:null}),N=v(null),K=v(!1),i=v({state:!1}),g=v(null),o=v([]),r=v({columns:[{name:"id",label:"ID",field:"id",align:"left",coldesc:"Identificador del producto (MySQL)"},{name:"code",label:"Codigo",field:"code",align:"left",coldesc:"Codigo principal del producto"},{name:"assocs",label:"Asociados",field:l=>l.variants.length?l.variants.map(a=>a.barcode).join(", "):null,align:"left",coldesc:"Codigos relacionados al codigo principal"},{name:"bcode",label:"Codigo de Barras",field:"barcode",align:"center",coldesc:"Codigo de barras principal"},{name:"locs",label:"Ubicacion",field:l=>l.locations.length?l.locations.map(a=>a.path).join(", "):"--",align:"left",coldesc:"Ubicaciones en almacen general"},{name:"stocks",label:"Stock (pzs)",field:l=>l.stocks.reduce((a,n)=>a+n.pivot.stock,0),sortable:!0,classes:l=>l.stocks.reduce((a,n)=>a+n.pivot.stock,0)<=0?"text-red text-bold":"text-bold text-primary",align:"center",coldesc:"Stock total en almacenes GENERALES (CEDIS+PAN)"},{name:"ipack",label:"PxC",field:l=>typeof l.pivot.ipack=="number"?l.pivot.ipack:l.pieces,align:"center",coldesc:"Unidades x Embalaje"},{name:"request",label:"Solicitud",field:l=>l.pivot.amount,align:"center",coldesc:"Embalaje solicitado"},{name:"uspply",label:"Unidad",field:l=>l.units.id==3?"Cajas":"Piezas",align:"left",coldesc:"Unidad de embalaje del producto"},{name:"delivery",label:"Salida (conteo)",field:l=>l.pivot.toDelivered,align:"center",coldesc:"Embalaje surtido",sortable:!0},{name:"reqinpzs",label:"Piezas",field:l=>l.pivot._supply_by==3?(typeof l.pivot.ipack=="number"?l.pivot.ipack:l.pieces)*(typeof l.pivot.ipack=="number"?l.pivot.toDelivered:l.pivot.amount):typeof l.pivot.ipack=="number"?l.pivot.toDelivered:l.pivot.amount,align:"center",coldesc:"Unidades totales en embalaje"},{name:"checkout",label:"Checkout",field:l=>l.pivot.checkout?"OK":"---",align:"center",classes:l=>l.pivot.checkout?"text-positive text-bold":"text-red",sortable:!0,coldesc:"Revision del Administrador"},{name:"received",label:"Entrada (conteo)",field:l=>l.pivot.toReceived,align:"center",coldesc:"Embalaje recibido"},{name:"descr",label:"Descripcion",field:"description",align:"left"},{name:"section",label:"Seccion",field:"section",align:"left"},{name:"family",label:"Familia",field:"family",align:"left"},{name:"category",label:"Categoria",field:"category",align:"left"}],filter:"",pagination:{sortBy:"locs",descending:!1,rowsPerPage:20}}),x=j(()=>B.value.reduce((l,a)=>l+(a.pivot._supply_by==3?a.pivot.amount*a.pieces:a.pivot.amount),0));j(()=>f.value&&(f.value.id==2||f.value.id==6)),j(()=>Q.value.find(l=>l.id==f.value.id).pivot),j(()=>N.value.map(l=>l._status).includes(6));const S=async()=>{h("loading"),E.value=!0;let l=await T.order(d.value.id);if(console.log(l.data),B.value=l.data.products,Q.value=l.data.log.map(a=>(a.pivot.details=JSON.parse(a.pivot.details),a)),N.value=l.data.partition,f.value=l.data.status,k.value=l.data,g.value=l.data.invoice,f.value.id==2){let a=await ae.getSupply();console.log(a),c.value.opts=a}E.value=!1,h("loaded")},O=()=>{i.value.state=!0},G=()=>{K.value=!0},re=async()=>{console.log("Iniciando surtido"),h("loading"),V.value=!0;let l=3,a={id:d.value.id,state:l};const n=await T.nextState(a);if(n.status==200){V.value=!1,_.notify({message:`Surtido iniciado para el pedido  ${d.value.id}`,icon:"done",position:"center",color:"teal"});let $={supplyer:c.value.val,pedido:d.value.id,status:l},R=await ae.SaveSupply($);console.log(R),R.status==200?(S(),h("fresh",d.value.id),i.value.state=!1):alert(`Error ${R.status}: ${R.data} 2`)}else alert(`Error ${n.status}: ${n.data} 1`);h("loaded")},ve=async()=>{console.log("Generando factura"),_.loading.show({message:"Cambiando, espera..."});let l={chofi:m.value.val,supplyer:q.value._suplier_id,pedido:d.value.id,status:7},a=await ae.SaveChofi(l);if(console.log("%cDELIVERY ASSIGNED","color:white; background:#b71540; font-size:1.3em;"),console.log(a),a.status==200){let n={id:d.value.id,state:7,suply:q.value._suplier_id};console.log(n);let $=await ae.nextState(n);if(console.log("%cState Changed on Assist","color:white; background:#0a3d62; font-size:1.2em;"),console.log($),$.data.partitionsEnd>k.value._status){console.log("%cTodas las particiones se han finalizado","color:white; background:#eb2f06; font-size:1.3em;");let R={id:d.value.id,state:$.data.partitionsEnd};console.log(R);const ue=await T.nextState(R);console.log("%cState Changed on RestockAPI","color:white; background:#079992; font-size:1.3em;"),console.log(ue)}if(h("chofiAssigned",n.id),$.status==200){S();let R=$.data.partition.id,ue=N.value.findIndex(Ae=>Ae.id==R);N.value[ue]._status=$.data.partition._status,N.value[ue].invoice=$.data.partition.invoice}_.notify({message:"Pedido en ruta",position:"center",icon:"done",timeout:5e3,color:"positive"}),A.value.state=!1}else alert(`Error ${a.status}: ${a.data}`);_.loading.hide()},De=async l=>{let a=`http://192.168.10.189:2200/#/checkin/${d.value.id}?key=${l}`;z.value.state=!0,Le(()=>et.toCanvas(document.getElementById("qrcode"),a))},Ee=async l=>{_.loading.show({message:"..."}),console.log(l);const a=await T.printKey({ip:l.ip,port:l._port,order:d.value.id});a.status==200?(a.data,_.loading.hide(),_.notify({message:"Impresion correcta",icon:"done",color:"positive",position:"top"})):(console.error(a),alert(`Error ${a.status}: ${a.data}`))},Ie=async l=>{_.loading.show({message:"..."}),console.log(l);const a=await T.printForSupply({ip:l.ip,port:l._port,order:d.value.id});console.log(a),a.status==200?(a.data?_.notify({message:"Impresion correcta",icon:"done",color:"positive",position:"top"}):_.notify({message:`Sin conexion a <b>${l.name} <small>(${l.ip})</small></b>`,icon:"fas fa-bug",color:"negative",position:"center",html:!0,timeout:4e3}),_.loading.hide()):(console.error(a),alert(`Error ${a.status}: ${a.data}`))},qe=async l=>{q.value=l,A.value.state=!0;let a=await ae.getSupply();console.log(a),m.value.opts=a},Qe=(l,a,n)=>{a(()=>{if(l==="")c.value.filter=c.value.opts;else{const $=l.toLowerCase();c.value.filter=c.value.opts.filter(R=>R.complete_name.toLowerCase().indexOf($)>-1)}})},Pe=(l,a,n)=>{a(()=>{if(l==="")m.value.filter=m.value.opts;else{const $=l.toLowerCase();m.value.filter=m.value.opts.filter(R=>R.complete_name.toLowerCase().indexOf($)>-1)}})},Ue=async()=>{console.log("Eliminando Pedido"),h("loading");let l=100,a={id:d.value.id,state:l};const n=await T.nextState(a);n.status==200?(K.value=!1,_.notify({message:`Surtido Cancelado para el pedido  ${d.value.id}`,icon:"close",position:"center",color:"negative"}),S(),h("fresh",d.value.id)):alert(`Error ${n.status}: ${n.data} 1`),h("loaded")};return Re(()=>o.value=r.value.columns.map(l=>l.name)),S(),(l,a)=>(p(),w(M,null,[e(J,{class:"full-width"},{default:t(()=>[e(D,{class:"row justify-between"},{default:t(()=>[s("div",null,[ut,s("div",ct,u(d.value.from.alias),1)]),s("div",pt,[vt,s("div",mt,u(d.value.id),1)]),s("div",ft,[_t,s("div",gt,u(d.value.created_by.nick),1)])]),_:1}),e(Y),e(D,{class:"row justify-between"},{default:t(()=>[s("div",bt,[ht,s("div",yt,u(L(Z)(d.value.updated_at).format("YYYY-MM-DD")),1)]),d.value.notes?(p(),w("div",xt,[kt,s("div",wt,u(d.value.notes),1)])):F("",!0),s("div",Ct,[s("div",St,[f.value&&f.value.id==2?(p(),P(b,{key:0,color:"positive",icon:"start",dense:"",label:"Iniciar",onClick:O,flat:"",rounded:""})):F("",!0)]),e(Y,{spaced:"",inset:"",vertical:"",dark:""}),s("div",Vt,[f.value&&f.value.id==2?(p(),P(b,{key:0,color:"negative",icon:"close",dense:"",label:"Declinar",onClick:G,flat:"",rounded:""})):F("",!0)]),f.value&&f.value.id>2?(p(),P(b,{key:0,color:"indigo-10",icon:"print",dense:""},{default:t(()=>[e(me,{class:"bg-grey-1 text-indigo-10",style:{"min-width":"250px"}},{default:t(()=>[e(Se,{onSelected:Ie})]),_:1})]),_:1})):F("",!0)])]),_:1}),e(Y),E.value?(p(),P(D,{key:0,class:"text-center"},{default:t(()=>[e(Ke,{size:"50px",color:"purple"})]),_:1})):(p(),w(M,{key:1},[e(Y),e(Ze,{modelValue:C.value,"onUpdate:modelValue":a[0]||(a[0]=n=>C.value=n),class:"text-pink-5",dense:"","no-caps":""},{default:t(()=>[e(fe,{name:"log",label:"Log"}),e(fe,{name:"basket",label:"Productos"}),e(fe,{name:"supliers",label:"Surtidores"})]),_:1},8,["modelValue"]),e(Je,{modelValue:C.value,"onUpdate:modelValue":a[3]||(a[3]=n=>C.value=n),animated:""},{default:t(()=>[e(_e,{name:"log"},{default:t(()=>[e(ye,null,{default:t(()=>[(p(!0),w(M,null,te(Q.value,n=>(p(),P(ne,{key:n.id},{default:t(()=>[e(U,{avatar:""},{default:t(()=>[y(u(n.id),1)]),_:2},1024),e(U,null,{default:t(()=>[y(u(n.name),1)]),_:2},1024),e(U,null,{default:t(()=>[y(u(n.pivot.details.responsable),1)]),_:2},1024),e(U,null,{default:t(()=>[y("de "+u(L(Z)(n.pivot.created_at).format("h:mm a"))+" a "+u(L(Z)(n.pivot.updated_at).format("h:mm a")),1)]),_:2},1024)]),_:2},1024))),128))]),_:1})]),_:1}),e(_e,{name:"basket"},{default:t(()=>[B.value.length?(p(),P(ie,{key:0,"row-key":"id",flat:"",rows:B.value,columns:r.value.columns,pagination:r.value.pagination,filter:r.value.filter,"visible-columns":o.value},{top:t(()=>[s("div",$t,[s("div",Dt,[s("span",Et,[e(b,{color:"pink-5",icon:"sync",onClick:S,round:"",dense:"",flat:""}),y(" Productos: "+u(B.value.length),1)]),y(", "),s("span",It,"Piezas: "+u(L(x)),1)]),e(ke,{dense:"",modelValue:r.value.filter,"onUpdate:modelValue":a[1]||(a[1]=n=>r.value.filter=n),placeholder:"Buscar","input-class":"text-uppercase",color:"pink-5"},{append:t(()=>[e(oe,{name:"search"})]),_:1},8,["modelValue"]),e(b,{color:"secondary",icon:"fas fa-eye","no-caps":""},{default:t(()=>[e(me,{style:{"min-width":"200px"}},{default:t(()=>[e(ye,null,{default:t(()=>[(p(!0),w(M,null,te(r.value.columns,(n,$)=>X((p(),P(ne,{tag:"label",key:$},{default:t(()=>[e(U,null,{default:t(()=>[e(le,null,{default:t(()=>[y(u(n.label),1)]),_:2},1024),e(le,{caption:""},{default:t(()=>[y(u(n.coldesc),1)]),_:2},1024)]),_:2},1024),e(U,{side:"",top:""},{default:t(()=>[e(Be,{color:"pink-5",modelValue:o.value,"onUpdate:modelValue":a[2]||(a[2]=R=>o.value=R),val:n.name},null,8,["modelValue","val"])]),_:2},1024)]),_:2},1024)),[[Ve]])),128))]),_:1})]),_:1})]),_:1})])]),_:1},8,["rows","columns","pagination","filter","visible-columns"])):(p(),w("div",qt,"Nada por aqui"))]),_:1}),e(_e,{name:"supliers"},{default:t(()=>[e(ie,{rows:N.value,"row-key":"id",dense:"",flat:"",bordered:"",grid:"","hide-header":""},{item:t(n=>[s("div",Qt,[e(J,{flat:"",bordered:""},{default:t(()=>[e(D,{class:"text-center"},{default:t(()=>[y(" Surtidor "),Pt,s("strong",null,u(n.row._suplier),1),Ut,s("div",At,[e(We,{color:"primary","text-color":"white",label:n.row.status.name},null,8,["label"])])]),_:2},1024),e(Y),e(D,{class:"flex justify-between"},{default:t(()=>[Ot,Rt,Lt]),_:1}),e(Y),e(D,{class:"flex justify-between"},{default:t(()=>[s("div",null,u(n.row.invoice),1),s("div",null,u(n.row.invoice_received),1),s("div",zt,[n.row._status==6?(p(),w("div",Ft,[e(b,{color:"pink",label:"En Camino",class:"q-px-xl q-py-xs",size:"10px",padding:"5px 2px","icon-right":"start",flat:"",onClick:$=>qe(n.row)},null,8,["onClick"])])):F("",!0),n.row._status>=7?(p(),w("div",jt,[e(b,{color:"pink",icon:"qr_code",onClick:$=>De(n.row.entry_key),flat:""},null,8,["onClick"])])):F("",!0),n.row._status>=7?(p(),w("div",Tt,[e(b,{color:"pink",icon:"list",onClick:$=>L(tt).pdf(n.row.invoice,n.row.entry_key,d.value.id),flat:""},null,8,["onClick"])])):F("",!0)])]),_:2},1024)]),_:2},1024)])]),_:1},8,["rows"])]),_:1})]),_:1},8,["modelValue"])],64))]),_:1}),e(W,{modelValue:z.value.state,"onUpdate:modelValue":a[4]||(a[4]=n=>z.value.state=n)},{default:t(()=>[e(J,null,{default:t(()=>[e(D,{class:"text-h6 text-center"},{default:t(()=>[y(u(d.value.id)+" - "+u(d.value.from.alias),1)]),_:1}),e(Y),e(D,{class:"text-center"},{default:t(()=>[Bt,s("div",Nt,u(z.value.key),1)]),_:1}),e(Y),e(D,{align:"center"},{default:t(()=>[e(b,{color:"indigo-10",icon:"print"},{default:t(()=>[e(me,null,{default:t(()=>[e(Se,{onSelected:Ee})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]),e(W,{modelValue:A.value.state,"onUpdate:modelValue":a[6]||(a[6]=n=>A.value.state=n)},{default:t(()=>[e(J,null,{default:t(()=>[e(D,{class:"row items-start"},{default:t(()=>[e(he,{icon:"warning",color:"orange-14","text-color":"white"}),Yt]),_:1}),e(D,null,{default:t(()=>[s("div",null,[Mt,s("div",Gt,u(q.value._suplier),1)])]),_:1}),q.value?(p(),P(D,{key:0},{default:t(()=>[e(se,{modelValue:m.value.val,"onUpdate:modelValue":a[5]||(a[5]=n=>m.value.val=n),options:m.value.filter,label:"CHOFER","option-label":"complete_name",filled:"",style:{width:"100%"},onFilter:Pe,"input-debounce":"0","use-input":""},null,8,["modelValue","options"])]),_:1})):F("",!0),e(ce,{align:"right"},{default:t(()=>[X(e(b,{flat:"",label:"Cancelar",color:"primary","no-caps":""},null,512),[[pe]]),e(b,{flat:"",label:"Continuar",color:"primary",onClick:ve,"no-caps":"",disable:m.value.val==null},null,8,["disable"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),e(W,{modelValue:i.value.state,"onUpdate:modelValue":a[8]||(a[8]=n=>i.value.state=n),persistent:""},{default:t(()=>[e(J,{style:{width:"400px"}},{default:t(()=>[e(D,{class:"row items-center"},{default:t(()=>[e(se,{modelValue:c.value.val,"onUpdate:modelValue":a[7]||(a[7]=n=>c.value.val=n),options:c.value.filter,label:"SELECCIONA SURTIDOR","option-label":"complete_name",filled:"",multiple:"",counter:"","max-values":"5",hint:"Maximo 5 colaboradores",style:{width:"100%"},onFilter:Qe,"input-debounce":"0","use-input":"","use-chips":""},null,8,["modelValue","options"])]),_:1}),e(ce,{align:"right"},{default:t(()=>[X(e(b,{flat:"",label:"Cancel",color:"primary"},null,512),[[pe]]),e(b,{flat:"",label:"Continuar",color:"primary",onClick:re,disable:c.value.val.length==0},null,8,["disable"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),e(W,{modelValue:K.value,"onUpdate:modelValue":a[9]||(a[9]=n=>K.value=n),persistent:""},{default:t(()=>[e(J,null,{default:t(()=>[e(D,{class:"row items-center"},{default:t(()=>[e(he,{icon:"warning",color:"negative","text-color":"white"}),Ht,s("div",Kt,u(d.value.id),1)]),_:1}),e(D,null,{default:t(()=>[y(" Es correcto? ")]),_:1}),e(ce,{align:"center"},{default:t(()=>[X(e(b,{flat:"",label:"Cancel",color:"positive"},null,512),[[pe]]),e(b,{flat:"",label:"Confirmar",color:"negative",onClick:Ue})]),_:1})]),_:1})]),_:1},8,["modelValue"])],64))}},Wt={class:"text-h6"},Xt={class:"row q-mt-md"},Zt={class:"q-ml-sm text-h6"},el={__name:"TableReport",props:{rows:{type:Array,default:[]},name:{type:String,default:""},type:{type:String,default:""}},emits:["cardResumeActived"],setup(ee,{emit:h}){const I=ee;Xe();const _=de(),c=v({state:!1,action:null}),m=v({columns:[{name:"ID",field:"ID",label:"ID",align:"center"},{name:"code",field:"CODIGO",label:"Codigo",align:"center",sortable:!0},{name:"desc",field:"DESCRIPCION",label:"Descripcion",align:"left"},{name:"stockcedis",field:"CEDIS",label:"Stock (CEDIS)",align:"center",sortable:!0},{name:"stockpan",field:"PANTACO",label:"Stock (PAN)",align:"center",sortable:!0}],filter:""}),q={pndcs:{l:"Habilitar todo",c:"indigo-13",desc:"Los productos en esta lista se habilitaran y podran ser solicitados por cuaqluier tienda."},pdss:{l:"Deshabilitar todo",c:"pink-13",desc:"Los productos en esta lista se deshabilitaran y no podran ser solicitados."}},d=v(I.rows),k=v(I.name),E=v(I.type),Q=j(()=>E.value?q[E.value]:{l:"",c:""}),C=()=>{const V=q[E.value];c.value.action=V,c.value.state=!0},f=async()=>{_.loading.show({message:"Espera..."});const V=await T.massiveAction({action:E.value});console.log(V),V.status==200?(V.data,c.value.state=!1,c.value.action=null,_.loading.hide(),_.notify({position:"center",color:"positive",icon:"done"}),h("cardResumeActived")):(console.error(V.data),alert(`Error ${V.status}: ${V.data.msg}`))},B=(V,A,z)=>{console.log(V),console.log(A),console.log(z),console.log(E.value)};return(V,A)=>(p(),w(M,null,[e(ie,{"row-key":"ID",rows:d.value,columns:m.value.columns,filter:m.value.filter,onRowClick:B},{top:t(()=>[s("div",Wt,u(k.value),1),s("div",Xt,[e(b,{color:L(Q).c,icon:"warning",label:L(Q).l,onClick:C},null,8,["color","label"]),e(ke,{modelValue:m.value.filter,"onUpdate:modelValue":A[0]||(A[0]=z=>m.value.filter=z),dense:"",type:"text",icon:"search",label:"Buscar"},{prepend:t(()=>[e(oe,{name:"search"})]),_:1},8,["modelValue"])])]),_:1},8,["rows","columns","filter"]),e(W,{modelValue:c.value.state,"onUpdate:modelValue":A[1]||(A[1]=z=>c.value.state=z),persistent:""},{default:t(()=>[e(J,null,{default:t(()=>[e(D,{class:"row items-center"},{default:t(()=>[e(he,{icon:"warning",color:c.value.action.c,"text-color":"white"},null,8,["color"]),s("span",Zt,u(c.value.action.l),1)]),_:1}),e(D,null,{default:t(()=>[y(u(c.value.action.desc),1)]),_:1}),e(ce,{align:"right"},{default:t(()=>[X(e(b,{flat:"",label:"cancelar",color:"primary"},null,512),[[pe]]),e(b,{flat:"",label:"continuar",color:"primary",onClick:f})]),_:1})]),_:1})]),_:1},8,["modelValue"])],64))}},tl={key:0,class:"bg-negative text-white q-pa-md q-mb-md"},ll=s("div",{class:"text-warning text-bold"},"Los siguientes folios tienen errores que no permiten ser listados en la tabla. ",-1),al={class:"text-h6"},ol=s("div",{class:"text--2"},"Errores comunes: Sin log, Sin fecha, Estatus desconocido",-1),sl={class:"row q-mb-md items-start justify-around"},nl={class:"text-left"},il={class:"text-h5"},dl={class:"text--2"},rl={class:"full-width row items-center"},ul={class:"col text-h6 text-dark"},cl={__name:"AdminDashboard",emits:["reloadDashboard","freshOrder"],setup(ee,{emit:h}){xe(),$e();const I=we(),_=de(),c=["text-grey-5 text-bold","text-bold text-h6 text-red","text-indigo","4","5","text-bold text-pink-7","text-orange-8","8","text-primary","text-positive"],m=v({columns:[{name:"id",label:"Folio",field:"id",align:"center",sortable:!0},{name:"state",label:"Estado",field:i=>i.log.length==1?i.log[0].name:i.log[i.log.length-1].name,align:"left",sortable:!0,sort:(i,g,o,r)=>parseInt(o._status)-parseInt(r._status),classes:i=>c[i._status?parseInt(i._status)-1:parseInt(i.status.id)-1]},{name:"suplier",label:"Surtidores",field:i=>{var g;return(g=i.partition)==null?void 0:g.length},align:"center",classes:"text-bold"},{name:"laststate",label:"Ultima actividad",field:i=>Z(i.log.find(g=>g.id==i.status.id).pivot.updated_at).format("YYYY-MM-DD hh:mm A"),align:"left"},{name:"from",label:"Sucursal",field:i=>i.from.name.toUpperCase(),align:"left",sortable:!0},{name:"to",label:"Destino",field:i=>i.to.name.toUpperCase(),align:"left",sortable:!0},{name:"notes",label:"Notas",field:i=>i.notes,align:"left",classes:"text-orange text-bold"},{name:"tmodels",label:"Modelos",field:i=>i.products_count,align:"center",sortable:!0}],filter:"",pagination:{sortBy:"desc",descending:!1,rowsPerPage:20}}),q=v(!1),d=v({state:!1,title:"",data:null,name:null,type:null}),k=v({state:!1,head:null,block:!0}),E=j(()=>I.ordersSize),Q=j(()=>I.ordersok.filter(i=>i._status!=100)),C=j(()=>I.ordersok.filter(i=>i._status==100)),f=j(()=>I.orderserrors),B=j(()=>I.resume),V=async i=>{console.log(i.row),k.value.head=i.row,k.value.state=!0},A=async i=>{_.loading.show({message:"cargando..."+i});const g=await T.report(i);console.log(g.data),d.value.data=g.data.rows,d.value.name=g.data.name,d.value.type=i,d.value.state=!0,_.loading.hide()},z=()=>{d.value.state=!1,d.state=!1,h("reload")},N=i=>{console.log(i),console.log("Se crearon las particiones",i),h("freshOrder",i)},K=()=>{q.value=!0};return(i,g)=>(p(),P(Te,{padding:"",class:"bg-grey-2"},{default:t(()=>[L(f).length?(p(),w("div",tl,[ll,s("div",al,u(L(f).map(o=>o.id).join("id")),1),ol])):F("",!0),s("div",sl,[(p(!0),w(M,null,te(L(B),o=>(p(),P(b,{stack:"","no-caps":"",class:"q-py-md",key:o.key,onClick:r=>A(o.key),color:o.total==0?"teal-10":"pink-13",disabled:o.total==0},{default:t(()=>[s("div",nl,[s("div",il,u(o.total),1),s("div",dl,u(o.name),1)])]),_:2},1032,["onClick","color","disabled"]))),128))]),e(ie,{flat:"",bordered:"","row-key":"id",rows:L(Q),columns:m.value.columns,filter:m.value.filter,pagination:m.value.pagination},{header:t(o=>[e(ge,{props:o},{default:t(()=>[e(Ce,{"auto-width":""}),(p(!0),w(M,null,te(o.cols,r=>(p(),P(Ce,{key:r.name,props:o},{default:t(()=>[y(u(r.label),1)]),_:2},1032,["props"]))),128))]),_:2},1032,["props"])]),body:t(o=>[e(ge,{props:o},{default:t(()=>[e(be,{"auto-width":""},{default:t(()=>[e(b,{size:"sm",dense:"",round:"",flat:"",onClick:r=>o.expand=!o.expand,icon:o.expand?"expand_less":"expand_more"},null,8,["onClick","icon"])]),_:2},1024),(p(!0),w(M,null,te(o.cols,r=>(p(),P(be,{key:r.name,props:o,onClick:x=>V(o)},{default:t(()=>[y(u(r.value),1)]),_:2},1032,["props","onClick"]))),128))]),_:2},1032,["props"]),X(e(ge,{props:o},{default:t(()=>[e(be,{colspan:"100%"},{default:t(()=>[e(ye,{dense:"",padding:"",class:"rounded-borders"},{default:t(()=>[e(ne,null,{default:t(()=>[e(U,null,{default:t(()=>[y("ID")]),_:1}),e(U,null,{default:t(()=>[y("ESTADO")]),_:1}),e(U,null,{default:t(()=>[y(" SALIDA")]),_:1}),e(U,null,{default:t(()=>[y("ENTRADA")]),_:1})]),_:1}),(p(!0),w(M,null,te(o.row.partition,(r,x)=>(p(),w("div",{key:x},[e(ne,null,{default:t(()=>[e(U,null,{default:t(()=>[e(le,{overline:""},{default:t(()=>[y(u(r._suplier),1)]),_:2},1024),e(le,{caption:""},{default:t(()=>[y(u(r.id),1)]),_:2},1024)]),_:2},1024),e(U,{class:ze(`${c[r.status.id-1]}`)},{default:t(()=>[y(u(r.status.name),1)]),_:2},1032,["class"]),e(U,null,{default:t(()=>[y(u(r.invoice),1)]),_:2},1024),e(U,null,{default:t(()=>[y(u(r.invoice_received),1)]),_:2},1024)]),_:2},1024),e(Y,{spaced:"",inset:""})]))),128))]),_:2},1024)]),_:2},1024)]),_:2},1032,["props"]),[[Fe,o.expand]])]),top:t(()=>[s("div",rl,[s("div",ul,"Pedidos: "+u(L(E)),1),e(ke,{dense:"",modelValue:m.value.filter,"onUpdate:modelValue":g[0]||(g[0]=o=>m.value.filter=o),"input-class":"text-uppercase",placeholder:"Buscar",color:"pink-5"},{append:t(()=>[e(oe,{name:"search"})]),_:1},8,["modelValue"]),e(Y,{spaced:"",inset:"",vertical:"",dark:""}),s("div",null,[e(oe,{name:"archive",size:"md",color:"negative",onClick:K})])])]),_:1},8,["rows","columns","filter","pagination"]),e(W,{"full-width":"",modelValue:k.value.state,"onUpdate:modelValue":g[3]||(g[3]=o=>k.value.state=o),persistent:k.value.block,"no-esc-dismiss":k.value.block,"no-backdrop-dismiss":k.value.block},{default:t(()=>[e(Jt,{head:k.value.head,onLoaded:g[1]||(g[1]=o=>k.value.block=!1),onLoading:g[2]||(g[2]=o=>k.value.block=!0),onFresh:N,onChofiAssigned:N},null,8,["head"])]),_:1},8,["modelValue","persistent","no-esc-dismiss","no-backdrop-dismiss"]),e(W,{modelValue:d.value.state,"onUpdate:modelValue":g[4]||(g[4]=o=>d.value.state=o)},{default:t(()=>[e(el,{rows:d.value.data,name:d.value.name,type:d.value.type,onCardResumeActived:z},null,8,["rows","name","type"])]),_:1},8,["modelValue"]),e(W,{modelValue:q.value,"onUpdate:modelValue":g[5]||(g[5]=o=>q.value=o),"full-width":""},{default:t(()=>[e(J,{style:{width:"700px","max-width":"80vw"}},{default:t(()=>[e(D,{class:"q-pt-none"},{default:t(()=>[e(ie,{flat:"",bordered:"","row-key":"id",rows:L(C),columns:m.value.columns,pagination:m.value.pagination,title:"Pedidos Cancelados"},null,8,["rows","columns","pagination"])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1}))}};const pl=s("div",{class:"text-bold"},"Dashboard ",-1),vl={class:"row"},ml={class:"col row"},Il={__name:"DashboardLyt",setup(ee){const h=xe(),I=$e(),_=we(),c=de(),m=lt,q=v([{id:0,alias:"Todas"},{id:1,alias:"CEDIS",_state:1},{id:2,alias:"SP1",_state:1}]),d=v([{id:"day",label:"Hoy"},{id:"week",label:"Semana"},{id:"month",label:"Mes"},{id:"C",label:"otra ...",disable:!0}]),k=["p2","P2","p3","P3","bol","BOL","sap","SAP"],E=v(null),Q=v(null),C=v({from:Z(Date.now()).startOf("day"),to:Z(Date.now()).startOf("day")}),f=async()=>{var G;c.loading.show({message:"Cargado vista..."}),console.log("%cIniciando MainLayout...","font-size:2em;color:orange;");let o=(G=h.query.v)!=null?G:"day",r=d.value.findIndex(re=>re.id==o),x=r>=0?r:0;Q.value=d.value[x],C.value.from=Z(Date.now()).startOf(Q.value.id);let S=h.query.d&&k.includes(h.query.d)?h.query.d:"all";console.log(S);const O=await T.index(Q.value.id,S);console.log(O),_.fillOrders(O.orders),_.fillResume(O.resume),_.fillPrinters(O.printers),E.value=q.value[0],console.log("%cMainLayout listo!!","font-size:2em;color:orange;"),c.loading.hide(),H.connect(),H.emit("joinat",m),H.on("joineddashreq",V),H.on("creating",A),H.on("order_update",z),H.on("order_changestate",N),H.on("order_refresh",K),H.on("orderpartition_refresh",g)},B=o=>{let r=h.query.d&&k.includes(h.query.d)?h.query.d:"all";I.push(`/dashboard?v=${o.id}&d=${r}`)};j(()=>C.value.from.format("YYYY/MM/DD")),j(()=>C.value.to.format("YYYY/MM/DD"));const V=o=>{console.log(`%c${o.user.me.nick} de ${o.from.alias} se ha unido a Restock (UID: ${o.user.me.id})`,"background:#076F3E;color:#f5f6fa;border-radius:10px;padding:10px;font-size:1.1em;")},A=async o=>{let r=o.order,x=await T.orderFresh(r.id),S=x.data.order,O=x.data.oid;_.addOrUpdate(O,S)},z=o=>{_.orderUpdate(o)},N=async o=>{let r=o.order,x=o.state,S=await T.orderFresh(r.id),O=S.data.order,G=S.data.oid;_.addOrUpdate(G,O),x.id==2&&c.notify({message:`El pedido <b>${r.id}</b> esta listo para iniciar surtido!!`,color:"positive",textColor:"white",position:"bottom",html:!0,timeout:5e3})},K=async o=>{console.log("REFRESHING BY SKT!!",o);let r=o.order,x=await T.orderFresh(r);console.log(x);let S=x.data.order;console.log(S.partition);let O=x.data.oid;_.addOrUpdate(O,S)},i=o=>{console.log("orderViewer/AdminDashboard actualizaron el pedido:",o),H.emit("order_refresh",{order:o})},g=async o=>{console.log("Partition refresh!!",o);let r=o.order,x=await T.orderFresh(r);console.log(x);let S=x.data.order,O=S.partition,G=x.data.oid;_.addOrUpdate(G,S),O.filter(ve=>ve._status==4).length==O.length&&c.notify({message:`El pedido <b>${G}</b> esta listo para iniciar <b>embarque</b>`,html:!0,color:"purple-10",icon:"fa-solid fa-truck-ramp-box"})};return je(()=>h.query,()=>{f()}),f(),document.title="Dashboard",(o,r)=>(p(),P(Ye,{view:"lHh Lpr lFf"},{default:t(()=>[e(Me,{bordered:"",class:"bg-yellow text-dark"},{default:t(()=>[e(Ne,{class:"row justify-between items-center"},{default:t(()=>[pl,s("div",vl,[e(b,{color:"dark",round:"",unelevated:"",flat:"",icon:"sync",onClick:f}),s("div",ml,[e(se,{class:"col",dense:"",filled:"",label:"Vista",modelValue:Q.value,"onUpdate:modelValue":[r[0]||(r[0]=x=>Q.value=x),B],options:d.value},null,8,["modelValue","options"]),Q.value.id=="C"?(p(),P(b,{key:0,unelevated:"",color:"pink-5",icon:"fas fa-calendar-day",dense:""})):F("",!0)])])]),_:1})]),_:1}),e(Ge,null,{default:t(()=>[e(cl,{onReload:f,onFreshOrder:i})]),_:1})]),_:1}))}};export{Il as default};
