import{u as te,r as m,c as S,o as p,aF as Q,d as a,w as o,h as y,aE as V,t as r,e as v,i as x,f as l,Q as G,aH as L,aG as J,ax as W,b as $,R as de,aI as re,aJ as F,aM as ue,x as ce,a as pe}from"./index.eb9bd313.js";import{u as ae,d as ve,o as X,f as me,a as T,p as fe,q as _e,x as ge,y as Y,z as Z,A as be,Q as ye,t as A,v as w,s as B,w as N,C as he,R as H,c as ke,b as xe,e as we,g as Ce}from"./ClosePopup.7c0f67cd.js";import{Q as Qe,a as Ve,b as ee}from"./QFooter.35ead882.js";import{A as P}from"./AssistApi.8bc23ce4.js";import"./axios.2cb04522.js";const Se={key:0,class:"text--3"},$e={key:0,class:"text-primary"},Re=l("div",null,"Entrada:",-1),qe={class:"text-bold"},Ee={class:"q-px-md q-py-sm"},je=l("div",{class:"col text-dark row justify-between"},null,-1),Pe={key:0,class:"row items-center justify-between q-pt-sm"},Ie=l("span",{class:"text--2"},"Contados:",-1),Ue=l("span",{class:"text--2"},"Por contar:",-1),De={class:"full-width row items-center justify-between"},ze={class:"row justify-between"},Ae={class:"text-left"},Be={class:"text--3"},Le={class:"text-h6"},Te={class:"text-right"},Fe={class:"text-bold"},Ne={class:"text--2"},He={class:"text-h6"},Ke={class:"text--2"},Me={class:"row items-start justify-between"},Oe={class:"text-center col text-primary"},Ge=l("div",null,"Solicitud",-1),Je={class:"text-bold"},We={class:"text-center col text-orange-10"},Xe=l("div",null,"Salida",-1),Ye={class:"text-bold"},Ze={class:"text-center col"},et=l("div",null,"PxC",-1),tt={class:"text-bold"},at={class:"text-center col"},lt=l("div",null,"Conteo",-1),ot={class:"text-center col"},st=l("div",null,"Piezas",-1),it={class:"text-bold"},nt=l("div",{class:"q-ml-md"},[l("div",{class:"text-h6"},"Quieres finalizar la revision?"),l("div",null,"EL pedido ya no podra editarse y se emitira una entrada...")],-1),dt={class:"q-pa-md text-bold text-uppercase text-center"},rt={__name:"OrderCheckin",props:{order:{type:Object,default:{}}},emits:["reload"],setup(K,{emit:f}){const h=K,_=ae(),C=te(),n=m(h.order),g=m({state:!1}),b=m(""),R=m(null),E=m(null),j=m(["code","request","ipack","uspply","delivery","checkout","received","reqinpzs"]),c=m({columns:[{name:"id",label:"ID",field:"id",align:"left",coldesc:"Identificador del producto (MySQL)"},{name:"code",label:"Codigo",field:"code",align:"left",coldesc:"Codigo principal del producto"},{name:"assocs",label:"Asociados",field:e=>e.variants.length?e.variants.map(s=>s.barcode).join(", "):null,align:"left",coldesc:"Codigos relacionados al codigo principal"},{name:"bcode",label:"Codigo de Barras",field:"barcode",align:"center",coldesc:"Codigo de barras principal"},{name:"ipack",label:"PxC",field:e=>typeof e.pivot.ipack=="number"?e.pivot.ipack:e.pieces,align:"center",coldesc:"Unidades x Embalaje"},{name:"request",label:"Solicitud",field:e=>e.pivot.amount,align:"center",coldesc:"Embalaje solicitado"},{name:"uspply",label:"Unidad",field:e=>e.units.id==3?"Cajas":"Piezas",align:"left",coldesc:"Unidad de embalaje del producto"},{name:"delivery",label:"Salida",field:e=>e.pivot.toDelivered,align:"center",coldesc:"Embalaje surtido",sortable:!0},{name:"reqinpzs",label:"Piezas",field:e=>e.pivot._supply_by==3?(typeof e.pivot.ipack=="number"?e.pivot.ipack:e.pieces)*(typeof e.pivot.ipack=="number"?e.pivot.toDelivered:e.pivot.amount):typeof e.pivot.ipack=="number"?e.pivot.toDelivered:e.pivot.amount,align:"center",coldesc:"Unidades totales en embalaje"},{name:"checkout",label:"Checkout",field:e=>e.pivot.checkout?"OK":null,classes:e=>e.pivot.checkout?"text-positive text-bold":"",align:"center",coldesc:"Revision del Administrador",sortable:!0},{name:"received",label:"Conteo",field:e=>e.pivot.toReceived,align:"center",coldesc:"Embalaje recepcion"},{name:"descr",label:"Descripcion",field:"description",align:"left"},{name:"section",label:"Seccion",field:"section",align:"left"},{name:"family",label:"Familia",field:"family",align:"left"},{name:"category",label:"Categoria",field:"category",align:"left"}],filter:"",pagination:{sortBy:"locs",descending:!1,rowsPerPage:20}}),t=m({state:!1,item:null,form:{count:0,ipack:null,setting:!1}}),d=S(()=>n.value?n.value.products.filter(e=>e.pivot.checkout==1):[]),u=S(()=>n.value?n.value.status:null),I=S(()=>u.value?u.value.id==9:!1),U=S(()=>d.value.filter(e=>typeof e.pivot.toReceived!="number")),k=S(()=>d.value.filter(e=>typeof e.pivot.toReceived=="number")),D=S(()=>{let e=b.value.toUpperCase().trim();return e.length?d.value.filter(s=>s.code.match(e)||s.barcode&&s.barcode.match(e)):d.value}),M=e=>{console.log(e),t.value.item=e,t.value.form.count=typeof e.pivot.toReceived=="number"?e.pivot.toReceived:0,t.value.form.ipack=typeof e.pivot.ipack=="number"?e.pivot.ipack:e.pieces,t.value.state=!0,ce(()=>{E.value.focus(),E.value.select()})},le=()=>{let e=b.value.toUpperCase().trim();if(e.length){let s=D.value.length==1?D.value[0]:D.value.find(i=>i.code==e||i.barcode==e);s?M(s):_.notify({message:`Sin coincidencias para <b>${e}</b>`,color:"pink-5",position:"center",html:!0})}},oe=async()=>{const e=parseInt(t.value.form.count),s=parseInt(t.value.form.ipack),i={order:t.value.item.pivot._partition,product:t.value.item.id,received:e,ipack:s,checkout:!1};console.log(i);const q=await H.setReceiveProduct(i);if(console.log(q),q.status==200){let z=d.value.findIndex(ne=>ne.id==t.value.item.id);d.value[z].pivot.toReceived=e,d.value[z].pivot.ipack=s,t.value.state=!1,b.value="",_.notify({color:"positive",icon:"done",position:"right",message:""})}else alert(`Error ${q.status}: ${q.data}`)},se=async()=>{_.loading.show({message:"Generando, espera..."});let e={id:C.params.oid,state:10,suply:n.value._suplier_id};console.log(e);let s=await P.nextState(e);s.status==200&&(_.notify({message:"Se genero la entrada",html:!0,position:"center",icon:"done",timeout:5e3,color:"positive"}),O()),console.log(s),_.loading.hide()},ie=(e,s,i)=>I.value?M(s):null,O=()=>f("reload");return(e,s)=>(p(),Q(L,null,[a(me,{bordered:"",class:"bg-white text-dark"},{default:o(()=>[a(ve,null,{default:o(()=>[a(y,{color:"pink-5",icon:"sync",onClick:O,round:"",dense:"",flat:""}),a(Qe,null,{default:o(()=>[V(" Pedido "+r(v(C).params.oid)+" ",1),n.value?(p(),Q("span",Se,"- "+r(n.value.requisition.from.alias),1)):x("",!0)]),_:1}),n.value.invoice_received?(p(),Q("div",$e,[Re,l("div",qe,r(n.value.invoice_received),1)])):x("",!0)]),_:1}),a(X),l("div",Ee,[je,v(u)&&v(u).id>=5?(p(),Q("div",Pe,[l("div",null,[Ie,V(),l("b",null,r(v(k).length),1)]),l("div",null,[Ue,V(),l("b",null,r(v(U).length),1)])])):x("",!0)])]),_:1}),a(ye,{"row-key":"id",flat:"",rows:v(D),columns:c.value.columns,pagination:c.value.pagination,filter:c.value.filter,"visible-columns":j.value,onRowClick:ie},{top:o(()=>[l("div",De,[a(T,{dense:"",modelValue:c.value.filter,"onUpdate:modelValue":s[0]||(s[0]=i=>c.value.filter=i),placeholder:"Buscar","input-class":"text-uppercase",color:"pink-5"},{append:o(()=>[a(G,{name:"search"})]),_:1},8,["modelValue"]),a(y,{color:"secondary",icon:"fas fa-eye","no-caps":""},{default:o(()=>[a(fe,{style:{"min-width":"200px"}},{default:o(()=>[a(_e,null,{default:o(()=>[(p(!0),Q(L,null,J(c.value.columns,(i,q)=>W((p(),$(ge,{tag:"label",key:q},{default:o(()=>[a(Y,null,{default:o(()=>[a(Z,null,{default:o(()=>[V(r(i.label),1)]),_:2},1024),a(Z,{caption:""},{default:o(()=>[V(r(i.coldesc),1)]),_:2},1024)]),_:2},1024),a(Y,{side:"",top:""},{default:o(()=>[a(be,{color:"pink-5",modelValue:j.value,"onUpdate:modelValue":s[1]||(s[1]=z=>j.value=z),val:i.name},null,8,["modelValue","val"])]),_:2},1024)]),_:2},1024)),[[de]])),128))]),_:1})]),_:1})]),_:1})])]),_:1},8,["rows","columns","pagination","filter","visible-columns"]),a(B,{modelValue:t.value.state,"onUpdate:modelValue":s[3]||(s[3]=i=>t.value.state=i),position:"bottom",onHide:s[4]||(s[4]=i=>R.value.focus())},{default:o(()=>[t.value.item?(p(),$(A,{key:0},{default:o(()=>[a(w,{class:"bg-grey-3"},{default:o(()=>[l("div",ze,[l("div",Ae,[l("div",Be,"ID: "+r(t.value.item.id),1),l("div",Le,r(t.value.item.code),1)]),l("div",Te,[l("div",Fe,r(t.value.item.name),1),l("div",Ne,r(t.value.item.barcode),1)])])]),_:1}),a(X),a(w,null,{default:o(()=>[V(r(t.value.item.description),1)]),_:1}),a(w,{class:"row justify-around items-center bg-grey-2"},{default:o(()=>[(p(!0),Q(L,null,J(t.value.item.stocks,i=>(p(),Q("div",{key:i.id,class:"text-center"},[l("div",He,r(i.pivot.gen),1),l("div",Ke,r(i.alias),1)]))),128))]),_:1}),a(Ve,{onSubmit:re(oe,["prevent"])},{default:o(()=>[a(w,null,{default:o(()=>[l("div",Me,[l("div",Oe,[Ge,l("div",Je,r(t.value.item.pivot.amount)+" "+r(t.value.item.units.id==3?`Caja${t.value.item.pivot.amount!=1?"s":""}`:`Pieza${t.value.item.pivot.amount!=1?"s":""}`),1)]),l("div",We,[Xe,l("div",Ye,[V(r(t.value.item.pivot.toDelivered)+" "+r(t.value.item.units.id==3?t.value.item.pivot.toDelivered!=1?"Cajas":"Caja":t.value.item.pivot.toDelivered!=1?"Piezas":"Pieza")+" ",1),l("small",null,"("+r(t.value.item.units.id==3?t.value.item.pivot.toDelivered*t.value.item.pivot.ipack:t.value.item.pivot.toDelivered)+" pzs)",1)])]),l("div",Ze,[et,l("div",tt,r(t.value.item.pivot.ipack),1)]),l("div",at,[lt,a(T,{dense:"",borderless:"",modelValue:t.value.form.count,"onUpdate:modelValue":s[2]||(s[2]=i=>t.value.form.count=i),type:"number",min:"0","input-class":"text-h6 text-center",ref_key:"iptcounter",ref:E},null,8,["modelValue"])]),l("div",ot,[st,l("div",it,r(t.value.item.units.id==3?t.value.form.count*t.value.form.ipack:t.value.form.count),1)])])]),_:1}),a(y,{color:"indigo",type:"submit",square:"",icon:"done","no-caps":"",class:"q-mt-md q-py-md full-width"})]),_:1},8,["onSubmit"])]),_:1})):x("",!0)]),_:1},8,["modelValue"]),a(B,{modelValue:g.value.state,"onUpdate:modelValue":s[5]||(s[5]=i=>g.value.state=i)},{default:o(()=>[a(A,null,{default:o(()=>[a(w,{class:"row items-start"},{default:o(()=>[a(F,{icon:"warning",color:"orange-14","text-color":"white"}),nt]),_:1}),a(N,{align:"right"},{default:o(()=>[W(a(y,{flat:"",label:"No",color:"primary","no-caps":""},null,512),[[he]]),a(y,{flat:"",label:"Si",color:"primary",onClick:se})]),_:1})]),_:1})]),_:1},8,["modelValue"]),v(I)?(p(),$(ee,{key:0,bordered:"",class:"bg-indigo-10 text-dark q-pa-sm row",elevated:""},{default:o(()=>[a(T,{color:"white",modelValue:b.value,"onUpdate:modelValue":s[7]||(s[7]=i=>b.value=i),type:"text",class:"col","input-class":"text-white text-h6 text-center text-uppercase",autofocus:"",dense:"",onKeypress:ue(le,["enter"]),ref_key:"iptfinder",ref:R},{prepend:o(()=>[a(G,{name:"fas fa-barcode",color:"white"})]),append:o(()=>[a(y,{flat:"",icon:"fas fa-eraser",color:"white",dense:"",onClick:s[6]||(s[6]=i=>b.value=""),disabled:!b.value.length},null,8,["disabled"])]),_:1},8,["modelValue","onKeypress"]),v(k).length>0?(p(),$(y,{key:0,color:"white","text-color":"indigo-10",label:"Finalizar",icon:"done",onClick:s[8]||(s[8]=i=>g.value.state=!0),"no-caps":""})):x("",!0)]),_:1})):x("",!0),v(u)&&v(u).id!=9?(p(),$(ee,{key:1,bordered:"",class:"bg-orange-9 text-white"},{default:o(()=>[l("div",dt,r(v(u).name),1)]),_:1})):x("",!0)],64))}},ut={class:"q-mx-sm text-h6"},ct={class:"q-mx-sm text-h6"},gt={__name:"CheckInLyt",setup(K){const f=ae(),h=te();pe(),m(""),m("");const _=m({state:!1}),C=m({state:!1}),n=m(null),g=m({val:null,opts:null}),b=S(()=>n.value?n.value.status:null),R=async()=>{n.value=null,f.loading.show({message:"Espera..."});let c=h.params.oid,t=h.query.key,d={oid:c,key:t};const u=await H.checkin(d);if(console.log(u.data),u.status==200){let I=u.data;n.value=I.order,console.log(n.value),console.log(n.value.requisition._workpoint_from),n.value._status==8&&(_.value.state=!0),n.value._status==7&&(C.value.state=!0),f.loading.hide();let U=n.value.requisition.from._client;console.log(U);let k=await P.getCheck(U);console.log(k),k.status==200?g.value.opts=k.data:alert(`Error ${k.status}: ${k.data}`)}else alert(`Error ${u.status}: ${u.data}`)},E=async()=>{f.loading.show({message:"Inicando, espera..."}),_.value.state=!1,f.loading.show({message:"Espera..."});let c={id:h.params.oid,state:9,suply:n.value._suplier_id};const t=await P.nextState(c);if(console.log(c),t.status==200){let d={verified:g.value.val.id,supplyer:n.value._suplier_id,pedido:n.value.requisition.id,status:9};console.log(d);let u=await P.SaveCheck(d);u.status==200?(R(),f.notify({message:"Revision de Recibo",position:"center",icon:"done",timeout:5e3,color:"positive"})):alert(`Error ${u.status}: ${u.data}`)}else alert(`Error ${t.status} ${t.data}`)},j=async()=>{f.loading.show({message:"Cambiando Estado..."});let c={id:h.params.oid,state:8,suply:n.value._suplier_id};const t=await P.nextState(c);if(console.log(c),t.status==200){C.value.state=!1,console.log(n.value.id);const d=await H.genEntry(n.value.id);console.log(d),d.status==200?(console.log(d.data),d.data?f.notify({message:"Pedido Recibido",type:"positive"}):alert("Error 500: Ocurrio un error inesperado :(")):(alert(`Error ${d.status}: ${d.data}`),console.log(d.data))}f.loading.hide()};return R(),(c,t)=>(p(),$(ke,{view:"hHh Lpr fFf"},{default:o(()=>[a(Ce,null,{default:o(()=>[a(xe,null,{default:o(()=>[v(b)?(p(),$(rt,{key:0,order:n.value,onReload:R},null,8,["order"])):x("",!0),a(B,{modelValue:_.value.state,"onUpdate:modelValue":t[1]||(t[1]=d=>_.value.state=d),persistent:""},{default:o(()=>[a(A,null,{default:o(()=>[a(w,{class:"row items-center"},{default:o(()=>[a(F,{icon:"warning",color:"orange-14","text-color":"white"}),l("span",ut,"Iniciar CheckIn #"+r(v(h).params.oid),1)]),_:1}),a(w,null,{default:o(()=>[a(we,{modelValue:g.value.val,"onUpdate:modelValue":t[0]||(t[0]=d=>g.value.val=d),options:g.value.opts,label:"Revisa ?","option-label":"complete_name",filled:""},null,8,["modelValue","options"])]),_:1}),a(N,{vertical:"",align:"center"},{default:o(()=>[a(y,{flat:"",label:"Si",color:"primary",onClick:E,disable:g.value.val==null},null,8,["disable"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),a(B,{modelValue:C.value.state,"onUpdate:modelValue":t[2]||(t[2]=d=>C.value.state=d),persistent:""},{default:o(()=>[a(A,null,{default:o(()=>[a(w,{class:"row items-center"},{default:o(()=>[a(F,{icon:"warning",color:"orange-14","text-color":"white"}),l("span",ct,"Recepcionas el pedido #"+r(v(h).params.oid)+"? ",1)]),_:1}),a(N,{vertical:"",align:"center"},{default:o(()=>[a(y,{flat:"",label:"Si",color:"primary",onClick:j})]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1}))}};export{gt as default};
