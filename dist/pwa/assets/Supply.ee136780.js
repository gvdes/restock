import{r as d,c as _,a as c,d as y,w as o,ar as be,k as ge,e as a,Q as v,u as f,g as u,t as n,b as P,i as k,h as l,j as J,as as W,at as X,aO as ye,aP as ke,aL as L,aQ as he,aR as xe,f as Qe,D as we,$ as Ce}from"./index.426a6555.js";import{Q as Ve}from"./QToolbarTitle.9a536f08.js";import{Q as Y}from"./QSpace.81a93c97.js";import{Q as Se}from"./QToolbar.a8300def.js";import{a as Z,Q as De}from"./QPage.06a1c063.js";import{Q as Pe}from"./QHeader.6775be6a.js";import{Q as E}from"./QInput.2882a81c.js";import{u as je,f as Ue,a as N,Q as $e,h as q}from"./use-quasar.f37057e5.js";import{Q as ee,a as B}from"./QItem.7a5efd4a.js";import{Q as Ee}from"./QToggle.157905f8.js";import{Q as qe}from"./QList.a1535c4e.js";import{Q as Ie}from"./QTable.1f68a4b1.js";import{Q as F,a as h}from"./QCard.c739a409.js";import{Q as Ae}from"./QForm.b0776a8b.js";import{Q as te}from"./QCardActions.5a7f2c3b.js";import{Q as ae}from"./QFooter.6ee107b3.js";import{Q as Re,a as Te}from"./QLayout.53cdf900.js";import{C as le}from"./ClosePopup.bc400f2c.js";import"./dayjs.min.25545ff6.js";import{R as H}from"./RestockApi.75260ed3.js";import{A as ze}from"./AssistApi.d49e53f7.js";import{$sktRestock as K,usrSkt as Le}from"./socket.0c311194.js";import"./use-key-composition.e0b6916a.js";import"./uid.42677368.js";import"./format.f1148f41.js";import"./rtl.7f7234e7.js";import"./use-timeout.38813a9d.js";import"./_commonjsHelpers.88e99c8f.js";import"./axios.10c2b4ae.js";const Ne={key:0,class:"text--3"},Be={class:"q-px-md q-py-sm"},Fe={class:"col text-dark row justify-between"},He={key:0,class:"row items-center justify-between q-pt-sm"},Ke=l("span",{class:"text--2"},"Contados:",-1),Me=l("span",{class:"text--2"},"Por contar:",-1),Ge=l("span",{class:"text--2"},"Agotados:",-1),Oe=l("span",{class:"text--2"},"Con stock:",-1),Je={class:"full-width row items-center justify-between"},We={class:"row justify-between"},Xe={class:"text-left"},Ye={class:"text--3"},Ze={class:"text-h6"},et={class:"text-right"},tt={class:"text-bold"},at={class:"text--2"},lt={class:"text-center"},ot={class:"text-h6"},st=l("div",{class:"text--2"},"Embalaje (org)",-1),it={class:"text-h6"},nt={class:"text--2"},rt={class:"row items-start justify-between"},dt={class:"text-center col"},ut=l("div",null,"Solicitud",-1),ct={class:"text-bold"},pt={class:"text-center col"},mt=l("div",null,"Conteo",-1),vt={class:"text-center col"},ft=l("div",null,"PxC",-1),_t={class:"text-center col"},bt=l("div",null,"Piezas",-1),gt={class:"text-bold"},yt=l("div",{class:"q-ml-md"},[l("div",{class:"text-h6"},"Deseas terminar el surtido?"),l("div",null,"La orden se encolara para verificacion")],-1),kt=l("div",null,"Quien eres?",-1),ht={class:"q-pa-md text-bold text-uppercase text-center"},Yt={__name:"Supply",setup(xt){const C=be(),oe=ge(),x=je(),se=Le,j=d({state:!1});d([]);const V=d([]),M=d(!0),p=d({val:null,opts:[]}),I=d(["code","notes","locs","request","uspply","stocks","delivery"]),A=d(null),Q=d([]),b=d(""),G=d(null),S=d(null),R=d(null),w=d({columns:[{name:"id",label:"ID",field:"id",align:"left",coldesc:"Identificador del producto (MySQL)"},{name:"code",label:"Codigo",field:"code",align:"left",coldesc:"Codigo principal del producto"},{name:"assocs",label:"Asociados",field:e=>e.variants.length?e.variants.map(t=>t.barcode).join(", "):null,align:"left",coldesc:"Codigos relacionados al codigo principal"},{name:"bcode",label:"Codigo de Barras",field:"barcode",align:"center",coldesc:"Codigo de barras principal"},{name:"notes",label:"Notas",field:e=>e.pivot.comments,align:"left"},{name:"locs",label:"Ubicacion",field:e=>e.locations.length?e.locations.map(t=>t.path).join(", "):"--",align:"left",coldesc:"Ubicaciones en almacen general",sortable:!0},{name:"ipack",label:"PxC",field:e=>typeof e.pivot.ipack=="number"?e.pivot.ipack:e.pieces,align:"center",coldesc:"Unidades x Embalaje"},{name:"request",label:"Solicitud",field:e=>e.pivot.amount,align:"center",coldesc:"Embalaje solicitado"},{name:"uspply",label:"Unidad",field:e=>e.pivot._supply_by==3?"Cajas":e.pivot._supply_by==2?"Docenas":"Piezas",align:"left",coldesc:"Unidad de embalaje del producto"},{name:"stocks",label:"Stock (pzs)",field:e=>e.stocks.reduce((t,r)=>t+r.pivot.stock,0),sortable:!0,classes:e=>e.stocks.reduce((t,r)=>t+r.pivot.stock,0)<=0?"text-red text-bold":"text-bold text-primary",align:"center",coldesc:"Stock total en almacenes GENERALES (CEDIS+PAN)"},{name:"delivery",label:"Conteo",field:e=>e.pivot.toDelivered,align:"center",coldesc:"Embalaje surtido"},{name:"reqinpzs",label:"Piezas",field:e=>e.pivot._supply_by==3?(typeof e.pivot.ipack=="number"?e.pivot.ipack:e.pieces)*(typeof e.pivot.ipack=="number"?e.pivot.toDelivered:e.pivot.amount):typeof e.pivot.ipack=="number"?e.pivot.toDelivered:e.pivot.amount,align:"center",coldesc:"Unidades totales en embalaje"},{name:"checkout",label:"Checkout",field:e=>e.pivot.checkout,coldesc:"Revision del Administrador"},{name:"descr",label:"Descripcion",field:"description",align:"left"},{name:"section",label:"Seccion",field:"section",align:"left"},{name:"family",label:"Familia",field:"family",align:"left"},{name:"category",label:"Categoria",field:"category",align:"left"}],filter:"",pagination:{sortBy:"locs",descending:!1,rowsPerPage:20}}),i=d({state:!1,item:null,form:{count:0,ipack:null,setting:!1}}),g=d(null);_(()=>S.value?S.value.id==3:!1);const ie=_(()=>D.value.reduce((e,t)=>e+(t.pivot._supply_by==3?t.pivot.amount*t.pieces:t.pivot.amount),0)),ne=_(()=>D.value.filter(e=>typeof e.pivot.toDelivered!="number")),U=_(()=>D.value.filter(e=>typeof e.pivot.toDelivered=="number")),re=_(()=>U.value.filter(e=>e.pivot.toDelivered==0)),de=_(()=>U.value.filter(e=>e.pivot.toDelivered>0)),D=_(()=>p.value.val?Q.value.filter(e=>e.pivot._suplier_id==p.value.val._suplier_id):[]),$=_(()=>{let e=b.value.toUpperCase().trim();return e.length?D.value.filter(t=>t.code.match(e)||t.barcode&&t.barcode.match(e)):D.value}),T=async()=>{x.loading.show({message:"Cargando..."}),console.log("Iniciando...");const e=await H.order(C.params.oid);console.log(e),K.connect(),K.emit("joinat",se),e.status==200?(Q.value=e.data.products,p.value.opts=e.data.partition,V.value=e.data,S.value=e.data.status,A.value=e.data.from,x.loading.hide()):alert(`Error ${e.status}: ${e.data}`)},ue=e=>{g.value=e},ce=(e,t,r)=>g.value._status==3?O(t):null,O=e=>{i.value.item=e,i.value.form.count=typeof e.pivot.toDelivered=="number"?e.pivot.toDelivered:0,i.value.form.ipack=typeof e.pivot.ipack=="number"?e.pivot.ipack:e.pieces,i.value.state=!0,we(()=>{R.value.focus(),R.value.select()})},pe=()=>{let e=b.value.toUpperCase().trim();if(e.length){let t=$.value.length==1?$.value[0]:$.value.find(r=>r.code==e||r.barcode==e);t?O(t):x.notify({message:`Sin coincidencias para <b>${e}</b>`,color:"pink-5",position:"center",html:!0})}},me=async()=>{const e=parseInt(i.value.form.count),t=parseInt(i.value.form.ipack),r={order:C.params.oid,product:i.value.item.id,delivery:e,ipack:t,checkout:!1},m=await H.setDeliveryProduct(r);if(console.log(m),m.status==200){let s=Q.value.findIndex(z=>z.id==i.value.item.id);Q.value[s].pivot.toDelivered=e,Q.value[s].pivot.ipack=t,i.value.state=!1,b.value="",x.notify({color:"positive",icon:"done",position:"right",message:"",timeout:1e3})}else alert(`Error ${m.status}: ${m.data}`)},ve=()=>{console.log("Hola")},fe=async()=>{console.log("Finalizando particion"),console.log(V.value.id);let e=V.value.id;x.loading.show({message:"Terminando, espera..."}),j.value.state=!1;let t={id:C.params.oid,state:4,suply:p.value.val._suplier_id};console.log(t);const r=await ze.nextState(t);if(console.log(r),g.value._status=r.data.partition._status,g.value.status.name=r.data.partition.name,r.data.partitionsEnd>V.value._status){let m={id:C.params.oid,state:r.data.partitionsEnd};const s=await H.nextState(m);console.log(s)}K.emit("orderpartition_refresh",{order:e}),r.status==200&&T(),x.loading.hide()};return T(),(e,t)=>(c(),y(Re,{view:"hHh Lpr fFf"},{default:o(()=>[a(Pe,{bordered:"",class:"bg-white text-dark"},{default:o(()=>[a(Se,null,{default:o(()=>{var r;return[a(v,{flat:"",round:"",dense:"",icon:"arrow_back",onClick:t[0]||(t[0]=m=>{f(oe).replace("/supply")})}),a(Ve,null,{default:o(()=>[u(" Pedido "+n(f(C).params.oid)+" ",1),A.value?(c(),P("span",Ne,"- "+n(A.value.alias),1)):k("",!0)]),_:1}),u(" "+n((r=p.value.val)==null?void 0:r._suplier)+" ",1),a(Y),u(" "+n(V.value.notes)+" ",1),a(Y),a(v,{color:"pink-5",icon:"sync",onClick:T,round:"",dense:"",flat:""})]}),_:1}),a(Z),l("div",Be,[l("div",Fe,[l("div",null,[u("Productos: "),l("b",null,n(Q.value.length),1)]),l("div",null,[u("Piezas: "),l("b",null,n(f(ie)),1)])]),S.value&&S.value.id>=3?(c(),P("div",He,[l("div",null,[Ke,u(),l("b",null,n(f(U).length),1)]),l("div",null,[Me,u(),l("b",null,n(f(ne).length),1)]),l("div",null,[Ge,u(),l("b",null,n(f(re).length),1)]),l("div",null,[Oe,u(),l("b",null,n(f(de).length),1)])])):k("",!0)])]),_:1}),a(Te,null,{default:o(()=>{var r,m;return[a(De,{padding:""},{default:o(()=>[p.value.val?(c(),y(Ie,{key:0,"row-key":"id",flat:"",rows:f($),columns:w.value.columns,pagination:w.value.pagination,filter:w.value.filter,"visible-columns":I.value,onRowClick:ce},{top:o(()=>[l("div",Je,[a(E,{dense:"",modelValue:w.value.filter,"onUpdate:modelValue":t[1]||(t[1]=s=>w.value.filter=s),placeholder:"Buscar","input-class":"text-uppercase",color:"pink-5"},{append:o(()=>[a(J,{name:"search"})]),_:1},8,["modelValue"]),a(v,{color:"secondary",icon:"fas fa-eye","no-caps":""},{default:o(()=>[a(Ue,{style:{"min-width":"200px"}},{default:o(()=>[a(qe,null,{default:o(()=>[(c(!0),P(X,null,W(w.value.columns,(s,z)=>L((c(),y(ee,{tag:"label",key:z},{default:o(()=>[a(B,null,{default:o(()=>[a(q,null,{default:o(()=>[u(n(s.label),1)]),_:2},1024),a(q,{caption:""},{default:o(()=>[u(n(s.coldesc),1)]),_:2},1024)]),_:2},1024),a(B,{side:"",top:""},{default:o(()=>[a(Ee,{color:"pink-5",modelValue:I.value,"onUpdate:modelValue":[t[2]||(t[2]=_e=>I.value=_e),ve],val:s.name},null,8,["modelValue","val"])]),_:2},1024)]),_:2},1024)),[[Ce]])),128))]),_:1})]),_:1})]),_:1})])]),_:1},8,["rows","columns","pagination","filter","visible-columns"])):k("",!0),a(N,{modelValue:i.value.state,"onUpdate:modelValue":t[5]||(t[5]=s=>i.value.state=s),position:"bottom",onHide:t[6]||(t[6]=s=>G.value.focus())},{default:o(()=>[i.value.item?(c(),y(F,{key:0},{default:o(()=>[a(h,null,{default:o(()=>[l("div",We,[l("div",Xe,[l("div",Ye,"ID: "+n(i.value.item.id),1),l("div",Ze,n(i.value.item.code),1)]),l("div",et,[l("div",tt,n(i.value.item.name),1),l("div",at,n(i.value.item.barcode),1)])])]),_:1}),a(Z),a(h,null,{default:o(()=>[u(n(i.value.item.description),1)]),_:1}),a(h,{class:"row justify-around items-center"},{default:o(()=>[l("div",lt,[l("div",ot,n(i.value.item.pieces),1),st]),(c(!0),P(X,null,W(i.value.item.stocks,s=>(c(),P("div",{key:s.id,class:"text-center"},[l("div",it,n(s.pivot.gen),1),l("div",nt,n(s.alias),1)]))),128))]),_:1}),a(Ae,{onSubmit:ye(me,["prevent"])},{default:o(()=>[a(h,null,{default:o(()=>[l("div",rt,[l("div",dt,[ut,l("div",ct,n(i.value.item.pivot.amount)+" "+n(i.value.item.pivot._supply_by==3?`Caja${i.value.item.pivot.amount!=1?"s":""}`:i.value.item.pivot._supply_by==2?`Docena${i.value.item.pivot.amount!=1?"s":""}`:`Pieza${i.value.item.pivot.amount!=1?"s":""}`),1)]),l("div",pt,[mt,a(E,{dense:"",borderless:"",modelValue:i.value.form.count,"onUpdate:modelValue":t[3]||(t[3]=s=>i.value.form.count=s),type:"number",min:"0","input-class":"text-h6 text-center",ref_key:"iptcounter",ref:R},null,8,["modelValue"])]),l("div",vt,[ft,a(E,{dense:"",borderless:"",modelValue:i.value.form.ipack,"onUpdate:modelValue":t[4]||(t[4]=s=>i.value.form.ipack=s),type:"number","input-class":"text-h6 text-center"},null,8,["modelValue"])]),l("div",_t,[bt,l("div",gt,n(i.value.item.pivot._supply_by==3?i.value.form.count*i.value.form.ipack:i.value.item.pivot._supply_by==2?i.value.form.count*12:i.value.form.count),1)])])]),_:1}),a(v,{color:"primary",type:"submit",square:"",icon:"check","no-caps":"",class:"q-mt-md q-py-md full-width"})]),_:1},8,["onSubmit"])]),_:1})):k("",!0)]),_:1},8,["modelValue"]),a(N,{modelValue:j.value.state,"onUpdate:modelValue":t[7]||(t[7]=s=>j.value.state=s)},{default:o(()=>[a(F,null,{default:o(()=>[a(h,{class:"row items-start"},{default:o(()=>[a(ke,{icon:"warning",color:"orange-14","text-color":"white"}),yt]),_:1}),a(te,{align:"right"},{default:o(()=>[L(a(v,{flat:"",label:"No",color:"primary","no-caps":""},null,512),[[le]]),a(v,{flat:"",label:"Si",color:"primary",onClick:fe})]),_:1})]),_:1})]),_:1},8,["modelValue"]),a(N,{modelValue:M.value,"onUpdate:modelValue":t[9]||(t[9]=s=>M.value=s),persistent:""},{default:o(()=>[a(F,{style:{width:"400px"}},{default:o(()=>[a(h,{class:"row items-center"},{default:o(()=>[kt]),_:1}),a(h,null,{default:o(()=>[a($e,{modelValue:p.value.val,"onUpdate:modelValue":[t[8]||(t[8]=s=>p.value.val=s),ue],options:p.value.opts,label:"Surtidor","option-label":"_suplier","option-value":"_suplier_id",filled:"","option-disable":s=>s._status!=3},{option:o(s=>[a(ee,he(xe(s.itemProps)),{default:o(()=>[a(B,null,{default:o(()=>[a(q,null,{default:o(()=>[u(n(s.opt._suplier),1)]),_:2},1024),a(q,{caption:"",lines:"2"},{default:o(()=>[u(n(s.opt.status.name),1)]),_:2},1024)]),_:2},1024)]),_:2},1040)]),_:1},8,["modelValue","options","option-disable"])]),_:1}),a(te,{align:"right"},{default:o(()=>[L(a(v,{flat:"",label:"Continuar",color:"primary",disable:!p.value.val},null,8,["disable"]),[[le]])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1}),((r=g.value)==null?void 0:r._status)==3?(c(),y(ae,{key:0,bordered:"",class:"bg-primary text-dark q-pa-sm row",elevated:""},{default:o(()=>[a(E,{color:"white",modelValue:b.value,"onUpdate:modelValue":t[11]||(t[11]=s=>b.value=s),type:"text",class:"col","input-class":"text-white text-h6 text-center text-uppercase",autofocus:"",dense:"",onKeypress:Qe(pe,["enter"]),ref_key:"iptfinder",ref:G},{prepend:o(()=>[a(J,{name:"fas fa-barcode",color:"white"})]),append:o(()=>[a(v,{flat:"",icon:"fas fa-eraser",color:"white",dense:"",onClick:t[10]||(t[10]=s=>b.value=""),disabled:!b.value.length},null,8,["disabled"])]),_:1},8,["modelValue","onKeypress"]),f(U).length>0?(c(),y(v,{key:0,color:"white","text-color":"cyan-9",label:"Terminar",icon:"done",onClick:t[12]||(t[12]=s=>j.value.state=!0),"no-caps":""})):k("",!0)]),_:1})):k("",!0),((m=g.value)==null?void 0:m._status)!=3?(c(),y(ae,{key:1,bordered:"",class:"bg-orange-9 text-white"},{default:o(()=>{var s;return[l("div",ht,n((s=g.value)==null?void 0:s.status.name),1)]}),_:1})):k("",!0)]}),_:1})]),_:1}))}};export{Yt as default};
