import{u as W,r as u,c as q,o as r,aE as V,d as t,w as o,h,aD as $,t as n,e as c,i as y,f as a,Q as N,aG as D,aF as H,au as K,b as E,R as ne,aH as de,aJ as X,aI as re,x as ce,a as ue}from"./index.116cfe64.js";import{u as Y,d as ve,q as O,f as pe,a as U,s as me,t as fe,y as _e,z as G,A as M,B as be,Q as ge,w as z,x as j,v as B,R as P,c as he,b as ye,g as ke}from"./QCard.86684f4e.js";import{Q as Z,C as xe}from"./ClosePopup.2cb46f42.js";import{Q as we,a as Ce,b as J}from"./QFooter.1d79807d.js";import"./axios.b18e358a.js";const Qe={key:0,class:"text--3"},Ve={key:0,class:"text-primary"},$e=a("div",null,"Entrada:",-1),qe={class:"text-bold"},Ee={class:"q-px-md q-py-sm"},Se=a("div",{class:"col text-dark row justify-between"},null,-1),je={key:0,class:"row items-center justify-between q-pt-sm"},Re=a("span",{class:"text--2"},"Contados:",-1),Ie=a("span",{class:"text--2"},"Por contar:",-1),Pe={class:"full-width row items-center justify-between"},De={class:"row justify-between"},Ue={class:"text-left"},ze={class:"text--3"},Be={class:"text-h6"},Le={class:"text-right"},Te={class:"text-bold"},Fe={class:"text--2"},Ae={class:"text-h6"},Ne={class:"text--2"},He={class:"row items-start justify-between"},Ke={class:"text-center col text-primary"},Oe=a("div",null,"Solicitud",-1),Ge={class:"text-bold"},Me={class:"text-center col text-orange-10"},Je=a("div",null,"Salida",-1),We={class:"text-bold"},Xe={class:"text-center col"},Ye=a("div",null,"PxC",-1),Ze={class:"text-bold"},et={class:"text-center col"},tt=a("div",null,"Conteo",-1),at={class:"text-center col"},lt=a("div",null,"Piezas",-1),ot={class:"text-bold"},st=a("div",{class:"q-ml-md"},[a("div",{class:"text-h6"},"Quieres finalizar la revision?"),a("div",null,"EL pedido ya no podra editarse y se emitira una entrada...")],-1),it={class:"q-pa-md text-bold text-uppercase text-center"},nt={__name:"OrderCheckin",props:{order:{type:Object,default:{}}},emits:["reload"],setup(L,{emit:k}){const x=L,v=Y(),p=W(),m=u(x.order),g=u({state:!1}),_=u(""),w=u(null),f=u(null),b=u(["code","request","ipack","uspply","delivery","checkout","received","reqinpzs"]),d=u({columns:[{name:"id",label:"ID",field:"id",align:"left",coldesc:"Identificador del producto (MySQL)"},{name:"code",label:"Codigo",field:"code",align:"left",coldesc:"Codigo principal del producto"},{name:"assocs",label:"Asociados",field:e=>e.variants.length?e.variants.map(s=>s.barcode).join(", "):null,align:"left",coldesc:"Codigos relacionados al codigo principal"},{name:"bcode",label:"Codigo de Barras",field:"barcode",align:"center",coldesc:"Codigo de barras principal"},{name:"ipack",label:"PxC",field:e=>typeof e.pivot.ipack=="number"?e.pivot.ipack:e.pieces,align:"center",coldesc:"Unidades x Embalaje"},{name:"request",label:"Solicitud",field:e=>e.pivot.amount,align:"center",coldesc:"Embalaje solicitado"},{name:"uspply",label:"Unidad",field:e=>e.units.id==3?"Cajas":"Piezas",align:"left",coldesc:"Unidad de embalaje del producto"},{name:"delivery",label:"Salida",field:e=>e.pivot.toDelivered,align:"center",coldesc:"Embalaje surtido",sortable:!0},{name:"reqinpzs",label:"Piezas",field:e=>e.pivot._supply_by==3?(typeof e.pivot.ipack=="number"?e.pivot.ipack:e.pieces)*(typeof e.pivot.ipack=="number"?e.pivot.toDelivered:e.pivot.amount):typeof e.pivot.ipack=="number"?e.pivot.toDelivered:e.pivot.amount,align:"center",coldesc:"Unidades totales en embalaje"},{name:"checkout",label:"Checkout",field:e=>e.pivot.checkout?"OK":null,classes:e=>e.pivot.checkout?"text-positive text-bold":"",align:"center",coldesc:"Revision del Administrador",sortable:!0},{name:"received",label:"Conteo",field:e=>e.pivot.toReceived,align:"center",coldesc:"Embalaje recepcion"},{name:"descr",label:"Descripcion",field:"description",align:"left"},{name:"section",label:"Seccion",field:"section",align:"left"},{name:"family",label:"Familia",field:"family",align:"left"},{name:"category",label:"Categoria",field:"category",align:"left"}],filter:"",pagination:{sortBy:"locs",descending:!1,rowsPerPage:20}}),l=u({state:!1,item:null,form:{count:0,ipack:null,setting:!1}}),C=q(()=>m.value?m.value.products:[]),Q=q(()=>m.value?m.value.status:null),T=q(()=>Q.value?Q.value.id==9:!1),ee=q(()=>C.value.filter(e=>typeof e.pivot.toReceived!="number")),F=q(()=>C.value.filter(e=>typeof e.pivot.toReceived=="number")),R=q(()=>{let e=_.value.toUpperCase().trim();return e.length?C.value.filter(s=>s.code.match(e)||s.barcode&&s.barcode.match(e)):C.value}),A=e=>{console.log(e),l.value.item=e,l.value.form.count=typeof e.pivot.toReceived=="number"?e.pivot.toReceived:0,l.value.form.ipack=typeof e.pivot.ipack=="number"?e.pivot.ipack:e.pieces,l.value.state=!0,ce(()=>{f.value.focus(),f.value.select()})},te=()=>{let e=_.value.toUpperCase().trim();if(e.length){let s=R.value.length==1?R.value[0]:R.value.find(i=>i.code==e||i.barcode==e);s?A(s):v.notify({message:`Sin coincidencias para <b>${e}</b>`,color:"pink-5",position:"center",html:!0})}},ae=async()=>{const e=parseInt(l.value.form.count),s=parseInt(l.value.form.ipack),i={order:p.params.oid,product:l.value.item.id,received:e,ipack:s,checkout:!1},S=await P.setReceiveProduct(i);if(console.log(S),S.status==200){let I=C.value.findIndex(ie=>ie.id==l.value.item.id);C.value[I].pivot.toReceived=e,C.value[I].pivot.ipack=s,l.value.state=!1,_.value="",v.notify({color:"positive",icon:"done",position:"right",message:""})}else alert(`Error ${S.status}: ${S.data}`)},le=async()=>{v.loading.show({message:"Generando, espera..."}),g.value.state=!1;const e=await P.genEntry(p.params.oid);console.log(e),e.status==200?(console.log(e.data),e.data?(v.notify({message:`Se genero la entrada <b class="text-h6">${e.data.invoice.folio}</b>`,html:!0,position:"center",icon:"done",timeout:5e3,color:"positive"}),k("reload")):alert("Error 500: Ocurrio un error inesperado :(")):alert(`Error ${e.status}: ${e.data}`),v.loading.hide()},oe=(e,s,i)=>T.value?A(s):null,se=()=>k("reload");return(e,s)=>(r(),V(D,null,[t(pe,{bordered:"",class:"bg-white text-dark"},{default:o(()=>[t(ve,null,{default:o(()=>[t(h,{color:"pink-5",icon:"sync",onClick:se,round:"",dense:"",flat:""}),t(we,null,{default:o(()=>[$(" Pedido "+n(c(p).params.oid)+" ",1),m.value?(r(),V("span",Qe,"- "+n(m.value.from.alias),1)):y("",!0)]),_:1}),m.value.invoice_received?(r(),V("div",Ve,[$e,a("div",qe,n(m.value.invoice_received),1)])):y("",!0)]),_:1}),t(O),a("div",Ee,[Se,c(Q)&&c(Q).id>=5?(r(),V("div",je,[a("div",null,[Re,$(),a("b",null,n(c(F).length),1)]),a("div",null,[Ie,$(),a("b",null,n(c(ee).length),1)])])):y("",!0)])]),_:1}),t(ge,{"row-key":"id",flat:"",rows:c(R),columns:d.value.columns,pagination:d.value.pagination,filter:d.value.filter,"visible-columns":b.value,onRowClick:oe},{top:o(()=>[a("div",Pe,[t(U,{dense:"",modelValue:d.value.filter,"onUpdate:modelValue":s[0]||(s[0]=i=>d.value.filter=i),placeholder:"Buscar","input-class":"text-uppercase",color:"pink-5"},{append:o(()=>[t(N,{name:"search"})]),_:1},8,["modelValue"]),t(h,{color:"secondary",icon:"fas fa-eye","no-caps":""},{default:o(()=>[t(me,{style:{"min-width":"200px"}},{default:o(()=>[t(fe,null,{default:o(()=>[(r(!0),V(D,null,H(d.value.columns,(i,S)=>K((r(),E(_e,{tag:"label",key:S},{default:o(()=>[t(G,null,{default:o(()=>[t(M,null,{default:o(()=>[$(n(i.label),1)]),_:2},1024),t(M,{caption:""},{default:o(()=>[$(n(i.coldesc),1)]),_:2},1024)]),_:2},1024),t(G,{side:"",top:""},{default:o(()=>[t(be,{color:"pink-5",modelValue:b.value,"onUpdate:modelValue":s[1]||(s[1]=I=>b.value=I),val:i.name},null,8,["modelValue","val"])]),_:2},1024)]),_:2},1024)),[[ne]])),128))]),_:1})]),_:1})]),_:1})])]),_:1},8,["rows","columns","pagination","filter","visible-columns"]),t(B,{modelValue:l.value.state,"onUpdate:modelValue":s[3]||(s[3]=i=>l.value.state=i),position:"bottom",onHide:s[4]||(s[4]=i=>w.value.focus())},{default:o(()=>[l.value.item?(r(),E(z,{key:0},{default:o(()=>[t(j,{class:"bg-grey-3"},{default:o(()=>[a("div",De,[a("div",Ue,[a("div",ze,"ID: "+n(l.value.item.id),1),a("div",Be,n(l.value.item.code),1)]),a("div",Le,[a("div",Te,n(l.value.item.name),1),a("div",Fe,n(l.value.item.barcode),1)])])]),_:1}),t(O),t(j,null,{default:o(()=>[$(n(l.value.item.description),1)]),_:1}),t(j,{class:"row justify-around items-center bg-grey-2"},{default:o(()=>[(r(!0),V(D,null,H(l.value.item.stocks,i=>(r(),V("div",{key:i.id,class:"text-center"},[a("div",Ae,n(i.pivot.gen),1),a("div",Ne,n(i.alias),1)]))),128))]),_:1}),t(Ce,{onSubmit:de(ae,["prevent"])},{default:o(()=>[t(j,null,{default:o(()=>[a("div",He,[a("div",Ke,[Oe,a("div",Ge,n(l.value.item.pivot.amount)+" "+n(l.value.item.units.id==3?`Caja${l.value.item.pivot.amount!=1?"s":""}`:`Pieza${l.value.item.pivot.amount!=1?"s":""}`),1)]),a("div",Me,[Je,a("div",We,[$(n(l.value.item.pivot.toDelivered)+" "+n(l.value.item.units.id==3?l.value.item.pivot.toDelivered!=1?"Cajas":"Caja":l.value.item.pivot.toDelivered!=1?"Piezas":"Pieza")+" ",1),a("small",null,"("+n(l.value.item.units.id==3?l.value.item.pivot.toDelivered*l.value.item.pivot.ipack:l.value.item.pivot.toDelivered)+" pzs)",1)])]),a("div",Xe,[Ye,a("div",Ze,n(l.value.item.pivot.ipack),1)]),a("div",et,[tt,t(U,{dense:"",borderless:"",modelValue:l.value.form.count,"onUpdate:modelValue":s[2]||(s[2]=i=>l.value.form.count=i),type:"number",min:"0","input-class":"text-h6 text-center",ref_key:"iptcounter",ref:f},null,8,["modelValue"])]),a("div",at,[lt,a("div",ot,n(l.value.item.units.id==3?l.value.form.count*l.value.form.ipack:l.value.form.count),1)])])]),_:1}),t(h,{color:"indigo",type:"submit",square:"",icon:"done","no-caps":"",class:"q-mt-md q-py-md full-width"})]),_:1},8,["onSubmit"])]),_:1})):y("",!0)]),_:1},8,["modelValue"]),t(B,{modelValue:g.value.state,"onUpdate:modelValue":s[5]||(s[5]=i=>g.value.state=i)},{default:o(()=>[t(z,null,{default:o(()=>[t(j,{class:"row items-start"},{default:o(()=>[t(X,{icon:"warning",color:"orange-14","text-color":"white"}),st]),_:1}),t(Z,{align:"right"},{default:o(()=>[K(t(h,{flat:"",label:"No",color:"primary","no-caps":""},null,512),[[xe]]),t(h,{flat:"",label:"Si",color:"primary",onClick:le})]),_:1})]),_:1})]),_:1},8,["modelValue"]),c(T)?(r(),E(J,{key:0,bordered:"",class:"bg-indigo-10 text-dark q-pa-sm row",elevated:""},{default:o(()=>[t(U,{color:"white",modelValue:_.value,"onUpdate:modelValue":s[7]||(s[7]=i=>_.value=i),type:"text",class:"col","input-class":"text-white text-h6 text-center text-uppercase",autofocus:"",dense:"",onKeypress:re(te,["enter"]),ref_key:"iptfinder",ref:w},{prepend:o(()=>[t(N,{name:"fas fa-barcode",color:"white"})]),append:o(()=>[t(h,{flat:"",icon:"fas fa-eraser",color:"white",dense:"",onClick:s[6]||(s[6]=i=>_.value=""),disabled:!_.value.length},null,8,["disabled"])]),_:1},8,["modelValue","onKeypress"]),c(F).length>0?(r(),E(h,{key:0,color:"white","text-color":"indigo-10",label:"Finalizar",icon:"done",onClick:s[8]||(s[8]=i=>g.value.state=!0),"no-caps":""})):y("",!0)]),_:1})):y("",!0),c(Q)&&c(Q).id!=9?(r(),E(J,{key:1,bordered:"",class:"bg-orange-9 text-white"},{default:o(()=>[a("div",it,n(c(Q).name),1)]),_:1})):y("",!0)],64))}},dt={class:"q-mx-sm text-h6"},mt={__name:"CheckInLyt",setup(L){const k=Y(),x=W();ue(),u(""),u("");const v=u({state:!1}),p=u(null),m=q(()=>p.value?p.value.status:null),g=async()=>{p.value=null,k.loading.show({message:"Espera..."});let w=x.params.oid,f=x.query.key,b={oid:w,key:f};const d=await P.checkin(b);if(console.log(d.data),d.status==200){let l=d.data;p.value=l.order,p.value._status==7&&(v.value.state=!0),k.loading.hide()}else alert(`Error ${d.status}: ${d.data}`)},_=async()=>{k.loading.show({message:"Inicando, espera..."}),v.value.state=!1,k.loading.show({message:"Espera..."});let w=x.params.oid,f=x.query.key,b={oid:w,key:f};const d=await P.checkinInit(b);console.log(d),d.status==200?g():alert(`Error ${d.status} ${d.data}`)};return g(),(w,f)=>(r(),E(he,{view:"hHh Lpr fFf"},{default:o(()=>[t(ke,null,{default:o(()=>[t(ye,null,{default:o(()=>[c(m)?(r(),E(nt,{key:0,order:p.value,onReload:g},null,8,["order"])):y("",!0),t(B,{modelValue:v.value.state,"onUpdate:modelValue":f[0]||(f[0]=b=>v.value.state=b),persistent:""},{default:o(()=>[t(z,null,{default:o(()=>[t(j,{class:"row items-center"},{default:o(()=>[t(X,{icon:"warning",color:"orange-14","text-color":"white"}),a("span",dt,"Iniciar CheckIn #"+n(c(x).params.oid),1)]),_:1}),t(Z,{vertical:"",align:"center"},{default:o(()=>[t(h,{flat:"",label:"Si",color:"primary",onClick:_})]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1}))}};export{mt as default};
