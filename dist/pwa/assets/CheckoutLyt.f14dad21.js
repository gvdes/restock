import{u as D,a as Y,r as m,c as C,o as $,b as O,w as p,d as n,e as Q,f as _,t as L,Q as N,g as j,h as S,i as z}from"./index.2b3d8d3a.js";import{Q as H,a as T,u as A,b as G}from"./QPage.a7345da3.js";import{Q as J}from"./QToggle.12463bec.js";import{Q as K,a as W,b as X}from"./QLayout.351489fc.js";import{d as k}from"./dayjs.min.53a5c0af.js";import{Q as Z,R as h}from"./ClosePopup.2c160215.js";import{u as R}from"./Restock.f9ce54e7.js";import"./axios.d46b4b71.js";import"./QTabs.c176b1a0.js";import"./jspdf.plugin.autotable.dbbab4f5.js";import{$sktRestock as u,usrSkt as ee}from"./socket.890df2ea.js";import"./rtl.ff96e2df.js";const te={class:"full-width row items-center"},oe={class:"col text-h6 text-dark"},ae={__name:"OrdersCheckout",setup(U){D();const v=Y(),y=R(),c=["text-grey-5 text-bold","text-bold text-h6 text-red","text-indigo","4","5","6","text-bold text-orange","8","text-primary","text-positive"],l=m({columns:[{name:"id",label:"Folio",field:"id",align:"center"},{name:"state",label:"Estado",field:e=>e.log.length==1?e.log[0].name:e.log[e.log.length-1].name,align:"left",sortable:!0,sort:(e,s,d,f)=>parseInt(d._status)-parseInt(f._status),classes:e=>c[e._status-1]},{name:"laststate",label:"Ultima actividad",field:e=>k(e.log.find(s=>s.id==e.status.id).pivot.updated_at).format("YYYY-MM-DD hh:mm A"),align:"left"},{name:"from",label:"Sucursal",field:e=>e.from.name.toUpperCase(),align:"left",sortable:!0},{name:"models",label:"Modelos",field:"products_count",align:"center"},{name:"notes",label:"Notas",field:e=>e.notes,align:"left"},{name:"invoice",label:"Salida",field:e=>{var s;return(s=e.invoice)!=null?s:"--"},align:"center"}],filter:"",pagination:{sortBy:"desc",descending:!1,rowsPerPage:20}}),x=(e,s,d)=>v.push(`/checkout/${s.id}`),b=C(()=>y.ordersdb.filter(e=>e._status>2));return(e,s)=>($(),O(T,{padding:""},{default:p(()=>[n(H,{flat:"","row-key":"id",rows:Q(b),columns:l.value.columns,filter:l.value.filter,pagination:l.value.pagination,onRowClick:x},{top:p(()=>[_("div",te,[_("div",oe,"Pedidos: "+L(Q(b).length),1),n(Z,{dense:"",modelValue:l.value.filter,"onUpdate:modelValue":s[0]||(s[0]=d=>l.value.filter=d),"input-class":"text-uppercase",placeholder:"Buscar",color:"pink-5"},{append:p(()=>[n(N,{name:"search"})]),_:1},8,["modelValue"])])]),_:1},8,["rows","columns","filter","pagination"])]),_:1}))}};const se=_("div",{class:"text-bold"},"CheckOut ",-1),re={class:"row"},le={class:"col row"},ke={__name:"CheckoutLyt",setup(U){const v=D(),y=Y(),c=R(),l=A(),x=ee,b=m([{id:0,alias:"Todas"},{id:1,alias:"CEDIS",_state:1},{id:2,alias:"SP1",_state:1}]),e=m([{id:"day",label:"Hoy"},{id:"week",label:"Semana"},{id:"month",label:"Mes"},{id:"C",label:"otra ...",disable:!0}]),s=m(null),d=m(null),f=m({from:k(Date.now()).startOf("day"),to:k(Date.now()).startOf("day")}),w=async()=>{var i;l.loading.show({message:"Cargado vista..."}),console.log("%cIniciando MainLayout...","font-size:2em;color:orange;");let t=(i=v.query.v)!=null?i:"day",a=e.value.findIndex(g=>g.id==t),o=a>=0?a:0;d.value=e.value[o],f.value.from=k(Date.now()).startOf(d.value.id);const r=await h.index(d.value.id);console.log(r),c.fillOrders(r.orders),s.value=b.value[0],console.log("%cMainLayout listo!!","font-size:2em;color:orange;"),l.loading.hide(),u.connect(),u.emit("joinat",x),u.on("joineddashreq",F),u.on("creating",M),u.on("order_update",P),u.on("order_changestate",I),u.on("order_refresh",B),u.on("orderpartition_refresh",E)},V=t=>y.push(`/checkout?v=${t.id}`);C(()=>f.value.from.format("YYYY/MM/DD")),C(()=>f.value.to.format("YYYY/MM/DD")),j(()=>v.query,()=>{w()});const F=t=>{console.log(`%c${t.user.me.nick} de ${t.from.alias} se ha unido a Restock (UID: ${t.user.me.id})`,"background:#076F3E;color:#f5f6fa;border-radius:10px;padding:10px;font-size:1.1em;")},M=async t=>{let a=t.order;console.log(`Pedido ${a.id} iniciado`);let o=await h.orderFresh(a.id),r=o.data.order,i=o.data.oid;c.addOrUpdate(i,r)},P=t=>{c.orderUpdate(t)},I=async t=>{let a=t.order;console.log(`Refrescando orden ${a.id}`),t.state;let o=await h.orderFresh(a.id);console.log(o.data);let r=o.data.order,i=o.data.oid;c.addOrUpdate(i,r),r._status==4&&l.notify({message:`El pedido <b>${a.id}</b> esta listo para CheckOut!!`,color:"positive",textColor:"white",position:"bottom",html:!0,timeout:5e3})},B=async t=>{console.log("REFRESHING BY SKT!!",t);let a=t.order,o=await h.orderFresh(a);console.log(o);let r=o.data.order,i=o.data.oid;c.addOrUpdate(i,r)},E=async t=>{console.log("Partition refresh!!",t);let a=t.order,o=await h.orderFresh(a);console.log(o);let r=o.data.order,i=r.partition,g=o.data.oid;c.addOrUpdate(g,r),i.filter(q=>q._status==4).length==i.length?l.notify({message:`El pedido ${g} ha finalizado particiones`,html:!0,color:"purple-10",icon:"fa-solid fa-truck-ramp-box"}):l.notify({message:`Particion lista para checkout en pedidido <b>${g}</b>`,html:!0,color:"pink-14",icon:"fa-solid fa-truck-ramp-box"})};return w(),document.title="CheckOut",(t,a)=>($(),O(K,{view:"lHh Lpr lFf"},{default:p(()=>[n(W,{bordered:"",class:"bg-cyan-10"},{default:p(()=>[n(J,{class:"row justify-between items-center"},{default:p(()=>[se,_("div",re,[n(S,{color:"white",round:"",unelevated:"",flat:"",icon:"sync",onClick:w}),_("div",le,[n(G,{class:"col",dark:"",dense:"",filled:"",label:"Vista",modelValue:d.value,"onUpdate:modelValue":[a[0]||(a[0]=o=>d.value=o),V],options:e.value},null,8,["modelValue","options"]),d.value.id=="C"?($(),O(S,{key:0,unelevated:"",color:"pink-5",icon:"fas fa-calendar-day",dense:""})):z("",!0)])])]),_:1})]),_:1}),n(X,null,{default:p(()=>[n(ae)]),_:1})]),_:1}))}};export{ke as default};
