import{u as R,a as Y,r as p,c as S,o as $,b as C,w as c,d,e as O,f,t as E,Q as L,g as N,h as Q,i as P}from"./index.1a2b59b5.js";import{Q as j,a as H,b as T,c as z,u as A,R as h,d as G,e as J,f as K,g as W}from"./ClosePopup.04d0f868.js";import{d as y}from"./dayjs.min.53a5c0af.js";import{u as D}from"./Restock.c0e9469f.js";import"./axios.ac4b1d99.js";import"./jspdf.plugin.autotable.cb13d869.js";import{$sktRestock as i,usrSkt as X}from"./socket.d0f8f9a5.js";const Z={class:"full-width row items-center"},ee={class:"col text-h6 text-dark"},te={__name:"OrdersSupply",setup(V){R();const g=Y(),b=D(),l=p({columns:[{name:"id",label:"Folio",field:"id",align:"center"},{name:"state",label:"Estado",field:e=>e.log.length==1?e.log[0].name:e.log[e.log.length-1].name,align:"left",sortable:!0,classes:e=>e._status==3?"text-positive text-bold":""},{name:"laststate",label:"Ultima actividad",field:e=>y(e.log.find(a=>a.id==e.status.id).pivot.updated_at).format("YYYY-MM-DD hh:mm A"),align:"left"},{name:"from",label:"Sucursal",field:e=>e.from.name.toUpperCase(),align:"left",sortable:!0},{name:"models",label:"Modelos",field:"products_count",align:"center"},{name:"notes",label:"Notas",field:e=>e.notes,align:"left"},{name:"invoice",label:"Salida",field:e=>{var a;return(a=e.invoice)!=null?a:"--"},align:"center"}],filter:"",pagination:{sortBy:"desc",descending:!1,rowsPerPage:20}}),m=(e,a,v)=>g.push(`/supply/${a.id}`),_=S(()=>b.ordersdb.filter(e=>e._status>2));return(e,a)=>($(),C(T,{padding:""},{default:c(()=>[d(j,{flat:"","row-key":"id",rows:O(_),columns:l.value.columns,filter:l.value.filter,pagination:l.value.pagination,onRowClick:m},{top:c(()=>[f("div",Z,[f("div",ee,"Pedidos: "+E(O(_).length),1),d(H,{dense:"",modelValue:l.value.filter,"onUpdate:modelValue":a[0]||(a[0]=v=>l.value.filter=v),"input-class":"text-uppercase",placeholder:"Buscar",color:"pink-5"},{append:c(()=>[d(L,{name:"search"})]),_:1},8,["modelValue"])])]),_:1},8,["rows","columns","filter","pagination"])]),_:1}))}};const ae=f("div",{class:"text-bold"},"Resurtido ",-1),oe={class:"row"},se={class:"col row"},pe={__name:"SupplyLyt",setup(V){const g=R(),b=Y(),l=D(),m=A(),_=X,e=p([{id:0,alias:"Todas"},{id:1,alias:"CEDIS",_state:1},{id:2,alias:"SP1",_state:1}]),a=p([{id:"day",label:"Hoy"},{id:"week",label:"Semana"},{id:"month",label:"Mes"},{id:"C",label:"otra ...",disable:!0}]),v=p(null),u=p(null),w=p({from:y(Date.now()).startOf("day"),to:y(Date.now()).startOf("day")}),k=async()=>{var n;m.loading.show({message:"Cargado vista..."}),console.log("%cIniciando MainLayout...","font-size:2em;color:orange;");let t=(n=g.query.v)!=null?n:"day",o=a.value.findIndex(x=>x.id==t),s=o>=0?o:0;u.value=a.value[s],w.value.from=y(Date.now()).startOf(u.value.id);const r=await h.index(u.value.id);console.log(r),l.fillOrders(r.orders),v.value=e.value[0],console.log("%cMainLayout listo!!","font-size:2em;color:orange;"),m.loading.hide(),i.connect(),i.emit("joinat",_),i.on("joineddashreq",U),i.on("creating",F),i.on("order_update",B),i.on("order_changestate",I),i.on("order_refresh",q)},M=t=>b.push(`/supply?v=${t.id}`);S(()=>w.value.from.format("YYYY/MM/DD")),S(()=>w.value.to.format("YYYY/MM/DD"));const U=t=>{console.log(`%c${t.user.me.nick} de ${t.from.alias} se ha unido a Restock (UID: ${t.user.me.id})`,"background:#076F3E;color:#f5f6fa;border-radius:10px;padding:10px;font-size:1.1em;")},F=async t=>{console.log("Nuevo pedido iniciado");let o=t.order,s=await h.orderFresh(o.id),r=s.data.order,n=s.data.oid;l.addOrUpdate(n,r)},B=t=>{l.orderUpdate(t)},I=async t=>{let o=t.order,s=t.state,r=await h.orderFresh(o.id),n=r.data.order,x=r.data.oid;l.addOrUpdate(x,n),s.id==3&&m.notify({message:`El pedido <b>${o.id}</b> esta listo para surtir!!`,color:"positive",textColor:"white",position:"bottom",html:!0,timeout:5e3})},q=async t=>{console.log("REFRESHING BY SKT!!",t);let o=t.order,s=await h.orderFresh(o);console.log(s);let r=s.data.order,n=s.data.oid;l.addOrUpdate(n,r)};return N(()=>g.query,()=>{k()}),k(),document.title="Resurtido",(t,o)=>($(),C(z,{view:"lHh Lpr lFf"},{default:c(()=>[d(K,{bordered:"",class:"transparent text-dark"},{default:c(()=>[d(G,{class:"row justify-between items-center"},{default:c(()=>[ae,f("div",oe,[d(Q,{color:"pink-5",round:"",unelevated:"",flat:"",icon:"sync",onClick:k}),f("div",se,[d(J,{class:"col",dense:"",filled:"",label:"Vista",modelValue:u.value,"onUpdate:modelValue":[o[0]||(o[0]=s=>u.value=s),M],options:a.value},null,8,["modelValue","options"]),u.value.id=="C"?($(),C(Q,{key:0,unelevated:"",color:"pink-5",icon:"fas fa-calendar-day",dense:""})):P("",!0)])])]),_:1})]),_:1}),d(W,null,{default:c(()=>[d(te)]),_:1})]),_:1}))}};export{pe as default};
