import{r as d,c as b,o as c,b as h,w as i,u as se,a as ie,d as l,h as m,e as r,aD as p,t as n,aE as k,i as x,f as a,Q as R,aF as z,aG as B,aH as ne,aI as de,ax as L,aJ as ce,x as ue,R as re}from"./index.94fef817.js";import{Q as pe,a as ve,b as N}from"./QFooter.154d0fc6.js";import{c as me,u as fe,R as I,d as be,o as F,f as _e,b as ge,Q as ye,a as P,p as he,q as xe,s as H,t as K,v as w,w as ke,g as we,x as Ce,y as M,z as G,A as Qe,C as Ve}from"./ClosePopup.c9df51a4.js";import"./dayjs.min.16be2667.js";import"./axios.2cb04522.js";const De={key:0,class:"text--3"},Se={class:"q-px-md q-py-sm"},Pe={class:"col text-dark row justify-between"},je={key:0,class:"row items-center justify-between q-pt-sm"},Ee=a("span",{class:"text--2"},"Contados:",-1),Ue=a("span",{class:"text--2"},"Por contar:",-1),qe=a("span",{class:"text--2"},"Agotados:",-1),Ie=a("span",{class:"text--2"},"Con stock:",-1),$e={class:"full-width row items-center justify-between"},Te={class:"row justify-between"},Ae={class:"text-left"},Re={class:"text--3"},ze={class:"text-h6"},Be={class:"text-right"},Le={class:"text-bold"},Ne={class:"text--2"},Fe={class:"text-center"},He={class:"text-h6"},Ke=a("div",{class:"text--2"},"Embalaje (org)",-1),Me={class:"text-h6"},Ge={class:"text--2"},Je={class:"row items-start justify-between"},Oe={class:"text-center col"},We=a("div",null,"Solicitud",-1),Xe={class:"text-bold"},Ye={class:"text-center col"},Ze=a("div",null,"Conteo",-1),et={class:"text-center col"},tt=a("div",null,"PxC",-1),at={class:"text-center col"},lt=a("div",null,"Piezas",-1),ot={class:"text-bold"},st=a("div",{class:"q-ml-md"},[a("div",{class:"text-h6"},"Deseas terminar la El surtido?"),a("div",null,"EL se ira a la cola de verificacion")],-1),it={class:"q-pa-md text-bold text-uppercase text-center"},vt={__name:"Supply",setup(nt){const C=se(),J=ie(),_=fe(),Q=d({state:!1});d([]);const j=d(["code","locs","request","uspply","stocks","delivery"]),E=d(null),u=d([]),f=d(""),$=d(null),v=d(null),U=d(null),g=d({columns:[{name:"id",label:"ID",field:"id",align:"left",coldesc:"Identificador del producto (MySQL)"},{name:"code",label:"Codigo",field:"code",align:"left",coldesc:"Codigo principal del producto"},{name:"assocs",label:"Asociados",field:e=>e.variants.length?e.variants.map(t=>t.barcode).join(", "):null,align:"left",coldesc:"Codigos relacionados al codigo principal"},{name:"bcode",label:"Codigo de Barras",field:"barcode",align:"center",coldesc:"Codigo de barras principal"},{name:"locs",label:"Ubicacion",field:e=>e.locations.length?e.locations.map(t=>t.path).join(", "):"--",align:"left",coldesc:"Ubicaciones en almacen general"},{name:"ipack",label:"PxC",field:e=>typeof e.pivot.ipack=="number"?e.pivot.ipack:e.pieces,align:"center",coldesc:"Unidades x Embalaje"},{name:"request",label:"Solicitud",field:e=>e.pivot.amount,align:"center",coldesc:"Embalaje solicitado"},{name:"uspply",label:"Unidad",field:e=>e.units.id==3?"Cajas":"Piezas",align:"left",coldesc:"Unidad de embalaje del producto"},{name:"stocks",label:"Stock (pzs)",field:e=>e.stocks.reduce((t,s)=>t+s.pivot.stock,0),sortable:!0,classes:e=>e.stocks.reduce((t,s)=>t+s.pivot.stock,0)<=0?"text-red text-bold":"text-bold text-primary",align:"center",coldesc:"Stock total en almacenes GENERALES (CEDIS+PAN)"},{name:"delivery",label:"Conteo",field:e=>e.pivot.toDelivered,align:"center",coldesc:"Embalaje surtido"},{name:"reqinpzs",label:"Piezas",field:e=>e.pivot._supply_by==3?(typeof e.pivot.ipack=="number"?e.pivot.ipack:e.pieces)*(typeof e.pivot.ipack=="number"?e.pivot.toDelivered:e.pivot.amount):typeof e.pivot.ipack=="number"?e.pivot.toDelivered:e.pivot.amount,align:"center",coldesc:"Unidades totales en embalaje"},{name:"checkout",label:"Checkout",field:e=>e.pivot.checkout,coldesc:"Revision del Administrador"},{name:"descr",label:"Descripcion",field:"description",align:"left"},{name:"section",label:"Seccion",field:"section",align:"left"},{name:"family",label:"Familia",field:"family",align:"left"},{name:"category",label:"Categoria",field:"category",align:"left"}],filter:"",pagination:{sortBy:"locs",descending:!1,rowsPerPage:20}}),o=d({state:!1,item:null,form:{count:0,ipack:null,setting:!1}}),T=b(()=>v.value?v.value.id==3:!1),O=b(()=>u.value.reduce((e,t)=>e+(t.pivot._supply_by==3?t.pivot.amount*t.pieces:t.pivot.amount),0)),W=b(()=>u.value.filter(e=>typeof e.pivot.toDelivered!="number")),V=b(()=>u.value.filter(e=>typeof e.pivot.toDelivered=="number")),X=b(()=>V.value.filter(e=>e.pivot.toDelivered==0)),Y=b(()=>V.value.filter(e=>e.pivot.toDelivered>0)),D=b(()=>{let e=f.value.toUpperCase().trim();return e.length?u.value.filter(t=>t.code.match(e)||t.barcode&&t.barcode.match(e)):u.value}),q=async()=>{_.loading.show({message:"Cargando..."}),console.log("Iniciando...");const e=await I.order(C.params.oid);console.log(e),e.status==200?(u.value=e.data.products,v.value=e.data.status,E.value=e.data.from,_.loading.hide()):alert(`Error ${e.status}: ${e.data}`)},Z=(e,t,s)=>T.value?A(t):null,A=e=>{o.value.item=e,o.value.form.count=typeof e.pivot.toDelivered=="number"?e.pivot.toDelivered:0,o.value.form.ipack=typeof e.pivot.ipack=="number"?e.pivot.ipack:e.pieces,o.value.state=!0,ue(()=>{U.value.focus(),U.value.select()})},ee=()=>{let e=f.value.toUpperCase().trim();if(e.length){let t=D.value.length==1?D.value[0]:D.value.find(s=>s.code==e||s.barcode==e);t?A(t):_.notify({message:`Sin coincidencias para <b>${e}</b>`,color:"pink-5",position:"center",html:!0})}},te=async()=>{const e=parseInt(o.value.form.count),t=parseInt(o.value.form.ipack),s={order:C.params.oid,product:o.value.item.id,delivery:e,ipack:t,checkout:!1},y=await I.setDeliveryProduct(s);if(console.log(y),y.status==200){let S=u.value.findIndex(oe=>oe.id==o.value.item.id);u.value[S].pivot.toDelivered=e,u.value[S].pivot.ipack=t,o.value.state=!1,f.value="",_.notify({color:"positive",icon:"done",position:"right",message:"",timeout:1e3})}else alert(`Error ${y.status}: ${y.data}`)},ae=()=>{console.log("Hola")},le=async()=>{_.loading.show({message:"Terminando, espera..."}),Q.value.state=!1;let e={id:C.params.oid,state:4};const t=await I.nextState(e);console.log(t),t.status==200&&q(),_.loading.hide()};return q(),(e,t)=>(c(),h(me,{view:"hHh Lpr fFf"},{default:i(()=>[l(_e,{bordered:"",class:"bg-white text-dark"},{default:i(()=>[l(be,null,{default:i(()=>[l(m,{flat:"",round:"",dense:"",icon:"arrow_back",onClick:t[0]||(t[0]=s=>{r(J).replace("/supply")})}),l(pe,null,{default:i(()=>[p(" Pedido "+n(r(C).params.oid)+" ",1),E.value?(c(),k("span",De,"- "+n(E.value.alias),1)):x("",!0)]),_:1}),l(m,{color:"pink-5",icon:"sync",onClick:q,round:"",dense:"",flat:""})]),_:1}),l(F),a("div",Se,[a("div",Pe,[a("div",null,[p("Productos: "),a("b",null,n(u.value.length),1)]),a("div",null,[p("Piezas: "),a("b",null,n(r(O)),1)])]),v.value&&v.value.id>=3?(c(),k("div",je,[a("div",null,[Ee,p(),a("b",null,n(r(V).length),1)]),a("div",null,[Ue,p(),a("b",null,n(r(W).length),1)]),a("div",null,[qe,p(),a("b",null,n(r(X).length),1)]),a("div",null,[Ie,p(),a("b",null,n(r(Y).length),1)])])):x("",!0)])]),_:1}),l(we,null,{default:i(()=>[l(ge,{padding:""},{default:i(()=>[l(ye,{"row-key":"id",flat:"",rows:r(D),columns:g.value.columns,pagination:g.value.pagination,filter:g.value.filter,"visible-columns":j.value,onRowClick:Z},{top:i(()=>[a("div",$e,[l(P,{dense:"",modelValue:g.value.filter,"onUpdate:modelValue":t[1]||(t[1]=s=>g.value.filter=s),placeholder:"Buscar","input-class":"text-uppercase",color:"pink-5"},{append:i(()=>[l(R,{name:"search"})]),_:1},8,["modelValue"]),l(m,{color:"secondary",icon:"fas fa-eye","no-caps":""},{default:i(()=>[l(he,{style:{"min-width":"200px"}},{default:i(()=>[l(xe,null,{default:i(()=>[(c(!0),k(B,null,z(g.value.columns,(s,y)=>L((c(),h(Ce,{tag:"label",key:y},{default:i(()=>[l(M,null,{default:i(()=>[l(G,null,{default:i(()=>[p(n(s.label),1)]),_:2},1024),l(G,{caption:""},{default:i(()=>[p(n(s.coldesc),1)]),_:2},1024)]),_:2},1024),l(M,{side:"",top:""},{default:i(()=>[l(Qe,{color:"pink-5",modelValue:j.value,"onUpdate:modelValue":[t[2]||(t[2]=S=>j.value=S),ae],val:s.name},null,8,["modelValue","val"])]),_:2},1024)]),_:2},1024)),[[re]])),128))]),_:1})]),_:1})]),_:1})])]),_:1},8,["rows","columns","pagination","filter","visible-columns"]),l(H,{modelValue:o.value.state,"onUpdate:modelValue":t[5]||(t[5]=s=>o.value.state=s),position:"bottom",onHide:t[6]||(t[6]=s=>$.value.focus())},{default:i(()=>[o.value.item?(c(),h(K,{key:0},{default:i(()=>[l(w,null,{default:i(()=>[a("div",Te,[a("div",Ae,[a("div",Re,"ID: "+n(o.value.item.id),1),a("div",ze,n(o.value.item.code),1)]),a("div",Be,[a("div",Le,n(o.value.item.name),1),a("div",Ne,n(o.value.item.barcode),1)])])]),_:1}),l(F),l(w,null,{default:i(()=>[p(n(o.value.item.description),1)]),_:1}),l(w,{class:"row justify-around items-center"},{default:i(()=>[a("div",Fe,[a("div",He,n(o.value.item.pieces),1),Ke]),(c(!0),k(B,null,z(o.value.item.stocks,s=>(c(),k("div",{key:s.id,class:"text-center"},[a("div",Me,n(s.pivot.gen),1),a("div",Ge,n(s.alias),1)]))),128))]),_:1}),l(ve,{onSubmit:ne(te,["prevent"])},{default:i(()=>[l(w,null,{default:i(()=>[a("div",Je,[a("div",Oe,[We,a("div",Xe,n(o.value.item.pivot.amount)+" "+n(o.value.item.units.id==3?`Caja${o.value.item.pivot.amount!=1?"s":""}`:`Pieza${o.value.item.pivot.amount!=1?"s":""}`),1)]),a("div",Ye,[Ze,l(P,{dense:"",borderless:"",modelValue:o.value.form.count,"onUpdate:modelValue":t[3]||(t[3]=s=>o.value.form.count=s),type:"number",min:"0","input-class":"text-h6 text-center",ref_key:"iptcounter",ref:U},null,8,["modelValue"])]),a("div",et,[tt,l(P,{dense:"",borderless:"",modelValue:o.value.form.ipack,"onUpdate:modelValue":t[4]||(t[4]=s=>o.value.form.ipack=s),type:"number","input-class":"text-h6 text-center",readonly:o.value.item.units.id!=3,disable:o.value.item.units.id!=3},null,8,["modelValue","readonly","disable"])]),a("div",at,[lt,a("div",ot,n(o.value.item.units.id==3?o.value.form.count*o.value.form.ipack:o.value.form.count),1)])])]),_:1}),l(m,{color:"primary",type:"submit",square:"",icon:"check","no-caps":"",class:"q-mt-md q-py-md full-width"})]),_:1},8,["onSubmit"])]),_:1})):x("",!0)]),_:1},8,["modelValue"]),l(H,{modelValue:Q.value.state,"onUpdate:modelValue":t[7]||(t[7]=s=>Q.value.state=s)},{default:i(()=>[l(K,null,{default:i(()=>[l(w,{class:"row items-start"},{default:i(()=>[l(de,{icon:"warning",color:"orange-14","text-color":"white"}),st]),_:1}),l(ke,{align:"right"},{default:i(()=>[L(l(m,{flat:"",label:"No",color:"primary","no-caps":""},null,512),[[Ve]]),l(m,{flat:"",label:"Si",color:"primary",onClick:le})]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1}),r(T)?(c(),h(N,{key:0,bordered:"",class:"bg-primary text-dark q-pa-sm row",elevated:""},{default:i(()=>[l(P,{color:"white",modelValue:f.value,"onUpdate:modelValue":t[9]||(t[9]=s=>f.value=s),type:"text",class:"col","input-class":"text-white text-h6 text-center text-uppercase",autofocus:"",dense:"",onKeypress:ce(ee,["enter"]),ref_key:"iptfinder",ref:$},{prepend:i(()=>[l(R,{name:"fas fa-barcode",color:"white"})]),append:i(()=>[l(m,{flat:"",icon:"fas fa-eraser",color:"white",dense:"",onClick:t[8]||(t[8]=s=>f.value=""),disabled:!f.value.length},null,8,["disabled"])]),_:1},8,["modelValue","onKeypress"]),r(V).length>0?(c(),h(m,{key:0,color:"white","text-color":"cyan-9",label:"Terminar",icon:"done",onClick:t[10]||(t[10]=s=>Q.value.state=!0),"no-caps":""})):x("",!0)]),_:1})):x("",!0),v.value&&v.value.id!=3?(c(),h(N,{key:1,bordered:"",class:"bg-orange-9 text-white"},{default:i(()=>[a("div",it,n(v.value.name),1)]),_:1})):x("",!0)]),_:1})]),_:1}))}};export{vt as default};
