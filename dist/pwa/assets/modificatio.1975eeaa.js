import{l as te,r as k,c as ae,x as j,z as oe,ak as ne,D as ie,ah as se,Q as w,a as _,b as Q,e,w as l,at as S,ar as ue,h as g,d as C,as as E,aL as B,aV as W,g as i,i as re,t as r,f as J,aP as de,$ as ce}from"./index.da85b8dc.js";import{Q as fe,a as O}from"./QPage.22409e19.js";import{c as M,Q as Y}from"./QTable.cc354dbb.js";import{Q as D,a as h}from"./QTd.4f2bd813.js";import{Q as T,a as b}from"./QItem.ca5ad26b.js";import{Q as K}from"./QList.171e9366.js";import{Q as ve}from"./QDate.d4acad44.js";import{Q as L,a as N}from"./QCard.25c69692.js";import{Q as H}from"./QCardActions.c9efc98d.js";import{f as me,a as F,u as pe,h as $}from"./use-quasar.fc3d653f.js";import{Q as X}from"./QInput.e927a1f6.js";import{C as Z}from"./ClosePopup.b7dbda90.js";import{d as ee}from"./dayjs.min.25545ff6.js";import{R as G}from"./RestockApi.4e5b12b6.js";import"./use-key-composition.a558bfa4.js";import"./uid.42677368.js";import"./format.fb212846.js";import"./rtl.c50304db.js";import"./use-timeout.c18bcc16.js";import"./_commonjsHelpers.88e99c8f.js";import"./axios.99c185bb.js";function z(o,m=new WeakMap){if(Object(o)!==o)return o;if(m.has(o))return m.get(o);const d=o instanceof Date?new Date(o):o instanceof RegExp?new RegExp(o.source,o.flags):o instanceof Set?new Set:o instanceof Map?new Map:typeof o.constructor!="function"?Object.create(null):o.prototype!==void 0&&typeof o.prototype.constructor=="function"?o:new o.constructor;if(typeof o.constructor=="function"&&typeof o.valueOf=="function"){const c=o.valueOf();if(Object(c)!==c){const f=new o.constructor(c);return m.set(o,f),f}}return m.set(o,d),o instanceof Set?o.forEach(c=>{d.add(z(c,m))}):o instanceof Map&&o.forEach((c,f)=>{d.set(f,z(c,m))}),Object.assign(d,...Object.keys(o).map(c=>({[c]:z(o[c],m)})))}var le=te({name:"QPopupEdit",props:{modelValue:{required:!0},title:String,buttons:Boolean,labelSet:String,labelCancel:String,color:{type:String,default:"primary"},validate:{type:Function,default:()=>!0},autoSave:Boolean,cover:{type:Boolean,default:!0},disable:Boolean},emits:["update:modelValue","save","cancel","before-show","show","before-hide","hide"],setup(o,{slots:m,emit:d}){const{proxy:c}=oe(),{$q:f}=c,p=k(null),y=k(""),v=k("");let q=!1;const I=ae(()=>ne({initialValue:y.value,validate:o.validate,set:U,cancel:P,updatePosition:x},"value",()=>v.value,V=>{v.value=V}));function U(){o.validate(v.value)!==!1&&(R()===!0&&(d("save",v.value,y.value),d("update:modelValue",v.value)),a())}function P(){R()===!0&&d("cancel",v.value,y.value),a()}function x(){ie(()=>{p.value.updatePosition()})}function R(){return se(v.value,y.value)===!1}function a(){q=!0,p.value.hide()}function s(){q=!1,y.value=z(o.modelValue),v.value=z(o.modelValue),d("before-show")}function t(){d("show")}function n(){q===!1&&R()===!0&&(o.autoSave===!0&&o.validate(v.value)===!0?(d("save",v.value,y.value),d("update:modelValue",v.value)):d("cancel",v.value,y.value)),d("before-hide")}function u(){d("hide")}function A(){const V=m.default!==void 0?[].concat(m.default(I.value)):[];return o.title&&V.unshift(j("div",{class:"q-dialog__title q-mt-sm q-mb-sm"},o.title)),o.buttons===!0&&V.push(j("div",{class:"q-popup-edit__buttons row justify-center no-wrap"},[j(w,{flat:!0,color:o.color,label:o.labelCancel||f.lang.label.cancel,onClick:P}),j(w,{flat:!0,color:o.color,label:o.labelSet||f.lang.label.set,onClick:U})])),V}return Object.assign(c,{set:U,cancel:P,show(V){p.value!==null&&p.value.show(V)},hide(V){p.value!==null&&p.value.hide(V)},updatePosition:x}),()=>{if(o.disable!==!0)return j(me,{ref:p,class:"q-popup-edit",cover:o.cover,onBeforeShow:s,onShow:t,onBeforeHide:n,onHide:u,onEscapeKey:P},A)}}});const _e={class:"row justify-between items-center"},be=g("div",{class:"text-bold"},"Modificaciones ",-1),we={class:"row"},ge={class:"col row"},ye={class:"text-left"},he={class:"text-left"},xe={class:"q-pa-md"},Ve={class:"q-pb-sm"},ke={class:"text-bold text-center text-h6"},Ce={class:"text-caption"},De={class:"text-caption"},Qe=g("span",{class:"q-ml-sm text-bold text-h6"},"Se realizara las modificaciones correspondientes",-1),Ge={__name:"modificatio",setup(o){const m=pe();ue();const d=k([]),c=k({val:null}),f=k({state:!1,val:null}),p=k(!1),y=k(!1),v=k({columnsPrimary:[{name:"name",align:"left",label:"Nombre",field:a=>a.name},{name:"alias",align:"left",label:"Alias",field:a=>a.alias},{name:"modified",align:"left",label:"Diferencias",field:a=>a.to_supply.length}],columnsSeconday:[{name:"id",align:"center",label:"Pedido",field:a=>a.id},{name:"notes",align:"left",label:"Nota",field:a=>a.notes},{name:"create",align:"left",label:"Creador",field:a=>`${a.created_by.names} ${a.created_by.surname_pat} ${a.created_by.surname_mat}`},{name:"update",align:"left",label:"Ultima Act",field:a=>ee(a.created_at).format("YYYY/MM/DD HH:mm:ss")}],columnsProduct:[{name:"code",align:"left",label:"Codigo",field:a=>a.code},{name:"description",align:"left",label:"Descripcion",field:a=>a.description},{name:"toDelivered",align:"center",label:"Salida",field:a=>a.pivot.toDelivered*x(a.pivot._supply_by,a)},{name:"toReceived",align:"center",label:"Entrada",field:a=>a.pivot.toReceived*x(a.pivot._supply_by,a)},{name:"Diference",align:"center",label:"Diferencia",field:a=>Number(a.pivot.toDelivered-a.pivot.toReceived)*x(a.pivot._supply_by,a)}],pagination:{rowsPerPage:0}}),q=async()=>{p.value=!1,m.loading.show({message:"Obteniendo Datos"});const a=await G.getDifferences({date:c.value.val});a.status!=200?console.log(a):(console.log(a),d.value=a.data),m.loading.hide()},I=async()=>{m.loading.show({message:"Cargado vista..."}),c.value.val=ee(new Date).format("YYYY/MM/DD");const a=await G.getDifferences({date:c.value.val});a.status!=200?console.log(a):(console.log(a),d.value=a.data),m.loading.hide()},U=a=>{d.value.forEach(s=>{s.to_supply.forEach(t=>{let n=t.partition.find(u=>u.id==a.pivot._partition);if(n){let u=n.products.findIndex(A=>A.id==a.id);n.products.splice(u,1)}})}),console.log(a.pivot)},P=async()=>{m.loading.show({message:"Realizando Cambios"}),console.log(f.value.val);const a=await G.correction(f.value.val);a.status!=200?console.log(a):(console.log(a.data),m.notify({message:"Se realizaron las modificaciones",html:!0,position:"center",icon:"done",timeout:5e3,color:"positive"}),m.loading.hide(),window.location.reload())},x=(a,s)=>{let t;switch(a){case 1:t=1;break;case 2:t=12;break;case 3:t=s.pieces}return t},R=a=>{let s;switch(a){case 1:s="Pieza";break;case 2:s="Docena";break;case 3:s="Caja"}return s};return I(),(a,s)=>(_(),Q(S,null,[e(fe,{padding:""},{default:l(()=>[g("div",_e,[be,g("div",we,[e(w,{color:"dark",round:"",unelevated:"",flat:"",icon:"sync",onClick:I}),g("div",ge,[e(O,{spaced:"",inset:"",vertical:"",dark:""}),e(w,{color:"primary",icon:"event",onClick:s[0]||(s[0]=t=>p.value=!p.value),flat:"",round:""})])])]),d.value.length>0?(_(),C(Y,{key:0,dense:"",title:"Modificacion Sucursales",rows:d.value,columns:v.value.columnsPrimary,pagination:v.value.pagination,"hide-bottom":""},{header:l(t=>[e(D,{props:t},{default:l(()=>[(_(!0),Q(S,null,E(t.cols,n=>(_(),C(M,{key:n.name,props:t},{default:l(()=>[i(r(n.label),1)]),_:2},1032,["props"]))),128)),e(M,{"auto-width":""})]),_:2},1032,["props"])]),body:l(t=>[e(D,{props:t},{default:l(()=>[(_(!0),Q(S,null,E(t.cols,n=>(_(),C(h,{key:n.name,props:t},{default:l(()=>[i(r(n.value),1)]),_:2},1032,["props"]))),128)),e(h,{"auto-width":""},{default:l(()=>[e(w,{size:"sm",color:"primary",round:"",dense:"",onClick:n=>t.expand=!t.expand,icon:t.expand?"remove":"add"},null,8,["onClick","icon"])]),_:2},1024)]),_:2},1032,["props"]),B(e(D,{props:t},{default:l(()=>[e(h,{colspan:"100%"},{default:l(()=>[g("div",ye,[e(Y,{rows:t.row.to_supply,columns:v.value.columnsSeconday,dense:"",pagination:v.value.pagination,"hide-bottom":""},{header:l(n=>[e(D,{props:n},{default:l(()=>[(_(!0),Q(S,null,E(n.cols,u=>(_(),C(M,{key:u.name,props:n},{default:l(()=>[i(r(u.label),1)]),_:2},1032,["props"]))),128)),e(M,{"auto-width":""})]),_:2},1032,["props"])]),body:l(n=>[e(D,{props:n},{default:l(()=>[(_(!0),Q(S,null,E(n.cols,u=>(_(),C(h,{key:u.name,props:n},{default:l(()=>[i(r(u.value),1)]),_:2},1032,["props"]))),128)),e(h,{"auto-width":""},{default:l(()=>[e(w,{size:"sm",color:"accent",round:"",dense:"",onClick:u=>n.expand=!n.expand,icon:n.expand?"remove":"add"},null,8,["onClick","icon"])]),_:2},1024)]),_:2},1032,["props"]),B(e(D,{props:n},{default:l(()=>[e(h,{colspan:"100%"},{default:l(()=>[g("div",he,[e(K,{bordered:"",dense:""},{default:l(()=>[e(T,{dense:""},{default:l(()=>[e(b,{class:"text-center"},{default:l(()=>[i("ID")]),_:1}),e(b,{class:"text-center"},{default:l(()=>[i("SALIDA")]),_:1}),e(b,{class:"text-center"},{default:l(()=>[i("ENTRADA")]),_:1}),e(b,{class:"text-center"},{default:l(()=>[i("ALMACEN")]),_:1}),e(b,{class:"text-center"},{default:l(()=>[i("Productos")]),_:1})]),_:1})]),_:1}),(_(!0),Q(S,null,E(n.row.partition,(u,A)=>(_(),C(K,{bordered:"",key:A,dense:""},{default:l(()=>[B((_(),C(T,{clickable:"",onClick:V=>{f.value.state=!f.value.state,f.value.val=u}},{default:l(()=>[e(b,{class:"text-center"},{default:l(()=>[i(r(u.id),1)]),_:2},1024),e(b,{class:"text-center"},{default:l(()=>[i(r(u.invoice),1)]),_:2},1024),e(b,{class:"text-center"},{default:l(()=>[i(r(u.invoice_received),1)]),_:2},1024),e(b,{class:"text-center"},{default:l(()=>[i(r(u._warehouse),1)]),_:2},1024),e(b,{class:"text-center"},{default:l(()=>[i(r(u.products.length),1)]),_:2},1024)]),_:2},1032,["onClick"])),[[ce]])]),_:2},1024))),128))])]),_:2},1024)]),_:2},1032,["props"]),[[W,n.expand]])]),_:2},1032,["rows","columns","pagination"])])]),_:2},1024)]),_:2},1032,["props"]),[[W,t.expand]])]),_:1},8,["rows","columns","pagination"])):re("",!0)]),_:1}),e(F,{modelValue:p.value,"onUpdate:modelValue":s[3]||(s[3]=t=>p.value=t)},{default:l(()=>[e(L,{class:"my-card"},{default:l(()=>[e(N,null,{default:l(()=>[g("div",xe,[g("div",Ve,r(c.value.val),1),e(ve,{modelValue:c.value.val,"onUpdate:modelValue":s[1]||(s[1]=t=>c.value.val=t),range:"",minimal:""},null,8,["modelValue"])])]),_:1}),e(N,null,{default:l(()=>[e(H,{align:"right"},{default:l(()=>[e(w,{flat:"",icon:"close",color:"negative",onClick:s[2]||(s[2]=t=>p.value=!p.value)}),e(w,{flat:"",icon:"check",color:"positive",onClick:q})]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]),e(F,{modelValue:f.value.state,"onUpdate:modelValue":s[5]||(s[5]=t=>f.value.state=t),persistent:""},{default:l(()=>[e(L,{style:{width:"900px","max-width":"80vw"}},{default:l(()=>[e(N,{class:"items-center"},{default:l(()=>[g("div",ke,"Particion - "+r(f.value.val.id),1),g("div",null,[e(K,{bordered:""},{default:l(()=>[e(T,null,{default:l(()=>[e(b,null,{default:l(()=>[e($,{class:"text-center",caption:""},{default:l(()=>[i("Factura")]),_:1}),e($,{class:"text-center text-bold"},{default:l(()=>[i(r(f.value.val.invoice),1)]),_:1})]),_:1}),e(O,{spaced:"",inset:"",vertical:"",dark:""}),e(b,null,{default:l(()=>[e($,{class:"text-center",caption:""},{default:l(()=>[i("Entrada")]),_:1}),e($,{class:"text-center text-bold"},{default:l(()=>[i(r(f.value.val.invoice_received),1)]),_:1})]),_:1}),e(O,{spaced:"",inset:"",vertical:"",dark:""}),e(b,null,{default:l(()=>[e($,{class:"text-center",caption:""},{default:l(()=>[i("Almacen")]),_:1}),e($,{class:"text-center text-bold"},{default:l(()=>[i(r(f.value.val._warehouse),1)]),_:1})]),_:1})]),_:1})]),_:1})])]),_:1}),e(N,null,{default:l(()=>[e(Y,{rows:f.value.val.products,columns:v.value.columnsProduct,pagination:v.value.pagination,"hide-bottom":""},{header:l(t=>[e(D,{props:t},{default:l(()=>[(_(!0),Q(S,null,E(t.cols,n=>(_(),C(M,{key:n.name,props:t},{default:l(()=>[i(r(n.label),1)]),_:2},1032,["props"]))),128)),e(M,{"auto-width":""})]),_:2},1032,["props"])]),body:l(t=>[e(D,{props:t},{default:l(()=>[e(h,null,{default:l(()=>[i(r(t.row.code),1)]),_:2},1024),e(h,null,{default:l(()=>[i(r(t.row.description),1)]),_:2},1024),e(h,{class:"text-center"},{default:l(()=>[i(r(t.row.pivot.toDelivered*x(t.row.pivot._supply_by,t.row))+" ",1),e(le,{modelValue:t.row.pivot.toDelivered,"onUpdate:modelValue":n=>t.row.pivot.toDelivered=n},{default:l(n=>[e(X,{type:"number",modelValue:n.value,"onUpdate:modelValue":u=>n.value=u,dense:"",autofocus:"",onKeyup:J(u=>n.set(),["enter"]),min:1},null,8,["modelValue","onUpdate:modelValue","onKeyup"]),g("div",Ce," Surtido Por "+r(R(t.row.pivot._supply_by)),1),i(" Piezas: "+r(n.value*x(t.row.pivot._supply_by,t.row)),1)]),_:2},1032,["modelValue","onUpdate:modelValue"])]),_:2},1024),e(h,{class:"text-center"},{default:l(()=>[i(r(t.row.pivot.toReceived*x(t.row.pivot._supply_by,t.row))+" ",1),e(le,{modelValue:t.row.pivot.toReceived,"onUpdate:modelValue":n=>t.row.pivot.toReceived=n},{default:l(n=>[e(X,{type:"number",modelValue:n.value,"onUpdate:modelValue":u=>n.value=u,dense:"",autofocus:"",onKeyup:J(u=>n.set(),["enter"]),min:1},null,8,["modelValue","onUpdate:modelValue","onKeyup"]),g("div",De," Surtido Por "+r(R(t.row.pivot._supply_by)),1),i(" Piezas: "+r(n.value*x(t.row.pivot._supply_by,t.row)),1)]),_:2},1032,["modelValue","onUpdate:modelValue"])]),_:2},1024),e(h,{class:"text-center"},{default:l(()=>[i(r(Number(t.row.pivot.toDelivered-t.row.pivot.toReceived)*x(t.row.pivot._supply_by,t.row)),1)]),_:2},1024),e(h,{"auto-width":""},{default:l(()=>[e(w,{color:t.row.pivot.toDelivered>=0&&t.row.pivot.toReceived>0?"grey":"negative",icon:"delete",onClick:n=>U(t.row),disable:t.row.pivot.toDelivered>=0&&t.row.pivot.toReceived>0,flat:""},null,8,["color","onClick","disable"])]),_:2},1024)]),_:2},1032,["props"])]),_:1},8,["rows","columns","pagination"])]),_:1}),e(H,{align:"right"},{default:l(()=>[B(e(w,{flat:"",label:"Cancel",color:"primary"},null,512),[[Z]]),e(w,{flat:"",label:"Guardar",color:"primary",onClick:s[4]||(s[4]=t=>y.value=!y.value)})]),_:1})]),_:1})]),_:1},8,["modelValue"]),e(F,{modelValue:y.value,"onUpdate:modelValue":s[6]||(s[6]=t=>y.value=t),persistent:""},{default:l(()=>[e(L,null,{default:l(()=>[e(N,{class:"row items-center"},{default:l(()=>[e(de,{icon:"warning",color:"white","text-color":"negative"}),Qe]),_:1}),e(H,{align:"right"},{default:l(()=>[B(e(w,{flat:"",label:"Cancelar",color:"primary"},null,512),[[Z]]),e(w,{flat:"",label:"Enviar",color:"primary",onClick:P})]),_:1})]),_:1})]),_:1},8,["modelValue"])],64))}};export{Ge as default};
