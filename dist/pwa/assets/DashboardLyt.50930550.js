import{r as p,c as B,o as c,aF as C,f as o,d as e,w as t,h,aH as Y,i as j,e as F,aA as ee,b as L,aN as Ue,Q as ue,t as u,aE as y,R as Se,u as he,a7 as Pe,aG as Z,aJ as $e,x as Oe,a as Ve,aO as Ae,aP as Re,g as Le}from"./index.2b3d8d3a.js";import{u as ne,t as K,b as oe,y as se,z as q,A as ae,v as pe,w as ge,Q as re,x as te,B as we,a as Fe}from"./QPage.a7345da3.js";import{a as je,Q as Be}from"./QToggle.12463bec.js";import{Q as Te,a as ze,b as Ne}from"./QLayout.351489fc.js";import{d as J}from"./dayjs.min.53a5c0af.js";import{b as R,Q as xe,a as X,c as be,C as ye,R as T}from"./ClosePopup.2c160215.js";import{a as Ye,Q as Me,b as He,c as ve,d as Ge,e as me,f as Ke,u as ke}from"./Restock.f9ce54e7.js";import{Q as fe,a as _e}from"./QTd.840fd401.js";import{Q as Je}from"./QTabs.c176b1a0.js";import{A as le}from"./AssistApi.a6b5b94c.js";import{b as We}from"./jspdf.plugin.autotable.dbbab4f5.js";import{p as Xe}from"./pdfCreate.9cf4e659.js";import{$sktRestock as G,usrSkt as Ze}from"./socket.890df2ea.js";import"./rtl.ff96e2df.js";import"./axios.d46b4b71.js";const et={class:"q-pa-sm bg-grey-2 text-bold row justify-between items-center",style:{"min-width":"250px"}},tt=o("div",null,"Impresion",-1),at={key:0,class:"row justify-between items-center"},lt={class:"q-mt-sm q-pa-sm"},ot={key:0,class:"q-pa-sm"},st={class:"text--3"},nt={class:"q-pa-sm text-right"},Ce={__name:"PrinterSelect",emits:["selected"],setup(W,{emit:x}){const E=ne(),f=Ye(),r=p(null),v=p(null),b=B(()=>f.printers),d=B(()=>r.value?r.value.printers:[]),z=()=>{E.localStorage.set("LUP",{wkp:r.value,printer:v.value}),x("selected",v.value)},Q=E.localStorage.getItem("LUP");return Q&&(r.value=Q.wkp,v.value=Q.printer),(I,S)=>(c(),C(Y,null,[o("div",et,[tt,r.value?(c(),C("div",at,[e(Me,{flat:""},{default:t(()=>[e(h,{flat:"",color:"positive",icon:"add",dense:""}),v.value?(c(),C(Y,{key:0},[e(h,{flat:"",color:"negative",icon:"delete",dense:""}),e(h,{flat:"",color:"orange",icon:"edit",dense:""})],64)):j("",!0)]),_:1})])):j("",!0)]),e(K),o("div",lt,[e(oe,{modelValue:r.value,"onUpdate:modelValue":[S[0]||(S[0]=_=>r.value=_),S[1]||(S[1]=_=>v.value=null)],options:F(b),label:"Sucursal",filled:"","option-label":"alias","option-value":"id"},null,8,["modelValue","options"])]),r.value?(c(),C("div",ot,[e(oe,{modelValue:v.value,"onUpdate:modelValue":S[2]||(S[2]=_=>v.value=_),options:F(d),label:"Impresora",filled:"","option-value":"id","option-label":"name"},{option:t(_=>[ee((c(),L(se,Ue({clickable:""},_.itemProps),{default:t(()=>[e(q,{class:"text-center",side:""},{default:t(()=>[e(ue,{color:"primary","text-color":"white",name:"print",size:"30px"}),o("span",st,"ID:"+u(_.opt.id),1)]),_:2},1024),e(q,null,{default:t(()=>[e(ae,null,{default:t(()=>[y(u(_.opt.name),1)]),_:2},1024),e(ae,{caption:"",lines:"2"},{default:t(()=>[y(u(_.opt.ip),1)]),_:2},1024)]),_:2},1024)]),_:2},1040)),[[Se]])]),_:1},8,["modelValue","options"])])):j("",!0),o("div",nt,[r.value&&v.value?(c(),L(h,{key:0,color:"primary",icon:"print",onClick:z})):j("",!0)])],64))}},it=o("div",{class:"text-overline text-grey-7"},"Sucursal",-1),dt={class:"text-h6"},rt={class:"q-px-lg text-center"},ut=o("div",{class:"text-overline text-grey-7"},"Folio",-1),ct={class:"text-h6"},pt={class:"text-right"},vt=o("div",{class:"text-overline text-grey-7"},"Agente",-1),mt={class:"text-h6"},ft={class:"text-center"},_t=o("div",{class:"text-overline text-grey-7"},"Fecha",-1),gt={class:"text-h6"},bt={key:0,class:"text-center"},yt=o("div",{class:"text-overline text-grey-7 col"},"Notas",-1),ht={class:"text-h6"},xt={class:"flex item-center"},kt={class:"full-width row items-center"},wt={class:"col text-dark"},Ct={class:"text-h6"},St={class:"text-bold"},$t={key:1,class:"text-center q-pa-lg text-h6 text-grey-7"},Vt={class:"q-pa-xs col-xs-12 col-sm-6 col-md-4"},Dt=o("br",null,null,-1),Qt=o("br",null,null,-1),It={class:"text-overline text-grey-7"},qt=o("div",null,"Salida",-1),Et=o("div",null,"Entrada",-1),Ut=o("div",null,"Herramientas",-1),Pt={class:"row"},Ot={key:0,class:"col"},At={key:1,class:"col"},Rt={key:2,class:"col"},Lt=o("canvas",{id:"qrcode"},null,-1),Ft={class:"text--2"},jt=o("div",{class:"q-ml-md"},[o("div",{class:"text-h6"},"Cambiar a En Camino?"),o("div",null,"Cambiara a estatus en camino")],-1),Bt=o("div",{class:"text-center text-h6"},"Surtidor",-1),Tt={class:"text-center text-bold text-subtitle2 text-overline"},zt={__name:"OrderViewer",props:{head:{type:Object,default:{}}},emits:["loaded","loading","fresh"],setup(W,{emit:x}){const E=W,f=ne();he();const r=p({opts:[],val:[],filter:[]}),v=p({opts:null,val:null,filter:null}),b=p(null),d=p(E.head),z=p(null),Q=p(!0),I=p([]),S=p("supliers"),_=p(null),N=p([]),$=p(!1),U=p({state:!1}),n=p({state:!1,key:null}),g=p(null),i=p({state:!1}),w=p(null),M=p([]),m=p({columns:[{name:"id",label:"ID",field:"id",align:"left",coldesc:"Identificador del producto (MySQL)"},{name:"code",label:"Codigo",field:"code",align:"left",coldesc:"Codigo principal del producto"},{name:"assocs",label:"Asociados",field:a=>a.variants.length?a.variants.map(l=>l.barcode).join(", "):null,align:"left",coldesc:"Codigos relacionados al codigo principal"},{name:"bcode",label:"Codigo de Barras",field:"barcode",align:"center",coldesc:"Codigo de barras principal"},{name:"locs",label:"Ubicacion",field:a=>a.locations.length?a.locations.map(l=>l.path).join(", "):"--",align:"left",coldesc:"Ubicaciones en almacen general"},{name:"stocks",label:"Stock (pzs)",field:a=>a.stocks.reduce((l,s)=>l+s.pivot.stock,0),sortable:!0,classes:a=>a.stocks.reduce((l,s)=>l+s.pivot.stock,0)<=0?"text-red text-bold":"text-bold text-primary",align:"center",coldesc:"Stock total en almacenes GENERALES (CEDIS+PAN)"},{name:"ipack",label:"PxC",field:a=>typeof a.pivot.ipack=="number"?a.pivot.ipack:a.pieces,align:"center",coldesc:"Unidades x Embalaje"},{name:"request",label:"Solicitud",field:a=>a.pivot.amount,align:"center",coldesc:"Embalaje solicitado"},{name:"uspply",label:"Unidad",field:a=>a.units.id==3?"Cajas":"Piezas",align:"left",coldesc:"Unidad de embalaje del producto"},{name:"delivery",label:"Salida (conteo)",field:a=>a.pivot.toDelivered,align:"center",coldesc:"Embalaje surtido",sortable:!0},{name:"reqinpzs",label:"Piezas",field:a=>a.pivot._supply_by==3?(typeof a.pivot.ipack=="number"?a.pivot.ipack:a.pieces)*(typeof a.pivot.ipack=="number"?a.pivot.toDelivered:a.pivot.amount):typeof a.pivot.ipack=="number"?a.pivot.toDelivered:a.pivot.amount,align:"center",coldesc:"Unidades totales en embalaje"},{name:"checkout",label:"Checkout",field:a=>a.pivot.checkout?"OK":"---",align:"center",classes:a=>a.pivot.checkout?"text-positive text-bold":"text-red",sortable:!0,coldesc:"Revision del Administrador"},{name:"received",label:"Entrada (conteo)",field:a=>a.pivot.toReceived,align:"center",coldesc:"Embalaje recibido"},{name:"descr",label:"Descripcion",field:"description",align:"left"},{name:"section",label:"Seccion",field:"section",align:"left"},{name:"family",label:"Familia",field:"family",align:"left"},{name:"category",label:"Categoria",field:"category",align:"left"}],filter:"",pagination:{sortBy:"locs",descending:!1,rowsPerPage:20}}),V=B(()=>N.value.reduce((a,l)=>a+(l.pivot._supply_by==3?l.pivot.amount*l.pieces:l.pivot.amount),0));B(()=>_.value&&(_.value.id==2||_.value.id==6)),B(()=>I.value.find(a=>a.id==_.value.id).pivot),B(()=>g.value.map(a=>a._status).includes(6));const k=async()=>{x("loading"),Q.value=!0;let a=await T.order(d.value.id);if(console.log(a.data),N.value=a.data.products,I.value=a.data.log.map(l=>(l.pivot.details=JSON.parse(l.pivot.details),l)),g.value=a.data.partition,_.value=a.data.status,z.value=a.data,w.value=a.data.invoice,_.value.id==2){let l=await le.getSupply();console.log(l),r.value.opts=l}Q.value=!1,x("loaded")},P=()=>{i.value.state=!0},O=async()=>{console.log("Iniciando surtido"),x("loading"),$.value=!0;let a=3,l={id:d.value.id,state:a};const s=await T.nextState(l);if(s.status==200){$.value=!1,f.notify({message:`Surtido iniciado para el pedido  ${d.value.id}`,icon:"done",position:"center",color:"teal"});let D={supplyer:r.value.val,pedido:d.value.id,status:a},A=await le.SaveSupply(D);console.log(A),A.status==200?(k(),x("fresh",d.value.id),i.value.state=!1):alert(`Error ${A.status}: ${A.data} 2`)}else alert(`Error ${s.status}: ${s.data} 1`);x("loaded")},H=async()=>{f.loading.show({message:"Cambiando, espera..."});let a={chofi:v.value.val,supplyer:b.value._suplier_id,pedido:d.value.id,status:7},l=await le.SaveChofi(a);if(l.status==200){let s={id:d.value.id,state:7,suply:b.value._suplier_id};console.log(s);let D=await le.nextState(s);if(console.log(D),D.data.partitionsEnd>z.value._status){let A={id:d.value.id,state:D.data.partitionsEnd};console.log(A);const de=await T.nextState(A);console.log(de)}if(D.status==200){k();let A=D.data.partition.id,de=g.value.findIndex(Ee=>Ee.id==A);g.value[de]._status=D.data.partition._status,g.value[de].invoice=D.data.partition.invoice}f.notify({message:"Pedido en ruta",position:"center",icon:"done",timeout:5e3,color:"positive"}),U.value.state=!1}else alert(`Error ${l.status}: ${l.data}`);f.loading.hide()},ie=async a=>{let l=`http://192.168.10.189:2200/#/checkin/${d.value.id}?key=${a}`;n.value.state=!0,Oe(()=>We.toCanvas(document.getElementById("qrcode"),l))},ce=async a=>{f.loading.show({message:"..."}),console.log(a);const l=await T.printKey({ip:a.ip,port:a._port,order:d.value.id});l.status==200?(l.data,f.loading.hide(),f.notify({message:"Impresion correcta",icon:"done",color:"positive",position:"top"})):(console.error(l),alert(`Error ${l.status}: ${l.data}`))},De=async a=>{f.loading.show({message:"..."}),console.log(a);const l=await T.printForSupply({ip:a.ip,port:a._port,order:d.value.id});console.log(l),l.status==200?(l.data?f.notify({message:"Impresion correcta",icon:"done",color:"positive",position:"top"}):f.notify({message:`Sin conexion a <b>${a.name} <small>(${a.ip})</small></b>`,icon:"fas fa-bug",color:"negative",position:"center",html:!0,timeout:4e3}),f.loading.hide()):(console.error(l),alert(`Error ${l.status}: ${l.data}`))},Qe=async a=>{b.value=a,U.value.state=!0;let l=await le.getSupply();console.log(l),v.value.opts=l},Ie=(a,l,s)=>{l(()=>{if(a==="")r.value.filter=r.value.opts;else{const D=a.toLowerCase();r.value.filter=r.value.opts.filter(A=>A.complete_name.toLowerCase().indexOf(D)>-1)}})},qe=(a,l,s)=>{l(()=>{if(a==="")v.value.filter=v.value.opts;else{const D=a.toLowerCase();v.value.filter=v.value.opts.filter(A=>A.complete_name.toLowerCase().indexOf(D)>-1)}})};return Pe(()=>M.value=m.value.columns.map(a=>a.name)),k(),(a,l)=>(c(),C(Y,null,[e(X,{class:"full-width"},{default:t(()=>[e(R,{class:"row justify-between"},{default:t(()=>[o("div",null,[it,o("div",dt,u(d.value.from.alias),1)]),o("div",rt,[ut,o("div",ct,u(d.value.id),1)]),o("div",pt,[vt,o("div",mt,u(d.value.created_by.nick),1)])]),_:1}),e(K),e(R,{class:"row justify-between"},{default:t(()=>[o("div",ft,[_t,o("div",gt,u(F(J)(d.value.updated_at).format("YYYY-MM-DD")),1)]),d.value.notes?(c(),C("div",bt,[yt,o("div",ht,u(d.value.notes),1)])):j("",!0),o("div",xt,[_.value&&_.value.id==2?(c(),L(h,{key:0,color:"positive",icon:"start",dense:"",label:"Iniciar Surtido",onClick:P,flat:"",rounded:""})):j("",!0),_.value&&_.value.id>2?(c(),L(h,{key:1,color:"indigo-10",icon:"print",dense:""},{default:t(()=>[e(pe,{class:"bg-grey-1 text-indigo-10",style:{"min-width":"250px"}},{default:t(()=>[e(Ce,{onSelected:De})]),_:1})]),_:1})):j("",!0)])]),_:1}),e(K),Q.value?(c(),L(R,{key:0,class:"text-center"},{default:t(()=>[e(He,{size:"50px",color:"purple"})]),_:1})):(c(),C(Y,{key:1},[e(K),e(Je,{modelValue:S.value,"onUpdate:modelValue":l[0]||(l[0]=s=>S.value=s),class:"text-pink-5",dense:"","no-caps":""},{default:t(()=>[e(ve,{name:"log",label:"Log"}),e(ve,{name:"basket",label:"Productos"}),e(ve,{name:"supliers",label:"Surtidores"})]),_:1},8,["modelValue"]),e(Ge,{modelValue:S.value,"onUpdate:modelValue":l[3]||(l[3]=s=>S.value=s),animated:""},{default:t(()=>[e(me,{name:"log"},{default:t(()=>[e(ge,null,{default:t(()=>[(c(!0),C(Y,null,Z(I.value,s=>(c(),L(se,{key:s.id},{default:t(()=>[e(q,{avatar:""},{default:t(()=>[y(u(s.id),1)]),_:2},1024),e(q,null,{default:t(()=>[y(u(s.name),1)]),_:2},1024),e(q,null,{default:t(()=>[y(u(s.pivot.details.responsable),1)]),_:2},1024),e(q,null,{default:t(()=>[y("de "+u(F(J)(s.pivot.created_at).format("h:mm a"))+" a "+u(F(J)(s.pivot.updated_at).format("h:mm a")),1)]),_:2},1024)]),_:2},1024))),128))]),_:1})]),_:1}),e(me,{name:"basket"},{default:t(()=>[N.value.length?(c(),L(re,{key:0,"row-key":"id",flat:"",rows:N.value,columns:m.value.columns,pagination:m.value.pagination,filter:m.value.filter,"visible-columns":M.value},{top:t(()=>[o("div",kt,[o("div",wt,[o("span",Ct,[e(h,{color:"pink-5",icon:"sync",onClick:k,round:"",dense:"",flat:""}),y(" Productos: "+u(N.value.length),1)]),y(", "),o("span",St,"Piezas: "+u(F(V)),1)]),e(xe,{dense:"",modelValue:m.value.filter,"onUpdate:modelValue":l[1]||(l[1]=s=>m.value.filter=s),placeholder:"Buscar","input-class":"text-uppercase",color:"pink-5"},{append:t(()=>[e(ue,{name:"search"})]),_:1},8,["modelValue"]),e(h,{color:"secondary",icon:"fas fa-eye","no-caps":""},{default:t(()=>[e(pe,{style:{"min-width":"200px"}},{default:t(()=>[e(ge,null,{default:t(()=>[(c(!0),C(Y,null,Z(m.value.columns,(s,D)=>ee((c(),L(se,{tag:"label",key:D},{default:t(()=>[e(q,null,{default:t(()=>[e(ae,null,{default:t(()=>[y(u(s.label),1)]),_:2},1024),e(ae,{caption:""},{default:t(()=>[y(u(s.coldesc),1)]),_:2},1024)]),_:2},1024),e(q,{side:"",top:""},{default:t(()=>[e(je,{color:"pink-5",modelValue:M.value,"onUpdate:modelValue":l[2]||(l[2]=A=>M.value=A),val:s.name},null,8,["modelValue","val"])]),_:2},1024)]),_:2},1024)),[[Se]])),128))]),_:1})]),_:1})]),_:1})])]),_:1},8,["rows","columns","pagination","filter","visible-columns"])):(c(),C("div",$t,"Nada por aqui"))]),_:1}),e(me,{name:"supliers"},{default:t(()=>[e(re,{rows:g.value,"row-key":"id",dense:"",flat:"",bordered:"",grid:"","hide-header":""},{item:t(s=>[o("div",Vt,[e(X,{flat:"",bordered:""},{default:t(()=>[e(R,{class:"text-center"},{default:t(()=>[y(" Surtidor "),Dt,o("strong",null,u(s.row._suplier),1),Qt,o("div",It,[e(Ke,{color:"primary","text-color":"white",label:s.row.status.name},null,8,["label"])])]),_:2},1024),e(K),e(R,{class:"flex justify-between"},{default:t(()=>[qt,Et,Ut]),_:1}),e(K),e(R,{class:"flex justify-between"},{default:t(()=>[o("div",null,u(s.row.invoice),1),o("div",null,u(s.row.invoice_received),1),o("div",Pt,[s.row._status==6?(c(),C("div",Ot,[e(h,{color:"pink",label:"En Camino",class:"q-px-xl q-py-xs",size:"10px",padding:"5px 2px","icon-right":"start",flat:"",onClick:D=>Qe(s.row)},null,8,["onClick"])])):j("",!0),s.row._status>=7?(c(),C("div",At,[e(h,{color:"pink",icon:"qr_code",onClick:D=>ie(s.row.entry_key),flat:""},null,8,["onClick"])])):j("",!0),s.row._status>=7?(c(),C("div",Rt,[e(h,{color:"pink",icon:"list",onClick:D=>F(Xe).pdf(s.row.invoice,s.row.entry_key,d.value.id),flat:""},null,8,["onClick"])])):j("",!0)])]),_:2},1024)]),_:2},1024)])]),_:1},8,["rows"])]),_:1})]),_:1},8,["modelValue"])],64))]),_:1}),e(te,{modelValue:n.value.state,"onUpdate:modelValue":l[4]||(l[4]=s=>n.value.state=s)},{default:t(()=>[e(X,null,{default:t(()=>[e(R,{class:"text-h6 text-center"},{default:t(()=>[y(u(d.value.id)+" - "+u(d.value.from.alias),1)]),_:1}),e(K),e(R,{class:"text-center"},{default:t(()=>[Lt,o("div",Ft,u(n.value.key),1)]),_:1}),e(K),e(R,{align:"center"},{default:t(()=>[e(h,{color:"indigo-10",icon:"print"},{default:t(()=>[e(pe,null,{default:t(()=>[e(Ce,{onSelected:ce})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]),e(te,{modelValue:U.value.state,"onUpdate:modelValue":l[6]||(l[6]=s=>U.value.state=s)},{default:t(()=>[e(X,null,{default:t(()=>[e(R,{class:"row items-start"},{default:t(()=>[e($e,{icon:"warning",color:"orange-14","text-color":"white"}),jt]),_:1}),e(R,null,{default:t(()=>[o("div",null,[Bt,o("div",Tt,u(b.value._suplier),1)])]),_:1}),b.value?(c(),L(R,{key:0},{default:t(()=>[e(oe,{modelValue:v.value.val,"onUpdate:modelValue":l[5]||(l[5]=s=>v.value.val=s),options:v.value.filter,label:"CHOFER","option-label":"complete_name",filled:"",style:{width:"100%"},onFilter:qe,"input-debounce":"0","use-input":""},null,8,["modelValue","options"])]),_:1})):j("",!0),e(be,{align:"right"},{default:t(()=>[ee(e(h,{flat:"",label:"Cancelar",color:"primary","no-caps":""},null,512),[[ye]]),e(h,{flat:"",label:"Continuar",color:"primary",onClick:H,"no-caps":"",disable:v.value.val==null},null,8,["disable"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),e(te,{modelValue:i.value.state,"onUpdate:modelValue":l[8]||(l[8]=s=>i.value.state=s),persistent:""},{default:t(()=>[e(X,{style:{width:"400px"}},{default:t(()=>[e(R,{class:"row items-center"},{default:t(()=>[e(oe,{modelValue:r.value.val,"onUpdate:modelValue":l[7]||(l[7]=s=>r.value.val=s),options:r.value.filter,label:"SELECCIONA SURTIDOR","option-label":"complete_name",filled:"",multiple:"",counter:"","max-values":"5",hint:"Maximo 5 colaboradores",style:{width:"100%"},onFilter:Ie,"input-debounce":"0","use-input":"","use-chips":""},null,8,["modelValue","options"])]),_:1}),e(be,{align:"right"},{default:t(()=>[ee(e(h,{flat:"",label:"Cancel",color:"primary"},null,512),[[ye]]),e(h,{flat:"",label:"Continuar",color:"primary",onClick:O,disable:r.value.val.length==0},null,8,["disable"])]),_:1})]),_:1})]),_:1},8,["modelValue"])],64))}},Nt={class:"text-h6"},Yt={class:"row q-mt-md"},Mt={class:"q-ml-sm text-h6"},Ht={__name:"TableReport",props:{rows:{type:Array,default:[]},name:{type:String,default:""},type:{type:String,default:""}},emits:["cardResumeActived"],setup(W,{emit:x}){const E=W;ke();const f=ne(),r=p({state:!1,action:null}),v=p({columns:[{name:"ID",field:"ID",label:"ID",align:"center"},{name:"code",field:"CODIGO",label:"Codigo",align:"center",sortable:!0},{name:"desc",field:"DESCRIPCION",label:"Descripcion",align:"left"},{name:"stockcedis",field:"CEDIS",label:"Stock (CEDIS)",align:"center",sortable:!0},{name:"stockpan",field:"PANTACO",label:"Stock (PAN)",align:"center",sortable:!0}],filter:""}),b={pndcs:{l:"Habilitar todo",c:"indigo-13",desc:"Los productos en esta lista se habilitaran y podran ser solicitados por cuaqluier tienda."},pdss:{l:"Deshabilitar todo",c:"pink-13",desc:"Los productos en esta lista se deshabilitaran y no podran ser solicitados."}},d=p(E.rows),z=p(E.name),Q=p(E.type),I=B(()=>Q.value?b[Q.value]:{l:"",c:""}),S=()=>{const $=b[Q.value];r.value.action=$,r.value.state=!0},_=async()=>{f.loading.show({message:"Espera..."});const $=await T.massiveAction({action:Q.value});console.log($),$.status==200?($.data,r.value.state=!1,r.value.action=null,f.loading.hide(),f.notify({position:"center",color:"positive",icon:"done"}),x("cardResumeActived")):(console.error($.data),alert(`Error ${$.status}: ${$.data.msg}`))},N=($,U,n)=>{console.log($),console.log(U),console.log(n),console.log(Q.value)};return($,U)=>(c(),C(Y,null,[e(re,{"row-key":"ID",rows:d.value,columns:v.value.columns,filter:v.value.filter,onRowClick:N},{top:t(()=>[o("div",Nt,u(z.value),1),o("div",Yt,[e(h,{color:F(I).c,icon:"warning",label:F(I).l,onClick:S},null,8,["color","label"]),e(xe,{modelValue:v.value.filter,"onUpdate:modelValue":U[0]||(U[0]=n=>v.value.filter=n),dense:"",type:"text",icon:"search",label:"Buscar"},{prepend:t(()=>[e(ue,{name:"search"})]),_:1},8,["modelValue"])])]),_:1},8,["rows","columns","filter"]),e(te,{modelValue:r.value.state,"onUpdate:modelValue":U[1]||(U[1]=n=>r.value.state=n),persistent:""},{default:t(()=>[e(X,null,{default:t(()=>[e(R,{class:"row items-center"},{default:t(()=>[e($e,{icon:"warning",color:r.value.action.c,"text-color":"white"},null,8,["color"]),o("span",Mt,u(r.value.action.l),1)]),_:1}),e(R,null,{default:t(()=>[y(u(r.value.action.desc),1)]),_:1}),e(be,{align:"right"},{default:t(()=>[ee(e(h,{flat:"",label:"cancelar",color:"primary"},null,512),[[ye]]),e(h,{flat:"",label:"continuar",color:"primary",onClick:_})]),_:1})]),_:1})]),_:1},8,["modelValue"])],64))}},Gt={key:0,class:"bg-negative text-white q-pa-md q-mb-md"},Kt=o("div",{class:"text-warning text-bold"},"Los siguientes folios tienen errores que no permiten ser listados en la tabla. ",-1),Jt={class:"text-h6"},Wt=o("div",{class:"text--2"},"Errores comunes: Sin log, Sin fecha, Estatus desconocido",-1),Xt={class:"row q-mb-md items-start justify-around"},Zt={class:"text-left"},ea={class:"text-h5"},ta={class:"text--2"},aa={class:"full-width row items-center"},la={class:"col text-h6 text-dark"},oa={__name:"AdminDashboard",emits:["reloadDashboard","freshOrder"],setup(W,{emit:x}){he(),Ve();const E=ke(),f=ne(),r=["text-grey-5 text-bold","text-bold text-h6 text-red","text-indigo","4","5","text-bold text-pink-7","text-orange-8","8","text-primary","text-positive"],v=p({columns:[{name:"id",label:"Folio",field:"id",align:"center",sortable:!0},{name:"state",label:"Estado",field:n=>n.log.length==1?n.log[0].name:n.log[n.log.length-1].name,align:"left",sortable:!0,sort:(n,g,i,w)=>parseInt(i._status)-parseInt(w._status),classes:n=>r[n._status?parseInt(n._status)-1:parseInt(n.status.id)-1]},{name:"suplier",label:"Surtidores",field:n=>{var g;return(g=n.partition)==null?void 0:g.length},align:"center",classes:"text-bold"},{name:"laststate",label:"Ultima actividad",field:n=>J(n.log.find(g=>g.id==n.status.id).pivot.updated_at).format("YYYY-MM-DD hh:mm A"),align:"left"},{name:"from",label:"Sucursal",field:n=>n.from.name.toUpperCase(),align:"left",sortable:!0},{name:"to",label:"Destino",field:n=>n.to.name.toUpperCase(),align:"left",sortable:!0},{name:"notes",label:"Notas",field:n=>n.notes,align:"left",classes:n=>n.notes?"text-orange text-bold":""},{name:"tmodels",label:"Modelos",field:n=>n.products_count,align:"center",sortable:!0}],filter:"",pagination:{sortBy:"desc",descending:!1,rowsPerPage:20}}),b=p({state:!1,title:"",data:null,name:null,type:null}),d=p({state:!1,head:null,block:!0}),z=B(()=>E.ordersSize),Q=B(()=>E.ordersok),I=B(()=>E.orderserrors),S=B(()=>E.resume),_=async n=>{console.log(n.row),d.value.head=n.row,d.value.state=!0},N=async n=>{f.loading.show({message:"cargando..."+n});const g=await T.report(n);console.log(g.data),b.value.data=g.data.rows,b.value.name=g.data.name,b.value.type=n,b.value.state=!0,f.loading.hide()},$=()=>{b.value.state=!1,b.state=!1,x("reload")},U=n=>{console.log("Se crearon las particiones",n),x("freshOrder",n)};return(n,g)=>(c(),L(Fe,{padding:"",class:"bg-grey-2"},{default:t(()=>[F(I).length?(c(),C("div",Gt,[Kt,o("div",Jt,u(F(I).map(i=>i.id).join("id")),1),Wt])):j("",!0),o("div",Xt,[(c(!0),C(Y,null,Z(F(S),i=>(c(),L(h,{stack:"","no-caps":"",class:"q-py-md",key:i.key,onClick:w=>N(i.key),color:i.total==0?"teal-10":"pink-13",disabled:i.total==0},{default:t(()=>[o("div",Zt,[o("div",ea,u(i.total),1),o("div",ta,u(i.name),1)])]),_:2},1032,["onClick","color","disabled"]))),128))]),e(re,{flat:"",bordered:"","row-key":"id",rows:F(Q),columns:v.value.columns,filter:v.value.filter,pagination:v.value.pagination},{header:t(i=>[e(fe,{props:i},{default:t(()=>[e(we,{"auto-width":""}),(c(!0),C(Y,null,Z(i.cols,w=>(c(),L(we,{key:w.name,props:i},{default:t(()=>[y(u(w.label),1)]),_:2},1032,["props"]))),128))]),_:2},1032,["props"])]),body:t(i=>[e(fe,{props:i},{default:t(()=>[e(_e,{"auto-width":""},{default:t(()=>[e(h,{size:"sm",dense:"",round:"",flat:"",onClick:w=>i.expand=!i.expand,icon:i.expand?"expand_less":"expand_more"},null,8,["onClick","icon"])]),_:2},1024),(c(!0),C(Y,null,Z(i.cols,w=>(c(),L(_e,{key:w.name,props:i,onClick:M=>_(i)},{default:t(()=>[y(u(w.value),1)]),_:2},1032,["props","onClick"]))),128))]),_:2},1032,["props"]),ee(e(fe,{props:i},{default:t(()=>[e(_e,{colspan:"100%"},{default:t(()=>[e(ge,{dense:"",padding:"",class:"rounded-borders"},{default:t(()=>[e(se,null,{default:t(()=>[e(q,null,{default:t(()=>[y("ID")]),_:1}),e(q,null,{default:t(()=>[y("ESTADO")]),_:1}),e(q,null,{default:t(()=>[y(" SALIDA")]),_:1}),e(q,null,{default:t(()=>[y("ENTRADA")]),_:1})]),_:1}),(c(!0),C(Y,null,Z(i.row.partition,(w,M)=>(c(),C("div",{key:M},[e(se,null,{default:t(()=>[e(q,null,{default:t(()=>[e(ae,{overline:""},{default:t(()=>[y(u(w._suplier),1)]),_:2},1024),e(ae,{caption:""},{default:t(()=>[y(u(w.id),1)]),_:2},1024)]),_:2},1024),e(q,{class:Ae(`${r[w.status.id-1]}`)},{default:t(()=>[y(u(w.status.name),1)]),_:2},1032,["class"]),e(q,null,{default:t(()=>[y(u(w.invoice),1)]),_:2},1024),e(q,null,{default:t(()=>[y(u(w.invoice_received),1)]),_:2},1024)]),_:2},1024),e(K,{spaced:"",inset:""})]))),128))]),_:2},1024)]),_:2},1024)]),_:2},1032,["props"]),[[Re,i.expand]])]),top:t(()=>[o("div",aa,[o("div",la,"Pedidos: "+u(F(z)),1),e(xe,{dense:"",modelValue:v.value.filter,"onUpdate:modelValue":g[0]||(g[0]=i=>v.value.filter=i),"input-class":"text-uppercase",placeholder:"Buscar",color:"pink-5"},{append:t(()=>[e(ue,{name:"search"})]),_:1},8,["modelValue"])])]),_:1},8,["rows","columns","filter","pagination"]),e(te,{"full-width":"",modelValue:d.value.state,"onUpdate:modelValue":g[3]||(g[3]=i=>d.value.state=i),persistent:d.value.block,"no-esc-dismiss":d.value.block,"no-backdrop-dismiss":d.value.block},{default:t(()=>[e(zt,{head:d.value.head,onLoaded:g[1]||(g[1]=i=>d.value.block=!1),onLoading:g[2]||(g[2]=i=>d.value.block=!0),onFresh:U},null,8,["head"])]),_:1},8,["modelValue","persistent","no-esc-dismiss","no-backdrop-dismiss"]),e(te,{modelValue:b.value.state,"onUpdate:modelValue":g[4]||(g[4]=i=>b.value.state=i)},{default:t(()=>[e(Ht,{rows:b.value.data,name:b.value.name,type:b.value.type,onCardResumeActived:$},null,8,["rows","name","type"])]),_:1},8,["modelValue"])]),_:1}))}};const sa=o("div",{class:"text-bold"},"Dashboard ",-1),na={class:"row"},ia={class:"col row"},wa={__name:"DashboardLyt",setup(W){const x=he(),E=Ve(),f=ke(),r=ne(),v=Ze,b=p([{id:0,alias:"Todas"},{id:1,alias:"CEDIS",_state:1},{id:2,alias:"SP1",_state:1}]),d=p([{id:"day",label:"Hoy"},{id:"week",label:"Semana"},{id:"month",label:"Mes"},{id:"C",label:"otra ...",disable:!0}]),z=["p2","P2","p3","P3","bol","BOL","sap","SAP"],Q=p(null),I=p(null),S=p({from:J(Date.now()).startOf("day"),to:J(Date.now()).startOf("day")}),_=async()=>{var H;r.loading.show({message:"Cargado vista..."}),console.log("%cIniciando MainLayout...","font-size:2em;color:orange;");let m=(H=x.query.v)!=null?H:"day",V=d.value.findIndex(ie=>ie.id==m),k=V>=0?V:0;I.value=d.value[k],S.value.from=J(Date.now()).startOf(I.value.id);let P=x.query.d&&z.includes(x.query.d)?x.query.d:"all";console.log(P);const O=await T.index(I.value.id,P);console.log(O),f.fillOrders(O.orders),f.fillResume(O.resume),f.fillPrinters(O.printers),Q.value=b.value[0],console.log("%cMainLayout listo!!","font-size:2em;color:orange;"),r.loading.hide(),G.connect(),G.emit("joinat",v),G.on("joineddashreq",$),G.on("creating",U),G.on("order_update",n),G.on("order_changestate",g),G.on("order_refresh",i),G.on("orderpartition_refresh",M)},N=m=>{let V=x.query.d&&z.includes(x.query.d)?x.query.d:"all";E.push(`/dashboard?v=${m.id}&d=${V}`)};B(()=>S.value.from.format("YYYY/MM/DD")),B(()=>S.value.to.format("YYYY/MM/DD"));const $=m=>{console.log(`%c${m.user.me.nick} de ${m.from.alias} se ha unido a Restock (UID: ${m.user.me.id})`,"background:#076F3E;color:#f5f6fa;border-radius:10px;padding:10px;font-size:1.1em;")},U=async m=>{let V=m.order,k=await T.orderFresh(V.id),P=k.data.order,O=k.data.oid;f.addOrUpdate(O,P)},n=m=>{f.orderUpdate(m)},g=async m=>{let V=m.order,k=m.state,P=await T.orderFresh(V.id),O=P.data.order,H=P.data.oid;f.addOrUpdate(H,O),k.id==2&&r.notify({message:`El pedido <b>${V.id}</b> esta listo para iniciar surtido!!`,color:"positive",textColor:"white",position:"bottom",html:!0,timeout:5e3})},i=async m=>{console.log("REFRESHING BY SKT!!",m);let V=m.order,k=await T.orderFresh(V);console.log(k);let P=k.data.order;console.log(P.partition);let O=k.data.oid;f.addOrUpdate(O,P)},w=m=>{console.log("orderViewer/AdminDashboard actualizaron el pedido:",m),G.emit("order_refresh",{order:m})},M=async m=>{console.log("Partition refresh!!",m);let V=m.order,k=await T.orderFresh(V);console.log(k);let P=k.data.order,O=P.partition,H=k.data.oid;f.addOrUpdate(H,P),O.filter(ce=>ce._status==4).length==O.length&&r.notify({message:`El pedido <b>${H}</b> esta listo para iniciar <b>embarque</b>`,html:!0,color:"purple-10",icon:"fa-solid fa-truck-ramp-box"})};return Le(()=>x.query,()=>{_()}),_(),document.title="Dashboard",(m,V)=>(c(),L(Te,{view:"lHh Lpr lFf"},{default:t(()=>[e(ze,{bordered:"",class:"bg-yellow text-dark"},{default:t(()=>[e(Be,{class:"row justify-between items-center"},{default:t(()=>[sa,o("div",na,[e(h,{color:"dark",round:"",unelevated:"",flat:"",icon:"sync",onClick:_}),o("div",ia,[e(oe,{class:"col",dense:"",filled:"",label:"Vista",modelValue:I.value,"onUpdate:modelValue":[V[0]||(V[0]=k=>I.value=k),N],options:d.value},null,8,["modelValue","options"]),I.value.id=="C"?(c(),L(h,{key:0,unelevated:"",color:"pink-5",icon:"fas fa-calendar-day",dense:""})):j("",!0)])])]),_:1})]),_:1}),e(Ne,null,{default:t(()=>[e(oa,{onReload:_,onFreshOrder:w})]),_:1})]),_:1}))}};export{wa as default};
