import{ar as U,k as M,r as g,c as O,a as B,d as L,w as n,e as s,u as P,h as _,t as q,j as N,q as T,Q as C}from"./index.ff53b2ff.js";import{u as z,Q as H,a as G}from"./use-quasar.ca09dc80.js";import{Q as J,a as K}from"./QPage.4fde114c.js";import{Q as X}from"./QToolbar.18977c69.js";import{Q as W}from"./QHeader.3d7dd228.js";import{Q as Z}from"./QDate.2baf39dc.js";import{Q as ee,a as E}from"./QCard.f30321b8.js";import{Q as te}from"./QCardActions.79a5c2cf.js";import{Q as oe,a as ae}from"./QLayout.e4b701c2.js";import{d as Q}from"./dayjs.min.25545ff6.js";import{R as h}from"./RestockApi.75260ed3.js";import{u as F}from"./Restock.2a97b32c.js";import{Q as se}from"./QInput.c1af0176.js";import{Q as le}from"./QTable.28382834.js";import"./axios.10c2b4ae.js";import"./QTabs.b8c08dd9.js";import"./QItem.fc0a63d0.js";import"./QList.8a85215d.js";import"./QToggle.1de5f85f.js";import"./ClosePopup.beb2b7c9.js";import"./jspdf.plugin.autotable.17413686.js";import{$sktRestock as l,usrSkt as re}from"./socket.1aa8b866.js";import"./use-key-composition.f40d518f.js";import"./uid.42677368.js";import"./format.22b8d4d6.js";import"./rtl.81f662dd.js";import"./use-timeout.9a5b3a92.js";import"./_commonjsHelpers.88e99c8f.js";import"./touch.70a9dd44.js";const ie={class:"full-width row items-center"},ne={class:"col text-h6 text-dark"},de={__name:"OrdersCheckout",props:{dash:{type:Object,default:{}}},setup(w){const b=w;U();const i=M(),c=F(),k=["text-grey-5 text-bold","text-bold text-h6 text-red","text-indigo","text-orange-8 text-bold","text-positive text-bold","6","7","8","9","9"],m=g({columns:[{name:"id",label:"Folio",field:"id",align:"center"},{name:"state",label:"Estado",field:t=>t.log.length==1?t.log[0].name:t.log[t.log.length-1].name,align:"left",sortable:!0,sort:(t,r,v,y)=>parseInt(v._status)-parseInt(y._status),classes:t=>k[t._status-1]},{name:"laststate",label:"Ultima actividad",field:t=>Q(t.log.find(r=>r.id==t.status.id).pivot.updated_at).format("YYYY-MM-DD hh:mm A"),align:"left"},{name:"from",label:"Sucursal",field:t=>t.from.name.toUpperCase(),align:"left",sortable:!0},{name:"models",label:"Modelos",field:"products_count",align:"center"},{name:"notes",label:"Notas",field:t=>t.notes,align:"left"},{name:"invoice",label:"Salida",field:t=>{var r;return(r=t.invoice)!=null?r:"--"},align:"center"}],filter:"",pagination:{sortBy:"desc",descending:!1,rowsPerPage:20}}),p=(t,r,v)=>i.push(`/checkout/${r.id}`),d=O(()=>c.ordersdb.filter(t=>b.dash.id==0?t._status>2:t._status>2&&t.to.id==b.dash.id));return(t,r)=>(B(),L(J,{padding:""},{default:n(()=>[s(le,{flat:"","row-key":"id",rows:P(d),columns:m.value.columns,filter:m.value.filter,pagination:m.value.pagination,onRowClick:p},{top:n(()=>[_("div",ie,[_("div",ne,"Pedidos: "+q(P(d).length),1),s(se,{dense:"",modelValue:m.value.filter,"onUpdate:modelValue":r[0]||(r[0]=v=>m.value.filter=v),"input-class":"text-uppercase",placeholder:"Buscar",color:"pink-5"},{append:n(()=>[s(N,{name:"search"})]),_:1},8,["modelValue"])])]),_:1},8,["rows","columns","filter","pagination"])]),_:1}))}};const ce=_("div",{class:"text-bold"},"CheckOut ",-1),ue={class:"row"},me={class:"col row"},pe={class:"q-pa-md"},fe={class:"q-pb-sm"},Te={__name:"CheckoutLyt",setup(w){const b=U();M();const i=F(),c=z(),k=re,m=g([{id:0,alias:"Todas"},{id:1,alias:"CEDIS",_state:1},{id:2,alias:"SP1",_state:1}]),p=g({val:null}),d=g(!1),t=[{id:0,label:"TODAS"},{id:1,label:"CEDIS SN PABLO",_state:1},{id:2,label:"CEDIS TEXCOCO",_state:1},{id:16,label:"CEDIS BRASIL",_state:1},{id:24,label:"CEDIS BOLIVIA",_state:1}],r=g({id:1,label:"CEDIS SN PABLO",_state:1}),v=g(null);g(null);const y=g({from:Q(Date.now()).startOf("day"),to:Q(Date.now()).startOf("day")}),x=async()=>{c.loading.show({message:"Cargado vista..."}),console.log("%cIniciando MainLayout...","font-size:2em;color:orange;"),p.value.val=Q(new Date).format("YYYY/MM/DD");const e=await h.index({date:p.value.val});console.log(e),i.fillOrders(e.orders),i.fillResume(e.resume),i.fillPrinters(e.printers),v.value=m.value[0],console.log("%cMainLayout listo!!","font-size:2em;color:orange;"),c.loading.hide(),l.connect(),l.emit("joinat",k),l.on("joineddashreq",S),l.on("creating",$),l.on("order_update",Y),l.on("order_changestate",I),l.on("order_refresh",R),l.on("orderpartition_refresh",V)};O(()=>y.value.from.format("YYYY/MM/DD")),O(()=>y.value.to.format("YYYY/MM/DD")),T(()=>b.query,()=>{x()});const S=e=>{console.log(`%c${e.user.me.nick} de ${e.from.alias} se ha unido a Restock (UID: ${e.user.me.id})`,"background:#076F3E;color:#f5f6fa;border-radius:10px;padding:10px;font-size:1.1em;")},$=async e=>{let a=e.order;console.log(`Pedido ${a.id} iniciado`);let o=await h.orderFresh(a.id),u=o.data.order,f=o.data.oid;i.addOrUpdate(f,u)},Y=e=>{i.orderUpdate(e)},I=async e=>{let a=e.order;console.log(`Refrescando orden ${a.id}`),e.state;let o=await h.orderFresh(a.id);console.log(o.data);let u=o.data.order,f=o.data.oid;i.addOrUpdate(f,u),u._status==4&&c.notify({message:`El pedido <b>${a.id}</b> esta listo para CheckOut!!`,color:"positive",textColor:"white",position:"bottom",html:!0,timeout:5e3})},R=async e=>{console.log("REFRESHING BY SKT!!",e);let a=e.order,o=await h.orderFresh(a);console.log(o);let u=o.data.order,f=o.data.oid;i.addOrUpdate(f,u)},V=async e=>{console.log("Partition refresh!!",e);let a=e.order,o=await h.orderFresh(a);console.log(o);let u=o.data.order,f=u.partition,D=o.data.oid;i.addOrUpdate(D,u),f.filter(A=>A._status==4).length==f.length?c.notify({message:`El pedido ${D} ha finalizado particiones`,html:!0,color:"purple-10",icon:"fa-solid fa-truck-ramp-box"}):c.notify({message:`Particion lista para checkout en pedidido <b>${D}</b>`,html:!0,color:"pink-14",icon:"fa-solid fa-truck-ramp-box"})},j=async()=>{d.value=!1,c.loading.show({message:"Obteniendo Datos"});const e=await h.index({date:p.value.val});console.log(e),i.fillOrders(e.orders),i.fillResume(e.resume),i.fillPrinters(e.printers),v.value=m.value[0],console.log("%cMainLayout listo!!","font-size:2em;color:orange;"),c.loading.hide(),l.connect(),l.emit("joinat",k),l.on("joineddashreq",S),l.on("creating",$),l.on("order_update",Y),l.on("order_changestate",I),l.on("order_refresh",R),l.on("orderpartition_refresh",V)};return x(),document.title="CheckOut",(e,a)=>(B(),L(oe,{view:"lHh Lpr lFf"},{default:n(()=>[s(W,{bordered:"",class:"bg-cyan-10"},{default:n(()=>[s(X,{class:"row justify-between items-center"},{default:n(()=>[ce,_("div",ue,[s(C,{color:"white",round:"",unelevated:"",flat:"",icon:"sync",onClick:x}),_("div",me,[s(H,{modelValue:r.value,"onUpdate:modelValue":a[0]||(a[0]=o=>r.value=o),options:t,filled:"",dense:""},null,8,["modelValue"]),s(K,{spaced:"",inset:"",vertical:"",dark:""}),s(C,{color:"primary",icon:"event",onClick:a[1]||(a[1]=o=>d.value=!d.value),flat:"",round:""})])])]),_:1})]),_:1}),s(G,{modelValue:d.value,"onUpdate:modelValue":a[4]||(a[4]=o=>d.value=o)},{default:n(()=>[s(ee,{class:"my-card"},{default:n(()=>[s(E,null,{default:n(()=>[_("div",pe,[_("div",fe,q(p.value.val),1),s(Z,{modelValue:p.value.val,"onUpdate:modelValue":a[2]||(a[2]=o=>p.value.val=o),range:"",minimal:""},null,8,["modelValue"])])]),_:1}),s(E,null,{default:n(()=>[s(te,{align:"right"},{default:n(()=>[s(C,{flat:"",icon:"close",color:"negative",onClick:a[3]||(a[3]=o=>d.value=!d.value)}),s(C,{flat:"",icon:"check",color:"positive",onClick:j})]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]),s(ae,null,{default:n(()=>[s(de,{dash:r.value},null,8,["dash"])]),_:1})]),_:1}))}};export{Te as default};
