import{ar as I,k as M,r as p,c as S,a as P,d as U,w as d,e as a,u as V,h as f,t as B,j,q as A,Q as b}from"./index.f1a056e5.js";import{u as N,Q as T,a as z}from"./use-quasar.10cb1f43.js";import{Q as H}from"./QSeparator.2e492904.js";import{Q as G}from"./QToolbar.c50c1d58.js";import{Q as J}from"./QHeader.93391b02.js";import{Q as K}from"./QDate.9bd143ea.js";import{Q as X,a as E}from"./QCard.b31734c2.js";import{Q as W}from"./QCardActions.476ac732.js";import{Q as Z,a as ee}from"./QLayout.f84d934c.js";import{d as y}from"./dayjs.min.25545ff6.js";import{R as _}from"./RestockApi.b0d544bf.js";import{u as L}from"./Restock.ab4ba8a2.js";import{Q as te}from"./QInput.591c2f26.js";import{Q as oe}from"./QTable.e4c927d8.js";import{Q as ae}from"./QPage.b3bde542.js";import"./axios.10c2b4ae.js";import"./QTabs.21c3fc27.js";import"./QItem.769cd19a.js";import"./QList.0aaf675b.js";import"./QToggle.86e9baae.js";import"./ClosePopup.cec40f43.js";import"./jspdf.plugin.autotable.b45f6d28.js";import{$sktRestock as r,usrSkt as se}from"./socket.1aa8b866.js";import"./use-key-composition.9a99c1a1.js";import"./uid.42677368.js";import"./format.54b33283.js";import"./rtl.950de787.js";import"./use-timeout.e24fe1b6.js";import"./_commonjsHelpers.88e99c8f.js";import"./touch.70a9dd44.js";const le={class:"full-width row items-center"},re={class:"col text-h6 text-dark"},ie={__name:"OrdersSupply",props:{dash:{type:Object,default:{}}},setup(w){const h=w;I();const i=M(),c=L(),m=p({columns:[{name:"id",label:"Folio",field:"id",align:"center"},{name:"state",label:"Estado",field:e=>e.log.length==1?e.log[0].name:e.log[e.log.length-1].name,align:"left",sortable:!0,classes:e=>e._status==3?"text-positive text-bold":""},{name:"laststate",label:"Ultima actividad",field:e=>y(e.log.find(s=>s.id==e.status.id).pivot.updated_at).format("YYYY-MM-DD hh:mm A"),align:"left"},{name:"from",label:"Sucursal",field:e=>e.from.name.toUpperCase(),align:"left",sortable:!0},{name:"models",label:"Modelos",field:"products_count",align:"center"},{name:"notes",label:"Notas",field:e=>e.notes,align:"left"},{name:"invoice",label:"Salida",field:e=>{var s;return(s=e.invoice)!=null?s:"--"},align:"center"}],filter:"",pagination:{sortBy:"desc",descending:!1,rowsPerPage:20}}),k=(e,s,n)=>i.push(`/supply/${s.id}`),g=S(()=>c.ordersdb.filter(e=>h.dash.id==0?e._status>2:e._status>2&&e.to.id==h.dash.id));return(e,s)=>(P(),U(ae,{padding:""},{default:d(()=>[a(oe,{flat:"","row-key":"id",rows:V(g),columns:m.value.columns,filter:m.value.filter,pagination:m.value.pagination,onRowClick:k},{top:d(()=>[f("div",le,[f("div",re,"Pedidos: "+B(V(g).length),1),a(te,{dense:"",modelValue:m.value.filter,"onUpdate:modelValue":s[0]||(s[0]=n=>m.value.filter=n),"input-class":"text-uppercase",placeholder:"Buscar",color:"pink-5"},{append:d(()=>[a(j,{name:"search"})]),_:1},8,["modelValue"])])]),_:1},8,["rows","columns","filter","pagination"])]),_:1}))}};const de=f("div",{class:"text-bold"},"Resurtido ",-1),ne={class:"row"},ue={class:"col row"},ce={class:"q-pa-md"},me={class:"q-pb-sm"},Ae={__name:"SupplyLyt",setup(w){const h=I();M();const i=L(),c=N(),m=se,k=[{id:0,label:"TODAS"},{id:1,label:"CEDIS SN PABLO",_state:1},{id:2,label:"CEDIS TEXCOCO",_state:1},{id:16,label:"CEDIS BRASIL",_state:1},{id:24,label:"CEDIS BOLIVIA",_state:1}],g=p({id:1,label:"CEDIS SN PABLO",_state:1}),e=p([{id:0,alias:"Todas"},{id:1,alias:"CEDIS",_state:1},{id:2,alias:"SP1",_state:1}]),s=p({val:null}),n=p(!1),C=p(null);p(null);const D=p({from:y(Date.now()).startOf("day"),to:y(Date.now()).startOf("day")}),Q=async()=>{c.loading.show({message:"Cargado vista..."}),console.log("%cIniciando MainLayout...","font-size:2em;color:orange;"),s.value.val=y(new Date).format("YYYY/MM/DD");const t=await _.index({date:s.value.val});console.log(t),i.fillOrders(t.orders),i.fillResume(t.resume),i.fillPrinters(t.printers),C.value=e.value[0],console.log("%cMainLayout listo!!","font-size:2em;color:orange;"),c.loading.hide(),r.connect(),r.emit("joinat",m),r.on("joineddashreq",O),r.on("creating",$),r.on("order_update",x),r.on("order_changestate",R),r.on("order_refresh",Y),r.on("orderpartition_refresh",sktOrderPartFresh)};S(()=>D.value.from.format("YYYY/MM/DD")),S(()=>D.value.to.format("YYYY/MM/DD"));const O=t=>{console.log(`%c${t.user.me.nick} de ${t.from.alias} se ha unido a Restock (UID: ${t.user.me.id})`,"background:#076F3E;color:#f5f6fa;border-radius:10px;padding:10px;font-size:1.1em;")},$=async t=>{let o=t.order;console.log(`El pedido ${o.id} ha sido iniciado!`);let l=await _.orderFresh(o.id),u=l.data.order,v=l.data.oid;i.addOrUpdate(v,u)},x=t=>{i.orderUpdate(t)},R=async t=>{let o=t.order;console.log(`Refrescando orden ${o.id}`);let l=t.state,u=await _.orderFresh(o.id);console.log(u.data);let v=u.data.order,F=u.data.oid;i.addOrUpdate(F,v),l.id==3&&c.notify({message:`El pedido <b>${o.id}</b> esta listo para surtir!!`,color:"positive",textColor:"white",position:"bottom",html:!0,timeout:5e3})},Y=async t=>{console.log("REFRESHING BY SKT!!",t);let o=t.order,l=await _.orderFresh(o);console.log(l);let u=l.data.order;console.log(u);let v=l.data.oid;i.addOrUpdate(v,u),u._status==3&&c.notify({message:`El pedido <b>${u.id}</b> esta listo para surtir!!`,color:"positive",textColor:"white",position:"bottom",html:!0,timeout:5e3})},q=async()=>{n.value=!1,c.loading.show({message:"Obteniendo Datos"});const t=await _.index({date:s.value.val});console.log(t),i.fillOrders(t.orders),i.fillResume(t.resume),i.fillPrinters(t.printers),C.value=e.value[0],console.log("%cMainLayout listo!!","font-size:2em;color:orange;"),c.loading.hide(),r.connect(),r.emit("joinat",m),r.on("joineddashreq",O),r.on("creating",$),r.on("order_update",x),r.on("order_changestate",R),r.on("order_refresh",Y),r.on("orderpartition_refresh",sktOrderPartFresh)};return A(()=>h.query,()=>{Q()}),Q(),document.title="Resurtido",(t,o)=>(P(),U(Z,{view:"lHh Lpr lFf"},{default:d(()=>[a(J,{bordered:"",class:"transparent text-dark"},{default:d(()=>[a(G,{class:"row justify-between items-center"},{default:d(()=>[de,f("div",ne,[a(b,{color:"pink-5",round:"",unelevated:"",flat:"",icon:"sync",onClick:Q}),f("div",ue,[a(T,{modelValue:g.value,"onUpdate:modelValue":o[0]||(o[0]=l=>g.value=l),options:k,filled:"",dense:""},null,8,["modelValue"]),a(H,{spaced:"",inset:"",vertical:"",dark:""}),a(b,{color:"primary",icon:"event",onClick:o[1]||(o[1]=l=>n.value=!n.value),flat:"",round:""})])])]),_:1})]),_:1}),a(z,{modelValue:n.value,"onUpdate:modelValue":o[4]||(o[4]=l=>n.value=l)},{default:d(()=>[a(X,{class:"my-card"},{default:d(()=>[a(E,null,{default:d(()=>[f("div",ce,[f("div",me,B(s.value.val),1),a(K,{modelValue:s.value.val,"onUpdate:modelValue":o[2]||(o[2]=l=>s.value.val=l),range:"",minimal:""},null,8,["modelValue"])])]),_:1}),a(E,null,{default:d(()=>[a(W,{align:"right"},{default:d(()=>[a(b,{flat:"",icon:"close",color:"negative",onClick:o[3]||(o[3]=l=>n.value=!n.value)}),a(b,{flat:"",icon:"check",color:"positive",onClick:q})]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]),a(ee,null,{default:d(()=>[a(ie,{dash:g.value},null,8,["dash"])]),_:1})]),_:1}))}};export{Ae as default};
