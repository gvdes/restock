import{r as p,c as g,o as u,b as y,w as o,u as pe,a as ve,d as l,h as f,e as r,aD as c,t as n,f as a,aE as V,i as Q,Q as B,aF as T,aG as z,aH as me,aJ as O,au as A,aI as fe,x as _e,R as W}from"./index.116cfe64.js";import{Q as be,a as ge,b as X}from"./QFooter.1d79807d.js";import{c as he,u as ye,R as L,d as xe,q as F,f as ke,b as we,Q as Y,a as P,s as Z,t as ee,v as N,w as H,x,g as Ce,y as te,z as S,A as I,B as le}from"./QCard.86684f4e.js";import{Q as Ve,C as Qe}from"./ClosePopup.2cb46f42.js";import"./dayjs.min.16be2667.js";import"./axios.b18e358a.js";const Pe={class:"q-px-md q-py-sm"},qe={class:"col row justify-between"},De={key:0,class:"row items-center justify-between q-pt-sm"},Ue=a("span",{class:"text--2"},"Por revisar:",-1),je=a("span",{class:"text--2"},"Revisados:",-1),Se=a("span",{class:"text--2"},"Agotados:",-1),Ie=a("span",{class:"text--2"},"Con stock:",-1),Re={class:"row"},$e={class:"col"},Ee=a("div",{class:"text-h6"},"Productos sin revisar",-1),Be={class:"full-width row items-center justify-between"},Te={class:"col"},ze=a("div",{class:"text-h6"},"Productos revisados",-1),Ae={class:"full-width row items-center justify-between"},Le={class:"row justify-between"},Fe={class:"text-left"},Ne={class:"text--3"},He={class:"text-h6"},Ke={class:"text-right"},Me={class:"text-bold"},Ge={class:"text--2"},Je={class:"text-center"},Oe={class:"text-h6"},We=a("div",{class:"text--2"},"PxC",-1),Xe={class:"text-h6"},Ye={class:"text--2"},Ze={class:"row items-start justify-between"},et={class:"text-center col text-primary"},tt=a("div",null,"Solicitud",-1),lt={class:"text-bold"},at={class:"text-center col"},ot=a("div",null,"Conteo",-1),st={class:"text-center col"},it=a("div",null,"PxC",-1),nt={class:"text-center col"},dt=a("div",null,"Piezas",-1),ut={class:"text-bold"},ct=a("div",{class:"q-ml-md"},[a("div",{class:"text-h6"},"Deseas terminar la revision?"),a("div",null,"EL pedido ya no podra editarse")],-1),rt={class:"q-ml-sm"},pt={class:"q-ml-sm"},vt={class:"q-pa-md text-bold text-uppercase text-center"},xt={__name:"Checkout",setup(mt){const q=pe(),ae=ve(),k=ye(),w=p(["code","assocs","ipack","request","uspply","delivery","reqinpzs","checkout"]),v=p([]),_=p(""),R=p(null),K=p(null),b=p(null),d=p({columns:[{name:"id",label:"ID",field:"id",align:"left",coldesc:"Identificador del producto (MySQL)"},{name:"code",label:"Codigo",field:"code",align:"left",coldesc:"Codigo principal del producto"},{name:"assocs",label:"Asociados",field:e=>e.variants.length?e.variants.map(t=>t.barcode).join(", "):null,align:"left",coldesc:"Codigos relacionados al codigo principal"},{name:"bcode",label:"Codigo de Barras",field:"barcode",align:"center",coldesc:"Codigo de barras principal"},{name:"locs",label:"Ubicacion",field:e=>e.locations.length?e.locations.map(t=>t.path).join(", "):"--",align:"left",coldesc:"Ubicaciones en almacen general"},{name:"ipack",label:"PxC",field:e=>typeof e.pivot.ipack=="number"?e.pivot.ipack:e.pieces,align:"center",coldesc:"Unidades x Embalaje"},{name:"request",label:"Solicitud",field:e=>e.pivot.amount,align:"center",coldesc:"Embalaje solicitado"},{name:"uspply",label:"Unidad",field:e=>e.units.id==3?"Cajas":"Piezas",align:"left",coldesc:"Unidad de embalaje del producto"},{name:"delivery",label:"Conteo",field:e=>e.pivot.toDelivered,align:"center",coldesc:"Embalaje surtido",sortable:!0},{name:"reqinpzs",label:"Piezas",field:e=>e.pivot._supply_by==3?(typeof e.pivot.ipack=="number"?e.pivot.ipack:e.pieces)*(typeof e.pivot.ipack=="number"?e.pivot.toDelivered:e.pivot.amount):typeof e.pivot.ipack=="number"?e.pivot.toDelivered:e.pivot.amount,align:"center",coldesc:"Unidades totales en embalaje"},{name:"checkout",label:"Checkout",field:e=>e.pivot.checkout?"OK":null,classes:e=>e.pivot.checkout?"text-positive text-bold":"",align:"center",coldesc:"Revision del Administrador"},{name:"descr",label:"Descripcion",field:"description",align:"left"},{name:"section",label:"Seccion",field:"section",align:"left"},{name:"family",label:"Familia",field:"family",align:"left"},{name:"category",label:"Categoria",field:"category",align:"left"}],filter:"",pagination:{sortBy:"locs",descending:!1,rowsPerPage:20}}),i=p({state:!1,item:null,form:{count:0,ipack:null,setting:!1}}),D=p({state:!1,code:null,text:null}),U=p({state:!1}),M=g(()=>b.value?b.value.id==3:!1),oe=g(()=>v.value.reduce((e,t)=>e+(t.pivot._supply_by==3?t.pivot.amount*t.pieces:t.pivot.amount),0)),$=g(()=>v.value.filter(e=>!e.pivot.checkout)),C=g(()=>v.value.filter(e=>e.pivot.checkout)),se=g(()=>C.value.filter(e=>e.pivot.toDelivered==0)),ie=g(()=>C.value.filter(e=>e.pivot.toDelivered>0)),j=g(()=>{let e=_.value.toUpperCase().trim();return e.length?$.value.filter(t=>t.code.match(e)||t.barcode&&t.barcode.match(e)):$.value}),ne=g(()=>{let e=_.value.toUpperCase().trim();return e.length?C.value.filter(t=>t.code.match(e)||t.barcode&&t.barcode.match(e)):C.value}),E=async()=>{k.loading.show({message:"Cargando..."}),console.log("Iniciando...");const e=await L.order(q.params.oid);console.log(e),e.status==200?(v.value=e.data.products,b.value=e.data.status,k.loading.hide()):displayErrRequest(e)},G=(e,t,s)=>M.value?J(t):null,J=e=>{console.log(e),i.value.item=e,i.value.form.count=typeof e.pivot.toDelivered=="number"?e.pivot.toDelivered:0,i.value.form.ipack=typeof e.pivot.ipack=="number"?e.pivot.ipack:e.pieces,i.value.state=!0,_e(()=>{R.value.focus(),R.value.select()})},de=()=>{let e=_.value.toUpperCase().trim();if(e.length){let t=j.value.length==1?j.value[0]:j.value.find(s=>s.code==e||s.barcode==e);t?J(t):k.notify({message:`Sin coincidencias para <b>${e}</b>`,color:"pink-5",position:"center",html:!0})}},ue=async()=>{const e=parseInt(i.value.form.count),t=parseInt(i.value.form.ipack),s={order:q.params.oid,product:i.value.item.id,delivery:e,ipack:t,checkout:!0},m=await L.setDeliveryProduct(s);if(console.log(m),m.status==200){console.log(m.data);let h=v.value.findIndex(re=>re.id==i.value.item.id);v.value[h].pivot.toDelivered=e,v.value[h].pivot.ipack=t,v.value[h].pivot.checkout=1,i.value.state=!1,_.value="",k.notify({color:"positive",icon:"done",position:"right",message:""})}else alert(`Error ${m.status}: ${m.data}`)},ce=async()=>{k.loading.show({message:"Terminando, espera..."}),U.value.state=!1;let e={id:q.params.oid,state:6};const t=await L.nextState(e);console.log(t),t.status==200&&E(),k.loading.hide()};return E(),(e,t)=>(u(),y(he,{view:"hHh Lpr fFf"},{default:o(()=>[l(ke,{bordered:"",class:"bg-cyan-10"},{default:o(()=>[l(xe,null,{default:o(()=>[l(f,{flat:"",round:"",dense:"",icon:"arrow_back",onClick:t[0]||(t[0]=s=>{r(ae).replace("/checkout")})}),l(be,null,{default:o(()=>[c(" Pedido "+n(r(q).params.oid),1)]),_:1}),l(f,{color:"white",icon:"sync",onClick:E,round:"",dense:"",flat:""})]),_:1}),l(F),a("div",Pe,[a("div",qe,[a("div",null,[c("Productos: "),a("b",null,n(v.value.length),1)]),a("div",null,[c("Piezas: "),a("b",null,n(r(oe)),1)])]),b.value&&b.value.id>=3?(u(),V("div",De,[a("div",null,[Ue,c(),a("b",null,n(r($).length),1)]),a("div",null,[je,c(),a("b",null,n(r(C).length),1)]),a("div",null,[Se,c(),a("b",null,n(r(se).length),1)]),a("div",null,[Ie,c(),a("b",null,n(r(ie).length),1)])])):Q("",!0)])]),_:1}),l(Ce,null,{default:o(()=>[l(we,{padding:""},{default:o(()=>[a("div",Re,[a("div",$e,[Ee,l(Y,{"row-key":"id",flat:"",rows:r(j),columns:d.value.columns,pagination:d.value.pagination,filter:d.value.filter,"visible-columns":w.value,onRowClick:G},{top:o(()=>[a("div",Be,[l(P,{dense:"",modelValue:d.value.filter,"onUpdate:modelValue":t[1]||(t[1]=s=>d.value.filter=s),placeholder:"Buscar","input-class":"text-uppercase",color:"pink-5"},{append:o(()=>[l(B,{name:"search"})]),_:1},8,["modelValue"]),l(f,{color:"secondary",icon:"fas fa-eye","no-caps":""},{default:o(()=>[l(Z,{style:{"min-width":"200px"}},{default:o(()=>[l(ee,null,{default:o(()=>[(u(!0),V(z,null,T(d.value.columns,(s,m)=>A((u(),y(te,{tag:"label",key:m},{default:o(()=>[l(S,null,{default:o(()=>[l(I,null,{default:o(()=>[c(n(s.label),1)]),_:2},1024),l(I,{caption:""},{default:o(()=>[c(n(s.coldesc),1)]),_:2},1024)]),_:2},1024),l(S,{side:"",top:""},{default:o(()=>[l(le,{color:"pink-5",modelValue:w.value,"onUpdate:modelValue":t[2]||(t[2]=h=>w.value=h),val:s.name},null,8,["modelValue","val"])]),_:2},1024)]),_:2},1024)),[[W]])),128))]),_:1})]),_:1})]),_:1})])]),_:1},8,["rows","columns","pagination","filter","visible-columns"])]),l(F,{vertical:""}),a("div",Te,[ze,l(Y,{"row-key":"id",flat:"",rows:r(ne),columns:d.value.columns,pagination:d.value.pagination,filter:d.value.filter,"visible-columns":w.value,onRowClick:G},{top:o(()=>[a("div",Ae,[l(P,{dense:"",modelValue:d.value.filter,"onUpdate:modelValue":t[3]||(t[3]=s=>d.value.filter=s),placeholder:"Buscar","input-class":"text-uppercase",color:"pink-5"},{append:o(()=>[l(B,{name:"search"})]),_:1},8,["modelValue"]),l(f,{color:"secondary",icon:"fas fa-eye","no-caps":""},{default:o(()=>[l(Z,{style:{"min-width":"200px"}},{default:o(()=>[l(ee,null,{default:o(()=>[(u(!0),V(z,null,T(d.value.columns,(s,m)=>A((u(),y(te,{tag:"label",key:m},{default:o(()=>[l(S,null,{default:o(()=>[l(I,null,{default:o(()=>[c(n(s.label),1)]),_:2},1024),l(I,{caption:""},{default:o(()=>[c(n(s.coldesc),1)]),_:2},1024)]),_:2},1024),l(S,{side:"",top:""},{default:o(()=>[l(le,{color:"pink-5",modelValue:w.value,"onUpdate:modelValue":t[4]||(t[4]=h=>w.value=h),val:s.name},null,8,["modelValue","val"])]),_:2},1024)]),_:2},1024)),[[W]])),128))]),_:1})]),_:1})]),_:1})])]),_:1},8,["rows","columns","pagination","filter","visible-columns"])])]),l(N,{modelValue:i.value.state,"onUpdate:modelValue":t[7]||(t[7]=s=>i.value.state=s),position:"bottom",onHide:t[8]||(t[8]=s=>K.value.focus())},{default:o(()=>[i.value.item?(u(),y(H,{key:0},{default:o(()=>[l(x,{class:"bg-grey-3"},{default:o(()=>[a("div",Le,[a("div",Fe,[a("div",Ne,"ID: "+n(i.value.item.id),1),a("div",He,n(i.value.item.code),1)]),a("div",Ke,[a("div",Me,n(i.value.item.name),1),a("div",Ge,n(i.value.item.barcode),1)])])]),_:1}),l(F),l(x,null,{default:o(()=>[c(n(i.value.item.description),1)]),_:1}),l(x,{class:"row justify-around items-center"},{default:o(()=>[a("div",Je,[a("div",Oe,n(i.value.item.pieces),1),We]),(u(!0),V(z,null,T(i.value.item.stocks,s=>(u(),V("div",{key:s.id,class:"text-center"},[a("div",Xe,n(s.pivot.gen),1),a("div",Ye,n(s.alias),1)]))),128))]),_:1}),l(ge,{onSubmit:me(ue,["prevent"])},{default:o(()=>[l(x,null,{default:o(()=>[a("div",Ze,[a("div",et,[tt,a("div",lt,n(i.value.item.pivot.amount)+" "+n(i.value.item.units.id==3?`Caja${i.value.item.pivot.amount!=1?"s":""}`:`Pieza${i.value.item.pivot.amount!=1?"s":""}`),1)]),a("div",at,[ot,l(P,{dense:"",borderless:"",modelValue:i.value.form.count,"onUpdate:modelValue":t[5]||(t[5]=s=>i.value.form.count=s),type:"number",min:"0","input-class":"text-h6 text-center",ref_key:"iptcounter",ref:R},null,8,["modelValue"])]),a("div",st,[it,l(P,{dense:"",borderless:"",modelValue:i.value.form.ipack,"onUpdate:modelValue":t[6]||(t[6]=s=>i.value.form.ipack=s),type:"number","input-class":"text-h6 text-center",readonly:i.value.item.units.id!=3,disable:i.value.item.units.id!=3},null,8,["modelValue","readonly","disable"])]),a("div",nt,[dt,a("div",ut,n(i.value.item.units.id==3?i.value.form.count*i.value.form.ipack:i.value.form.count),1)])])]),_:1}),l(f,{color:"green-5",type:"submit",square:"",icon:"done_all","no-caps":"",class:"q-mt-md q-py-md full-width"})]),_:1},8,["onSubmit"])]),_:1})):Q("",!0)]),_:1},8,["modelValue"]),l(N,{modelValue:U.value.state,"onUpdate:modelValue":t[9]||(t[9]=s=>U.value.state=s)},{default:o(()=>[l(H,null,{default:o(()=>[l(x,{class:"row items-start"},{default:o(()=>[l(O,{icon:"warning",color:"orange-14","text-color":"white"}),ct]),_:1}),l(Ve,{align:"right"},{default:o(()=>[A(l(f,{flat:"",label:"No",color:"primary","no-caps":""},null,512),[[Qe]]),l(f,{flat:"",label:"Si",color:"primary",onClick:ce})]),_:1})]),_:1})]),_:1},8,["modelValue"]),l(N,{modelValue:D.value.state,"onUpdate:modelValue":t[10]||(t[10]=s=>D.value.state=s),persistent:""},{default:o(()=>[l(H,{class:"bg-red text-white"},{default:o(()=>[l(x,{class:"row items-center"},{default:o(()=>[l(O,{icon:"signal_wifi_off",color:"primary","text-color":"white"}),a("span",rt,n(D.value.code),1)]),_:1}),l(x,null,{default:o(()=>[a("span",pt,n(D.value.text),1)]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1}),r(M)?(u(),y(X,{key:0,bordered:"",class:"bg-cyan-10 text-dark q-pa-sm row",elevated:""},{default:o(()=>[l(P,{color:"white",modelValue:_.value,"onUpdate:modelValue":t[12]||(t[12]=s=>_.value=s),type:"text",class:"col","input-class":"text-white text-h6 text-center text-uppercase",autofocus:"",dense:"",onKeypress:fe(de,["enter"]),ref_key:"iptfinder",ref:K},{prepend:o(()=>[l(B,{name:"fas fa-barcode",color:"white"})]),append:o(()=>[l(f,{flat:"",icon:"fas fa-delete-left",color:"white",onClick:t[11]||(t[11]=s=>_.value=""),disabled:!_.value.length},null,8,["disabled"])]),_:1},8,["modelValue","onKeypress"]),r(C).length>0?(u(),y(f,{key:0,color:"white","text-color":"cyan-9",label:"Terminar",icon:"done",onClick:t[13]||(t[13]=s=>U.value.state=!0),"no-caps":""})):Q("",!0)]),_:1})):Q("",!0),b.value&&b.value.id!=3?(u(),y(X,{key:1,bordered:"",class:"bg-orange-9 text-white"},{default:o(()=>[a("div",vt,n(b.value.name),1)]),_:1})):Q("",!0)]),_:1})]),_:1}))}};export{xt as default};
