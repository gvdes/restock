import{r as _,c as P,o as v,aF as E,f as s,d as e,w as t,h as w,aH as j,i as F,e as Q,ax as ae,b as U,aN as Xe,Q as ue,t as u,aE as C,R as Te,u as Ae,a8 as We,aG as te,aJ as Fe,x as et,F as Qe,B as he,E as ke,m as tt,a as Me,aO as at,aP as lt,g as ot}from"./index.2aff58c5.js";import{u as de,o as Y,e as ne,x as ie,y as R,z as oe,v as L,p as _e,q as Ce,Q as ce,a as Ee,A as st,t as ee,s as le,w as we,C as Se,R as B,D as Ue,b as nt,c as it,d as dt,f as rt,g as ct}from"./ClosePopup.6df6d9d9.js";import{d as H}from"./dayjs.min.53a5c0af.js";import{a as ut,Q as pt,b as vt,c as mt,d as ge,e as ft,f as be,g as _t,h as Pe,E as gt,i as qe,u as De}from"./Restock.b27eec06.js";import{A as X}from"./AssistApi.8bc23ce4.js";import{$sktRestock as W}from"./socket.16cd1dbf.js";import"./axios.2cb04522.js";const bt={class:"q-pa-sm bg-grey-2 text-bold row justify-between items-center",style:{"min-width":"250px"}},yt=s("div",null,"Impresion",-1),xt={key:0,class:"row justify-between items-center"},ht={class:"q-mt-sm q-pa-sm"},kt={key:0,class:"q-pa-sm"},Ct={class:"text--3"},wt={class:"q-pa-sm text-right"},Ne={__name:"PrinterSelect",emits:["selected"],setup(D,{emit:h}){const I=de(),g=ut(),r=_(null),f=_(null),b=P(()=>g.printers),c=P(()=>r.value?r.value.printers:[]),M=()=>{I.localStorage.set("LUP",{wkp:r.value,printer:f.value}),h("selected",f.value)},O=I.localStorage.getItem("LUP");return O&&(r.value=O.wkp,f.value=O.printer),($,x)=>(v(),E(j,null,[s("div",bt,[yt,r.value?(v(),E("div",xt,[e(pt,{flat:""},{default:t(()=>[e(w,{flat:"",color:"positive",icon:"add",dense:""}),f.value?(v(),E(j,{key:0},[e(w,{flat:"",color:"negative",icon:"delete",dense:""}),e(w,{flat:"",color:"orange",icon:"edit",dense:""})],64)):F("",!0)]),_:1})])):F("",!0)]),e(Y),s("div",ht,[e(ne,{modelValue:r.value,"onUpdate:modelValue":[x[0]||(x[0]=k=>r.value=k),x[1]||(x[1]=k=>f.value=null)],options:Q(b),label:"Sucursal",filled:"","option-label":"alias","option-value":"id"},null,8,["modelValue","options"])]),r.value?(v(),E("div",kt,[e(ne,{modelValue:f.value,"onUpdate:modelValue":x[2]||(x[2]=k=>f.value=k),options:Q(c),label:"Impresora",filled:"","option-value":"id","option-label":"name"},{option:t(k=>[ae((v(),U(ie,Xe({clickable:""},k.itemProps),{default:t(()=>[e(R,{class:"text-center",side:""},{default:t(()=>[e(ue,{color:"primary","text-color":"white",name:"print",size:"30px"}),s("span",Ct,"ID:"+u(k.opt.id),1)]),_:2},1024),e(R,null,{default:t(()=>[e(oe,null,{default:t(()=>[C(u(k.opt.name),1)]),_:2},1024),e(oe,{caption:"",lines:"2"},{default:t(()=>[C(u(k.opt.ip),1)]),_:2},1024)]),_:2},1024)]),_:2},1040)),[[Te]])]),_:1},8,["modelValue","options"])])):F("",!0),s("div",wt,[r.value&&f.value?(v(),U(w,{key:0,color:"primary",icon:"print",onClick:M})):F("",!0)])],64))}},St=s("div",{class:"text-overline text-grey-7"},"Sucursal",-1),At={class:"text-h6"},Et={class:"q-px-lg text-center"},Dt=s("div",{class:"text-overline text-grey-7"},"Folio",-1),It={class:"text-h6"},$t={class:"text-right"},Ot=s("div",{class:"text-overline text-grey-7"},"Agente",-1),Vt={class:"text-h6"},Rt={class:"text-center"},Lt=s("div",{class:"text-overline text-grey-7"},"Fecha",-1),Ut={class:"text-h6"},Pt={key:0,class:"text-center"},qt=s("div",{class:"text-overline text-grey-7 col"},"Notas",-1),Nt={class:"text-h6"},Tt={class:"flex item-center"},Ft={class:"full-width row items-center"},Qt={class:"col text-dark"},Mt={class:"text-h6"},zt={class:"text-bold"},jt={key:1,class:"text-center q-pa-lg text-h6 text-grey-7"},Bt={class:"q-pa-xs col-xs-12 col-sm-6 col-md-4"},Gt=s("br",null,null,-1),Yt=s("br",null,null,-1),Ht={class:"text-overline text-grey-7"},Jt=s("div",null,"Salida",-1),Zt=s("div",null,"Entrada",-1),Kt=s("div",null,"Herramientas",-1),Xt={class:"row"},Wt={key:0,class:"col"},ea={key:1,class:"col"},ta={key:2,class:"col"},aa=s("canvas",{id:"qrcode"},null,-1),la={class:"text--2"},oa=s("div",{class:"q-ml-md"},[s("div",{class:"text-h6"},"Emitir salida?"),s("div",null,"La salida emitira la factura correspondiente en Factusol.")],-1),sa=s("div",{class:"text-center text-h6"},"Surtidor",-1),na={class:"text-center text-bold text-subtitle2 text-overline"},ia={__name:"OrderViewer",props:{head:{type:Object,default:{}}},emits:["loaded","loading"],setup(D,{emit:h}){const I=D,g=de();Ae();const r=_({opts:[],val:[],filter:[]}),f=_({opts:null,val:null}),b=_(null),c=_(I.head),M=_(!0),O=_([]),$=_("supliers"),x=_(null),k=_([]),J=_(!1),S=_({state:!1}),i=_({state:!1,key:null}),p=_(null),d=_({state:!1}),m=_(null),A=_([]),V=_({columns:[{name:"id",label:"ID",field:"id",align:"left",coldesc:"Identificador del producto (MySQL)"},{name:"code",label:"Codigo",field:"code",align:"left",coldesc:"Codigo principal del producto"},{name:"assocs",label:"Asociados",field:a=>a.variants.length?a.variants.map(o=>o.barcode).join(", "):null,align:"left",coldesc:"Codigos relacionados al codigo principal"},{name:"bcode",label:"Codigo de Barras",field:"barcode",align:"center",coldesc:"Codigo de barras principal"},{name:"locs",label:"Ubicacion",field:a=>a.locations.length?a.locations.map(o=>o.path).join(", "):"--",align:"left",coldesc:"Ubicaciones en almacen general"},{name:"stocks",label:"Stock (pzs)",field:a=>a.stocks.reduce((o,n)=>o+n.pivot.stock,0),sortable:!0,classes:a=>a.stocks.reduce((o,n)=>o+n.pivot.stock,0)<=0?"text-red text-bold":"text-bold text-primary",align:"center",coldesc:"Stock total en almacenes GENERALES (CEDIS+PAN)"},{name:"ipack",label:"PxC",field:a=>typeof a.pivot.ipack=="number"?a.pivot.ipack:a.pieces,align:"center",coldesc:"Unidades x Embalaje"},{name:"request",label:"Solicitud",field:a=>a.pivot.amount,align:"center",coldesc:"Embalaje solicitado"},{name:"uspply",label:"Unidad",field:a=>a.units.id==3?"Cajas":"Piezas",align:"left",coldesc:"Unidad de embalaje del producto"},{name:"delivery",label:"Salida (conteo)",field:a=>a.pivot.toDelivered,align:"center",coldesc:"Embalaje surtido",sortable:!0},{name:"reqinpzs",label:"Piezas",field:a=>a.pivot._supply_by==3?(typeof a.pivot.ipack=="number"?a.pivot.ipack:a.pieces)*(typeof a.pivot.ipack=="number"?a.pivot.toDelivered:a.pivot.amount):typeof a.pivot.ipack=="number"?a.pivot.toDelivered:a.pivot.amount,align:"center",coldesc:"Unidades totales en embalaje"},{name:"checkout",label:"Checkout",field:a=>a.pivot.checkout?"OK":"---",align:"center",classes:a=>a.pivot.checkout?"text-positive text-bold":"text-red",sortable:!0,coldesc:"Revision del Administrador"},{name:"received",label:"Entrada (conteo)",field:a=>a.pivot.toReceived,align:"center",coldesc:"Embalaje recibido"},{name:"descr",label:"Descripcion",field:"description",align:"left"},{name:"section",label:"Seccion",field:"section",align:"left"},{name:"family",label:"Familia",field:"family",align:"left"},{name:"category",label:"Categoria",field:"category",align:"left"}],filter:"",pagination:{sortBy:"locs",descending:!1,rowsPerPage:20}}),G=P(()=>k.value.reduce((a,o)=>a+(o.pivot._supply_by==3?o.pivot.amount*o.pieces:o.pivot.amount),0));P(()=>x.value&&(x.value.id==2||x.value.id==6)),P(()=>O.value.find(a=>a.id==x.value.id).pivot),P(()=>p.value.map(a=>a._status).includes(6));const N=async()=>{h("loading"),M.value=!0;let a=await B.order(c.value.id);if(console.log(a.data),k.value=a.data.products,O.value=a.data.log.map(o=>(o.pivot.details=JSON.parse(o.pivot.details),o)),p.value=a.data.partition,x.value=a.data.status,m.value=a.data.invoice,x.value.id==2){let o=await X.getSupply();console.log(o),r.value.opts=o}M.value=!1,h("loaded")},Z=()=>{d.value.state=!0},pe=async()=>{h("loading"),J.value=!0;let a=3,o={id:c.value.id,state:a};const n=await B.nextState(o);if(n.status==200){J.value=!1,g.notify({message:`Surtido iniciado para el pedido  ${c.value.id}`,icon:"done",position:"center",color:"teal"});let T={supplyer:r.value.val,pedido:c.value.id,status:a},y=await X.SaveSupply(T);console.log(y),y.status==200?(N(),d.value.state=!1):alert(`Error ${y.status}: ${y.data} 2`)}else alert(`Error ${n.status}: ${n.data} 1`);h("loaded")},ze=async()=>{g.loading.show({message:"Generando, espera..."}),S.value.state=!1,console.log(b.value._suplier_id);const a=await B.genInvoice(c.value.id,b.value._suplier_id);if(a.status==200){if(a.data.invoice){g.notify({message:`Se genero la salida <b class="text-h6">${a.data.invoice.folio}</b>`,html:!0,position:"center",icon:"done",timeout:5e3,color:"positive"}),console.log(a.data),i.value.key=a.data.requisition.entry_key,console.log(i.value.key),Ie(a.data.invoice.folio,i.value.key);let o={chofi:f.value.val,supplyer:b.value._suplier_id,pedido:c.value.id,status:7},n=await X.SaveChofi(o);if(n.status==200){let T={id:c.value.id,state:7,suply:b.value._suplier_id};console.log(T);let y=await X.nextState(T);if(console.log(y),y.status==200){N();let K=y.data.id,re=p.value.findIndex(ve=>ve.id==K);p.value[re]._status=y.data._status,p.value[re].invoice=y.data.invoice}g.notify({message:"Pedido en ruta",position:"center",icon:"done",timeout:5e3,color:"positive"})}else alert(`Error ${n.status}: ${n.data}`)}}else alert(`Error ${a.status}: ${a.data}`);g.loading.hide()},je=async a=>{let o=`http://192.168.10.189:2200/#/checkin/${c.value.id}?key=${a}`;i.value.state=!0,et(()=>Pe.toCanvas(document.getElementById("qrcode"),o))},Be=async a=>{g.loading.show({message:"..."}),console.log(a);const o=await B.printKey({ip:a.ip,port:a._port,order:c.value.id});o.status==200?(o.data,g.loading.hide(),g.notify({message:"Impresion correcta",icon:"done",color:"positive",position:"top"})):(console.error(o),alert(`Error ${o.status}: ${o.data}`))},Ge=async a=>{g.loading.show({message:"..."}),console.log(a);const o=await B.printForSupply({ip:a.ip,port:a._port,order:c.value.id});console.log(o),o.status==200?(o.data?g.notify({message:"Impresion correcta",icon:"done",color:"positive",position:"top"}):g.notify({message:`Sin conexion a <b>${a.name} <small>(${a.ip})</small></b>`,icon:"fas fa-bug",color:"negative",position:"center",html:!0,timeout:4e3}),g.loading.hide()):(console.error(o),alert(`Error ${o.status}: ${o.data}`))},Ye=async a=>{b.value=a,S.value.state=!0;let o=await X.getChof();console.log(o),f.value.opts=o.data},He=(a,o,n)=>{o(()=>{if(a==="")r.value.filter=r.value.opts;else{const T=a.toLowerCase();r.value.filter=r.value.opts.filter(y=>y.complete_name.toLowerCase().indexOf(T)>-1)}})},Ie=async(a,o)=>{let n={salida:a};const T=new Date;console.log(n),console.log(o);let y=await X.getSalida(n);if(console.log(y),y.status==200){const re=`http://192.168.10.189:2200/#/checkin/${c.value.id}?key=${o}`,ve={margin:1,width:1,height:1},$e=document.createElement("canvas");await Pe.toCanvas($e,re,ve);const Je=$e.toDataURL("image/png"),l=new gt;let me=[];const fe=y.data.productos.map(se=>Object.values(se)),Ze=Math.ceil(fe.length/20);for(var K=0;K<fe.length;K+=20)me.push(fe.slice(K,K+20));console.log(me);for(let se=0;se<2;se++){let Oe="ORIGINAL";se>0&&(Oe="COPIA",l.addPage()),me.forEach(function(z,Ve){Ve>0&&l.addPage();let Re=0,Le=0;for(let q=0;q<z.length;q++)z[q][1]=z[q][1]==0?1:parseFloat(z[q][1]),z[q][2]=parseFloat(z[q][2]),z[q][3]=parseFloat(z[q][3]),Re+=parseFloat(z[q][1]),Le+=parseFloat(z[q][3]);for(let q=0;q<z.length;q++);l.setFontSize(25),l.setFont("helvetica","bold"),l.text("GRUPO VIZCARRA",105,10,"center"),l.setFontSize(8),l.text("NUMERO PEDIDO:",10,10,"left"),l.text(y.data.salida.FOLIO,10,15,"left"),l.setFontSize(12),l.text(Oe,185,10,"left"),l.text(y.data.salida.CLIENTE,10,25,"left"),l.text("LLUVIA LIGTH SA DE CV",120,25,"left"),l.setFontSize(8),l.text("CALLE AN PABLO 10 LOC G 10",120,30,"left"),l.text("06090",120,35,"left"),l.text("DELEG, CUAUHTEMOC CDMX       CENTRO",120,40,"left"),l.text("LLI1210184G8",120,45,"left"),l.text("HORA DE IMP:",10,50,"left"),l.rect(45,46,15,5),l.text(H(T).format("HH:mm:ss"),47,50),l.text("HR SALIDA M:",61,50,"left"),l.rect(91,46,15,5),l.text("LLEGADA A SUCURSAL:",10,60,"left"),l.rect(45,56,15,5),l.text("SALIDA SUCURSAL:",61,60,"left"),l.rect(91,56,15,5),l.rect(120,51,80,5),l.text("DOCUMENTO",121,55,"left"),l.text("FACTURA",121,60,"left"),l.text("NUMERO",143,55,"left"),l.text(y.data.salida.FACTURA,143,60,"left"),l.text("PAGINA",165,55,"left"),l.text(`${Ve+1} de ${Ze}`,165,60,"left"),l.text("FECHA",185,55,"left");const Ke=H(y.data.salida.FECHA).format("YYYY-MM-DD");l.text(Ke,185,60,"left"),qe(l,{startX:10,startY:65,theme:"plain",styles:{cellPadding:1,fontSize:8,halign:"center"},head:[["CREADOR DOC","ALMACEN","AGENTE","FORMA DE PAGO"]],body:[["APP",y.data.salida.AMACEN,y.data.salida.AGENTE,y.data.salida.FPAGO]]}),qe(l,{startX:10,startY:80,theme:"striped",styles:{cellPadding:.6,fontSize:8,halign:"center"},head:[["ARTICULO","CAJAS","U.X CAJA","CANTIDAD","DESCRIPCION"]],body:z,columnStyles:{0:{fontStyle:"bold",halign:"left"},1:{fontStyle:"bold",halign:"center"},4:{halign:"left"}}}),l.setFontSize(11),l.text("TOTAL CAJAS:",10,200,"left"),l.text(Re.toString(),40,200,"left"),l.text("TOTAL UNIDDADES:",60,200,"left"),l.text(Le.toString(),100,200,"left"),l.setFontSize(8),l.text("Debo(emos) y pagare(mos) incondicionalmente por este pagare a la order de GRUPO VIZCARRA, en la ciudad de Mexico,",10,210,"left"),l.text("la cantidad de el valor recibido a mi(nuestra) entera satisfaccion",10,215,"left"),l.text("Este pagare forma parte de una serie numerica del 1 al y 9 y todos estos estan sujetos a la condicion, de que al no pagarse cualquiera de ellos a su",10,220,"left"),l.text("vencimiento sean exigibles todos los que le sigan en numero, ademas de los ya vencidosm desde la fecha de su vencimiento de el presente documento",10,225,"left"),l.text("hasta el dia de su liquidacion, causaran intereses moratorios al tipo del % mensual en esta ciudad justamente con el principal",10,230,"left"),l.setFontSize(15),l.text("______________",31,248,"center"),l.text("AUTORIZO",20,254,"left"),l.text("______________",85,248,"center"),l.text("CHOFER",75,254,"left"),l.text("______________",140,248,"center"),l.text("RECIBIO",130,254,"left"),l.text("______________",168,248,"left"),l.text("FECHA Y HORA",168,254,"left"),l.setFontSize(9),l.text("UNA VEZ ENTREGADA LA MERCANCIA EN LA FLETERA O DOMICILIO QUE INDIQUE EL CLIENTE ",10,260,"left"),l.text("LLUVIA LIGHT SA DE CV NO ES RESPONSABLE POR PEDIDAS TOTALES, PARCIALES ",10,265,"left"),l.text("O CUALQUIER TIPO DE DANO EN LA MERCANCIA DE ESTE DOCUMENTO ",10,270,"left"),l.setFont("helvetica","bold"),l.setFontSize(12),l.text("NO SE ACEPTAN CAMBIOS NI DEVOLUCIONES",10,280,"left"),l.setFontSize(25),l.setFont("helvetica","bold"),l.text("GRUPO VIZCARRA",105,10,"center"),l.addImage(Je,"PNG",95,25,20,20)})}l.save(y.data.salida.FACTURA)}else console.error("No se logro imprimir la factura")};return We(()=>A.value=V.value.columns.map(a=>a.name)),N(),(a,o)=>(v(),E(j,null,[e(ee,{class:"full-width"},{default:t(()=>[e(L,{class:"row justify-between"},{default:t(()=>[s("div",null,[St,s("div",At,u(c.value.from.alias),1)]),s("div",Et,[Dt,s("div",It,u(c.value.id),1)]),s("div",$t,[Ot,s("div",Vt,u(c.value.created_by.nick),1)])]),_:1}),e(Y),e(L,{class:"row justify-between"},{default:t(()=>[s("div",Rt,[Lt,s("div",Ut,u(Q(H)(c.value.updated_at).format("YYYY-MM-DD")),1)]),c.value.notes?(v(),E("div",Pt,[qt,s("div",Nt,u(c.value.notes),1)])):F("",!0),s("div",Tt,[x.value&&x.value.id==2?(v(),U(w,{key:0,color:"positive",icon:"start",dense:"",label:"Iniciar Surtido",onClick:Z,flat:"",rounded:""})):F("",!0),x.value&&x.value.id>2?(v(),U(w,{key:1,color:"indigo-10",icon:"print",dense:""},{default:t(()=>[e(_e,{class:"bg-grey-1 text-indigo-10",style:{"min-width":"250px"}},{default:t(()=>[e(Ne,{onSelected:Ge})]),_:1})]),_:1})):F("",!0)])]),_:1}),e(Y),M.value?(v(),U(L,{key:0,class:"text-center"},{default:t(()=>[e(vt,{size:"50px",color:"purple"})]),_:1})):(v(),E(j,{key:1},[e(Y),e(mt,{modelValue:$.value,"onUpdate:modelValue":o[0]||(o[0]=n=>$.value=n),class:"text-pink-5",dense:"","no-caps":""},{default:t(()=>[e(ge,{name:"log",label:"Log"}),e(ge,{name:"basket",label:"Productos"}),e(ge,{name:"supliers",label:"Surtidores"})]),_:1},8,["modelValue"]),e(ft,{modelValue:$.value,"onUpdate:modelValue":o[3]||(o[3]=n=>$.value=n),animated:""},{default:t(()=>[e(be,{name:"log"},{default:t(()=>[e(Ce,null,{default:t(()=>[(v(!0),E(j,null,te(O.value,n=>(v(),U(ie,{key:n.id},{default:t(()=>[e(R,{avatar:""},{default:t(()=>[C(u(n.id),1)]),_:2},1024),e(R,null,{default:t(()=>[C(u(n.name),1)]),_:2},1024),e(R,null,{default:t(()=>[C(u(n.pivot.details.responsable),1)]),_:2},1024),e(R,null,{default:t(()=>[C("de "+u(Q(H)(n.pivot.created_at).format("h:mm a"))+" a "+u(Q(H)(n.pivot.updated_at).format("h:mm a")),1)]),_:2},1024)]),_:2},1024))),128))]),_:1})]),_:1}),e(be,{name:"basket"},{default:t(()=>[k.value.length?(v(),U(ce,{key:0,"row-key":"id",flat:"",rows:k.value,columns:V.value.columns,pagination:V.value.pagination,filter:V.value.filter,"visible-columns":A.value},{top:t(()=>[s("div",Ft,[s("div",Qt,[s("span",Mt,[e(w,{color:"pink-5",icon:"sync",onClick:N,round:"",dense:"",flat:""}),C(" Productos: "+u(k.value.length),1)]),C(", "),s("span",zt,"Piezas: "+u(Q(G)),1)]),e(Ee,{dense:"",modelValue:V.value.filter,"onUpdate:modelValue":o[1]||(o[1]=n=>V.value.filter=n),placeholder:"Buscar","input-class":"text-uppercase",color:"pink-5"},{append:t(()=>[e(ue,{name:"search"})]),_:1},8,["modelValue"]),e(w,{color:"secondary",icon:"fas fa-eye","no-caps":""},{default:t(()=>[e(_e,{style:{"min-width":"200px"}},{default:t(()=>[e(Ce,null,{default:t(()=>[(v(!0),E(j,null,te(V.value.columns,(n,T)=>ae((v(),U(ie,{tag:"label",key:T},{default:t(()=>[e(R,null,{default:t(()=>[e(oe,null,{default:t(()=>[C(u(n.label),1)]),_:2},1024),e(oe,{caption:""},{default:t(()=>[C(u(n.coldesc),1)]),_:2},1024)]),_:2},1024),e(R,{side:"",top:""},{default:t(()=>[e(st,{color:"pink-5",modelValue:A.value,"onUpdate:modelValue":o[2]||(o[2]=y=>A.value=y),val:n.name},null,8,["modelValue","val"])]),_:2},1024)]),_:2},1024)),[[Te]])),128))]),_:1})]),_:1})]),_:1})])]),_:1},8,["rows","columns","pagination","filter","visible-columns"])):(v(),E("div",jt,"Nada por aqui"))]),_:1}),e(be,{name:"supliers"},{default:t(()=>[e(ce,{rows:p.value,"row-key":"id",dense:"",flat:"",bordered:"",grid:"","hide-header":""},{item:t(n=>[s("div",Bt,[e(ee,{flat:"",bordered:""},{default:t(()=>[e(L,{class:"text-center"},{default:t(()=>[C(" Surtidor "),Gt,s("strong",null,u(n.row._suplier),1),Yt,s("div",Ht,[e(_t,{color:"primary","text-color":"white",label:n.row.status.name},null,8,["label"])])]),_:2},1024),e(Y),e(L,{class:"flex justify-between"},{default:t(()=>[Jt,Zt,Kt]),_:1}),e(Y),e(L,{class:"flex justify-between"},{default:t(()=>[s("div",null,u(n.row.invoice),1),s("div",null,u(n.row.invoice_received),1),s("div",Xt,[n.row._status==6?(v(),E("div",Wt,[e(w,{color:"pink",label:"Emitir Factura",class:"q-px-xl q-py-xs",size:"10px",padding:"5px 2px","icon-right":"start",flat:"",onClick:T=>Ye(n.row)},null,8,["onClick"])])):F("",!0),n.row._status>=7?(v(),E("div",ea,[e(w,{color:"pink",icon:"qr_code",onClick:T=>je(n.row.entry_key),flat:""},null,8,["onClick"])])):F("",!0),n.row._status>=7?(v(),E("div",ta,[e(w,{color:"pink",icon:"list",onClick:T=>Ie(n.row.invoice,n.row.entry_key),flat:""},null,8,["onClick"])])):F("",!0)])]),_:2},1024)]),_:2},1024)])]),_:1},8,["rows"])]),_:1})]),_:1},8,["modelValue"])],64))]),_:1}),e(le,{modelValue:i.value.state,"onUpdate:modelValue":o[4]||(o[4]=n=>i.value.state=n)},{default:t(()=>[e(ee,null,{default:t(()=>[e(L,{class:"text-h6 text-center"},{default:t(()=>[C(u(c.value.id)+" - "+u(c.value.from.alias),1)]),_:1}),e(Y),e(L,{class:"text-center"},{default:t(()=>[aa,s("div",la,u(i.value.key),1)]),_:1}),e(Y),e(L,{align:"center"},{default:t(()=>[e(w,{color:"indigo-10",icon:"print"},{default:t(()=>[e(_e,null,{default:t(()=>[e(Ne,{onSelected:Be})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]),e(le,{modelValue:S.value.state,"onUpdate:modelValue":o[6]||(o[6]=n=>S.value.state=n)},{default:t(()=>[e(ee,null,{default:t(()=>[e(L,{class:"row items-start"},{default:t(()=>[e(Fe,{icon:"warning",color:"orange-14","text-color":"white"}),oa]),_:1}),e(L,null,{default:t(()=>[s("div",null,[sa,s("div",na,u(b.value._suplier),1)])]),_:1}),b.value?(v(),U(L,{key:0},{default:t(()=>[e(ne,{modelValue:f.value.val,"onUpdate:modelValue":o[5]||(o[5]=n=>f.value.val=n),options:f.value.opts,label:"Chofer",filled:"","option-label":"complete_name"},null,8,["modelValue","options"])]),_:1})):F("",!0),e(we,{align:"right"},{default:t(()=>[ae(e(w,{flat:"",label:"Cancelar",color:"primary","no-caps":""},null,512),[[Se]]),e(w,{flat:"",label:"Continuar",color:"primary",onClick:ze,"no-caps":"",disable:f.value.val==null},null,8,["disable"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),e(le,{modelValue:d.value.state,"onUpdate:modelValue":o[8]||(o[8]=n=>d.value.state=n),persistent:""},{default:t(()=>[e(ee,{style:{width:"400px"}},{default:t(()=>[e(L,{class:"row items-center"},{default:t(()=>[e(ne,{modelValue:r.value.val,"onUpdate:modelValue":o[7]||(o[7]=n=>r.value.val=n),options:r.value.filter,label:"SELECCIONA SURTIDOR","option-label":"complete_name",filled:"",multiple:"",counter:"","max-values":"5",hint:"Maximo 5 colaboradores",style:{width:"100%"},onFilter:He,"input-debounce":"0","use-input":"","use-chips":""},null,8,["modelValue","options"])]),_:1}),e(we,{align:"right"},{default:t(()=>[ae(e(w,{flat:"",label:"Cancel",color:"primary"},null,512),[[Se]]),e(w,{flat:"",label:"Continuar",color:"primary",onClick:pe,disable:r.value.val.length==0},null,8,["disable"])]),_:1})]),_:1})]),_:1},8,["modelValue"])],64))}};var ye=Qe({name:"QTr",props:{props:Object,noHover:Boolean},setup(D,{slots:h}){const I=P(()=>"q-tr"+(D.props===void 0||D.props.header===!0?"":" "+D.props.__trClass)+(D.noHover===!0?" q-tr--no-hover":""));return()=>he("tr",{class:I.value},ke(h.default))}}),xe=Qe({name:"QTd",props:{props:Object,autoWidth:Boolean,noHover:Boolean},setup(D,{slots:h}){const I=tt(),g=P(()=>"q-td"+(D.autoWidth===!0?" q-table--col-auto-width":"")+(D.noHover===!0?" q-td--no-hover":"")+" ");return()=>{if(D.props===void 0)return he("td",{class:g.value},ke(h.default));const r=I.vnode.key,f=(D.props.colsMap!==void 0?D.props.colsMap[r]:null)||D.props.col;if(f===void 0)return;const{row:b}=D.props;return he("td",{class:g.value+f.__tdClass(b),style:f.__tdStyle(b)},ke(h.default))}}});const da={class:"text-h6"},ra={class:"row q-mt-md"},ca={class:"q-ml-sm text-h6"},ua={__name:"TableReport",props:{rows:{type:Array,default:[]},name:{type:String,default:""},type:{type:String,default:""}},emits:["cardResumeActived"],setup(D,{emit:h}){const I=D;De();const g=de(),r=_({state:!1,action:null}),f=_({columns:[{name:"ID",field:"ID",label:"ID",align:"center"},{name:"code",field:"CODIGO",label:"Codigo",align:"center",sortable:!0},{name:"desc",field:"DESCRIPCION",label:"Descripcion",align:"left"},{name:"stockcedis",field:"CEDIS",label:"Stock (CEDIS)",align:"center",sortable:!0},{name:"stockpan",field:"PANTACO",label:"Stock (PAN)",align:"center",sortable:!0}],filter:""}),b={pndcs:{l:"Habilitar todo",c:"indigo-13",desc:"Los productos en esta lista se habilitaran y podran ser solicitados por cuaqluier tienda."},pdss:{l:"Deshabilitar todo",c:"pink-13",desc:"Los productos en esta lista se deshabilitaran y no podran ser solicitados."}},c=_(I.rows),M=_(I.name),O=_(I.type),$=P(()=>O.value?b[O.value]:{l:"",c:""}),x=()=>{const S=b[O.value];r.value.action=S,r.value.state=!0},k=async()=>{g.loading.show({message:"Espera..."});const S=await B.massiveAction({action:O.value});console.log(S),S.status==200?(S.data,r.value.state=!1,r.value.action=null,g.loading.hide(),g.notify({position:"center",color:"positive",icon:"done"}),h("cardResumeActived")):(console.error(S.data),alert(`Error ${S.status}: ${S.data.msg}`))},J=(S,i,p)=>{console.log(S),console.log(i),console.log(p),console.log(O.value)};return(S,i)=>(v(),E(j,null,[e(ce,{"row-key":"ID",rows:c.value,columns:f.value.columns,filter:f.value.filter,onRowClick:J},{top:t(()=>[s("div",da,u(M.value),1),s("div",ra,[e(w,{color:Q($).c,icon:"warning",label:Q($).l,onClick:x},null,8,["color","label"]),e(Ee,{modelValue:f.value.filter,"onUpdate:modelValue":i[0]||(i[0]=p=>f.value.filter=p),dense:"",type:"text",icon:"search",label:"Buscar"},{prepend:t(()=>[e(ue,{name:"search"})]),_:1},8,["modelValue"])])]),_:1},8,["rows","columns","filter"]),e(le,{modelValue:r.value.state,"onUpdate:modelValue":i[1]||(i[1]=p=>r.value.state=p),persistent:""},{default:t(()=>[e(ee,null,{default:t(()=>[e(L,{class:"row items-center"},{default:t(()=>[e(Fe,{icon:"warning",color:r.value.action.c,"text-color":"white"},null,8,["color"]),s("span",ca,u(r.value.action.l),1)]),_:1}),e(L,null,{default:t(()=>[C(u(r.value.action.desc),1)]),_:1}),e(we,{align:"right"},{default:t(()=>[ae(e(w,{flat:"",label:"cancelar",color:"primary"},null,512),[[Se]]),e(w,{flat:"",label:"continuar",color:"primary",onClick:k})]),_:1})]),_:1})]),_:1},8,["modelValue"])],64))}},pa={key:0,class:"bg-negative text-white q-pa-md q-mb-md"},va=s("div",{class:"text-warning text-bold"},"Los siguientes folios tienen errores que no permiten ser listados en la tabla. ",-1),ma={class:"text-h6"},fa=s("div",{class:"text--2"},"Errores comunes: Sin log, Sin fecha, Estatus desconocido",-1),_a={class:"row q-mb-md items-start justify-around"},ga={class:"text-left"},ba={class:"text-h5"},ya={class:"text--2"},xa={class:"full-width row items-center"},ha={class:"col text-h6 text-dark"},ka={__name:"AdminDashboard",emits:["reloadDashboard"],setup(D,{emit:h}){Ae(),Me();const I=De(),g=de(),r=["text-grey-5 text-bold","text-bold text-h6 text-red","text-indigo","4","5","text-bold text-pink-7","text-orange-8","8","text-primary","text-positive"],f=_({columns:[{name:"id",label:"Folio",field:"id",align:"center",sortable:!0},{name:"state",label:"Estado",field:i=>i.log.length==1?i.log[0].name:i.log[i.log.length-1].name,align:"left",sortable:!0,sort:(i,p,d,m)=>parseInt(d._status)-parseInt(m._status),classes:i=>r[i._status?parseInt(i._status)-1:parseInt(i.status.id)-1]},{name:"suplier",label:"Surtidores",field:i=>{var p;return(p=i.partition)==null?void 0:p.length},align:"center",classes:"text-bold"},{name:"laststate",label:"Ultima actividad",field:i=>H(i.log.find(p=>p.id==i.status.id).pivot.updated_at).format("YYYY-MM-DD hh:mm A"),align:"left"},{name:"from",label:"Sucursal",field:i=>i.from.name.toUpperCase(),align:"left",sortable:!0},{name:"to",label:"Destino",field:i=>i.to.name.toUpperCase(),align:"left",sortable:!0},{name:"notes",label:"Notas",field:i=>i.notes,align:"left",classes:i=>i.notes?"text-orange text-bold":""},{name:"tmodels",label:"Modelos",field:i=>i.products_count,align:"center",sortable:!0}],filter:"",pagination:{sortBy:"desc",descending:!1,rowsPerPage:20}}),b=_({state:!1,title:"",data:null,name:null,type:null}),c=_({state:!1,head:null,block:!0}),M=P(()=>I.ordersSize),O=P(()=>I.ordersok),$=P(()=>I.orderserrors),x=P(()=>I.resume),k=async i=>{console.log(i.row),c.value.head=i.row,c.value.state=!0},J=async i=>{g.loading.show({message:"cargando..."+i});const p=await B.report(i);console.log(p.data),b.value.data=p.data.rows,b.value.name=p.data.name,b.value.type=i,b.value.state=!0,g.loading.hide()},S=()=>{b.value.state=!1,b.state=!1,h("reload")};return(i,p)=>(v(),U(nt,{padding:"",class:"bg-grey-2"},{default:t(()=>[Q($).length?(v(),E("div",pa,[va,s("div",ma,u(Q($).map(d=>d.id).join("id")),1),fa])):F("",!0),s("div",_a,[(v(!0),E(j,null,te(Q(x),d=>(v(),U(w,{stack:"","no-caps":"",class:"q-py-md",key:d.key,onClick:m=>J(d.key),color:d.total==0?"teal-10":"pink-13",disabled:d.total==0},{default:t(()=>[s("div",ga,[s("div",ba,u(d.total),1),s("div",ya,u(d.name),1)])]),_:2},1032,["onClick","color","disabled"]))),128))]),e(ce,{flat:"",bordered:"","row-key":"id",rows:Q(O),columns:f.value.columns,filter:f.value.filter,pagination:f.value.pagination},{header:t(d=>[e(ye,{props:d},{default:t(()=>[e(Ue,{"auto-width":""}),(v(!0),E(j,null,te(d.cols,m=>(v(),U(Ue,{key:m.name,props:d},{default:t(()=>[C(u(m.label),1)]),_:2},1032,["props"]))),128))]),_:2},1032,["props"])]),body:t(d=>[e(ye,{props:d},{default:t(()=>[e(xe,{"auto-width":""},{default:t(()=>[e(w,{size:"sm",dense:"",round:"",flat:"",onClick:m=>d.expand=!d.expand,icon:d.expand?"expand_less":"expand_more"},null,8,["onClick","icon"])]),_:2},1024),(v(!0),E(j,null,te(d.cols,m=>(v(),U(xe,{key:m.name,props:d,onClick:A=>k(d)},{default:t(()=>[C(u(m.value),1)]),_:2},1032,["props","onClick"]))),128))]),_:2},1032,["props"]),ae(e(ye,{props:d},{default:t(()=>[e(xe,{colspan:"100%"},{default:t(()=>[e(Ce,{dense:"",padding:"",class:"rounded-borders"},{default:t(()=>[e(ie,null,{default:t(()=>[e(R,null,{default:t(()=>[C("ID")]),_:1}),e(R,null,{default:t(()=>[C("ESTADO")]),_:1}),e(R,null,{default:t(()=>[C(" SALIDA")]),_:1}),e(R,null,{default:t(()=>[C("ENTRADA")]),_:1})]),_:1}),(v(!0),E(j,null,te(d.row.partition,(m,A)=>(v(),E("div",{key:A},[e(ie,null,{default:t(()=>[e(R,null,{default:t(()=>[e(oe,{overline:""},{default:t(()=>[C(u(m._suplier),1)]),_:2},1024),e(oe,{caption:""},{default:t(()=>[C(u(m.id),1)]),_:2},1024)]),_:2},1024),e(R,{class:at(`${r[m.status.id-1]}`)},{default:t(()=>[C(u(m.status.name),1)]),_:2},1032,["class"]),e(R,null,{default:t(()=>[C(u(m.invoice),1)]),_:2},1024),e(R,null,{default:t(()=>[C(u(m.invoice_received),1)]),_:2},1024)]),_:2},1024),e(Y,{spaced:"",inset:""})]))),128))]),_:2},1024)]),_:2},1024)]),_:2},1032,["props"]),[[lt,d.expand]])]),top:t(()=>[s("div",xa,[s("div",ha,"Pedidos: "+u(Q(M)),1),e(Ee,{dense:"",modelValue:f.value.filter,"onUpdate:modelValue":p[0]||(p[0]=d=>f.value.filter=d),"input-class":"text-uppercase",placeholder:"Buscar",color:"pink-5"},{append:t(()=>[e(ue,{name:"search"})]),_:1},8,["modelValue"])])]),_:1},8,["rows","columns","filter","pagination"]),e(le,{"full-width":"",modelValue:c.value.state,"onUpdate:modelValue":p[3]||(p[3]=d=>c.value.state=d),persistent:c.value.block,"no-esc-dismiss":c.value.block,"no-backdrop-dismiss":c.value.block},{default:t(()=>[e(ia,{head:c.value.head,onLoaded:p[1]||(p[1]=d=>c.value.block=!1),onLoading:p[2]||(p[2]=d=>c.value.block=!0)},null,8,["head"])]),_:1},8,["modelValue","persistent","no-esc-dismiss","no-backdrop-dismiss"]),e(le,{modelValue:b.value.state,"onUpdate:modelValue":p[4]||(p[4]=d=>b.value.state=d)},{default:t(()=>[e(ua,{rows:b.value.data,name:b.value.name,type:b.value.type,onCardResumeActived:S},null,8,["rows","name","type"])]),_:1},8,["modelValue"])]),_:1}))}};const Ca=s("div",{class:"text-bold"},"Dashboard ",-1),wa={class:"row"},Sa={class:"col row"},Ra={__name:"DashboardLyt",setup(D){const h=Ae(),I=Me(),g=De(),r=de(),f={profile:{me:{id:1,nick:"root",picture:"",names:"Restock",surname_pat:"Master",surname_mat:"Dashboard",change_password:!1,_rol:1},workpoint:{id:1,name:"CEDIS San Pablo",alias:"CEDISSAP",dominio:"192.168.10.53:1619",_client:359,active:1,_port:"1619"}},workpoint:{id:1,name:"CEDIS San Pablo",alias:"CEDISSAP",dominio:"192.168.10.53:1619",_client:359,active:1,_port:"1619"},room:"admin"},b=_([{id:0,alias:"Todas"},{id:1,alias:"CEDIS",_state:1},{id:2,alias:"SP1",_state:1}]),c=_([{id:"day",label:"Hoy"},{id:"week",label:"Semana"},{id:"month",label:"Mes"},{id:"C",label:"otra ...",disable:!0}]),M=["p2","P2","p3","P3","bol","BOL","sap","SAP"],O=_(null),$=_(null),x=_({from:H(Date.now()).startOf("day"),to:H(Date.now()).startOf("day")}),k=async()=>{var Z;r.loading.show({message:"Cargado vista..."}),console.log("%cIniciando MainLayout...","font-size:2em;color:orange;");let m=(Z=h.query.v)!=null?Z:"day",A=c.value.findIndex(pe=>pe.id==m),V=A>=0?A:0;$.value=c.value[V],x.value.from=H(Date.now()).startOf($.value.id);let G=h.query.d&&M.includes(h.query.d)?h.query.d:"all";console.log(G);const N=await B.index($.value.id,G);console.log(N),g.fillOrders(N.orders),g.fillResume(N.resume),g.fillPrinters(N.printers),O.value=b.value[0],console.log("%cMainLayout listo!!","font-size:2em;color:orange;"),r.loading.hide(),W.connect(),W.emit("joinat",f),W.on("joineddashreq",S),W.on("creating",i),W.on("order_update",p),W.on("order_changestate",d)},J=m=>{let A=h.query.d&&M.includes(h.query.d)?h.query.d:"all";I.push(`/dashboard?v=${m.id}&d=${A}`)};P(()=>x.value.from.format("YYYY/MM/DD")),P(()=>x.value.to.format("YYYY/MM/DD"));const S=m=>{console.log(`%c${m.user.me.nick} de ${m.from.alias} se ha unido a Restock (UID: ${m.user.me.id})`,"background:#076F3E;color:#f5f6fa;border-radius:10px;padding:10px;font-size:1.1em;")},i=async m=>{let A=m.order,V=await B.orderFresh(A.id),G=V.data.order,N=V.data.oid;g.addOrUpdate(N,G)},p=m=>{g.orderUpdate(m)},d=async m=>{let A=m.order,V=m.state,G=await B.orderFresh(A.id),N=G.data.order,Z=G.data.oid;g.addOrUpdate(Z,N),V.id==2&&r.notify({message:`El pedido <b>${A.id}</b> esta listo para iniciar surtido!!`,color:"positive",textColor:"white",position:"bottom",html:!0,timeout:5e3})};return ot(()=>h.query,()=>{k()}),k(),document.title="Dashboard",(m,A)=>(v(),U(it,{view:"lHh Lpr lFf"},{default:t(()=>[e(rt,{bordered:"",class:"bg-yellow text-dark"},{default:t(()=>[e(dt,{class:"row justify-between items-center"},{default:t(()=>[Ca,s("div",wa,[e(w,{color:"dark",round:"",unelevated:"",flat:"",icon:"sync",onClick:k}),s("div",Sa,[e(ne,{class:"col",dense:"",filled:"",label:"Vista",modelValue:$.value,"onUpdate:modelValue":[A[0]||(A[0]=V=>$.value=V),J],options:c.value},null,8,["modelValue","options"]),$.value.id=="C"?(v(),U(w,{key:0,unelevated:"",color:"pink-5",icon:"fas fa-calendar-day",dense:""})):F("",!0)])])]),_:1})]),_:1}),e(ct,null,{default:t(()=>[e(ka,{onReload:k})]),_:1})]),_:1}))}};export{Ra as default};
