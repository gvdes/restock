import{Q as L,a as v}from"./QTd.3007aac3.js";import{r,c as $,a as J,d as O,w as s,ar as W,h as _,e as a,g as k,t as m,Q as f,u as F,j as H}from"./index.46b313ec.js";import{Q as V}from"./QTable.e38e3ee7.js";import{u as M,Q as x,a as P}from"./use-quasar.833708d0.js";import{Q as S,a as w}from"./QCard.0fb728b6.js";import{Q as h}from"./QInput.505e0cd7.js";import{Q as G}from"./QCardActions.89482656.js";import{Q as K}from"./QSpace.91c31192.js";import{Q as X,a as C}from"./QPage.3b7255b1.js";import"./axios.10c2b4ae.js";import{R as Q}from"./RestockApi.75260ed3.js";import{E as Y}from"./exceljs.min.9e24d01d.js";import"./QList.76a12b05.js";import"./QItem.b548151d.js";import"./use-key-composition.7bdc05bb.js";import"./uid.42677368.js";import"./format.02636e7a.js";import"./rtl.8056f98d.js";import"./use-timeout.794c468a.js";import"./_commonjsHelpers.88e99c8f.js";const Z=_("div",{class:"text-bold"},"Notas",-1),ee={class:"col-2 q-table__title q-mr-xl"},ae={class:"text-overline"},Qe={__name:"Texcoco",setup(le){const d=M();W();const n=r({state:!1,val:null}),u=r({columns:[{name:"code",label:"Codigo",align:"left",field:e=>e.code},{name:"shortcode",label:"Codigo Corto",align:"left",field:e=>e.name},{name:"section",label:"Seccion",align:"left",field:e=>e.categories.familia.seccion.name},{name:"family",label:"Familia",align:"left",field:e=>e.categories.familia.name},{name:"category",label:"Categoria",align:"left",field:e=>e.categories.name},{name:"description",label:"Descripcion",align:"left",field:e=>e.description},{name:"supplyby",label:"Surtir por ",align:"left",field:e=>e.pivot._supply_by==1?"Pieza":e.pivot._supply_by==3?"Caja":"Docena"},{name:"amount",label:"Cantidad",align:"left",field:e=>e.pivot.amount},{name:"piezas",label:"Cantidad en Piezas",field:e=>e.pivot.units}],filter:""}),b=r([]),D=r({opts:["Mochila","Juguete","Papeleria","Paraguas","Accesorios","Calculadora","Peluche","Transporte","Electronicos","Navidad","Sin categor\xEDa","Hogar","Sistema","Detalles"]}),g=r(!1),c=r(!1);r("");const y=r(null),U=r({cols:[{name:"id",label:"ID",align:"center"},{name:"alias",label:"ALIAS",align:"center"},{name:"name",label:"SUCURSAL",align:"left"},{name:"actions",label:"Actions",align:"left"}]}),i=r({cats:[],_workpoint_from:null,_workpoint_to:null,_type:2,notes:null}),E=$(()=>i.value.cats.length>0&&i.value._workpoint_to),A=async()=>{d.loading.show({message:"Obteniendo Sucursales"});const e=await Q.cedis();e.status==200?(console.log(e.data),b.value=e.data,d.loading.hide()):alert("Problemas con la obtencion de datos")},R=e=>{c.value=!0,y.value=e},T=async e=>{g.value=!0,d.loading.show({message:"Creando Pedido"});let t={cats:i.value.cats.map(o=>"'"+o+"'").join(),_workpoint_from:y.value,_workpoint_to:i.value._workpoint_to.id,_type:2,notes:i.value.notes};console.log(t);const l=await Q.createAutomate(t);l.status==200?(console.log(l.data),g.value=!1,d.loading.hide(),d.notify({type:"positive",message:`Pedido ${l.data.order.id} creado`,position:"center"}),n.value.state=!0,n.value.val=l.data.order,i.value={cats:[],_workpoint_from:null,_workpoint_to:null,_type:2,notes:null},c.value=!1):alert("Nosegeneroelpedido")},N=e=>e.id==y.value,B=()=>{i.value={cats:[],_workpoint_from:null,_workpoint_to:null,_type:2,notes:null},c.value=!1},j=async()=>{const e=new Y.Workbook,t=e.addWorksheet("Comparativo");t.addRow(u.value.columns.map(o=>o.label)),n.value.val.products.forEach(o=>{t.addRow([o.code,o.name,o.categories.familia.seccion.name,o.categories.familia.name,o.categories.name,o.description,o.pivot._supply_by==1?"Pieza":o.pivot._supply_by==3?"Caja":"Docena",o.pivot.amount,o.pivot.units])}),(async()=>{const o=await e.xlsx.writeBuffer(),z=new Blob([o],{type:"application/octet-stream"}),I=URL.createObjectURL(z),p=document.createElement("a");p.href=I,p.download=`Pedido${n.value.val.id}.xlsx`,document.body.appendChild(p),p.click(),document.body.removeChild(p)})()},q=async()=>{const e=await Q.nextStep({id:n.value.val.id});console.log(e),e.status==200?(console.log(e),d.notify({message:"Pedido Enviado :)",type:"positive",position:"center"}),n.value={state:!1,val:null}):alert("Problema con el envio de el pedido ")};return A(),(e,t)=>(J(),O(X,{padding:""},{default:s(()=>[_("div",null,[a(V,{title:"Sucursales",rows:b.value,"row-key":"id",columns:U.value.cols,pagination:{rowsPerPage:20}},{body:s(l=>[a(L,{props:l},{default:s(()=>[a(v,{key:"id",props:l},{default:s(()=>[k(m(l.row.id),1)]),_:2},1032,["props"]),a(v,{key:"alias",props:l},{default:s(()=>[k(m(l.row.alias),1)]),_:2},1032,["props"]),a(v,{key:"name",props:l},{default:s(()=>[k(m(l.row.name),1)]),_:2},1032,["props"]),a(v,{key:"actions",props:l},{default:s(()=>[a(f,{flat:"",rounded:"","icon-right":"arrow_circle_right",label:"Crear Pedido",color:"primary",onClick:o=>R(l.row.id),disable:g.value},null,8,["onClick","disable"])]),_:2},1032,["props"])]),_:2},1032,["props"])]),_:1},8,["rows","columns"]),a(P,{modelValue:c.value,"onUpdate:modelValue":t[3]||(t[3]=l=>c.value=l),persistent:""},{default:s(()=>[a(S,{style:{"min-width":"350px"}},{default:s(()=>[a(w,null,{default:s(()=>[a(x,{modelValue:i.value.cats,"onUpdate:modelValue":t[0]||(t[0]=l=>i.value.cats=l),options:D.value.opts,label:"Seccion",filled:"",multiple:"","use-chips":""},null,8,["modelValue","options"])]),_:1}),a(w,null,{default:s(()=>[a(x,{modelValue:i.value._workpoint_to,"onUpdate:modelValue":t[1]||(t[1]=l=>i.value._workpoint_to=l),options:b.value,label:"Destino","option-label":"name",filled:"","option-disable":l=>N(l)},null,8,["modelValue","options","option-disable"])]),_:1}),a(w,{class:"q-pt-none"},{default:s(()=>[Z,a(h,{dense:"",modelValue:i.value.notes,"onUpdate:modelValue":t[2]||(t[2]=l=>i.value.notes=l),autofocus:""},null,8,["modelValue"])]),_:1}),a(G,{align:"right",class:"text-primary"},{default:s(()=>[a(f,{flat:"",label:"Cancel",onClick:B}),a(f,{flat:"",label:"Continuar",onClick:T,disable:!F(E)},null,8,["disable"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),a(P,{modelValue:n.value.state,"onUpdate:modelValue":t[5]||(t[5]=l=>n.value.state=l),"full-width":""},{default:s(()=>[a(S,null,{default:s(()=>[a(V,{rows:n.value.val.products,columns:u.value.columns,filter:u.value.filter},{top:s(l=>[_("div",ee,"Pedido : "+m(n.value.val.id),1),_("div",ae,"Notas : "+m(n.value.val.notes),1),a(K),a(C,{spaced:"",inset:"",vertical:""}),a(f,{color:"primary",icon:"send",onClick:q,flat:"",round:"",title:"Enviar Pedido"}),a(C,{spaced:"",inset:"",vertical:""}),a(f,{color:"primary",icon:"download",onClick:j,flat:"",round:"",title:"Descargar"}),a(C,{spaced:"",inset:"",vertical:""}),a(h,{borderless:"",dense:"",debounce:"300",modelValue:u.value.filter,"onUpdate:modelValue":t[4]||(t[4]=o=>u.value.filter=o),placeholder:"Search"},{append:s(()=>[a(H,{name:"search"})]),_:1},8,["modelValue"])]),_:1},8,["rows","columns","filter"])]),_:1})]),_:1},8,["modelValue"])])]),_:1}))}};export{Qe as default};
