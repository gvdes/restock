import{r as m,c as O,o as v,aF as C,f as s,d as e,w as t,h,aH as H,i as B,e as F,ax as Z,b as U,aN as je,Q as oe,t as c,aE as y,R as De,u as we,a8 as Fe,aG as te,aJ as he,x as ze,F as qe,B as ye,E as xe,m as Be,a as Ee,aO as Te,aP as Me,g as Ne}from"./index.f71dd59b.js";import{u as de,o as Y,e as se,x as ne,y as A,z as le,v as I,p as me,q as ke,Q as ie,a as Ce,A as Ye,t as W,s as X,w as ce,C as pe,R as T,D as Ve,b as He,c as Ge,d as Ke,f as Je,g as We}from"./ClosePopup.004aec16.js";import{d as ee}from"./dayjs.min.53a5c0af.js";import{a as Xe,Q as Ze,b as et,c as tt,d as fe,e as lt,f as _e,g as at,u as Se}from"./Restock.90e947d6.js";import{A as ae}from"./AssistApi.ff1bf221.js";import{b as ot}from"./jspdf.plugin.autotable.ad50246c.js";import{p as st}from"./pdfCreate.e6de7d83.js";import{$sktRestock as K,usrSkt as nt}from"./socket.66d9ef78.js";import"./axios.e009800f.js";const it={class:"q-pa-sm bg-grey-2 text-bold row justify-between items-center",style:{"min-width":"250px"}},dt=s("div",null,"Impresion",-1),rt={key:0,class:"row justify-between items-center"},ut={class:"q-mt-sm q-pa-sm"},ct={key:0,class:"q-pa-sm"},pt={class:"text--3"},vt={class:"q-pa-sm text-right"},$e={__name:"PrinterSelect",emits:["selected"],setup(S,{emit:g}){const k=de(),f=Xe(),u=m(null),p=m(null),V=O(()=>f.printers),d=O(()=>u.value?u.value.printers:[]),w=()=>{k.localStorage.set("LUP",{wkp:u.value,printer:p.value}),g("selected",p.value)},Q=k.localStorage.getItem("LUP");return Q&&(u.value=Q.wkp,p.value=Q.printer),(P,$)=>(v(),C(H,null,[s("div",it,[dt,u.value?(v(),C("div",rt,[e(Ze,{flat:""},{default:t(()=>[e(h,{flat:"",color:"positive",icon:"add",dense:""}),p.value?(v(),C(H,{key:0},[e(h,{flat:"",color:"negative",icon:"delete",dense:""}),e(h,{flat:"",color:"orange",icon:"edit",dense:""})],64)):B("",!0)]),_:1})])):B("",!0)]),e(Y),s("div",ut,[e(se,{modelValue:u.value,"onUpdate:modelValue":[$[0]||($[0]=_=>u.value=_),$[1]||($[1]=_=>p.value=null)],options:F(V),label:"Sucursal",filled:"","option-label":"alias","option-value":"id"},null,8,["modelValue","options"])]),u.value?(v(),C("div",ct,[e(se,{modelValue:p.value,"onUpdate:modelValue":$[2]||($[2]=_=>p.value=_),options:F(d),label:"Impresora",filled:"","option-value":"id","option-label":"name"},{option:t(_=>[Z((v(),U(ne,je({clickable:""},_.itemProps),{default:t(()=>[e(A,{class:"text-center",side:""},{default:t(()=>[e(oe,{color:"primary","text-color":"white",name:"print",size:"30px"}),s("span",pt,"ID:"+c(_.opt.id),1)]),_:2},1024),e(A,null,{default:t(()=>[e(le,null,{default:t(()=>[y(c(_.opt.name),1)]),_:2},1024),e(le,{caption:"",lines:"2"},{default:t(()=>[y(c(_.opt.ip),1)]),_:2},1024)]),_:2},1024)]),_:2},1040)),[[De]])]),_:1},8,["modelValue","options"])])):B("",!0),s("div",vt,[u.value&&p.value?(v(),U(h,{key:0,color:"primary",icon:"print",onClick:w})):B("",!0)])],64))}},mt=s("div",{class:"text-overline text-grey-7"},"Sucursal",-1),ft={class:"text-h6"},_t={class:"q-px-lg text-center"},gt=s("div",{class:"text-overline text-grey-7"},"Folio",-1),bt={class:"text-h6"},ht={class:"text-right"},yt=s("div",{class:"text-overline text-grey-7"},"Agente",-1),xt={class:"text-h6"},kt={class:"text-center"},wt=s("div",{class:"text-overline text-grey-7"},"Fecha",-1),Ct={class:"text-h6"},St={key:0,class:"text-center"},Vt=s("div",{class:"text-overline text-grey-7 col"},"Notas",-1),$t={class:"text-h6"},Dt={class:"text-center"},qt={class:"text-overline text-grey-7"},Et={class:"text-h6"},It={class:"full-width row items-center"},Qt={class:"col text-dark"},Pt={class:"text-h6"},Ut={class:"text-bold"},At={key:1,class:"text-center q-pa-lg text-h6 text-grey-7"},Ot={class:"q-pa-xs col-xs-12 col-sm-6 col-md-4"},Rt=s("br",null,null,-1),Lt=s("br",null,null,-1),jt={class:"text-overline text-grey-7"},Ft=s("div",null,"Salida",-1),zt=s("div",null,"Entrada",-1),Bt=s("div",null,"Herramientas",-1),Tt={class:"row"},Mt={key:0,class:"col"},Nt={key:1,class:"col"},Yt={key:2,class:"col"},Ht=s("canvas",{id:"qrcode"},null,-1),Gt={class:"text--2"},Kt=s("div",{class:"q-ml-md"},[s("div",{class:"text-h6"},"Cambiar a En Camino?"),s("div",null,"Cambiara a estatus en camino")],-1),Jt=s("div",{class:"text-center text-h6"},"Surtidor",-1),Wt={class:"text-center text-bold text-subtitle2 text-overline"},Xt=s("div",{class:"q-ml-sm text-bold"},"Estas a punto de cancelar el pedido ",-1),Zt={class:"q-ml-sm text-bold"},el={__name:"OrderViewer",props:{head:{type:Object,default:{}}},emits:["loaded","loading","fresh","chofiAssigned"],setup(S,{emit:g}){const k=S,f=de();we();const u=m({opts:[],val:[],filter:[]}),p=m({opts:null,val:null,filter:null}),V=m(null),d=m(k.head),w=m(null),Q=m(!0),P=m([]),$=m("supliers"),_=m(null),M=m([]),q=m(!1),R=m({state:!1}),z=m({state:!1,key:null}),N=m(null),J=m(!1),i=m({state:!1}),b=m(null),o=m([]),r=m({columns:[{name:"id",label:"ID",field:"id",align:"left",coldesc:"Identificador del producto (MySQL)"},{name:"code",label:"Codigo",field:"code",align:"left",coldesc:"Codigo principal del producto"},{name:"assocs",label:"Asociados",field:l=>l.variants.length?l.variants.map(a=>a.barcode).join(", "):null,align:"left",coldesc:"Codigos relacionados al codigo principal"},{name:"bcode",label:"Codigo de Barras",field:"barcode",align:"center",coldesc:"Codigo de barras principal"},{name:"locs",label:"Ubicacion",field:l=>l.locations.length?l.locations.map(a=>a.path).join(", "):"--",align:"left",coldesc:"Ubicaciones en almacen general"},{name:"stocks",label:"Stock (pzs)",field:l=>l.stocks.reduce((a,n)=>a+n.pivot.stock,0),sortable:!0,classes:l=>l.stocks.reduce((a,n)=>a+n.pivot.stock,0)<=0?"text-red text-bold":"text-bold text-primary",align:"center",coldesc:"Stock total en almacenes GENERALES (CEDIS+PAN)"},{name:"ipack",label:"PxC",field:l=>typeof l.pivot.ipack=="number"?l.pivot.ipack:l.pieces,align:"center",coldesc:"Unidades x Embalaje"},{name:"request",label:"Solicitud",field:l=>l.pivot.amount,align:"center",coldesc:"Embalaje solicitado"},{name:"uspply",label:"Unidad",field:l=>l.units.id==3?"Cajas":"Piezas",align:"left",coldesc:"Unidad de embalaje del producto"},{name:"delivery",label:"Salida (conteo)",field:l=>l.pivot.toDelivered,align:"center",coldesc:"Embalaje surtido",sortable:!0},{name:"reqinpzs",label:"Piezas",field:l=>l.pivot._supply_by==3?(typeof l.pivot.ipack=="number"?l.pivot.ipack:l.pieces)*(typeof l.pivot.ipack=="number"?l.pivot.toDelivered:l.pivot.amount):typeof l.pivot.ipack=="number"?l.pivot.toDelivered:l.pivot.amount,align:"center",coldesc:"Unidades totales en embalaje"},{name:"checkout",label:"Checkout",field:l=>l.pivot.checkout?"OK":"---",align:"center",classes:l=>l.pivot.checkout?"text-positive text-bold":"text-red",sortable:!0,coldesc:"Revision del Administrador"},{name:"received",label:"Entrada (conteo)",field:l=>l.pivot.toReceived,align:"center",coldesc:"Embalaje recibido"},{name:"descr",label:"Descripcion",field:"description",align:"left"},{name:"section",label:"Seccion",field:"section",align:"left"},{name:"family",label:"Familia",field:"family",align:"left"},{name:"category",label:"Categoria",field:"category",align:"left"}],filter:"",pagination:{sortBy:"locs",descending:!1,rowsPerPage:20}}),x=O(()=>M.value.reduce((l,a)=>l+(a.pivot._supply_by==3?a.pivot.amount*a.pieces:a.pivot.amount),0));O(()=>_.value&&(_.value.id==2||_.value.id==6)),O(()=>P.value.find(l=>l.id==_.value.id).pivot),O(()=>N.value.map(l=>l._status).includes(6));const D=async()=>{g("loading"),Q.value=!0;let l=await T.order(d.value.id);if(console.log(l.data),M.value=l.data.products,P.value=l.data.log.map(a=>(a.pivot.details=JSON.parse(a.pivot.details),a)),N.value=l.data.partition,_.value=l.data.status,w.value=l.data,b.value=l.data.invoice,_.value.id==2){let a=await ae.getSupply();console.log(a),u.value.opts=a}Q.value=!1,g("loaded")},L=()=>{i.value.state=!0},G=()=>{J.value=!0},re=async()=>{console.log("Iniciando surtido"),g("loading"),q.value=!0;let l=3,a={id:d.value.id,state:l};const n=await T.nextState(a);if(n.status==200){q.value=!1,f.notify({message:`Surtido iniciado para el pedido  ${d.value.id}`,icon:"done",position:"center",color:"teal"});let E={supplyer:u.value.val,pedido:d.value.id,status:l},j=await ae.SaveSupply(E);console.log(j),j.status==200?(D(),g("fresh",d.value.id),i.value.state=!1):alert(`Error ${j.status}: ${j.data} 2`)}else alert(`Error ${n.status}: ${n.data} 1`);g("loaded")},ve=async()=>{console.log("Generando factura"),f.loading.show({message:"Cambiando, espera..."});let l={chofi:p.value.val,supplyer:V.value._suplier_id,pedido:d.value.id,status:7},a=await ae.SaveChofi(l);if(console.log("%cDELIVERY ASSIGNED","color:white; background:#b71540; font-size:1.3em;"),console.log(a),a.status==200){let n={id:d.value.id,state:7,suply:V.value._suplier_id};console.log(n);let E=await ae.nextState(n);if(console.log("%cState Changed on Assist","color:white; background:#0a3d62; font-size:1.2em;"),console.log(E),E.data.partitionsEnd>w.value._status){console.log("%cTodas las particiones se han finalizado","color:white; background:#eb2f06; font-size:1.3em;");let j={id:d.value.id,state:E.data.partitionsEnd};console.log(j);const ue=await T.nextState(j);console.log("%cState Changed on RestockAPI","color:white; background:#079992; font-size:1.3em;"),console.log(ue)}if(g("chofiAssigned",n.id),E.status==200){D();let j=E.data.partition.id,ue=N.value.findIndex(Le=>Le.id==j);N.value[ue]._status=E.data.partition._status,N.value[ue].invoice=E.data.partition.invoice}f.notify({message:"Pedido en ruta",position:"center",icon:"done",timeout:5e3,color:"positive"}),R.value.state=!1}else alert(`Error ${a.status}: ${a.data}`);f.loading.hide()},Ie=async l=>{let a=`http://192.168.10.189:2200/#/checkin/${d.value.id}?key=${l}`;z.value.state=!0,ze(()=>ot.toCanvas(document.getElementById("qrcode"),a))},Qe=async l=>{f.loading.show({message:"..."}),console.log(l);const a=await T.printKey({ip:l.ip,port:l._port,order:d.value.id});a.status==200?(a.data,f.loading.hide(),f.notify({message:"Impresion correcta",icon:"done",color:"positive",position:"top"})):(console.error(a),alert(`Error ${a.status}: ${a.data}`))},Pe=async l=>{f.loading.show({message:"..."}),console.log(l);const a=await T.printForSupply({ip:l.ip,port:l._port,order:d.value.id});console.log(a),a.status==200?(a.data?f.notify({message:"Impresion correcta",icon:"done",color:"positive",position:"top"}):f.notify({message:`Sin conexion a <b>${l.name} <small>(${l.ip})</small></b>`,icon:"fas fa-bug",color:"negative",position:"center",html:!0,timeout:4e3}),f.loading.hide()):(console.error(a),alert(`Error ${a.status}: ${a.data}`))},Ue=async l=>{V.value=l,R.value.state=!0;let a=await ae.getSupply();console.log(a),p.value.opts=a},Ae=(l,a,n)=>{a(()=>{if(l==="")u.value.filter=u.value.opts;else{const E=l.toLowerCase();u.value.filter=u.value.opts.filter(j=>j.complete_name.toLowerCase().indexOf(E)>-1)}})},Oe=(l,a,n)=>{a(()=>{if(l==="")p.value.filter=p.value.opts;else{const E=l.toLowerCase();p.value.filter=p.value.opts.filter(j=>j.complete_name.toLowerCase().indexOf(E)>-1)}})},Re=async()=>{console.log("Eliminando Pedido"),g("loading");let l=100,a={id:d.value.id,state:l};const n=await T.nextState(a);n.status==200?(J.value=!1,f.notify({message:`Surtido Cancelado para el pedido  ${d.value.id}`,icon:"close",position:"center",color:"negative"}),D(),g("fresh",d.value.id)):alert(`Error ${n.status}: ${n.data} 1`),g("loaded")};return Fe(()=>o.value=r.value.columns.map(l=>l.name)),D(),(l,a)=>(v(),C(H,null,[e(W,{class:"full-width"},{default:t(()=>[e(I,{class:"row justify-between"},{default:t(()=>[s("div",null,[mt,s("div",ft,c(d.value.from.alias),1)]),s("div",_t,[gt,s("div",bt,c(d.value.id),1)]),s("div",ht,[yt,s("div",xt,c(d.value.created_by.nick),1)])]),_:1}),e(Y),e(I,{class:"row justify-between"},{default:t(()=>[s("div",kt,[wt,s("div",Ct,c(F(ee)(d.value.updated_at).format("YYYY-MM-DD")),1)]),d.value.notes?(v(),C("div",St,[Vt,s("div",$t,c(d.value.notes),1)])):B("",!0),s("div",Dt,[s("div",qt,[_.value&&_.value.id==2?(v(),U(h,{key:0,color:"positive",icon:"start",dense:"",label:"Iniciar",onClick:L,flat:"",rounded:""})):B("",!0)]),e(Y,{spaced:"",inset:"",vertical:"",dark:""}),s("div",Et,[_.value&&_.value.id==2?(v(),U(h,{key:0,color:"negative",icon:"close",dense:"",label:"Declinar",onClick:G,flat:"",rounded:""})):B("",!0)]),_.value&&_.value.id>2?(v(),U(h,{key:0,color:"indigo-10",icon:"print",dense:""},{default:t(()=>[e(me,{class:"bg-grey-1 text-indigo-10",style:{"min-width":"250px"}},{default:t(()=>[e($e,{onSelected:Pe})]),_:1})]),_:1})):B("",!0)])]),_:1}),e(Y),Q.value?(v(),U(I,{key:0,class:"text-center"},{default:t(()=>[e(et,{size:"50px",color:"purple"})]),_:1})):(v(),C(H,{key:1},[e(Y),e(tt,{modelValue:$.value,"onUpdate:modelValue":a[0]||(a[0]=n=>$.value=n),class:"text-pink-5",dense:"","no-caps":""},{default:t(()=>[e(fe,{name:"log",label:"Log"}),e(fe,{name:"basket",label:"Productos"}),e(fe,{name:"supliers",label:"Surtidores"})]),_:1},8,["modelValue"]),e(lt,{modelValue:$.value,"onUpdate:modelValue":a[3]||(a[3]=n=>$.value=n),animated:""},{default:t(()=>[e(_e,{name:"log"},{default:t(()=>[e(ke,null,{default:t(()=>[(v(!0),C(H,null,te(P.value,n=>(v(),U(ne,{key:n.id},{default:t(()=>[e(A,{avatar:""},{default:t(()=>[y(c(n.id),1)]),_:2},1024),e(A,null,{default:t(()=>[y(c(n.name),1)]),_:2},1024),e(A,null,{default:t(()=>[y(c(n.pivot.details.responsable),1)]),_:2},1024),e(A,null,{default:t(()=>[y("de "+c(F(ee)(n.pivot.created_at).format("h:mm a"))+" a "+c(F(ee)(n.pivot.updated_at).format("h:mm a")),1)]),_:2},1024)]),_:2},1024))),128))]),_:1})]),_:1}),e(_e,{name:"basket"},{default:t(()=>[M.value.length?(v(),U(ie,{key:0,"row-key":"id",flat:"",rows:M.value,columns:r.value.columns,pagination:r.value.pagination,filter:r.value.filter,"visible-columns":o.value},{top:t(()=>[s("div",It,[s("div",Qt,[s("span",Pt,[e(h,{color:"pink-5",icon:"sync",onClick:D,round:"",dense:"",flat:""}),y(" Productos: "+c(M.value.length),1)]),y(", "),s("span",Ut,"Piezas: "+c(F(x)),1)]),e(Ce,{dense:"",modelValue:r.value.filter,"onUpdate:modelValue":a[1]||(a[1]=n=>r.value.filter=n),placeholder:"Buscar","input-class":"text-uppercase",color:"pink-5"},{append:t(()=>[e(oe,{name:"search"})]),_:1},8,["modelValue"]),e(h,{color:"secondary",icon:"fas fa-eye","no-caps":""},{default:t(()=>[e(me,{style:{"min-width":"200px"}},{default:t(()=>[e(ke,null,{default:t(()=>[(v(!0),C(H,null,te(r.value.columns,(n,E)=>Z((v(),U(ne,{tag:"label",key:E},{default:t(()=>[e(A,null,{default:t(()=>[e(le,null,{default:t(()=>[y(c(n.label),1)]),_:2},1024),e(le,{caption:""},{default:t(()=>[y(c(n.coldesc),1)]),_:2},1024)]),_:2},1024),e(A,{side:"",top:""},{default:t(()=>[e(Ye,{color:"pink-5",modelValue:o.value,"onUpdate:modelValue":a[2]||(a[2]=j=>o.value=j),val:n.name},null,8,["modelValue","val"])]),_:2},1024)]),_:2},1024)),[[De]])),128))]),_:1})]),_:1})]),_:1})])]),_:1},8,["rows","columns","pagination","filter","visible-columns"])):(v(),C("div",At,"Nada por aqui"))]),_:1}),e(_e,{name:"supliers"},{default:t(()=>[e(ie,{rows:N.value,"row-key":"id",dense:"",flat:"",bordered:"",grid:"","hide-header":""},{item:t(n=>[s("div",Ot,[e(W,{flat:"",bordered:""},{default:t(()=>[e(I,{class:"text-center"},{default:t(()=>[y(" Surtidor "),Rt,s("strong",null,c(n.row._suplier),1),Lt,s("div",jt,[e(at,{color:"primary","text-color":"white",label:n.row.status.name},null,8,["label"])])]),_:2},1024),e(Y),e(I,{class:"flex justify-between"},{default:t(()=>[Ft,zt,Bt]),_:1}),e(Y),e(I,{class:"flex justify-between"},{default:t(()=>[s("div",null,c(n.row.invoice),1),s("div",null,c(n.row.invoice_received),1),s("div",Tt,[n.row._status==6?(v(),C("div",Mt,[e(h,{color:"pink",label:"En Camino",class:"q-px-xl q-py-xs",size:"10px",padding:"5px 2px","icon-right":"start",flat:"",onClick:E=>Ue(n.row)},null,8,["onClick"])])):B("",!0),n.row._status>=7?(v(),C("div",Nt,[e(h,{color:"pink",icon:"qr_code",onClick:E=>Ie(n.row.entry_key),flat:""},null,8,["onClick"])])):B("",!0),n.row._status>=7?(v(),C("div",Yt,[e(h,{color:"pink",icon:"list",onClick:E=>F(st).pdf(n.row.invoice,n.row.entry_key,d.value.id),flat:""},null,8,["onClick"])])):B("",!0)])]),_:2},1024)]),_:2},1024)])]),_:1},8,["rows"])]),_:1})]),_:1},8,["modelValue"])],64))]),_:1}),e(X,{modelValue:z.value.state,"onUpdate:modelValue":a[4]||(a[4]=n=>z.value.state=n)},{default:t(()=>[e(W,null,{default:t(()=>[e(I,{class:"text-h6 text-center"},{default:t(()=>[y(c(d.value.id)+" - "+c(d.value.from.alias),1)]),_:1}),e(Y),e(I,{class:"text-center"},{default:t(()=>[Ht,s("div",Gt,c(z.value.key),1)]),_:1}),e(Y),e(I,{align:"center"},{default:t(()=>[e(h,{color:"indigo-10",icon:"print"},{default:t(()=>[e(me,null,{default:t(()=>[e($e,{onSelected:Qe})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]),e(X,{modelValue:R.value.state,"onUpdate:modelValue":a[6]||(a[6]=n=>R.value.state=n)},{default:t(()=>[e(W,null,{default:t(()=>[e(I,{class:"row items-start"},{default:t(()=>[e(he,{icon:"warning",color:"orange-14","text-color":"white"}),Kt]),_:1}),e(I,null,{default:t(()=>[s("div",null,[Jt,s("div",Wt,c(V.value._suplier),1)])]),_:1}),V.value?(v(),U(I,{key:0},{default:t(()=>[e(se,{modelValue:p.value.val,"onUpdate:modelValue":a[5]||(a[5]=n=>p.value.val=n),options:p.value.filter,label:"CHOFER","option-label":"complete_name",filled:"",style:{width:"100%"},onFilter:Oe,"input-debounce":"0","use-input":""},null,8,["modelValue","options"])]),_:1})):B("",!0),e(ce,{align:"right"},{default:t(()=>[Z(e(h,{flat:"",label:"Cancelar",color:"primary","no-caps":""},null,512),[[pe]]),e(h,{flat:"",label:"Continuar",color:"primary",onClick:ve,"no-caps":"",disable:p.value.val==null},null,8,["disable"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),e(X,{modelValue:i.value.state,"onUpdate:modelValue":a[8]||(a[8]=n=>i.value.state=n),persistent:""},{default:t(()=>[e(W,{style:{width:"400px"}},{default:t(()=>[e(I,{class:"row items-center"},{default:t(()=>[e(se,{modelValue:u.value.val,"onUpdate:modelValue":a[7]||(a[7]=n=>u.value.val=n),options:u.value.filter,label:"SELECCIONA SURTIDOR","option-label":"complete_name",filled:"",multiple:"",counter:"","max-values":"5",hint:"Maximo 5 colaboradores",style:{width:"100%"},onFilter:Ae,"input-debounce":"0","use-input":"","use-chips":""},null,8,["modelValue","options"])]),_:1}),e(ce,{align:"right"},{default:t(()=>[Z(e(h,{flat:"",label:"Cancel",color:"primary"},null,512),[[pe]]),e(h,{flat:"",label:"Continuar",color:"primary",onClick:re,disable:u.value.val.length==0},null,8,["disable"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),e(X,{modelValue:J.value,"onUpdate:modelValue":a[9]||(a[9]=n=>J.value=n),persistent:""},{default:t(()=>[e(W,null,{default:t(()=>[e(I,{class:"row items-center"},{default:t(()=>[e(he,{icon:"warning",color:"negative","text-color":"white"}),Xt,s("div",Zt,c(d.value.id),1)]),_:1}),e(I,null,{default:t(()=>[y(" Es correcto? ")]),_:1}),e(ce,{align:"center"},{default:t(()=>[Z(e(h,{flat:"",label:"Cancel",color:"positive"},null,512),[[pe]]),e(h,{flat:"",label:"Confirmar",color:"negative",onClick:Re})]),_:1})]),_:1})]),_:1},8,["modelValue"])],64))}};var ge=qe({name:"QTr",props:{props:Object,noHover:Boolean},setup(S,{slots:g}){const k=O(()=>"q-tr"+(S.props===void 0||S.props.header===!0?"":" "+S.props.__trClass)+(S.noHover===!0?" q-tr--no-hover":""));return()=>ye("tr",{class:k.value},xe(g.default))}}),be=qe({name:"QTd",props:{props:Object,autoWidth:Boolean,noHover:Boolean},setup(S,{slots:g}){const k=Be(),f=O(()=>"q-td"+(S.autoWidth===!0?" q-table--col-auto-width":"")+(S.noHover===!0?" q-td--no-hover":"")+" ");return()=>{if(S.props===void 0)return ye("td",{class:f.value},xe(g.default));const u=k.vnode.key,p=(S.props.colsMap!==void 0?S.props.colsMap[u]:null)||S.props.col;if(p===void 0)return;const{row:V}=S.props;return ye("td",{class:f.value+p.__tdClass(V),style:p.__tdStyle(V)},xe(g.default))}}});const tl={class:"text-h6"},ll={class:"row q-mt-md"},al={class:"q-ml-sm text-h6"},ol={__name:"TableReport",props:{rows:{type:Array,default:[]},name:{type:String,default:""},type:{type:String,default:""}},emits:["cardResumeActived"],setup(S,{emit:g}){const k=S;Se();const f=de(),u=m({state:!1,action:null}),p=m({columns:[{name:"ID",field:"ID",label:"ID",align:"center"},{name:"code",field:"CODIGO",label:"Codigo",align:"center",sortable:!0},{name:"desc",field:"DESCRIPCION",label:"Descripcion",align:"left"},{name:"stockcedis",field:"CEDIS",label:"Stock (CEDIS)",align:"center",sortable:!0},{name:"stockpan",field:"PANTACO",label:"Stock (PAN)",align:"center",sortable:!0}],filter:""}),V={pndcs:{l:"Habilitar todo",c:"indigo-13",desc:"Los productos en esta lista se habilitaran y podran ser solicitados por cuaqluier tienda."},pdss:{l:"Deshabilitar todo",c:"pink-13",desc:"Los productos en esta lista se deshabilitaran y no podran ser solicitados."}},d=m(k.rows),w=m(k.name),Q=m(k.type),P=O(()=>Q.value?V[Q.value]:{l:"",c:""}),$=()=>{const q=V[Q.value];u.value.action=q,u.value.state=!0},_=async()=>{f.loading.show({message:"Espera..."});const q=await T.massiveAction({action:Q.value});console.log(q),q.status==200?(q.data,u.value.state=!1,u.value.action=null,f.loading.hide(),f.notify({position:"center",color:"positive",icon:"done"}),g("cardResumeActived")):(console.error(q.data),alert(`Error ${q.status}: ${q.data.msg}`))},M=(q,R,z)=>{console.log(q),console.log(R),console.log(z),console.log(Q.value)};return(q,R)=>(v(),C(H,null,[e(ie,{"row-key":"ID",rows:d.value,columns:p.value.columns,filter:p.value.filter,onRowClick:M},{top:t(()=>[s("div",tl,c(w.value),1),s("div",ll,[e(h,{color:F(P).c,icon:"warning",label:F(P).l,onClick:$},null,8,["color","label"]),e(Ce,{modelValue:p.value.filter,"onUpdate:modelValue":R[0]||(R[0]=z=>p.value.filter=z),dense:"",type:"text",icon:"search",label:"Buscar"},{prepend:t(()=>[e(oe,{name:"search"})]),_:1},8,["modelValue"])])]),_:1},8,["rows","columns","filter"]),e(X,{modelValue:u.value.state,"onUpdate:modelValue":R[1]||(R[1]=z=>u.value.state=z),persistent:""},{default:t(()=>[e(W,null,{default:t(()=>[e(I,{class:"row items-center"},{default:t(()=>[e(he,{icon:"warning",color:u.value.action.c,"text-color":"white"},null,8,["color"]),s("span",al,c(u.value.action.l),1)]),_:1}),e(I,null,{default:t(()=>[y(c(u.value.action.desc),1)]),_:1}),e(ce,{align:"right"},{default:t(()=>[Z(e(h,{flat:"",label:"cancelar",color:"primary"},null,512),[[pe]]),e(h,{flat:"",label:"continuar",color:"primary",onClick:_})]),_:1})]),_:1})]),_:1},8,["modelValue"])],64))}},sl={key:0,class:"bg-negative text-white q-pa-md q-mb-md"},nl=s("div",{class:"text-warning text-bold"},"Los siguientes folios tienen errores que no permiten ser listados en la tabla. ",-1),il={class:"text-h6"},dl=s("div",{class:"text--2"},"Errores comunes: Sin log, Sin fecha, Estatus desconocido",-1),rl={class:"row q-mb-md items-start justify-around"},ul={class:"text-left"},cl={class:"text-h5"},pl={class:"text--2"},vl={class:"full-width row items-center"},ml={class:"col text-h6 text-dark"},fl={__name:"AdminDashboard",emits:["reloadDashboard","freshOrder"],setup(S,{emit:g}){we(),Ee();const k=Se(),f=de(),u=["text-grey-5 text-bold","text-bold text-h6 text-red","text-indigo","4","5","text-bold text-pink-7","text-orange-8","8","text-primary","text-positive"],p=m({columns:[{name:"id",label:"Folio",field:"id",align:"center",sortable:!0},{name:"state",label:"Estado",field:i=>i.log.length==1?i.log[0].name:i.log[i.log.length-1].name,align:"left",sortable:!0,sort:(i,b,o,r)=>parseInt(o._status)-parseInt(r._status),classes:i=>u[i._status?parseInt(i._status)-1:parseInt(i.status.id)-1]},{name:"suplier",label:"Surtidores",field:i=>{var b;return(b=i.partition)==null?void 0:b.length},align:"center",classes:"text-bold"},{name:"laststate",label:"Ultima actividad",field:i=>ee(i.log.find(b=>b.id==i.status.id).pivot.updated_at).format("YYYY-MM-DD hh:mm A"),align:"left"},{name:"from",label:"Sucursal",field:i=>i.from.name.toUpperCase(),align:"left",sortable:!0},{name:"to",label:"Destino",field:i=>i.to.name.toUpperCase(),align:"left",sortable:!0},{name:"notes",label:"Notas",field:i=>i.notes,align:"left",classes:"text-orange text-bold"},{name:"tmodels",label:"Modelos",field:i=>i.products_count,align:"center",sortable:!0}],filter:"",pagination:{sortBy:"desc",descending:!1,rowsPerPage:20}}),V=m(!1),d=m({state:!1,title:"",data:null,name:null,type:null}),w=m({state:!1,head:null,block:!0}),Q=O(()=>k.ordersSize),P=O(()=>k.ordersok.filter(i=>i._status!=100)),$=O(()=>k.ordersok.filter(i=>i._status==100)),_=O(()=>k.orderserrors),M=O(()=>k.resume),q=async i=>{console.log(i.row),w.value.head=i.row,w.value.state=!0},R=async i=>{f.loading.show({message:"cargando..."+i});const b=await T.report(i);console.log(b.data),d.value.data=b.data.rows,d.value.name=b.data.name,d.value.type=i,d.value.state=!0,f.loading.hide()},z=()=>{d.value.state=!1,d.state=!1,g("reload")},N=i=>{console.log(i),console.log("Se crearon las particiones",i),g("freshOrder",i)},J=()=>{V.value=!0};return(i,b)=>(v(),U(He,{padding:"",class:"bg-grey-2"},{default:t(()=>[F(_).length?(v(),C("div",sl,[nl,s("div",il,c(F(_).map(o=>o.id).join("id")),1),dl])):B("",!0),s("div",rl,[(v(!0),C(H,null,te(F(M),o=>(v(),U(h,{stack:"","no-caps":"",class:"q-py-md",key:o.key,onClick:r=>R(o.key),color:o.total==0?"teal-10":"pink-13",disabled:o.total==0},{default:t(()=>[s("div",ul,[s("div",cl,c(o.total),1),s("div",pl,c(o.name),1)])]),_:2},1032,["onClick","color","disabled"]))),128))]),e(ie,{flat:"",bordered:"","row-key":"id",rows:F(P),columns:p.value.columns,filter:p.value.filter,pagination:p.value.pagination},{header:t(o=>[e(ge,{props:o},{default:t(()=>[e(Ve,{"auto-width":""}),(v(!0),C(H,null,te(o.cols,r=>(v(),U(Ve,{key:r.name,props:o},{default:t(()=>[y(c(r.label),1)]),_:2},1032,["props"]))),128))]),_:2},1032,["props"])]),body:t(o=>[e(ge,{props:o},{default:t(()=>[e(be,{"auto-width":""},{default:t(()=>[e(h,{size:"sm",dense:"",round:"",flat:"",onClick:r=>o.expand=!o.expand,icon:o.expand?"expand_less":"expand_more"},null,8,["onClick","icon"])]),_:2},1024),(v(!0),C(H,null,te(o.cols,r=>(v(),U(be,{key:r.name,props:o,onClick:x=>q(o)},{default:t(()=>[y(c(r.value),1)]),_:2},1032,["props","onClick"]))),128))]),_:2},1032,["props"]),Z(e(ge,{props:o},{default:t(()=>[e(be,{colspan:"100%"},{default:t(()=>[e(ke,{dense:"",padding:"",class:"rounded-borders"},{default:t(()=>[e(ne,null,{default:t(()=>[e(A,null,{default:t(()=>[y("ID")]),_:1}),e(A,null,{default:t(()=>[y("ESTADO")]),_:1}),e(A,null,{default:t(()=>[y(" SALIDA")]),_:1}),e(A,null,{default:t(()=>[y("ENTRADA")]),_:1})]),_:1}),(v(!0),C(H,null,te(o.row.partition,(r,x)=>(v(),C("div",{key:x},[e(ne,null,{default:t(()=>[e(A,null,{default:t(()=>[e(le,{overline:""},{default:t(()=>[y(c(r._suplier),1)]),_:2},1024),e(le,{caption:""},{default:t(()=>[y(c(r.id),1)]),_:2},1024)]),_:2},1024),e(A,{class:Te(`${u[r.status.id-1]}`)},{default:t(()=>[y(c(r.status.name),1)]),_:2},1032,["class"]),e(A,null,{default:t(()=>[y(c(r.invoice),1)]),_:2},1024),e(A,null,{default:t(()=>[y(c(r.invoice_received),1)]),_:2},1024)]),_:2},1024),e(Y,{spaced:"",inset:""})]))),128))]),_:2},1024)]),_:2},1024)]),_:2},1032,["props"]),[[Me,o.expand]])]),top:t(()=>[s("div",vl,[s("div",ml,"Pedidos: "+c(F(Q)),1),e(Ce,{dense:"",modelValue:p.value.filter,"onUpdate:modelValue":b[0]||(b[0]=o=>p.value.filter=o),"input-class":"text-uppercase",placeholder:"Buscar",color:"pink-5"},{append:t(()=>[e(oe,{name:"search"})]),_:1},8,["modelValue"]),e(Y,{spaced:"",inset:"",vertical:"",dark:""}),s("div",null,[e(oe,{name:"archive",size:"md",color:"negative",onClick:J})])])]),_:1},8,["rows","columns","filter","pagination"]),e(X,{"full-width":"",modelValue:w.value.state,"onUpdate:modelValue":b[3]||(b[3]=o=>w.value.state=o),persistent:w.value.block,"no-esc-dismiss":w.value.block,"no-backdrop-dismiss":w.value.block},{default:t(()=>[e(el,{head:w.value.head,onLoaded:b[1]||(b[1]=o=>w.value.block=!1),onLoading:b[2]||(b[2]=o=>w.value.block=!0),onFresh:N,onChofiAssigned:N},null,8,["head"])]),_:1},8,["modelValue","persistent","no-esc-dismiss","no-backdrop-dismiss"]),e(X,{modelValue:d.value.state,"onUpdate:modelValue":b[4]||(b[4]=o=>d.value.state=o)},{default:t(()=>[e(ol,{rows:d.value.data,name:d.value.name,type:d.value.type,onCardResumeActived:z},null,8,["rows","name","type"])]),_:1},8,["modelValue"]),e(X,{modelValue:V.value,"onUpdate:modelValue":b[5]||(b[5]=o=>V.value=o),"full-width":""},{default:t(()=>[e(W,{style:{width:"700px","max-width":"80vw"}},{default:t(()=>[e(I,{class:"q-pt-none"},{default:t(()=>[e(ie,{flat:"",bordered:"","row-key":"id",rows:F($),columns:p.value.columns,pagination:p.value.pagination,title:"Pedidos Cancelados"},null,8,["rows","columns","pagination"])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1}))}};const _l=s("div",{class:"text-bold"},"Dashboard ",-1),gl={class:"row"},bl={class:"col row"},Dl={__name:"DashboardLyt",setup(S){const g=we(),k=Ee(),f=Se(),u=de(),p=nt,V=m([{id:0,alias:"Todas"},{id:1,alias:"CEDIS",_state:1},{id:2,alias:"SP1",_state:1}]),d=m([{id:"day",label:"Hoy"},{id:"week",label:"Semana"},{id:"month",label:"Mes"},{id:"C",label:"otra ...",disable:!0}]),w=["p2","P2","p3","P3","bol","BOL","sap","SAP"],Q=m(null),P=m(null),$=m({from:ee(Date.now()).startOf("day"),to:ee(Date.now()).startOf("day")}),_=async()=>{var G;u.loading.show({message:"Cargado vista..."}),console.log("%cIniciando MainLayout...","font-size:2em;color:orange;");let o=(G=g.query.v)!=null?G:"day",r=d.value.findIndex(re=>re.id==o),x=r>=0?r:0;P.value=d.value[x],$.value.from=ee(Date.now()).startOf(P.value.id);let D=g.query.d&&w.includes(g.query.d)?g.query.d:"all";console.log(D);const L=await T.index(P.value.id,D);console.log(L),f.fillOrders(L.orders),f.fillResume(L.resume),f.fillPrinters(L.printers),Q.value=V.value[0],console.log("%cMainLayout listo!!","font-size:2em;color:orange;"),u.loading.hide(),K.connect(),K.emit("joinat",p),K.on("joineddashreq",q),K.on("creating",R),K.on("order_update",z),K.on("order_changestate",N),K.on("order_refresh",J),K.on("orderpartition_refresh",b)},M=o=>{let r=g.query.d&&w.includes(g.query.d)?g.query.d:"all";k.push(`/dashboard?v=${o.id}&d=${r}`)};O(()=>$.value.from.format("YYYY/MM/DD")),O(()=>$.value.to.format("YYYY/MM/DD"));const q=o=>{console.log(`%c${o.user.me.nick} de ${o.from.alias} se ha unido a Restock (UID: ${o.user.me.id})`,"background:#076F3E;color:#f5f6fa;border-radius:10px;padding:10px;font-size:1.1em;")},R=async o=>{let r=o.order,x=await T.orderFresh(r.id),D=x.data.order,L=x.data.oid;f.addOrUpdate(L,D)},z=o=>{f.orderUpdate(o)},N=async o=>{let r=o.order,x=o.state,D=await T.orderFresh(r.id),L=D.data.order,G=D.data.oid;f.addOrUpdate(G,L),x.id==2&&u.notify({message:`El pedido <b>${r.id}</b> esta listo para iniciar surtido!!`,color:"positive",textColor:"white",position:"bottom",html:!0,timeout:5e3})},J=async o=>{console.log("REFRESHING BY SKT!!",o);let r=o.order,x=await T.orderFresh(r);console.log(x);let D=x.data.order;console.log(D.partition);let L=x.data.oid;f.addOrUpdate(L,D)},i=o=>{console.log("orderViewer/AdminDashboard actualizaron el pedido:",o),K.emit("order_refresh",{order:o})},b=async o=>{console.log("Partition refresh!!",o);let r=o.order,x=await T.orderFresh(r);console.log(x);let D=x.data.order,L=D.partition,G=x.data.oid;f.addOrUpdate(G,D),L.filter(ve=>ve._status==4).length==L.length&&u.notify({message:`El pedido <b>${G}</b> esta listo para iniciar <b>embarque</b>`,html:!0,color:"purple-10",icon:"fa-solid fa-truck-ramp-box"})};return Ne(()=>g.query,()=>{_()}),_(),document.title="Dashboard",(o,r)=>(v(),U(Ge,{view:"lHh Lpr lFf"},{default:t(()=>[e(Je,{bordered:"",class:"bg-yellow text-dark"},{default:t(()=>[e(Ke,{class:"row justify-between items-center"},{default:t(()=>[_l,s("div",gl,[e(h,{color:"dark",round:"",unelevated:"",flat:"",icon:"sync",onClick:_}),s("div",bl,[e(se,{class:"col",dense:"",filled:"",label:"Vista",modelValue:P.value,"onUpdate:modelValue":[r[0]||(r[0]=x=>P.value=x),M],options:d.value},null,8,["modelValue","options"]),P.value.id=="C"?(v(),U(h,{key:0,unelevated:"",color:"pink-5",icon:"fas fa-calendar-day",dense:""})):B("",!0)])])]),_:1})]),_:1}),e(We,null,{default:t(()=>[e(fl,{onReload:_,onFreshOrder:i})]),_:1})]),_:1}))}};export{Dl as default};
