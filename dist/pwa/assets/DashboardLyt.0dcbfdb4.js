import{r as m,c as R,o as v,aF as E,f as s,d as e,w as t,h as k,aH as M,i as q,e as N,ax as X,b as L,aN as Ke,Q as de,t as c,aE as C,R as Ue,u as Ce,a8 as Xe,aG as K,aJ as Pe,x as We,F as qe,B as ge,E as be,m as et,a as Ne,aO as tt,aP as at,g as lt}from"./index.d7b08697.js";import{u as oe,o as B,e as ae,x as le,y as $,z as ee,v as V,p as pe,q as ye,Q as ie,a as ke,A as ot,t as Z,s as W,w as xe,C as he,R as G,D as Oe,b as st,c as nt,d as it,f as dt,g as rt}from"./ClosePopup.75bd1f53.js";import{d as j}from"./dayjs.min.53a5c0af.js";import{a as ct,Q as ut,b as pt,c as vt,d as ve,e as ft,f as fe,g as mt,h as Ve,E as _t,i as Le,u as we}from"./Restock.5d72cc36.js";import{A as J}from"./AssistApi.8bc23ce4.js";import"./axios.2cb04522.js";const gt={class:"q-pa-sm bg-grey-2 text-bold row justify-between items-center",style:{"min-width":"250px"}},bt=s("div",null,"Impresion",-1),yt={key:0,class:"row justify-between items-center"},xt={class:"q-mt-sm q-pa-sm"},ht={key:0,class:"q-pa-sm"},Ct={class:"text--3"},kt={class:"q-pa-sm text-right"},Re={__name:"PrinterSelect",emits:["selected"],setup(D,{emit:h}){const I=oe(),g=ct(),r=m(null),f=m(null),_=R(()=>g.printers),u=R(()=>r.value?r.value.printers:[]),Q=()=>{I.localStorage.set("LUP",{wkp:r.value,printer:f.value}),h("selected",f.value)},w=I.localStorage.getItem("LUP");return w&&(r.value=w.wkp,f.value=w.printer),(O,b)=>(v(),E(M,null,[s("div",gt,[bt,r.value?(v(),E("div",yt,[e(ut,{flat:""},{default:t(()=>[e(k,{flat:"",color:"positive",icon:"add",dense:""}),f.value?(v(),E(M,{key:0},[e(k,{flat:"",color:"negative",icon:"delete",dense:""}),e(k,{flat:"",color:"orange",icon:"edit",dense:""})],64)):q("",!0)]),_:1})])):q("",!0)]),e(B),s("div",xt,[e(ae,{modelValue:r.value,"onUpdate:modelValue":[b[0]||(b[0]=A=>r.value=A),b[1]||(b[1]=A=>f.value=null)],options:N(_),label:"Sucursal",filled:"","option-label":"alias","option-value":"id"},null,8,["modelValue","options"])]),r.value?(v(),E("div",ht,[e(ae,{modelValue:f.value,"onUpdate:modelValue":b[2]||(b[2]=A=>f.value=A),options:N(u),label:"Impresora",filled:"","option-value":"id","option-label":"name"},{option:t(A=>[X((v(),L(le,Ke({clickable:""},A.itemProps),{default:t(()=>[e($,{class:"text-center",side:""},{default:t(()=>[e(de,{color:"primary","text-color":"white",name:"print",size:"30px"}),s("span",Ct,"ID:"+c(A.opt.id),1)]),_:2},1024),e($,null,{default:t(()=>[e(ee,null,{default:t(()=>[C(c(A.opt.name),1)]),_:2},1024),e(ee,{caption:"",lines:"2"},{default:t(()=>[C(c(A.opt.ip),1)]),_:2},1024)]),_:2},1024)]),_:2},1040)),[[Ue]])]),_:1},8,["modelValue","options"])])):q("",!0),s("div",kt,[r.value&&f.value?(v(),L(k,{key:0,color:"primary",icon:"print",onClick:Q})):q("",!0)])],64))}},wt=s("div",{class:"text-overline text-grey-7"},"Sucursal",-1),At={class:"text-h6"},St={class:"q-px-lg text-center"},Et=s("div",{class:"text-overline text-grey-7"},"Folio",-1),Dt={class:"text-h6"},It={class:"text-right"},$t=s("div",{class:"text-overline text-grey-7"},"Agente",-1),Ot={class:"text-h6"},Vt={class:"text-center"},Lt=s("div",{class:"text-overline text-grey-7"},"Fecha",-1),Rt={class:"text-h6"},Ut={key:0,class:"text-center"},Pt=s("div",{class:"text-overline text-grey-7 col"},"Notas",-1),qt={class:"text-h6"},Nt={class:"flex item-center"},Tt={class:"full-width row items-center"},Qt={class:"col text-dark"},Ft={class:"text-h6"},Mt={class:"text-bold"},zt={key:1,class:"text-center q-pa-lg text-h6 text-grey-7"},Bt={class:"q-pa-xs col-xs-12 col-sm-6 col-md-4"},jt=s("br",null,null,-1),Gt=s("br",null,null,-1),Yt={class:"text-overline text-grey-7"},Ht=s("div",null,"Salida",-1),Jt=s("div",null,"Entrada",-1),Zt=s("div",null,"Herramientas",-1),Kt={class:"row"},Xt={key:0,class:"col"},Wt={key:1,class:"col"},ea={key:2,class:"col"},ta=s("canvas",{id:"qrcode"},null,-1),aa={class:"text--2"},la=s("div",{class:"q-ml-md"},[s("div",{class:"text-h6"},"Emitir salida?"),s("div",null,"La salida emitira la factura correspondiente en Factusol.")],-1),oa=s("div",{class:"text-center text-h6"},"Surtidor",-1),sa={class:"text-center text-bold text-subtitle2 text-overline"},na={__name:"OrderViewer",props:{head:{type:Object,default:{}}},emits:["loaded","loading"],setup(D,{emit:h}){const I=D,g=oe();Ce();const r=m({opts:[],val:[],filter:[]}),f=m({opts:null,val:null}),_=m(null),u=m(I.head),Q=m(!0),w=m([]),O=m("supliers"),b=m(null),A=m([]),F=m(!1),y=m({state:!1}),i=m({state:!1,key:null}),p=m(null),d=m({state:!1}),S=m(null),z=m([]),Y=m({columns:[{name:"id",label:"ID",field:"id",align:"left",coldesc:"Identificador del producto (MySQL)"},{name:"code",label:"Codigo",field:"code",align:"left",coldesc:"Codigo principal del producto"},{name:"assocs",label:"Asociados",field:a=>a.variants.length?a.variants.map(o=>o.barcode).join(", "):null,align:"left",coldesc:"Codigos relacionados al codigo principal"},{name:"bcode",label:"Codigo de Barras",field:"barcode",align:"center",coldesc:"Codigo de barras principal"},{name:"locs",label:"Ubicacion",field:a=>a.locations.length?a.locations.map(o=>o.path).join(", "):"--",align:"left",coldesc:"Ubicaciones en almacen general"},{name:"stocks",label:"Stock (pzs)",field:a=>a.stocks.reduce((o,n)=>o+n.pivot.stock,0),sortable:!0,classes:a=>a.stocks.reduce((o,n)=>o+n.pivot.stock,0)<=0?"text-red text-bold":"text-bold text-primary",align:"center",coldesc:"Stock total en almacenes GENERALES (CEDIS+PAN)"},{name:"ipack",label:"PxC",field:a=>typeof a.pivot.ipack=="number"?a.pivot.ipack:a.pieces,align:"center",coldesc:"Unidades x Embalaje"},{name:"request",label:"Solicitud",field:a=>a.pivot.amount,align:"center",coldesc:"Embalaje solicitado"},{name:"uspply",label:"Unidad",field:a=>a.units.id==3?"Cajas":"Piezas",align:"left",coldesc:"Unidad de embalaje del producto"},{name:"delivery",label:"Salida (conteo)",field:a=>a.pivot.toDelivered,align:"center",coldesc:"Embalaje surtido",sortable:!0},{name:"reqinpzs",label:"Piezas",field:a=>a.pivot._supply_by==3?(typeof a.pivot.ipack=="number"?a.pivot.ipack:a.pieces)*(typeof a.pivot.ipack=="number"?a.pivot.toDelivered:a.pivot.amount):typeof a.pivot.ipack=="number"?a.pivot.toDelivered:a.pivot.amount,align:"center",coldesc:"Unidades totales en embalaje"},{name:"checkout",label:"Checkout",field:a=>a.pivot.checkout?"OK":"---",align:"center",classes:a=>a.pivot.checkout?"text-positive text-bold":"text-red",sortable:!0,coldesc:"Revision del Administrador"},{name:"received",label:"Entrada (conteo)",field:a=>a.pivot.toReceived,align:"center",coldesc:"Embalaje recibido"},{name:"descr",label:"Descripcion",field:"description",align:"left"},{name:"section",label:"Seccion",field:"section",align:"left"},{name:"family",label:"Familia",field:"family",align:"left"},{name:"category",label:"Categoria",field:"category",align:"left"}],filter:"",pagination:{sortBy:"locs",descending:!1,rowsPerPage:20}}),Te=R(()=>A.value.reduce((a,o)=>a+(o.pivot._supply_by==3?o.pivot.amount*o.pieces:o.pivot.amount),0));R(()=>b.value&&(b.value.id==2||b.value.id==6)),R(()=>w.value.find(a=>a.id==b.value.id).pivot),R(()=>p.value.map(a=>a._status).includes(6));const se=async()=>{h("loading"),Q.value=!0;let a=await G.order(u.value.id);if(console.log(a.data),A.value=a.data.products,w.value=a.data.log.map(o=>(o.pivot.details=JSON.parse(o.pivot.details),o)),p.value=a.data.partition,b.value=a.data.status,S.value=a.data.invoice,b.value.id==2){let o=await J.getSupply();console.log(o),r.value.opts=o}Q.value=!1,h("loaded")},Qe=()=>{d.value.state=!0},Fe=async()=>{h("loading"),F.value=!0;let a=3,o={id:u.value.id,state:a};const n=await G.nextState(o);if(n.status==200){F.value=!1,g.notify({message:`Surtido iniciado para el pedido  ${u.value.id}`,icon:"done",position:"center",color:"teal"});let P={supplyer:r.value.val,pedido:u.value.id,status:a},x=await J.SaveSupply(P);console.log(x),x.status==200?(se(),d.value.state=!1):alert(`Error ${x.status}: ${x.data} 2`)}else alert(`Error ${n.status}: ${n.data} 1`);h("loaded")},Me=async()=>{g.loading.show({message:"Generando, espera..."}),y.value.state=!1,console.log(_.value._suplier_id);const a=await G.genInvoice(u.value.id,_.value._suplier_id);if(a.status==200){if(a.data.invoice){g.notify({message:`Se genero la salida <b class="text-h6">${a.data.invoice.folio}</b>`,html:!0,position:"center",icon:"done",timeout:5e3,color:"positive"}),console.log(a.data),i.value.key=a.data.requisition.entry_key,console.log(i.value.key),Ae(a.data.invoice.folio);let o={chofi:f.value.val,supplyer:_.value._suplier_id,pedido:u.value.id,status:7},n=await J.SaveChofi(o);if(n.status==200){let P={id:u.value.id,state:7,suply:_.value._suplier_id};console.log(P);let x=await J.nextState(P);if(console.log(x),x.status==200){se();let H=x.data.id,ne=p.value.findIndex(re=>re.id==H);p.value[ne]._status=x.data._status,p.value[ne].invoice=x.data.invoice}g.notify({message:"Pedido en ruta",position:"center",icon:"done",timeout:5e3,color:"positive"})}else alert(`Error ${n.status}: ${n.data}`)}}else alert(`Error ${a.status}: ${a.data}`);g.loading.hide()},ze=async a=>{let o=`http://192.168.10.189:2200/#/checkin/${u.value.id}?key=${a}`;i.value.state=!0,We(()=>Ve.toCanvas(document.getElementById("qrcode"),o))},Be=async a=>{g.loading.show({message:"..."}),console.log(a);const o=await G.printKey({ip:a.ip,port:a._port,order:u.value.id});o.status==200?(o.data,g.loading.hide(),g.notify({message:"Impresion correcta",icon:"done",color:"positive",position:"top"})):(console.error(o),alert(`Error ${o.status}: ${o.data}`))},je=async a=>{g.loading.show({message:"..."}),console.log(a);const o=await G.printForSupply({ip:a.ip,port:a._port,order:u.value.id});console.log(o),o.status==200?(o.data?g.notify({message:"Impresion correcta",icon:"done",color:"positive",position:"top"}):g.notify({message:`Sin conexion a <b>${a.name} <small>(${a.ip})</small></b>`,icon:"fas fa-bug",color:"negative",position:"center",html:!0,timeout:4e3}),g.loading.hide()):(console.error(o),alert(`Error ${o.status}: ${o.data}`))},Ge=async a=>{_.value=a,y.value.state=!0;let o=await J.getChof();console.log(o),f.value.opts=o.data},Ye=(a,o,n)=>{o(()=>{if(a==="")r.value.filter=r.value.opts;else{const P=a.toLowerCase();r.value.filter=r.value.opts.filter(x=>x.complete_name.toLowerCase().indexOf(P)>-1)}})},Ae=async(a,o)=>{let n={salida:a};const P=new Date;console.log(n);let x=await J.getSalida(n);if(console.log(x),x.status==200){const ne=`http://192.168.10.189:2200/#/checkin/${u.value.id}?key=${o}`,re={margin:1,width:1,height:1},Se=document.createElement("canvas");await Ve.toCanvas(Se,ne,re);const He=Se.toDataURL("image/png"),l=new _t;let ce=[];const ue=x.data.productos.map(te=>Object.values(te)),Je=Math.ceil(ue.length/20);for(var H=0;H<ue.length;H+=20)ce.push(ue.slice(H,H+20));console.log(ce);for(let te=0;te<2;te++){let Ee="ORIGINAL";te>0&&(Ee="COPIA",l.addPage()),ce.forEach(function(T,De){De>0&&l.addPage();let Ie=0,$e=0;for(let U=0;U<T.length;U++)T[U][1]=T[U][1]==0?1:parseFloat(T[U][1]),T[U][2]=parseFloat(T[U][2]),T[U][3]=parseFloat(T[U][3]),Ie+=parseFloat(T[U][1]),$e+=parseFloat(T[U][3]);for(let U=0;U<T.length;U++);l.setFontSize(25),l.setFont("helvetica","bold"),l.text("GRUPO VIZCARRA",105,10,"center"),l.setFontSize(8),l.text("NUMERO PEDIDO:",10,10,"left"),l.text(x.data.salida.FOLIO,10,15,"left"),l.setFontSize(12),l.text(Ee,185,10,"left"),l.text(x.data.salida.CLIENTE,10,25,"left"),l.text("LLUVIA LIGTH SA DE CV",120,25,"left"),l.setFontSize(8),l.text("CALLE AN PABLO 10 LOC G 10",120,30,"left"),l.text("06090",120,35,"left"),l.text("DELEG, CUAUHTEMOC CDMX       CENTRO",120,40,"left"),l.text("LLI1210184G8",120,45,"left"),l.text("HORA DE IMP:",10,50,"left"),l.rect(45,46,15,5),l.text(j(P).format("HH:mm:ss"),47,50),l.text("HR SALIDA M:",61,50,"left"),l.rect(91,46,15,5),l.text("LLEGADA A SUCURSAL:",10,60,"left"),l.rect(45,56,15,5),l.text("SALIDA SUCURSAL:",61,60,"left"),l.rect(91,56,15,5),l.rect(120,51,80,5),l.text("DOCUMENTO",121,55,"left"),l.text("FACTURA",121,60,"left"),l.text("NUMERO",143,55,"left"),l.text(x.data.salida.FACTURA,143,60,"left"),l.text("PAGINA",165,55,"left"),l.text(`${De+1} de ${Je}`,165,60,"left"),l.text("FECHA",185,55,"left");const Ze=j(x.data.salida.FECHA).format("YYYY-MM-DD");l.text(Ze,185,60,"left"),Le(l,{startX:10,startY:65,theme:"plain",styles:{cellPadding:1,fontSize:8,halign:"center"},head:[["CREADOR DOC","ALMACEN","AGENTE","FORMA DE PAGO"]],body:[["APP",x.data.salida.AMACEN,x.data.salida.AGENTE,x.data.salida.FPAGO]]}),Le(l,{startX:10,startY:80,theme:"striped",styles:{cellPadding:.6,fontSize:8,halign:"center"},head:[["ARTICULO","CAJAS","U.X CAJA","CANTIDAD","DESCRIPCION"]],body:T,columnStyles:{0:{fontStyle:"bold",halign:"left"},1:{fontStyle:"bold",halign:"center"},4:{halign:"left"}}}),l.setFontSize(11),l.text("TOTAL CAJAS:",10,200,"left"),l.text(Ie.toString(),40,200,"left"),l.text("TOTAL UNIDDADES:",60,200,"left"),l.text($e.toString(),100,200,"left"),l.setFontSize(8),l.text("Debo(emos) y pagare(mos) incondicionalmente por este pagare a la order de GRUPO VIZCARRA, en la ciudad de Mexico,",10,210,"left"),l.text("la cantidad de el valor recibido a mi(nuestra) entera satisfaccion",10,215,"left"),l.text("Este pagare forma parte de una serie numerica del 1 al y 9 y todos estos estan sujetos a la condicion, de que al no pagarse cualquiera de ellos a su",10,220,"left"),l.text("vencimiento sean exigibles todos los que le sigan en numero, ademas de los ya vencidosm desde la fecha de su vencimiento de el presente documento",10,225,"left"),l.text("hasta el dia de su liquidacion, causaran intereses moratorios al tipo del % mensual en esta ciudad justamente con el principal",10,230,"left"),l.setFontSize(15),l.text("______________",31,248,"center"),l.text("AUTORIZO",20,254,"left"),l.text("______________",85,248,"center"),l.text("CHOFER",75,254,"left"),l.text("______________",140,248,"center"),l.text("RECIBIO",130,254,"left"),l.text("______________",168,248,"left"),l.text("FECHA Y HORA",168,254,"left"),l.setFontSize(9),l.text("UNA VEZ ENTREGADA LA MERCANCIA EN LA FLETERA O DOMICILIO QUE INDIQUE EL CLIENTE ",10,260,"left"),l.text("LLUVIA LIGHT SA DE CV NO ES RESPONSABLE POR PEDIDAS TOTALES, PARCIALES ",10,265,"left"),l.text("O CUALQUIER TIPO DE DANO EN LA MERCANCIA DE ESTE DOCUMENTO ",10,270,"left"),l.setFont("helvetica","bold"),l.setFontSize(12),l.text("NO SE ACEPTAN CAMBIOS NI DEVOLUCIONES",10,280,"left"),l.setFontSize(25),l.setFont("helvetica","bold"),l.text("GRUPO VIZCARRA",105,10,"center"),l.addImage(He,"PNG",95,25,20,20)})}l.save(x.data.salida.FACTURA)}else console.error("No se logro imprimir la factura")};return Xe(()=>z.value=Y.value.columns.map(a=>a.name)),se(),(a,o)=>(v(),E(M,null,[e(Z,{class:"full-width"},{default:t(()=>[e(V,{class:"row justify-between"},{default:t(()=>[s("div",null,[wt,s("div",At,c(u.value.from.alias),1)]),s("div",St,[Et,s("div",Dt,c(u.value.id),1)]),s("div",It,[$t,s("div",Ot,c(u.value.created_by.nick),1)])]),_:1}),e(B),e(V,{class:"row justify-between"},{default:t(()=>[s("div",Vt,[Lt,s("div",Rt,c(N(j)(u.value.updated_at).format("YYYY-MM-DD")),1)]),u.value.notes?(v(),E("div",Ut,[Pt,s("div",qt,c(u.value.notes),1)])):q("",!0),s("div",Nt,[b.value&&b.value.id==2?(v(),L(k,{key:0,color:"positive",icon:"start",dense:"",label:"Iniciar Surtido",onClick:Qe,flat:"",rounded:""})):q("",!0),b.value&&b.value.id>2?(v(),L(k,{key:1,color:"indigo-10",icon:"print",dense:""},{default:t(()=>[e(pe,{class:"bg-grey-1 text-indigo-10",style:{"min-width":"250px"}},{default:t(()=>[e(Re,{onSelected:je})]),_:1})]),_:1})):q("",!0)])]),_:1}),e(B),Q.value?(v(),L(V,{key:0,class:"text-center"},{default:t(()=>[e(pt,{size:"50px",color:"purple"})]),_:1})):(v(),E(M,{key:1},[e(B),e(vt,{modelValue:O.value,"onUpdate:modelValue":o[0]||(o[0]=n=>O.value=n),class:"text-pink-5",dense:"","no-caps":""},{default:t(()=>[e(ve,{name:"log",label:"Log"}),e(ve,{name:"basket",label:"Productos"}),e(ve,{name:"supliers",label:"Surtidores"})]),_:1},8,["modelValue"]),e(ft,{modelValue:O.value,"onUpdate:modelValue":o[3]||(o[3]=n=>O.value=n),animated:""},{default:t(()=>[e(fe,{name:"log"},{default:t(()=>[e(ye,null,{default:t(()=>[(v(!0),E(M,null,K(w.value,n=>(v(),L(le,{key:n.id},{default:t(()=>[e($,{avatar:""},{default:t(()=>[C(c(n.id),1)]),_:2},1024),e($,null,{default:t(()=>[C(c(n.name),1)]),_:2},1024),e($,null,{default:t(()=>[C(c(n.pivot.details.responsable),1)]),_:2},1024),e($,null,{default:t(()=>[C("de "+c(N(j)(n.pivot.created_at).format("h:mm a"))+" a "+c(N(j)(n.pivot.updated_at).format("h:mm a")),1)]),_:2},1024)]),_:2},1024))),128))]),_:1})]),_:1}),e(fe,{name:"basket"},{default:t(()=>[A.value.length?(v(),L(ie,{key:0,"row-key":"id",flat:"",rows:A.value,columns:Y.value.columns,pagination:Y.value.pagination,filter:Y.value.filter,"visible-columns":z.value},{top:t(()=>[s("div",Tt,[s("div",Qt,[s("span",Ft,[e(k,{color:"pink-5",icon:"sync",onClick:se,round:"",dense:"",flat:""}),C(" Productos: "+c(A.value.length),1)]),C(", "),s("span",Mt,"Piezas: "+c(N(Te)),1)]),e(ke,{dense:"",modelValue:Y.value.filter,"onUpdate:modelValue":o[1]||(o[1]=n=>Y.value.filter=n),placeholder:"Buscar","input-class":"text-uppercase",color:"pink-5"},{append:t(()=>[e(de,{name:"search"})]),_:1},8,["modelValue"]),e(k,{color:"secondary",icon:"fas fa-eye","no-caps":""},{default:t(()=>[e(pe,{style:{"min-width":"200px"}},{default:t(()=>[e(ye,null,{default:t(()=>[(v(!0),E(M,null,K(Y.value.columns,(n,P)=>X((v(),L(le,{tag:"label",key:P},{default:t(()=>[e($,null,{default:t(()=>[e(ee,null,{default:t(()=>[C(c(n.label),1)]),_:2},1024),e(ee,{caption:""},{default:t(()=>[C(c(n.coldesc),1)]),_:2},1024)]),_:2},1024),e($,{side:"",top:""},{default:t(()=>[e(ot,{color:"pink-5",modelValue:z.value,"onUpdate:modelValue":o[2]||(o[2]=x=>z.value=x),val:n.name},null,8,["modelValue","val"])]),_:2},1024)]),_:2},1024)),[[Ue]])),128))]),_:1})]),_:1})]),_:1})])]),_:1},8,["rows","columns","pagination","filter","visible-columns"])):(v(),E("div",zt,"Nada por aqui"))]),_:1}),e(fe,{name:"supliers"},{default:t(()=>[e(ie,{rows:p.value,"row-key":"id",dense:"",flat:"",bordered:"",grid:"","hide-header":""},{item:t(n=>[s("div",Bt,[e(Z,{flat:"",bordered:""},{default:t(()=>[e(V,{class:"text-center"},{default:t(()=>[C(" Surtidor "),jt,s("strong",null,c(n.row._suplier),1),Gt,s("div",Yt,[e(mt,{color:"primary","text-color":"white",label:n.row.status.name},null,8,["label"])])]),_:2},1024),e(B),e(V,{class:"flex justify-between"},{default:t(()=>[Ht,Jt,Zt]),_:1}),e(B),e(V,{class:"flex justify-between"},{default:t(()=>[s("div",null,c(n.row.invoice),1),s("div",null,c(n.row.invoice_received),1),s("div",Kt,[n.row._status==6?(v(),E("div",Xt,[e(k,{color:"pink",label:"Emitir Factura",class:"q-px-xl q-py-xs",size:"10px",padding:"5px 2px","icon-right":"start",flat:"",onClick:P=>Ge(n.row)},null,8,["onClick"])])):q("",!0),n.row._status>=7?(v(),E("div",Wt,[e(k,{color:"pink",icon:"qr_code",onClick:P=>ze(n.row.entry_key),flat:""},null,8,["onClick"])])):q("",!0),n.row._status>=7?(v(),E("div",ea,[e(k,{color:"pink",icon:"list",onClick:P=>Ae(n.row.invoice,n.row.entry_key),flat:""},null,8,["onClick"])])):q("",!0)])]),_:2},1024)]),_:2},1024)])]),_:1},8,["rows"])]),_:1})]),_:1},8,["modelValue"])],64))]),_:1}),e(W,{modelValue:i.value.state,"onUpdate:modelValue":o[4]||(o[4]=n=>i.value.state=n)},{default:t(()=>[e(Z,null,{default:t(()=>[e(V,{class:"text-h6 text-center"},{default:t(()=>[C(c(u.value.id)+" - "+c(u.value.from.alias),1)]),_:1}),e(B),e(V,{class:"text-center"},{default:t(()=>[ta,s("div",aa,c(i.value.key),1)]),_:1}),e(B),e(V,{align:"center"},{default:t(()=>[e(k,{color:"indigo-10",icon:"print"},{default:t(()=>[e(pe,null,{default:t(()=>[e(Re,{onSelected:Be})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]),e(W,{modelValue:y.value.state,"onUpdate:modelValue":o[6]||(o[6]=n=>y.value.state=n)},{default:t(()=>[e(Z,null,{default:t(()=>[e(V,{class:"row items-start"},{default:t(()=>[e(Pe,{icon:"warning",color:"orange-14","text-color":"white"}),la]),_:1}),e(V,null,{default:t(()=>[s("div",null,[oa,s("div",sa,c(_.value._suplier),1)])]),_:1}),_.value?(v(),L(V,{key:0},{default:t(()=>[e(ae,{modelValue:f.value.val,"onUpdate:modelValue":o[5]||(o[5]=n=>f.value.val=n),options:f.value.opts,label:"Chofer",filled:"","option-label":"complete_name"},null,8,["modelValue","options"])]),_:1})):q("",!0),e(xe,{align:"right"},{default:t(()=>[X(e(k,{flat:"",label:"Cancelar",color:"primary","no-caps":""},null,512),[[he]]),e(k,{flat:"",label:"Continuar",color:"primary",onClick:Me,"no-caps":"",disable:f.value.val==null},null,8,["disable"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),e(W,{modelValue:d.value.state,"onUpdate:modelValue":o[8]||(o[8]=n=>d.value.state=n),persistent:""},{default:t(()=>[e(Z,{style:{width:"400px"}},{default:t(()=>[e(V,{class:"row items-center"},{default:t(()=>[e(ae,{modelValue:r.value.val,"onUpdate:modelValue":o[7]||(o[7]=n=>r.value.val=n),options:r.value.filter,label:"SELECCIONA SURTIDOR","option-label":"complete_name",filled:"",multiple:"",counter:"","max-values":"5",hint:"Maximo 5 colaboradores",style:{width:"100%"},onFilter:Ye,"input-debounce":"0","use-input":"","use-chips":""},null,8,["modelValue","options"])]),_:1}),e(xe,{align:"right"},{default:t(()=>[X(e(k,{flat:"",label:"Cancel",color:"primary"},null,512),[[he]]),e(k,{flat:"",label:"Continuar",color:"primary",onClick:Fe,disable:r.value.val.length==0},null,8,["disable"])]),_:1})]),_:1})]),_:1},8,["modelValue"])],64))}};var me=qe({name:"QTr",props:{props:Object,noHover:Boolean},setup(D,{slots:h}){const I=R(()=>"q-tr"+(D.props===void 0||D.props.header===!0?"":" "+D.props.__trClass)+(D.noHover===!0?" q-tr--no-hover":""));return()=>ge("tr",{class:I.value},be(h.default))}}),_e=qe({name:"QTd",props:{props:Object,autoWidth:Boolean,noHover:Boolean},setup(D,{slots:h}){const I=et(),g=R(()=>"q-td"+(D.autoWidth===!0?" q-table--col-auto-width":"")+(D.noHover===!0?" q-td--no-hover":"")+" ");return()=>{if(D.props===void 0)return ge("td",{class:g.value},be(h.default));const r=I.vnode.key,f=(D.props.colsMap!==void 0?D.props.colsMap[r]:null)||D.props.col;if(f===void 0)return;const{row:_}=D.props;return ge("td",{class:g.value+f.__tdClass(_),style:f.__tdStyle(_)},be(h.default))}}});const ia={class:"text-h6"},da={class:"row q-mt-md"},ra={class:"q-ml-sm text-h6"},ca={__name:"TableReport",props:{rows:{type:Array,default:[]},name:{type:String,default:""},type:{type:String,default:""}},emits:["cardResumeActived"],setup(D,{emit:h}){const I=D;we();const g=oe(),r=m({state:!1,action:null}),f=m({columns:[{name:"ID",field:"ID",label:"ID",align:"center"},{name:"code",field:"CODIGO",label:"Codigo",align:"center",sortable:!0},{name:"desc",field:"DESCRIPCION",label:"Descripcion",align:"left"},{name:"stockcedis",field:"CEDIS",label:"Stock (CEDIS)",align:"center",sortable:!0},{name:"stockpan",field:"PANTACO",label:"Stock (PAN)",align:"center",sortable:!0}],filter:""}),_={pndcs:{l:"Habilitar todo",c:"indigo-13",desc:"Los productos en esta lista se habilitaran y podran ser solicitados por cuaqluier tienda."},pdss:{l:"Deshabilitar todo",c:"pink-13",desc:"Los productos en esta lista se deshabilitaran y no podran ser solicitados."}},u=m(I.rows),Q=m(I.name),w=m(I.type),O=R(()=>w.value?_[w.value]:{l:"",c:""}),b=()=>{const y=_[w.value];r.value.action=y,r.value.state=!0},A=async()=>{g.loading.show({message:"Espera..."});const y=await G.massiveAction({action:w.value});console.log(y),y.status==200?(y.data,r.value.state=!1,r.value.action=null,g.loading.hide(),g.notify({position:"center",color:"positive",icon:"done"}),h("cardResumeActived")):(console.error(y.data),alert(`Error ${y.status}: ${y.data.msg}`))},F=(y,i,p)=>{console.log(y),console.log(i),console.log(p),console.log(w.value)};return(y,i)=>(v(),E(M,null,[e(ie,{"row-key":"ID",rows:u.value,columns:f.value.columns,filter:f.value.filter,onRowClick:F},{top:t(()=>[s("div",ia,c(Q.value),1),s("div",da,[e(k,{color:N(O).c,icon:"warning",label:N(O).l,onClick:b},null,8,["color","label"]),e(ke,{modelValue:f.value.filter,"onUpdate:modelValue":i[0]||(i[0]=p=>f.value.filter=p),dense:"",type:"text",icon:"search",label:"Buscar"},{prepend:t(()=>[e(de,{name:"search"})]),_:1},8,["modelValue"])])]),_:1},8,["rows","columns","filter"]),e(W,{modelValue:r.value.state,"onUpdate:modelValue":i[1]||(i[1]=p=>r.value.state=p),persistent:""},{default:t(()=>[e(Z,null,{default:t(()=>[e(V,{class:"row items-center"},{default:t(()=>[e(Pe,{icon:"warning",color:r.value.action.c,"text-color":"white"},null,8,["color"]),s("span",ra,c(r.value.action.l),1)]),_:1}),e(V,null,{default:t(()=>[C(c(r.value.action.desc),1)]),_:1}),e(xe,{align:"right"},{default:t(()=>[X(e(k,{flat:"",label:"cancelar",color:"primary"},null,512),[[he]]),e(k,{flat:"",label:"continuar",color:"primary",onClick:A})]),_:1})]),_:1})]),_:1},8,["modelValue"])],64))}},ua={key:0,class:"bg-negative text-white q-pa-md q-mb-md"},pa=s("div",{class:"text-warning text-bold"},"Los siguientes folios tienen errores que no permiten ser listados en la tabla. ",-1),va={class:"text-h6"},fa=s("div",{class:"text--2"},"Errores comunes: Sin log, Sin fecha, Estatus desconocido",-1),ma={class:"row q-mb-md items-start justify-around"},_a={class:"text-left"},ga={class:"text-h5"},ba={class:"text--2"},ya={class:"full-width row items-center"},xa={class:"col text-h6 text-dark"},ha={__name:"AdminDashboard",emits:["reloadDashboard"],setup(D,{emit:h}){Ce(),Ne();const I=we(),g=oe(),r=["text-grey-5 text-bold","text-bold text-h6 text-red","text-indigo","4","5","text-bold text-pink-7","text-orange-8","8","text-primary","text-positive"],f=m({columns:[{name:"id",label:"Folio",field:"id",align:"center",sortable:!0},{name:"state",label:"Estado",field:i=>i.log.length==1?i.log[0].name:i.log[i.log.length-1].name,align:"left",sortable:!0,sort:(i,p,d,S)=>parseInt(d._status)-parseInt(S._status),classes:i=>r[i._status-1]},{name:"suplier",label:"Surtidores",field:i=>{var p;return(p=i.partition)==null?void 0:p.length},align:"center",classes:"text-bold"},{name:"laststate",label:"Ultima actividad",field:i=>j(i.log.find(p=>p.id==i.status.id).pivot.updated_at).format("YYYY-MM-DD hh:mm A"),align:"left"},{name:"from",label:"Sucursal",field:i=>i.from.name.toUpperCase(),align:"left",sortable:!0},{name:"to",label:"Destino",field:i=>i.to.name.toUpperCase(),align:"left",sortable:!0},{name:"notes",label:"Notas",field:i=>i.notes,align:"left",classes:i=>i.notes?"text-orange text-bold":""},{name:"tmodels",label:"Modelos",field:i=>i.products_count,align:"center",sortable:!0}],filter:"",pagination:{sortBy:"desc",descending:!1,rowsPerPage:20}}),_=m({state:!1,title:"",data:null,name:null,type:null}),u=m({state:!1,head:null,block:!0}),Q=R(()=>I.ordersSize),w=R(()=>I.ordersok),O=R(()=>I.orderserrors),b=R(()=>I.resume),A=async i=>{console.log(i.row),u.value.head=i.row,u.value.state=!0},F=async i=>{g.loading.show({message:"cargando..."+i});const p=await G.report(i);console.log(p.data),_.value.data=p.data.rows,_.value.name=p.data.name,_.value.type=i,_.value.state=!0,g.loading.hide()},y=()=>{_.value.state=!1,_.state=!1,h("reload")};return(i,p)=>(v(),L(st,{padding:"",class:"bg-grey-2"},{default:t(()=>[N(O).length?(v(),E("div",ua,[pa,s("div",va,c(N(O).map(d=>d.id).join("id")),1),fa])):q("",!0),s("div",ma,[(v(!0),E(M,null,K(N(b),d=>(v(),L(k,{stack:"","no-caps":"",class:"q-py-md",key:d.key,onClick:S=>F(d.key),color:d.total==0?"teal-10":"pink-13",disabled:d.total==0},{default:t(()=>[s("div",_a,[s("div",ga,c(d.total),1),s("div",ba,c(d.name),1)])]),_:2},1032,["onClick","color","disabled"]))),128))]),e(ie,{flat:"",bordered:"","row-key":"id",rows:N(w),columns:f.value.columns,filter:f.value.filter,pagination:f.value.pagination},{header:t(d=>[e(me,{props:d},{default:t(()=>[e(Oe,{"auto-width":""}),(v(!0),E(M,null,K(d.cols,S=>(v(),L(Oe,{key:S.name,props:d},{default:t(()=>[C(c(S.label),1)]),_:2},1032,["props"]))),128))]),_:2},1032,["props"])]),body:t(d=>[e(me,{props:d},{default:t(()=>[e(_e,{"auto-width":""},{default:t(()=>[e(k,{size:"sm",dense:"",round:"",flat:"",onClick:S=>d.expand=!d.expand,icon:d.expand?"expand_less":"expand_more"},null,8,["onClick","icon"])]),_:2},1024),(v(!0),E(M,null,K(d.cols,S=>(v(),L(_e,{key:S.name,props:d,onClick:z=>A(d)},{default:t(()=>[C(c(S.value),1)]),_:2},1032,["props","onClick"]))),128))]),_:2},1032,["props"]),X(e(me,{props:d},{default:t(()=>[e(_e,{colspan:"100%"},{default:t(()=>[e(ye,{dense:"",padding:"",class:"rounded-borders"},{default:t(()=>[e(le,null,{default:t(()=>[e($,null,{default:t(()=>[C("ID")]),_:1}),e($,null,{default:t(()=>[C("ESTADO")]),_:1}),e($,null,{default:t(()=>[C(" SALIDA")]),_:1}),e($,null,{default:t(()=>[C("ENTRADA")]),_:1})]),_:1}),(v(!0),E(M,null,K(d.row.partition,(S,z)=>(v(),E("div",{key:z},[e(le,null,{default:t(()=>[e($,null,{default:t(()=>[e(ee,{overline:""},{default:t(()=>[C(c(S._suplier),1)]),_:2},1024),e(ee,{caption:""},{default:t(()=>[C(c(S.id),1)]),_:2},1024)]),_:2},1024),e($,{class:tt(`${r[S.status.id-1]}`)},{default:t(()=>[C(c(S.status.name),1)]),_:2},1032,["class"]),e($,null,{default:t(()=>[C(c(S.invoice),1)]),_:2},1024),e($,null,{default:t(()=>[C(c(S.invoice_received),1)]),_:2},1024)]),_:2},1024),e(B,{spaced:"",inset:""})]))),128))]),_:2},1024)]),_:2},1024)]),_:2},1032,["props"]),[[at,d.expand]])]),top:t(()=>[s("div",ya,[s("div",xa,"Pedidos: "+c(N(Q)),1),e(ke,{dense:"",modelValue:f.value.filter,"onUpdate:modelValue":p[0]||(p[0]=d=>f.value.filter=d),"input-class":"text-uppercase",placeholder:"Buscar",color:"pink-5"},{append:t(()=>[e(de,{name:"search"})]),_:1},8,["modelValue"])])]),_:1},8,["rows","columns","filter","pagination"]),e(W,{"full-width":"",modelValue:u.value.state,"onUpdate:modelValue":p[3]||(p[3]=d=>u.value.state=d),persistent:u.value.block,"no-esc-dismiss":u.value.block,"no-backdrop-dismiss":u.value.block},{default:t(()=>[e(na,{head:u.value.head,onLoaded:p[1]||(p[1]=d=>u.value.block=!1),onLoading:p[2]||(p[2]=d=>u.value.block=!0)},null,8,["head"])]),_:1},8,["modelValue","persistent","no-esc-dismiss","no-backdrop-dismiss"]),e(W,{modelValue:_.value.state,"onUpdate:modelValue":p[4]||(p[4]=d=>_.value.state=d)},{default:t(()=>[e(ca,{rows:_.value.data,name:_.value.name,type:_.value.type,onCardResumeActived:y},null,8,["rows","name","type"])]),_:1},8,["modelValue"])]),_:1}))}};const Ca=s("div",{class:"text-bold"},"Dashboard ",-1),ka={class:"row"},wa={class:"col row"},Oa={__name:"DashboardLyt",setup(D){const h=Ce(),I=Ne(),g=we(),r=oe(),f=m([{id:0,alias:"Todas"},{id:1,alias:"CEDIS",_state:1},{id:2,alias:"SP1",_state:1}]),_=m([{id:"day",label:"Hoy"},{id:"week",label:"Semana"},{id:"month",label:"Mes"},{id:"C",label:"otra ...",disable:!0}]),u=["p2","P2","p3","P3","bol","BOL","sap","SAP"],Q=m(null),w=m(null),O=m({from:j(Date.now()).startOf("day"),to:j(Date.now()).startOf("day")}),b=async()=>{var S;r.loading.show({message:"Cargado vista..."}),console.log("%cIniciando MainLayout...","font-size:2em;color:orange;");let F=(S=h.query.v)!=null?S:"day",y=_.value.findIndex(z=>z.id==F),i=y>=0?y:0;w.value=_.value[i],O.value.from=j(Date.now()).startOf(w.value.id);let p=h.query.d&&u.includes(h.query.d)?h.query.d:"all";console.log(p);const d=await G.index(w.value.id,p);console.log(d),g.fillOrders(d.orders),g.fillResume(d.resume),g.fillPrinters(d.printers),Q.value=f.value[0],console.log("%cMainLayout listo!!","font-size:2em;color:orange;"),r.loading.hide()},A=F=>{let y=h.query.d&&u.includes(h.query.d)?h.query.d:"all";I.push(`/dashboard?v=${F.id}&d=${y}`)};return R(()=>O.value.from.format("YYYY/MM/DD")),R(()=>O.value.to.format("YYYY/MM/DD")),lt(()=>h.query,()=>{b()}),b(),document.title="Dashboard",(F,y)=>(v(),L(nt,{view:"lHh Lpr lFf"},{default:t(()=>[e(dt,{bordered:"",class:"bg-yellow text-dark"},{default:t(()=>[e(it,{class:"row justify-between items-center"},{default:t(()=>[Ca,s("div",ka,[e(k,{color:"dark",round:"",unelevated:"",flat:"",icon:"sync",onClick:b}),s("div",wa,[e(ae,{class:"col",dense:"",filled:"",label:"Vista",modelValue:w.value,"onUpdate:modelValue":[y[0]||(y[0]=i=>w.value=i),A],options:_.value},null,8,["modelValue","options"]),w.value.id=="C"?(v(),L(k,{key:0,unelevated:"",color:"pink-5",icon:"fas fa-calendar-day",dense:""})):q("",!0)])])]),_:1})]),_:1}),e(rt,null,{default:t(()=>[e(ha,{onReload:b})]),_:1})]),_:1}))}};export{Oa as default};
