import{r as u,c as x,o as p,b as w,w as o,u as Ee,a as Pe,d as a,h as b,e as m,aE as c,t as n,f as s,aF as q,i as E,aJ as J,Q as W,aG as X,aH as Y,aI as Ue,ax as B,aK as qe,aL as De,aM as $e,x as Ie,R as ne}from"./index.f89a5d2a.js";import{Q as je,a as Re,b as de}from"./QFooter.cfbdbe16.js";import{Q as ue}from"./QSpace.96e22552.js";import{c as Ae,u as ze,R as P,d as Te,o as Z,f as Be,s as D,v as f,e as re,w as ee,t as $,b as Le,Q as ce,a as I,p as pe,q as ve,x as te,y as j,z as U,g as Fe,A as me,C as fe}from"./ClosePopup.97ffcdde.js";import"./dayjs.min.53a5c0af.js";import{p as Ne}from"./pdfCreate.b8306e3f.js";import{A as L}from"./AssistApi.8d05192a.js";import"./axios.4ac73f8a.js";import"./jspdf.plugin.autotable.cbc84ec1.js";const Ke={class:"q-px-md q-py-sm"},He={class:"col row justify-between"},Me={key:0,class:"row items-center justify-between q-pt-sm"},Oe=s("span",{class:"text--2"},"Por revisar:",-1),Ge=s("span",{class:"text--2"},"Revisados:",-1),Je=s("span",{class:"text--2"},"Agotados:",-1),We=s("span",{class:"text--2"},"Con stock:",-1),Xe={class:"q-mx-sm text-h6"},Ye={class:"row"},Ze={class:"col"},et=s("div",{class:"text-h6"},"Productos sin revisar",-1),tt={class:"full-width row items-center justify-between"},at={class:"col"},lt=s("div",{class:"text-h6"},"Productos revisados",-1),ot={class:"full-width row items-center justify-between"},st={class:"row justify-between"},it={class:"text-left"},nt={class:"text--3"},dt={class:"text-h6"},ut={class:"text-right"},rt={class:"text-bold"},ct={class:"text--2"},pt={class:"text-center"},vt={class:"text-h6"},mt=s("div",{class:"text--2"},"PxC",-1),ft={class:"text-h6"},_t={class:"text--2"},bt={class:"row items-start justify-between"},gt={class:"text-center col text-primary"},yt=s("div",null,"Solicitud",-1),ht={class:"text-bold"},xt={class:"text-center col"},kt=s("div",null,"Conteo",-1),wt={class:"text-center col"},Vt=s("div",null,"PxC",-1),Ct={class:"text-center col"},Qt=s("div",null,"Piezas",-1),St={class:"text-bold"},Et=s("div",{class:"q-ml-md"},[s("div",{class:"text-h6 text-bold"},"Deseas terminar la revision?")],-1),Pt=s("div",null,"EL pedido ya no podra editarse y se emitira la salida correspondiente",-1),Ut=s("div",null,"en factusol",-1),qt={class:"q-ml-sm"},Dt={class:"q-ml-sm"},$t=s("div",null,"Quien Surtio?",-1),It={class:"q-pa-md text-bold text-uppercase text-center"},Ht={__name:"Checkout",setup(jt){const _=Ee(),_e=Pe(),g=ze();u({state:!1});const ae=u({state:!1,key:null}),F=u({state:!0}),N=u(!0),y=u({val:null,opts:[]}),r=u(null),C=u(["code","assocs","ipack","request","uspply","delivery","reqinpzs","checkout","stocks"]),V=u([]),k=u(""),K=u(null),le=u(null),H=u(null),v=u({columns:[{name:"id",label:"ID",field:"id",align:"left",coldesc:"Identificador del producto (MySQL)"},{name:"code",label:"Codigo",field:"code",align:"left",coldesc:"Codigo principal del producto"},{name:"assocs",label:"Asociados",field:e=>e.variants.length?e.variants.map(t=>t.barcode).join(", "):null,align:"left",coldesc:"Codigos relacionados al codigo principal"},{name:"bcode",label:"Codigo de Barras",field:"barcode",align:"center",coldesc:"Codigo de barras principal"},{name:"locs",label:"Ubicacion",field:e=>e.locations.length?e.locations.map(t=>t.path).join(", "):"--",align:"left",coldesc:"Ubicaciones en almacen general"},{name:"ipack",label:"PxC",field:e=>typeof e.pivot.ipack=="number"?e.pivot.ipack:e.pieces,align:"center",coldesc:"Unidades x Embalaje"},{name:"request",label:"Solicitud",field:e=>e.pivot.amount,align:"center",coldesc:"Embalaje solicitado"},{name:"uspply",label:"Unidad",field:e=>e.pivot._supply_by==3?"Cajas":e.pivot._supply_by==2?"Docenas":"Piezas",align:"left",coldesc:"Unidad de embalaje del producto"},{name:"delivery",label:"Conteo",field:e=>e.pivot.toDelivered,align:"center",coldesc:"Embalaje surtido",sortable:!0},{name:"reqinpzs",label:"Piezas",field:e=>e.pivot._supply_by==3?(typeof e.pivot.ipack=="number"?e.pivot.ipack:e.pieces)*(typeof e.pivot.ipack=="number"?e.pivot.toDelivered:e.pivot.amount):typeof e.pivot.ipack=="number"?e.pivot.toDelivered:e.pivot.amount,align:"center",coldesc:"Unidades totales en embalaje"},{name:"checkout",label:"Checkout",field:e=>e.pivot.checkout?"OK":null,classes:e=>e.pivot.checkout?"text-positive text-bold":"",align:"center",coldesc:"Revision del Administrador"},{name:"descr",label:"Descripcion",field:"description",align:"left"},{name:"section",label:"Seccion",field:"section",align:"left"},{name:"family",label:"Familia",field:"family",align:"left"},{name:"category",label:"Categoria",field:"category",align:"left"},{name:"stocks",label:"Stock (pzs)",field:e=>e.stocks.reduce((t,l)=>t+l.pivot.stock,0),sortable:!0,classes:e=>e.stocks.reduce((t,l)=>t+l.pivot.stock,0)<=0?"text-red text-bold":"text-bold text-primary",align:"center",coldesc:"Stock total en almacenes GENERALES (CEDIS+PAN)"}],filter:"",pagination:{sortBy:"locs",descending:!1,rowsPerPage:10}}),i=u({state:!1,item:null,form:{count:0,ipack:null,setting:!1}}),Q=u({val:null,opts:null}),R=u([]),A=u({state:!1,code:null,text:null}),z=u({state:!1}),M=x(()=>y.value.val?V.value.filter(e=>e.pivot._suplier_id==y.value.val._suplier_id):[]),oe=x(()=>r.value?r.value._status==5:!1),be=x(()=>M.value.reduce((e,t)=>e+(t.pivot._supply_by==3?t.pivot.amount*t.pieces:t.pivot.amount),0)),O=x(()=>M.value.filter(e=>!e.pivot.checkout)),S=x(()=>M.value.filter(e=>e.pivot.checkout)),ge=x(()=>S.value.filter(e=>e.pivot.toDelivered==0)),ye=x(()=>S.value.filter(e=>e.pivot.toDelivered>0)),T=x(()=>{let e=k.value.toUpperCase().trim();return e.length?O.value.filter(t=>t.code.match(e)||t.barcode&&t.barcode.match(e)):O.value}),he=x(()=>{let e=k.value.toUpperCase().trim();return e.length?S.value.filter(t=>t.code.match(e)||t.barcode&&t.barcode.match(e)):S.value}),G=async()=>{g.loading.show({message:"Cargando..."}),console.log("Iniciando...");const e=await P.order(_.params.oid);if(console.log(e),e.status==200){V.value=e.data.products,H.value=e.data.status,R.value=e.data,y.value.opts=e.data.partition;let t=await L.getVerified();console.log(t),Q.value.opts=t,g.loading.hide()}else displayErrRequest(e)},xe=e=>{r.value=e,e._status==5&&(N.value=!1)},se=(e,t,l)=>oe.value?ie(t):null,ie=e=>{console.log(e),i.value.item=e,i.value.form.count=typeof e.pivot.toDelivered=="number"?e.pivot.toDelivered:0,i.value.form.ipack=typeof e.pivot.ipack=="number"?e.pivot.ipack:e.pieces,i.value.state=!0,Ie(()=>{K.value.focus(),K.value.select()})},ke=()=>{let e=k.value.toUpperCase().trim();if(e.length){let t=T.value.length==1?T.value[0]:T.value.find(l=>l.code==e||l.barcode==e);t?ie(t):g.notify({message:`Sin coincidencias para <b>${e}</b>`,color:"pink-5",position:"center",html:!0})}},we=async()=>{const e=parseInt(i.value.form.count),t=parseInt(i.value.form.ipack),l={order:_.params.oid,product:i.value.item.id,delivery:e,ipack:t,checkout:!0},d=await P.setDeliveryProduct(l);if(console.log(d),d.status==200){console.log(d.data);let h=V.value.findIndex(Se=>Se.id==i.value.item.id);V.value[h].pivot.toDelivered=e,V.value[h].pivot.ipack=t,V.value[h].pivot.checkout=1,i.value.state=!1,k.value="",g.notify({color:"positive",icon:"done",position:"right",message:""})}else alert(`Error ${d.status}: ${d.data}`)},Ve=async()=>{g.loading.show({message:"Terminando, espera..."}),z.value.state=!1;let e={id:_.params.oid,state:6,suply:y.value.val._suplier_id};console.log(e);let t=await L.nextState(e);if(t.status==200){r.value._status=t.data.partition._status,r.value.status.name=t.data.partition.name;const l=await P.genInvoice(_.params.oid,r.value._suplier_id);if(console.log(l),t.data.partitionsEnd>R.value._status){let d={id:_.params.oid,state:t.data.partitionsEnd};const h=await P.nextState(d);console.log(h)}if(l.status==200){if(l.data.invoice){g.notify({message:`Se genero la salida <b class="text-h6">${l.data.invoice.folio}</b>`,html:!0,position:"center",icon:"done",timeout:5e3,color:"positive"}),ae.value.key=l.data.requisition.entry_key,Ne.pdf(l.data.invoice.folio,ae.value.key,_.params.oid),console.log(r.value.id);const d=await P.genEntry(r.value.id);console.log(d),d.status==200?(console.log(d.data),d.data?g.notify({message:`Se genero la Entrada <b class="text-h6">${d.data.invoice.folio}</b>`,html:!0,position:"center",icon:"done",timeout:5e3,color:"orange"}):alert("Error 500: Ocurrio un error inesperado :(")):(alert(`Error ${l.status}: ${l.data}`),console.log(l.data))}}else alert(`Error ${l.status}: ${l.data}`);console.log(t)}else console.log(t);g.loading.hide()},Ce=async()=>{let e={id:_.params.oid,state:5,suply:y.value.val._suplier_id};console.log(e);let t=await L.nextState(e);if(t.status==200){if(r.value._status=t.data.partition._status,r.value.status.name=t.data.partition.name,console.log(t),t.data.partitionsEnd>R.value._status){let l={id:_.params.oid,state:t.data.partitionsEnd};const d=await P.nextState(l);console.log(d)}}else console.log(t)},Qe=async()=>{g.loading.show({message:"Inicando, espera..."});let e={pedido:_.params.oid,surtidor:y.value.val._suplier_id,verified:Q.value.val.id};console.log(e);let t=await L.SaveVerified(e);console.log(t),t.status==200?(G(),F.value.state=!1,g.loading.hide()):alert(`Error ${t.status}: ${t.data} 2`)};return G(),(e,t)=>(p(),w(Ae,{view:"hHh Lpr fFf"},{default:o(()=>[a(Be,{bordered:"",class:"bg-cyan-10"},{default:o(()=>[a(Te,null,{default:o(()=>{var l;return[a(b,{flat:"",round:"",dense:"",icon:"arrow_back",onClick:t[0]||(t[0]=d=>{m(_e).replace("/checkout")})}),a(je,null,{default:o(()=>[c(" Pedido "+n(m(_).params.oid),1)]),_:1}),c(" "+n((l=r.value)==null?void 0:l._suplier)+" ",1),a(ue),c(" "+n(R.value.notes)+" ",1),a(ue),a(b,{color:"white",icon:"sync",onClick:G,round:"",dense:"",flat:""})]}),_:1}),a(Z),s("div",Ke,[s("div",He,[s("div",null,[c("Productos: "),s("b",null,n(V.value.length),1)]),s("div",null,[c("Piezas: "),s("b",null,n(m(be)),1)])]),H.value&&H.value.id>=3?(p(),q("div",Me,[s("div",null,[Oe,c(),s("b",null,n(m(O).length),1)]),s("div",null,[Ge,c(),s("b",null,n(m(S).length),1)]),s("div",null,[Je,c(),s("b",null,n(m(ge).length),1)]),s("div",null,[We,c(),s("b",null,n(m(ye).length),1)])])):E("",!0)])]),_:1}),r.value&&r.value._status==5&&r.value._out_verified==null?(p(),w(D,{key:0,modelValue:F.value.state,"onUpdate:modelValue":t[2]||(t[2]=l=>F.value.state=l),persistent:""},{default:o(()=>[a($,null,{default:o(()=>[a(f,{class:"row items-center"},{default:o(()=>[a(J,{icon:"warning",color:"orange-14","text-color":"white"}),s("span",Xe,"Iniciar CheckOut #"+n(m(_).params.oid),1)]),_:1}),a(f,null,{default:o(()=>[a(re,{modelValue:Q.value.val,"onUpdate:modelValue":t[1]||(t[1]=l=>Q.value.val=l),options:Q.value.opts,label:"Verificador","option-label":"complete_name",filled:""},null,8,["modelValue","options"])]),_:1}),a(ee,{vertical:"",align:"center"},{default:o(()=>[a(b,{flat:"",label:"Si",color:"primary",onClick:Qe,disable:Q.value.val==null},null,8,["disable"])]),_:1})]),_:1})]),_:1},8,["modelValue"])):E("",!0),a(Fe,null,{default:o(()=>[a(Le,{padding:""},{default:o(()=>[s("div",Ye,[s("div",Ze,[et,a(ce,{"row-key":"id",flat:"",rows:m(T),columns:v.value.columns,pagination:v.value.pagination,filter:v.value.filter,"visible-columns":C.value,onRowClick:se},{top:o(()=>[s("div",tt,[a(I,{dense:"",modelValue:v.value.filter,"onUpdate:modelValue":t[3]||(t[3]=l=>v.value.filter=l),placeholder:"Buscar","input-class":"text-uppercase",color:"pink-5"},{append:o(()=>[a(W,{name:"search"})]),_:1},8,["modelValue"]),a(b,{color:"secondary",icon:"fas fa-eye","no-caps":""},{default:o(()=>[a(pe,{style:{"min-width":"200px"}},{default:o(()=>[a(ve,null,{default:o(()=>[(p(!0),q(Y,null,X(v.value.columns,(l,d)=>B((p(),w(te,{tag:"label",key:d},{default:o(()=>[a(j,null,{default:o(()=>[a(U,null,{default:o(()=>[c(n(l.label),1)]),_:2},1024),a(U,{caption:""},{default:o(()=>[c(n(l.coldesc),1)]),_:2},1024)]),_:2},1024),a(j,{side:"",top:""},{default:o(()=>[a(me,{color:"pink-5",modelValue:C.value,"onUpdate:modelValue":t[4]||(t[4]=h=>C.value=h),val:l.name},null,8,["modelValue","val"])]),_:2},1024)]),_:2},1024)),[[ne]])),128))]),_:1})]),_:1})]),_:1})])]),_:1},8,["rows","columns","pagination","filter","visible-columns"])]),a(Z,{vertical:""}),s("div",at,[lt,a(ce,{"row-key":"id",flat:"",rows:m(he),columns:v.value.columns,pagination:v.value.pagination,filter:v.value.filter,"visible-columns":C.value,onRowClick:se},{top:o(()=>[s("div",ot,[a(I,{dense:"",modelValue:v.value.filter,"onUpdate:modelValue":t[5]||(t[5]=l=>v.value.filter=l),placeholder:"Buscar","input-class":"text-uppercase",color:"pink-5"},{append:o(()=>[a(W,{name:"search"})]),_:1},8,["modelValue"]),a(b,{color:"secondary",icon:"fas fa-eye","no-caps":""},{default:o(()=>[a(pe,{style:{"min-width":"200px"}},{default:o(()=>[a(ve,null,{default:o(()=>[(p(!0),q(Y,null,X(v.value.columns,(l,d)=>B((p(),w(te,{tag:"label",key:d},{default:o(()=>[a(j,null,{default:o(()=>[a(U,null,{default:o(()=>[c(n(l.label),1)]),_:2},1024),a(U,{caption:""},{default:o(()=>[c(n(l.coldesc),1)]),_:2},1024)]),_:2},1024),a(j,{side:"",top:""},{default:o(()=>[a(me,{color:"pink-5",modelValue:C.value,"onUpdate:modelValue":t[6]||(t[6]=h=>C.value=h),val:l.name},null,8,["modelValue","val"])]),_:2},1024)]),_:2},1024)),[[ne]])),128))]),_:1})]),_:1})]),_:1})])]),_:1},8,["rows","columns","pagination","filter","visible-columns"])])]),a(D,{modelValue:i.value.state,"onUpdate:modelValue":t[9]||(t[9]=l=>i.value.state=l),position:"bottom",onHide:t[10]||(t[10]=l=>le.value.focus())},{default:o(()=>[i.value.item?(p(),w($,{key:0},{default:o(()=>[a(f,{class:"bg-grey-3"},{default:o(()=>[s("div",st,[s("div",it,[s("div",nt,"ID: "+n(i.value.item.id),1),s("div",dt,n(i.value.item.code),1)]),s("div",ut,[s("div",rt,n(i.value.item.name),1),s("div",ct,n(i.value.item.barcode),1)])])]),_:1}),a(Z),a(f,null,{default:o(()=>[c(n(i.value.item.description),1)]),_:1}),a(f,{class:"row justify-around items-center"},{default:o(()=>[s("div",pt,[s("div",vt,n(i.value.item.pieces),1),mt]),(p(!0),q(Y,null,X(i.value.item.stocks,l=>(p(),q("div",{key:l.id,class:"text-center"},[s("div",ft,n(l.pivot.gen),1),s("div",_t,n(l.alias),1)]))),128))]),_:1}),a(Re,{onSubmit:Ue(we,["prevent"])},{default:o(()=>[a(f,null,{default:o(()=>[s("div",bt,[s("div",gt,[yt,s("div",ht,n(i.value.item.pivot.amount)+" "+n(i.value.item.pivot._supply_by==3?`Caja${i.value.item.pivot.amount!=1?"s":""}`:i.value.item.pivot._supply_by==2?`Docena${i.value.item.pivot.amount!=1?"s":""}`:`Pieza${i.value.item.pivot.amount!=1?"s":""}`),1)]),s("div",xt,[kt,a(I,{dense:"",borderless:"",modelValue:i.value.form.count,"onUpdate:modelValue":t[7]||(t[7]=l=>i.value.form.count=l),type:"number",min:"0","input-class":"text-h6 text-center",ref_key:"iptcounter",ref:K},null,8,["modelValue"])]),s("div",wt,[Vt,a(I,{dense:"",borderless:"",modelValue:i.value.form.ipack,"onUpdate:modelValue":t[8]||(t[8]=l=>i.value.form.ipack=l),type:"number","input-class":"text-h6 text-center",readonly:i.value.item.units.id!=3,disable:i.value.item.units.id!=3},null,8,["modelValue","readonly","disable"])]),s("div",Ct,[Qt,s("div",St,n(i.value.item.pivot._supply_by==3?i.value.form.count*i.value.form.ipack:i.value.item.pivot._supply_by==2?i.value.form.count*12:i.value.form.count),1)])])]),_:1}),a(b,{color:"green-5",type:"submit",square:"",icon:"done_all","no-caps":"",class:"q-mt-md q-py-md full-width"})]),_:1},8,["onSubmit"])]),_:1})):E("",!0)]),_:1},8,["modelValue"]),a(D,{modelValue:z.value.state,"onUpdate:modelValue":t[11]||(t[11]=l=>z.value.state=l)},{default:o(()=>[a($,null,{default:o(()=>[a(f,{class:"row items-start"},{default:o(()=>[a(J,{icon:"warning",color:"orange-14","text-color":"white"}),Et]),_:1}),a(f,{class:"text-subtitle1 text-bold"},{default:o(()=>[Pt,Ut]),_:1}),a(ee,{align:"right"},{default:o(()=>[B(a(b,{flat:"",label:"Canclear",color:"negative",rounded:"","no-caps":""},null,512),[[fe]]),a(b,{flat:"",label:"Emitir Factura",color:"positive",rounded:"",onClick:Ve})]),_:1})]),_:1})]),_:1},8,["modelValue"]),a(D,{modelValue:A.value.state,"onUpdate:modelValue":t[12]||(t[12]=l=>A.value.state=l),persistent:""},{default:o(()=>[a($,{class:"bg-red text-white"},{default:o(()=>[a(f,{class:"row items-center"},{default:o(()=>[a(J,{icon:"signal_wifi_off",color:"primary","text-color":"white"}),s("span",qt,n(A.value.code),1)]),_:1}),a(f,null,{default:o(()=>[s("span",Dt,n(A.value.text),1)]),_:1})]),_:1})]),_:1},8,["modelValue"]),a(D,{modelValue:N.value,"onUpdate:modelValue":t[14]||(t[14]=l=>N.value=l),persistent:""},{default:o(()=>[a($,{style:{width:"400px"}},{default:o(()=>[a(f,{class:"row items-center"},{default:o(()=>[$t]),_:1}),a(f,null,{default:o(()=>[a(re,{modelValue:y.value.val,"onUpdate:modelValue":[t[13]||(t[13]=l=>y.value.val=l),xe],options:y.value.opts,label:"Surtidor","option-label":"_suplier","option-value":"_suplier_id",filled:"","option-disable":l=>!(l._status==4||l._status==5)},{option:o(l=>[a(te,qe(De(l.itemProps)),{default:o(()=>[a(j,null,{default:o(()=>[a(U,null,{default:o(()=>[c(n(l.opt._suplier),1)]),_:2},1024),a(U,{caption:"",lines:"2"},{default:o(()=>[c("Estado: "+n(l.opt.status.name),1)]),_:2},1024)]),_:2},1024)]),_:2},1040)]),_:1},8,["modelValue","options","option-disable"])]),_:1}),a(ee,{align:"right"},{default:o(()=>[B(a(b,{flat:"",label:"Continuar",color:"primary",disable:!y.value.val,onClick:Ce},null,8,["disable"]),[[fe]])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1}),m(oe)?(p(),w(de,{key:0,bordered:"",class:"bg-cyan-10 text-dark q-pa-sm row",elevated:""},{default:o(()=>[a(I,{color:"white",modelValue:k.value,"onUpdate:modelValue":t[16]||(t[16]=l=>k.value=l),type:"text",class:"col","input-class":"text-white text-h6 text-center text-uppercase",autofocus:"",dense:"",onKeypress:$e(ke,["enter"]),ref_key:"iptfinder",ref:le},{prepend:o(()=>[a(W,{name:"fas fa-barcode",color:"white"})]),append:o(()=>[a(b,{flat:"",icon:"fas fa-delete-left",color:"white",onClick:t[15]||(t[15]=l=>k.value=""),disabled:!k.value.length},null,8,["disabled"])]),_:1},8,["modelValue","onKeypress"]),m(S).length>0?(p(),w(b,{key:0,color:"white","text-color":"cyan-9",label:"Terminar",icon:"done",onClick:t[17]||(t[17]=l=>z.value.state=!0),"no-caps":""})):E("",!0)]),_:1})):E("",!0),r.value&&r.value._status!=5?(p(),w(de,{key:1,bordered:"",class:"bg-orange-9 text-white"},{default:o(()=>{var l;return[s("div",It,n((l=r.value)==null?void 0:l.status.name),1)]}),_:1})):E("",!0)]),_:1})]),_:1}))}};export{Ht as default};
