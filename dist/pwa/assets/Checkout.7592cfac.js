import{r as c,c as b,j as se,o as u,b as y,w as o,u as ie,a as ne,d as l,h as g,e as r,aD as p,t as n,f as t,aE as P,i as w,Q as A,aF as L,aG as F,aH as de,aJ as N,au as H,aI as ce,x as ue,R as re}from"./index.08f3e598.js";import{Q as pe,a as ve,b as K}from"./QFooter.b9f8266f.js";import{c as me,u as fe,R as E,d as _e,q as M,f as be,b as ge,Q as he,a as S,s as ye,t as xe,v as R,w as $,x as h,g as ke,y as we,z as G,A as J,B as Ce}from"./QCard.7efc9022.js";import{Q as Qe,C as Ve}from"./ClosePopup.945bad5f.js";import"./dayjs.min.16be2667.js";import"./axios.05577114.js";const De={class:"q-px-md q-py-sm"},qe={class:"col text-dark row justify-between"},je={key:0,class:"row items-center justify-between q-pt-sm"},Pe=t("span",{class:"text--2"},"Por revisar:",-1),Se=t("span",{class:"text--2"},"Revisados:",-1),Ue=t("span",{class:"text--2"},"Agotados:",-1),Ie=t("span",{class:"text--2"},"Con stock:",-1),Ee={class:"full-width row items-center justify-between"},Re={class:"row justify-between"},$e={class:"text-left"},Te={class:"text--3"},Be={class:"text-h6"},ze={class:"text-right"},Ae={class:"text-bold"},Le={class:"text--2"},Fe={class:"text-center"},Ne={class:"text-h6"},He=t("div",{class:"text--2"},"Embalaje (org)",-1),Ke={class:"text-h6"},Me={class:"text--2"},Ge={class:"row items-start justify-between"},Je={class:"text-center col"},Oe=t("div",null,"Solicitud",-1),We={class:"text-bold"},Xe={class:"text-center col"},Ye=t("div",null,"Conteo",-1),Ze={class:"text-center col"},et=t("div",null,"PxC",-1),tt={class:"text-center col"},at=t("div",null,"Piezas",-1),lt={class:"text-bold"},ot=t("div",{class:"q-ml-md"},[t("div",{class:"text-h6"},"Deseas terminar la revision?"),t("div",null,"EL pedido ya no podra editarse")],-1),st={class:"q-ml-sm"},it={class:"q-ml-sm"},nt={class:"q-pa-md text-bold text-uppercase text-center"},ft={__name:"Checkout",setup(dt){const C=ie(),O=ne(),m=fe(),Q=c([]),d=c([]),x=c(""),U=c(null),T=c(null),v=c(null),f=c({columns:[{name:"id",label:"ID",field:"id",align:"left",coldesc:"Identificador del producto (MySQL)"},{name:"code",label:"Codigo",field:"code",align:"left",coldesc:"Codigo principal del producto"},{name:"assocs",label:"Asociados",field:e=>e.variants.length?e.variants.map(a=>a.barcode).join(", "):null,align:"left",coldesc:"Codigos relacionados al codigo principal"},{name:"bcode",label:"Codigo de Barras",field:"barcode",align:"center",coldesc:"Codigo de barras principal"},{name:"locs",label:"Ubicacion",field:e=>e.locations.length?e.locations.map(a=>a.path).join(", "):"--",align:"left",coldesc:"Ubicaciones en almacen general"},{name:"ipack",label:"PxC",field:e=>typeof e.pivot.ipack=="number"?e.pivot.ipack:e.pieces,align:"center",coldesc:"Unidades x Embalaje"},{name:"request",label:"Solicitud",field:e=>e.pivot.amount,align:"center",coldesc:"Embalaje solicitado"},{name:"uspply",label:"Unidad",field:e=>e.units.id==3?"Cajas":"Piezas",align:"left",coldesc:"Unidad de embalaje del producto"},{name:"delivery",label:"Conteo",field:e=>e.pivot.toDelivered,align:"center",coldesc:"Embalaje surtido",sortable:!0},{name:"reqinpzs",label:"Piezas",field:e=>e.pivot._supply_by==3?(typeof e.pivot.ipack=="number"?e.pivot.ipack:e.pieces)*(typeof e.pivot.ipack=="number"?e.pivot.toDelivered:e.pivot.amount):typeof e.pivot.ipack=="number"?e.pivot.toDelivered:e.pivot.amount,align:"center",coldesc:"Unidades totales en embalaje"},{name:"checkout",label:"Checkout",field:e=>e.pivot.checkout?"OK":null,classes:e=>e.pivot.checkout?"text-positive text-bold":"",align:"center",coldesc:"Revision del Administrador"},{name:"descr",label:"Descripcion",field:"description",align:"left"},{name:"section",label:"Seccion",field:"section",align:"left"},{name:"family",label:"Familia",field:"family",align:"left"},{name:"category",label:"Categoria",field:"category",align:"left"}],filter:"",pagination:{sortBy:"locs",descending:!1,rowsPerPage:20}}),s=c({state:!1,item:null,form:{count:0,ipack:null,setting:!1}}),V=c({state:!1,code:null,text:null}),D=c({state:!1}),B=b(()=>v.value?v.value.id==3:!1),W=b(()=>d.value.reduce((e,a)=>e+(a.pivot._supply_by==3?a.pivot.amount*a.pieces:a.pivot.amount),0)),X=b(()=>d.value.filter(e=>!e.pivot.checkout)),q=b(()=>d.value.filter(e=>e.pivot.checkout)),Y=b(()=>q.value.filter(e=>e.pivot.toDelivered==0)),Z=b(()=>q.value.filter(e=>e.pivot.toDelivered>0)),j=b(()=>{let e=x.value.toUpperCase().trim();return e.length?d.value.filter(a=>a.code.match(e)||a.barcode&&a.barcode.match(e)):d.value}),I=async()=>{m.loading.show({message:"Cargando..."}),console.log("Iniciando...");const e=await E.order(C.params.oid);console.log(e),e.status==200?(d.value=e.data.products,v.value=e.data.status,m.loading.hide()):displayErrRequest(e)},ee=(e,a,i)=>B.value?z(a):null,z=e=>{s.value.item=e,s.value.form.count=typeof e.pivot.toDelivered=="number"?e.pivot.toDelivered:0,s.value.form.ipack=typeof e.pivot.ipack=="number"?e.pivot.ipack:e.pieces,s.value.state=!0,ue(()=>{U.value.focus(),U.value.select()})},te=()=>{let e=x.value.toUpperCase().trim();if(e.length){let a=j.value.length==1?j.value[0]:j.value.find(i=>i.code==e||i.barcode==e);a?z(a):m.notify({message:`Sin coincidencias para <b>${e}</b>`,color:"pink-5",position:"center",html:!0})}},ae=async()=>{const e=parseInt(s.value.form.count),a=parseInt(s.value.form.ipack),i={order:C.params.oid,product:s.value.item.id,delivery:e,ipack:a,checkout:!0},_=await E.setDeliveryProduct(i);if(console.log(_),_.status==200){console.log(_.data);let k=d.value.findIndex(oe=>oe.id==s.value.item.id);d.value[k].pivot.toDelivered=e,d.value[k].pivot.ipack=a,d.value[k].pivot.checkout=1,s.value.state=!1,x.value="",m.notify({color:"positive",icon:"done",position:"right",message:""})}else alert(`Error ${_.status}: ${_.data}`)},le=async()=>{m.loading.show({message:"Terminando, espera..."}),D.value.state=!1;let e={id:C.params.oid,state:6};const a=await E.nextState(e);console.log(a),a.status==200&&I(),m.loading.hide()};return se(()=>{Q.value=m.screen.xs?["code","request","uspply","delivery"]:f.value.columns.map(e=>e.name)}),I(),(e,a)=>(u(),y(me,{view:"hHh Lpr fFf"},{default:o(()=>[l(be,{bordered:"",class:"bg-white text-dark"},{default:o(()=>[l(_e,null,{default:o(()=>[l(g,{flat:"",round:"",dense:"",icon:"arrow_back",onClick:a[0]||(a[0]=i=>{r(O).replace("/checkout")})}),l(pe,null,{default:o(()=>[p(" Pedido "+n(r(C).params.oid),1)]),_:1}),l(g,{color:"pink-5",icon:"sync",onClick:I,round:"",dense:"",flat:""})]),_:1}),l(M),t("div",De,[t("div",qe,[t("div",null,[p("Productos: "),t("b",null,n(d.value.length),1)]),t("div",null,[p("Piezas: "),t("b",null,n(r(W)),1)])]),v.value&&v.value.id>=3?(u(),P("div",je,[t("div",null,[Pe,p(),t("b",null,n(r(X).length),1)]),t("div",null,[Se,p(),t("b",null,n(r(q).length),1)]),t("div",null,[Ue,p(),t("b",null,n(r(Y).length),1)]),t("div",null,[Ie,p(),t("b",null,n(r(Z).length),1)])])):w("",!0)])]),_:1}),l(ke,null,{default:o(()=>[l(ge,{padding:""},{default:o(()=>[l(he,{"row-key":"id",flat:"",rows:r(j),columns:f.value.columns,pagination:f.value.pagination,filter:f.value.filter,"visible-columns":Q.value,onRowClick:ee},{top:o(()=>[t("div",Ee,[l(S,{dense:"",modelValue:f.value.filter,"onUpdate:modelValue":a[1]||(a[1]=i=>f.value.filter=i),placeholder:"Buscar","input-class":"text-uppercase",color:"pink-5"},{append:o(()=>[l(A,{name:"search"})]),_:1},8,["modelValue"]),l(g,{color:"secondary",icon:"fas fa-eye","no-caps":""},{default:o(()=>[l(ye,{style:{"min-width":"200px"}},{default:o(()=>[l(xe,null,{default:o(()=>[(u(!0),P(F,null,L(f.value.columns,(i,_)=>H((u(),y(we,{tag:"label",key:_},{default:o(()=>[l(G,null,{default:o(()=>[l(J,null,{default:o(()=>[p(n(i.label),1)]),_:2},1024),l(J,{caption:""},{default:o(()=>[p(n(i.coldesc),1)]),_:2},1024)]),_:2},1024),l(G,{side:"",top:""},{default:o(()=>[l(Ce,{color:"pink-5",modelValue:Q.value,"onUpdate:modelValue":a[2]||(a[2]=k=>Q.value=k),val:i.name},null,8,["modelValue","val"])]),_:2},1024)]),_:2},1024)),[[re]])),128))]),_:1})]),_:1})]),_:1})])]),_:1},8,["rows","columns","pagination","filter","visible-columns"]),l(R,{modelValue:s.value.state,"onUpdate:modelValue":a[5]||(a[5]=i=>s.value.state=i),position:"bottom",onHide:a[6]||(a[6]=i=>T.value.focus())},{default:o(()=>[s.value.item?(u(),y($,{key:0},{default:o(()=>[l(h,null,{default:o(()=>[t("div",Re,[t("div",$e,[t("div",Te,"ID: "+n(s.value.item.id),1),t("div",Be,n(s.value.item.code),1)]),t("div",ze,[t("div",Ae,n(s.value.item.name),1),t("div",Le,n(s.value.item.barcode),1)])])]),_:1}),l(M),l(h,null,{default:o(()=>[p(n(s.value.item.description),1)]),_:1}),l(h,{class:"row justify-around items-center"},{default:o(()=>[t("div",Fe,[t("div",Ne,n(s.value.item.pieces),1),He]),(u(!0),P(F,null,L(s.value.item.stocks,i=>(u(),P("div",{key:i.id,class:"text-center"},[t("div",Ke,n(i.pivot.gen),1),t("div",Me,n(i.alias),1)]))),128))]),_:1}),l(ve,{onSubmit:de(ae,["prevent"])},{default:o(()=>[l(h,null,{default:o(()=>[t("div",Ge,[t("div",Je,[Oe,t("div",We,n(s.value.item.pivot.amount)+" "+n(s.value.item.units.id==3?`Caja${s.value.item.pivot.amount!=1?"s":""}`:`Pieza${s.value.item.pivot.amount!=1?"s":""}`),1)]),t("div",Xe,[Ye,l(S,{dense:"",borderless:"",modelValue:s.value.form.count,"onUpdate:modelValue":a[3]||(a[3]=i=>s.value.form.count=i),type:"number",min:"0","input-class":"text-h6 text-center",ref_key:"iptcounter",ref:U},null,8,["modelValue"])]),t("div",Ze,[et,l(S,{dense:"",borderless:"",modelValue:s.value.form.ipack,"onUpdate:modelValue":a[4]||(a[4]=i=>s.value.form.ipack=i),type:"number","input-class":"text-h6 text-center",readonly:s.value.item.units.id!=3,disable:s.value.item.units.id!=3},null,8,["modelValue","readonly","disable"])]),t("div",tt,[at,t("div",lt,n(s.value.item.units.id==3?s.value.form.count*s.value.form.ipack:s.value.form.count),1)])])]),_:1}),l(g,{color:"green-5",type:"submit",square:"",icon:"done_all","no-caps":"",class:"q-mt-md q-py-md full-width"})]),_:1},8,["onSubmit"])]),_:1})):w("",!0)]),_:1},8,["modelValue"]),l(R,{modelValue:D.value.state,"onUpdate:modelValue":a[7]||(a[7]=i=>D.value.state=i)},{default:o(()=>[l($,null,{default:o(()=>[l(h,{class:"row items-start"},{default:o(()=>[l(N,{icon:"warning",color:"orange-14","text-color":"white"}),ot]),_:1}),l(Qe,{align:"right"},{default:o(()=>[H(l(g,{flat:"",label:"No",color:"primary","no-caps":""},null,512),[[Ve]]),l(g,{flat:"",label:"Si",color:"primary",onClick:le})]),_:1})]),_:1})]),_:1},8,["modelValue"]),l(R,{modelValue:V.value.state,"onUpdate:modelValue":a[8]||(a[8]=i=>V.value.state=i),persistent:""},{default:o(()=>[l($,{class:"bg-red text-white"},{default:o(()=>[l(h,{class:"row items-center"},{default:o(()=>[l(N,{icon:"signal_wifi_off",color:"primary","text-color":"white"}),t("span",st,n(V.value.code),1)]),_:1}),l(h,null,{default:o(()=>[t("span",it,n(V.value.text),1)]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1}),r(B)?(u(),y(K,{key:0,bordered:"",class:"bg-cyan-10 text-dark q-pa-sm row",elevated:""},{default:o(()=>[l(S,{color:"white",modelValue:x.value,"onUpdate:modelValue":a[9]||(a[9]=i=>x.value=i),type:"text",class:"col","input-class":"text-white text-h6 text-center text-uppercase",autofocus:"",dense:"",onKeypress:ce(te,["enter"]),ref_key:"iptfinder",ref:T},{prepend:o(()=>[l(A,{name:"fas fa-barcode",color:"white"})]),_:1},8,["modelValue","onKeypress"]),r(q).length>0?(u(),y(g,{key:0,color:"white","text-color":"cyan-9",label:"Terminar",icon:"done",onClick:a[10]||(a[10]=i=>D.value.state=!0),"no-caps":""})):w("",!0)]),_:1})):w("",!0),v.value&&v.value.id!=3?(u(),y(K,{key:1,bordered:"",class:"bg-orange-9 text-white"},{default:o(()=>[t("div",nt,n(v.value.name),1)]),_:1})):w("",!0)]),_:1})]),_:1}))}};export{ft as default};
